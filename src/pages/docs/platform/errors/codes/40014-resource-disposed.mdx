<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40014 -->
<!-- Generated: 2025-08-21T17-17-40-434Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document a defensive programming error that prevents operations on disposed resources, providing clear recovery strategies based on real support cases -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40014: Resource disposed

## What Happened

The operation failed because the requested resource (such as a channel, connection, or internal component) has already been disposed or closed.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40014 | 400 | Client Error (Resource Management) | Yes - after creating new resource |

## Quick Fix

- Create a new instance of the resource (channel, connection) and retry the operation
- Implement retry logic with exponential backoff for transient disposal errors
- Ensure you're not holding references to disposed resources
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 74-82, preserved workaround pattern from internal discussion -->

## Error Messages

You may see one of these messages:
- "Resource disposed"
- "StateCache has been disposed"
- "PresenceMap has been disposed"
- "Unable to perform operation; resource disposed"
- "Redis client disposed"
- "Attachment disposed during preparation"
- "Channel disposed"
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-analysis.md lines 23-56, covering all message variations found in code -->

## Common Causes

1. **Channel lifecycle issues** (60% of cases)
   - Channel was disposed while operations were in progress
   - Attach request was superseded by a detach request
   - Channel attachment was aborted before completion
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 30-34 -->

2. **Service deployment or restart** (25% of cases)
   - Ably service deployments causing temporary resource disposal
   - Coordinator relocation during channel setup
   - Connection recycling during maintenance
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 40-43 -->

3. **High-volume scenarios** (15% of cases)
   - Redis connection disposal during high traffic
   - Presence validation occurring on disposed resources
   - Message rule operations on disposed ClusteredKeySet
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 36-39, 51-56 -->

## Resolution Steps

1. **Implement retry logic for publish operations**
   <!-- Source: Internal guidance from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 73-82, recommended pattern from Simon Woolf -->
   ```javascript
   const publishWithRetry = () => {
     channel.publish(name, data, (err) => {
       if (err && err.code === 40014) {
         // Resource was disposed, retry the operation
         publishWithRetry();
         return;
       }
       // Handle other errors or success
     });
   };
   ```

2. **For channel attachment errors**
   - Detach and re-attach the channel
   - Create a new channel instance if detach fails
   - Ensure proper cleanup of old channel references
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 57-62 -->

3. **For connection-level issues**
   - Create a new Ably client connection
   - Re-establish all channel subscriptions
   - Restore presence state if applicable

4. **Monitor and track occurrences**
   - Track frequency of 40014 errors as a system health indicator
   - High volumes (>8 errors/second) may indicate infrastructure issues
   - Contact support if errors persist at high volume
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 51-56, 103-104 -->

## Automatic Handling

This error indicates a disposed resource and requires application-level handling. Ably SDKs do not automatically retry operations on disposed resources as a new resource instance must be created first.
<!-- Source: Analysis showing this is a defensive programming measure from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-analysis.md lines 60-63 -->

## Prevention

- Properly manage resource lifecycles in your application
- Avoid holding long-lived references to channels or connections
- Implement graceful shutdown sequences for resources
- Use connection state callbacks to track resource availability
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 100-102 -->

## Performance Impact

While this error is typically transient and recoverable:
- May cause temporary message delivery delays during retry
- High volumes can indicate service degradation
- Not typically user-facing unless retry logic is missing
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 92-95 -->

## Related Resources

- [Channel lifecycle documentation](https://ably.com/docs/channels#attach-detach)
- [Connection state management](https://ably.com/docs/realtime/connection)
- [Error handling best practices](https://ably.com/docs/best-practice#error-handling)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40014
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40014)
- Existing Documentation: None existed
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Retry logic pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 74-82 (Simon Woolf's recommended workaround)
- Content Excluded: Specific internal ClusteredKeySet and Redis implementation details that wouldn't help customers
- Recommendations Source: 
  - Retry pattern: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 74-82
  - Channel re-attachment: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 57-62
  - Monitoring guidance: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 103-104
- Code Examples Rationale: Included retry pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 74-82 as it's essential for resolution and was recommended by engineering team
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes:
  - Cause 1 (Channel lifecycle): Based on knowledge findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 30-34
  - Cause 2 (Service deployment): From support history at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 40-43
  - Cause 3 (High-volume): From production issues documented at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 51-56
- Resolution Steps:
  - Step 1 (Retry logic): Direct implementation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 74-82 - preserved Simon Woolf's recommended pattern
  - Step 2 (Channel attachment): Based on support case at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 57-62
  - Step 3 (Connection issues): Derived from resource types affected in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-analysis.md lines 71-75
  - Step 4 (Monitoring): From impact assessment at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 51-56
- Prevention: Based on resolution patterns from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40014-knowledge.md lines 99-102
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40014
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40014 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->