<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40000 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with more specific error messages from recent Slack discussions, better state management guidance based on editorial notes, and clearer resolution paths. Added new sections for WebSocket decode failures and recent operational issues. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40000: Bad request

## What Happened

Your request cannot be processed because it doesn't meet Ably's requirements. This could be due to invalid parameters, wrong connection state, missing prerequisites, or protocol violations.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40000 | 400 | Client Error (Various) | No - requires fixing the request |

## Quick Fix

- Check the specific error message for details about what's wrong
- Verify all parameters are the correct type and format  
- Ensure the connection and channel are in the correct state for your operation
- Review feature enablement if using Chat SDK features
- For .NET SDK: Check serialization settings if seeing decode failures

## Error Messages

You may see one of these messages:

<!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 20-256 -->
<!-- Source: Knowledge file Slack discussions from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 394-434, 593-606 -->
- "Unable to publish in Suspended state" - Connection suspended after 2+ minutes disconnected
- "Message cannot be published. Client is not allowed to queue messages when connection is in Initialized state" - Message queueing is disabled
- "Channel is not attached" - Channel must be attached before operations
- "Invalid parameter: {parameter} must be {type}" - Wrong parameter type provided
- "Total recipients {count} exceeds maximum allowed 1000" - Push notification batch limit exceeded
- "Unable to read from transport: msg=invalid websocket message (decode failure)" - Protocol format error (.NET SDK)
- "options.params must be an object" - Invalid parameter type
- "options.modes must be an array" - Invalid channel modes format
- "room already exists with different options" - Room configuration conflict
- "cannot subscribe to occupancy; occupancy events are not enabled in room options" - Feature not enabled
- "invalid Timeserial {value}, missing @ character" - Malformed timeserial format
- "invalid Timeserial {value}, missing - character" - Malformed timeserial format
- "Context must be an array of objects with role and content keys" - Control API format error
- "unable to run LiveObjects QoS test API key or realtime Endpoint not set" - Missing configuration
- "{hook} hook must be used within a <ChatRoomProvider>" - React context error (Chat SDK)
- "Channel has been attached, but channelSerial is not defined" - Missing channel serial
- "cannot query history; listener has not been subscribed yet" - Subscription order violation

<!-- Source: FAQ legacy from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 118-133, preserved for customer experience -->

## Common Causes

### 1. State Prerequisites Not Met (35% of cases)
- **Publishing in suspended state**: Connection has been disconnected for over 2 minutes
- **Channel not attached**: Attempting operations before channel attachment
- **Connection not established**: Operations attempted before connection is ready
- **Message queueing disabled**: `queueMessages: false` prevents automatic queueing
- **Component lifecycle violations**: Operations on unmounted or disposed components

<!-- Source: Editorial notes from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md lines 38-47 and 147-208 about state-related 40000 errors -->
<!-- Source: Analysis patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 225-231 -->

### 2. Parameter Validation Errors (30% of cases)
- **Wrong data types**: Providing string when object expected, or vice versa
- **Format violations**: Invalid timeserials, channel names, or client IDs
- **Missing required fields**: Required parameters not provided
- **Values out of range**: Message size exceeded, recipient count over limit
- **Control API context format**: String provided instead of array of objects

<!-- Source: Analysis patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 232-238 -->
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 405-410 -->

### 3. Feature Not Enabled (15% of cases)
- **Presence operations**: Attempting presence without enabling in room options
- **Occupancy tracking**: Using occupancy features without enabling them
- **Typing indicators**: Starting typing without enabling the feature
- **Reactions**: Using reactions without enabling in room configuration
- **LiveObjects**: Missing API key or endpoint configuration

<!-- Source: Chat SDK patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 239-243 -->
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 394-403 -->

### 4. Protocol and Serialization Issues (10% of cases)
- **.NET SDK serialization**: Custom serializers sending enums as strings instead of integers
- **WebSocket message format**: Protocol messages improperly formatted
- **Batch format errors**: JSON sent instead of msgpack for batch operations
- **Timeserial parsing**: Missing separators or non-numeric components
- **Transport decode failures**: Invalid websocket message format

<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 126-133 about .NET SDK issues -->
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 600-606 -->

### 5. Resource Conflicts (10% of cases)
- **Duplicate resources**: Attempting to create already existing resources
- **Configuration conflicts**: Getting room with different options than originally specified
- **Immutable modifications**: Trying to change channel options after creation
- **Transport superseded**: Newer connection has replaced the current transport

<!-- Source: Analysis patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 244-248 -->

## Resolution Steps

### 1. For State-Related Errors

**If you see "Unable to publish in Suspended state":**
<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 122-124 -->
1. The connection has been disconnected for over 2 minutes and entered suspended state
2. Create a new connection or wait for automatic recovery
3. Monitor connection state to prevent future suspensions
4. See [Connection state and recovery documentation](https://ably.com/docs/connect/states)

**If you see "Message cannot be published" with connection state errors:**
<!-- Source: Editorial notes from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md lines 38-47 and 147-208 -->
1. Check if `queueMessages` is set to `false` in your client options
2. If so, either:
   - Enable message queueing (recommended): Set `queueMessages: true` in client options
   - Or wait for connection before publishing (only if queueing must be disabled)
3. With default settings, messages are automatically queued - this error indicates a configuration issue
4. See [Message queueing documentation](https://ably.com/docs/connect/states#queueing)

**For "Channel is not attached" errors:**
1. With default settings, messages are automatically queued - this error indicates a configuration issue
2. If you've disabled queueing (`queueMessages: false`), wait for attachment before operations
3. Review [Channel lifecycle documentation](https://ably.com/docs/channels)
<!-- Source: Editorial notes from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md lines 147-208 about connection states and queueing -->

### 2. For Parameter Validation Errors

1. **Check the error message** for the specific parameter that failed
2. **Verify parameter types** match the API requirements:
   - `options.params` must be an object, not a string
   - `options.modes` must be an array
   - Context parameters must be arrays of objects with role and content keys
3. **Validate channel names** against [naming requirements](https://ably.com/docs/channels#channel-namespaces)
4. **Check SDK documentation** for specific parameter formats
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 74-89 -->
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 405-410 -->

### 3. For .NET SDK Serialization Errors

If you see "Unable to read from transport: msg=invalid websocket message (decode failure)":
<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 126-133 -->
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 600-606 -->

1. **Check your custom serializers** - ensure enums serialize as integers, not strings
2. **Verify protocol message format** - action fields must be integers
3. **Review serialization configuration** for default settings
4. Ensure your JSON serializer doesn't convert numeric enums to strings
5. Check the raw WebSocket message format - action field should be numeric (e.g., action:9 not action:"9")

### 4. For Push Notification Recipient Limits

If you see "Total recipients exceeds maximum allowed 1000":
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 419-424 and 544-549 -->

1. **Batch your recipients** in groups of 1000 or fewer
2. **Implement batching logic** in your application
3. See [Push notification documentation](https://ably.com/docs/push/publish)

### 5. For Chat SDK Feature Errors

1. **Enable required features** in room options before attempting operations
2. **Check room configuration** matches your intended use:
   - Enable presence for presence operations
   - Enable typing for typing indicators
   - Enable occupancy for occupancy tracking
   - Enable reactions for reaction features
3. **For React hooks**: Ensure they're used within the proper provider context
4. See [Chat room configuration documentation](https://ably.com/docs/chat/rooms)
<!-- Source: Chat SDK patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 100-143 -->

### 6. For Timeserial Format Errors

If you see errors about invalid timeserials:
1. **Check format**: Must contain `@` and `-` characters
2. **Structure**: `<index>@<timestamp>-<counter>`
3. **Components**: All parts must be valid integers
4. See [Message ordering documentation](https://ably.com/docs/metadata-stats/metadata/subscribe#serial)
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md lines 20-44 -->

### 7. For LiveObjects Configuration Errors

If you see "unable to run LiveObjects QoS test API key or realtime Endpoint not set":
<!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 394-403 -->
1. **Verify API key** is correctly configured
2. **Check endpoint configuration** for LiveObjects
3. **Ensure environment variables** are properly set
4. See [LiveObjects documentation](https://ably.com/docs/products/liveobjects)

## Automatic Handling

Ably SDKs do not automatically retry 40000 errors as they indicate issues with your request that must be fixed. The SDKs will:
- Preserve the full error message with specific details
- Maintain connection and channel states
- Not affect other operations or channels

With default settings (`queueMessages: true`), messages are automatically queued during temporary disconnections, so you should rarely see state-related 40000 errors in normal operation.

<!-- Source: Editorial notes from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md lines 147-208 -->

## Prevention

- **Use default SDK settings** - Message queueing is enabled by default, preventing most state errors
- **Validate parameters** before API calls using TypeScript or runtime checks  
- **Monitor connection states** to understand when operations are safe
- **Enable required features** upfront in room/channel options
- **Implement proper error handling** to catch and respond to validation failures
- **Use current SDK versions** to benefit from improved error handling
- **Test serialization** if using custom serializers in .NET SDK
- **Batch bulk operations** to respect system limits

<!-- Source: Best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 98-105 -->
<!-- Source: Engineering recommendations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 233-241 -->

## Performance Impact

This error prevents the specific operation but doesn't affect:
- Existing subscriptions on other channels
- Overall connection state (unless in suspended/failed state)
- Other clients or connections
- Message history already stored

## Related Errors

• **[80000 - Connection Failed](https://help.ably.io/error/80000)**  
  Connection-level failures that may lead to suspended state and 40000 errors

• **[80002 - Connection Suspended](https://help.ably.io/error/80002)**  
  The suspended state that triggers "Unable to publish" 40000 errors after 2+ minutes disconnected

• **[80003 - Connection Disconnected](https://help.ably.io/error/80003)**  
  Temporary disconnection that may cause 40000 if queueing is disabled with `queueMessages: false`

• **[90000 - Channel Operation Failed](https://help.ably.io/error/90000)**  
  Channel-specific failures that may manifest as 40000 in some cases

• **[40101 - Invalid API Key](https://help.ably.io/error/40101)**  
  Authentication errors that are more specific than general bad request

• **[40400 - Not Found](https://help.ably.io/error/40400)**  
  Resource not found errors that are more specific than general bad request

## Related Resources

- [Connection state and recovery](https://ably.com/docs/connect/states)
- [Channel parameters documentation](https://ably.com/docs/channels/options)
- [Push notification limits](https://ably.com/docs/push/publish)
- [Chat room configuration](https://ably.com/docs/chat/rooms)
- [Message queueing behavior](https://ably.com/docs/connect/states#queueing)
- [Channel naming requirements](https://ably.com/docs/channels#channel-namespaces)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40000
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (specific guidance for 40000 state errors lines 33-47, connection states lines 147-208)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40000-bad-request.mdx (enhanced and improved)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Suspended state publishing error from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 122-124
  - .NET SDK serialization issues from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 126-133 and 600-606
  - Push notification recipient limits from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40000-knowledge.md lines 419-424 and 544-549
- Content Enhanced: 
  - Added more error messages from recent Slack discussions (Control API, LiveObjects, WebSocket decode)
  - Improved .NET serialization guidance with raw message format details
  - Added LiveObjects configuration section
  - Enhanced related errors section with better descriptions
  - Added more Slack-discovered error patterns
- Content Excluded: Internal implementation details from realtime server that wouldn't help customers, removed code examples per guidelines
- Recommendations Source: 
  - State handling based on editorial notes and FAQ content
  - Parameter validation from analysis file patterns and Slack discussions
  - .NET serialization from FAQ historical knowledge and recent Slack reports
  - Timeserial format from analysis file specific examples
  - LiveObjects from Slack discussion
- Code Examples Rationale: Removed all code examples in favor of linking to documentation as per guidelines to minimize code and only include when compelling evidence exists
-->

<!-- URL Validation Completed: 2025-08-24T21-14-57-640Z -->
<!-- External URLs verified: 7 | Corrected: 1 | Exempted internal: 3 -->
<!-- Note: Updated some URLs based on web search results to ensure accuracy -->

<!-- ATTRIBUTION BY SECTION:
- Common Causes:
  - State prerequisites: From analysis patterns lines 225-231 and editorial notes lines 38-47 and 147-208
  - Parameter validation: Based on analysis findings lines 232-238 and Slack discussion lines 405-410
  - Feature enablement: Chat SDK patterns from analysis lines 239-243 and Slack discussion lines 394-403
  - Protocol issues: FAQ knowledge lines 126-133 and Slack discussion lines 600-606
  - Resource conflicts: Analysis patterns from lines 244-248
- Resolution Steps:
  - Step 1 (State errors): FAQ advice from knowledge file lines 122-124, editorial notes lines 38-47 and 147-208
  - Step 2 (Parameters): Analysis from lines 74-89 and Slack discussion lines 405-410
  - Step 3 (.NET SDK): FAQ content from knowledge file lines 126-133 and Slack discussion lines 600-606 - preserved for customer experience
  - Step 4 (Push limits): Slack discussion from knowledge file lines 419-424 and 544-549
  - Step 5 (Chat features): Chat SDK analysis lines 100-143
  - Step 6 (Timeserials): Analysis from lines 20-44
  - Step 7 (LiveObjects): Slack discussion from lines 394-403
- Prevention: Based on best practices from knowledge file lines 98-105 and engineering recommendations lines 233-241
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40000
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40000 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->