<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40008 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document a server-side validation error for Content-Length mismatches in HTTP requests -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40008: Invalid content length

## What Happened

The request body size doesn't match the Content-Length header value declared in your HTTP request.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40008 | 400 | Client Error (Request Validation) | No - requires fixing the request |

## Quick Fix

- Ensure your HTTP client properly calculates the Content-Length header
- Check that your request body matches the declared content length exactly
- Consider using chunked transfer encoding for streaming data

## Error Messages

You may see this message:
- "Invalid content length"

## Common Causes

1. **Mismatched Content-Length header** (most common)
   - The Content-Length header value doesn't match the actual request body size
   - Data was truncated or expanded during transmission
   - Client incorrectly calculated the content length

2. **HTTP client issues**
   - Proxy or middleware modifying the request body
   - Network issues causing partial data transmission
   - Encoding problems changing the byte size

3. **Manual header setting**
   - Manually setting Content-Length without proper byte calculation
   - Character encoding differences affecting byte count

## Resolution Steps

1. **Let your HTTP client handle Content-Length automatically**
   <!-- Source: Best practice from analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md lines 33-44 -->
   - Most HTTP clients automatically calculate and set the Content-Length header
   - Avoid manually setting this header unless necessary

2. **If manually setting Content-Length, ensure accurate byte counting**
   <!-- Source: Common issue identified from analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md lines 26-31 -->
   - Calculate the exact byte length of your request body
   - Be aware that character count may differ from byte count with multi-byte characters
   - Test with various payload sizes to ensure correct calculation

3. **Consider using chunked transfer encoding for dynamic content**
   <!-- Source: Alternative approach based on related error 40009 mentioned at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md line 54 -->
   - For streaming or dynamically generated content, use Transfer-Encoding: chunked
   - This eliminates the need to know content size in advance

4. **Check for intermediate proxies or middleware**
   - Verify that no proxy servers are modifying your request
   - Ensure any middleware isn't altering the request body after Content-Length is set

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the Content-Length mismatch before the request will succeed.

## Prevention

- Use well-established HTTP client libraries that handle headers automatically
- Avoid manually setting Content-Length headers
- For custom implementations, thoroughly test byte counting logic
- Monitor for this error in production to catch edge cases

## Related Resources

- [Ably REST API documentation](https://ably.com/docs/api/rest-api)
- [HTTP request limits](https://ably.com/docs/general/limits#http)
- Related error: 40009 (Max content length exceeded)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40008
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40008)
- Existing Documentation: None existed
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No FAQ content was available for this error
- Content Excluded: None
- Recommendations Source: 
  - Step 1: Best practice for HTTP client usage
  - Step 2: Based on error trigger condition from analysis lines 26-31
  - Step 3: Alternative approach based on related error mentioned in analysis
  - Step 4: Common troubleshooting for HTTP issues
- Code Examples Rationale: No code examples included as this is a low-level HTTP protocol error best handled by HTTP client libraries
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on error implementation in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md lines 26-31
  - Cause 2: General HTTP troubleshooting patterns
  - Cause 3: Common developer mistake with Content-Length
- Resolution Steps: 
  - Step 1: Best practice for HTTP client usage
  - Step 2: Based on the validation logic at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md lines 33-44
  - Step 3: Alternative mentioned in relation to error 40009 at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40008-analysis.md line 54
  - Step 4: Standard HTTP debugging approach
- Prevention: Based on understanding of the error trigger from analysis
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40008
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40008 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->