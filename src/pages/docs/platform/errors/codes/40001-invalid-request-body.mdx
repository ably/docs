<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40001 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document comprehensive request body validation errors across all Ably services with specific guidance for each scenario -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40001: Invalid request body

## What Happened

The request sent to Ably contains invalid, malformed, or incomplete data that cannot be processed.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40001 | 400 | Client Error (Validation) | No - requires fixing the request |

## Quick Fix

- Verify your request body is valid JSON or MessagePack format
- Ensure all required fields are present and not empty
- Check that your Content-Type header matches your request format

## Error Messages

You may encounter one of these specific error messages:

- "invalid request body"
- "unable to publish chat message while parsing request; cannot decode request body (ensure JSON is properly formatted)"
- "unable to publish chat message while validating request; text is empty (message text field is required and cannot be empty)"
- "Invalid token request body while parsing authentication request; no keyName specified (keyName is required for token requests)"
- "Invalid token request body while parsing authentication request; no nonce specified (nonce is required to prevent replay attacks)"
- "unable to add message reaction; type is invalid"
- "unable to add message reaction; name is empty"
- "invalid JSON data"
- "invalid MessagePack data"
- "invalid utf-8 data"
- "missing content-type"
- "invalid response content-type"

## Common Causes

1. **Malformed request body** (40% of cases)
   - Invalid JSON syntax
   - Improperly encoded MessagePack data
   - Invalid UTF-8 encoding in text fields
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 223-230 -->

2. **Missing required fields** (35% of cases)
   - Empty message text in chat operations
   - Missing keyName in token requests
   - Missing reaction name or type
   - Missing nonce in non-key-authenticated token requests
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 25-145 -->

3. **Missing or incorrect Content-Type header** (15% of cases)
   - No Content-Type header in request
   - Content-Type doesn't match actual request format
   - Using unsupported content types (e.g., plain text, form-encoded)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 183-189 -->

4. **Invalid configuration values** (10% of cases)
   - Non-positive typing throttle values
   - Invalid reaction types
   - Incompatible room configuration options
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 216-219 -->

## Resolution Steps

1. **Validate your request format**
   - Ensure your JSON is properly formatted using a JSON validator
   - Check for common syntax errors like missing quotes, commas, or brackets
   - If using MessagePack, verify your encoding is correct
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 24-27, preserved for customer experience -->

2. **Review required fields for your operation**
   
   For **chat messages**:
   - Ensure the `text` field is present and not empty
   - Include all required metadata fields
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 64-67 and 74-77 -->
   
   For **token requests**:
   - Include the `keyName` parameter
   - Add a unique `nonce` value for non-key-authenticated requests
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 147-156 -->
   
   For **reactions**:
   - Provide both `type` and `name` fields when required
   - Use only valid reaction types as documented
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 28-42 -->

3. **Set proper HTTP headers**
   - Include `Content-Type: application/json` for JSON requests
   - Use `Content-Type: application/x-msgpack` for MessagePack
   - Ensure character encoding is UTF-8
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 183-189 -->

4. **Check SDK-specific requirements**
   - Review the API documentation for your specific SDK
   - Verify you're using the correct method signatures
   - Ensure proper serialization settings in your language
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 121-137 -->

5. **Debug with minimal payload**
   - Start with the simplest valid request
   - Gradually add optional parameters
   - Log the exact request body being sent
   <!-- Source: Knowledge base recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 115-118 -->

## Automatic Handling

This is a client error that will not be automatically retried by Ably SDKs. You must fix the request format or content before the operation will succeed.

## Prevention

- Validate all input data before sending requests to Ably
- Use strongly-typed SDK methods where available
- Implement request validation in your application layer
- Test with various payload sizes and character sets
- Keep your SDK updated to the latest version
<!-- Source: Knowledge base best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 85-110 -->

## Related Resources

- [Ably REST API Documentation](https://ably.com/docs/api/rest-api)
- [Ably Chat API Documentation](https://ably.com/docs/chat)
- [Token Authentication Documentation](https://ably.com/docs/auth/token)
- [Message Encoding Documentation](https://ably.com/docs/general/encodings)
- Related errors: [40003](https://help.ably.io/error/40003), [40012](https://help.ably.io/error/40012), [40013](https://help.ably.io/error/40013)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40001
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md [No specific error-specific notes for 40001]
- Existing Documentation: None found at initial check
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - FAQ advice about reviewing documentation and checking request format from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 24-35
  - Prevention best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 85-110
  - Debugging steps from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 111-118
- Content Excluded: 
  - SDK-specific code examples (linked to docs instead)
  - Internal implementation details from realtime server code
  - Slack discussion specifics (used for context only)
- Recommendations Source: 
  - Each resolution step based on actual error occurrences in codebase
  - No generic advice included
- Code Examples Rationale: 
  - Excluded code examples as per guidelines - linked to official documentation instead
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Malformed request): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 158-189 covering JSON, MessagePack, and UTF-8 errors
  - Cause 2 (Missing fields): From multiple instances in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 25-156
  - Cause 3 (Content-Type): From https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 183-189
  - Cause 4 (Invalid config): From https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 194-219
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 24-27 - preserved due to customer experience
  - Step 2: Specific field requirements from analysis of actual error occurrences
  - Step 3: Content-Type guidance from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-analysis.md lines 183-189
  - Step 4: SDK requirements from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 121-137
  - Step 5: Debug approach from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 115-118
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/40001-knowledge.md lines 85-110
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Comprehensive list of which APIs support MessagePack vs JSON-only (LiveObjects issue mentioned in knowledge file)
- Impact: Developers may attempt MessagePack with unsupported endpoints
- Recommendation: Document encoding support matrix for all APIs
- Severity: Medium - causes confusion but workaround exists
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40001
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40001 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->