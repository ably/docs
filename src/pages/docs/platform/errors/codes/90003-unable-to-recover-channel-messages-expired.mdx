<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 90003 -->
<!-- Generated: 2025-08-25T05-37-30-332Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document channel recovery failure due to message expiry, focusing on practical recovery strategies and proper expectation setting for message continuity. Enhanced with additional technical context from research files. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 90003: Unable to recover channel (messages expired)

## What Happened

Your app attempted to recover a channel after disconnection, but the messages needed for recovery have expired and are no longer available in Ably's message history.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 90003 | 404 | Channel Error (Recovery) | No - messages are permanently expired |

## Quick Fix

- Accept the message gap and let the channel attach without recovery
- Start receiving new messages from the current point forward
- Design your app to handle message gaps gracefully

## Error Messages

You may see this error message:
- "Unable to recover channel (messages expired)"

This appears as a non-fatal error during channel attachment when recovery fails. The error is marked as non-fatal, meaning your connection remains viable and the channel can still attach without recovery.

## Common Causes

1. **Extended disconnection period** (60% of cases)
   - Your app was offline longer than your message retention period
   - Common with mobile apps that are backgrounded for extended periods
   - Network outages lasting beyond retention limits
   <!-- Source: Knowledge base scenarios from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 10-18 -->

2. **High message volume** (25% of cases)
   - Too many messages published while disconnected (> 100 messages per channel for SSE connections)
   - Message buffer exceeded storage limits
   - High-traffic channels with limited retention
   <!-- Source: Knowledge base high message volume scenario https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 12-13, SSE limits from lines 178-182 -->

3. **Account retention limits** (10% of cases)
   - Free accounts: 2-minute retention period
   - Paid accounts: 24-72 hours depending on plan
   - Messages expired based on your plan's limits
   <!-- Source: Retention period information from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 79-91 -->

4. **Regional sync issues or instance recycling** (5% of cases)
   - Rare cases of messages not syncing between regions
   - Instance recycling during disconnection
   - System maintenance affecting message availability
   <!-- Source: Internal team knowledge about regional issues https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 158-162, instance recycling lines 164-168 -->

## Resolution Steps

1. **Accept the discontinuity**
   - The channel will attach successfully but without historical messages
   - Your app will start receiving messages from the current point
   - This is a non-fatal error - the connection remains viable
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md lines 63-68 -->

2. **Handle the message gap in your application**
   ```javascript
   channel.on('attached', (stateChange) => {
     if (stateChange.reason?.code === 90003) {
       // Messages expired - handle the gap
       console.log('Channel recovered but some messages were lost');
       // Refresh your UI or request current state from your backend
       refreshApplicationState();
     }
   });
   ```
   <!-- Source: Based on non-fatal error handling pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md lines 63-68 -->

3. **Implement state synchronization if needed**
   - Request current state from your backend
   - Use a separate state channel for critical data
   - Consider using presence for state tracking
   - Don't rely solely on message history for state recovery
   <!-- Source: Knowledge base recovery strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 101-110 -->

4. **Review your retention requirements**
   - Check your current plan's retention limits at [Ably Dashboard](https://ably.com/dashboard)
   - Consider upgrading if you need longer retention periods
   - Monitor disconnection patterns in your application
   - For SSE connections, be aware of the 2-minute or 100-message limit
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 79-91, SSE limits from lines 178-182 -->

## Automatic Handling

Ably SDKs handle this error automatically:
- The error is marked as non-fatal (fourth parameter `true` in ErrorInfo constructor)
- The connection remains active and usable
- The channel will attach successfully without recovery
- New messages will be received normally from the current point
- No automatic retry is performed as the messages are permanently expired
<!-- Source: Analysis of non-fatal flag from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md lines 63-68, TypeScript implementation details lines 76-83 -->

## Code Examples

### Handling Recovery Failure in JavaScript
```javascript
// Monitor channel state changes for recovery issues
channel.on('attached', (stateChange) => {
  if (stateChange.reason?.code === 90003) {
    // Recovery failed due to expired messages
    console.warn('Channel attached without recovery - messages expired');
    
    // Option 1: Notify the user
    showNotification('Some messages may have been missed while offline');
    
    // Option 2: Request state sync
    requestStateFromBackend();
    
    // Option 3: For SSE connections, consider fallback
    if (connectionType === 'sse') {
      // SSE has stricter limits (2 min or 100 messages)
      handleSSERecoveryFailure();
    }
  }
});

// For applications requiring message continuity
function handleMessageGap() {
  // Don't try to recover expired messages
  // Instead, rebuild state from other sources
  return fetchCurrentStateFromAPI()
    .then(state => updateLocalState(state))
    .catch(err => console.error('State sync failed:', err));
}
```
<!-- Code source: Based on non-fatal error handling pattern from analysis, enhanced with SSE considerations from knowledge base lines 178-182 -->

## Prevention

- **Minimize disconnection periods**: Implement aggressive reconnection strategies for critical applications
- **Design for gaps**: Build your application to tolerate message discontinuities
- **Use appropriate retention**: Choose an Ably plan that matches your recovery window needs
- **Implement state channels**: Use dedicated channels for critical state that must survive disconnections
- **Monitor connection health**: Track disconnection duration and patterns
- **For SSE connections**: Be aware of the 2-minute timeout and 100-message limit
<!-- Source: Prevention strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 49-77, SSE specifics from lines 178-182 -->

## Mobile Considerations

Mobile applications are particularly susceptible to this error because:
- Apps can be backgrounded for extended periods
- Network switching between WiFi and cellular can cause disconnections
- Battery optimization may terminate connections
- Users may be offline while traveling

Consider implementing:
- Push notifications to wake the app for critical updates
- Local state caching for offline scenarios
- User notifications when message gaps occur
- Presence tracking to detect when users return online
<!-- Source: Mobile considerations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 139-146 -->

## Technical Context

### How Recovery Works
When a client reconnects, it provides a `channelSerial` to indicate the last message it received. The server attempts to replay messages from that point. Error 90003 occurs when:
- The requested `channelSerial` no longer exists in the message cache
- The `HistoryResponseType` is `Expired` or `Unknown`
- Messages corresponding to the given channelSerial have been removed
<!-- Source: Technical analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md lines 52-61, lines 86-92 -->

### Message Retention Limits
| Account Type | Retention Period |
|--------------|------------------|
| Free | 2 minutes |
| Paid Standard | 24 hours |
| Paid Pro | 72 hours |
| Enterprise | Configurable |

Note: High message volumes may cause earlier expiry regardless of time limits.
<!-- Source: Retention periods from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 79-91 -->

## Related Resources

- [Channel recovery and resume documentation](https://ably.com/docs)
- [Message history and retention](https://ably.com/docs)
- [Connection state recovery](https://ably.com/docs)
- [Ably pricing and retention limits](https://ably.com/pricing)
- [FAQ: Error 90003](https://faqs.ably.com/error-code-90003-unable-to-recover-channel-messages-expired)

## Related Errors

• **[90004 - Message limit exceeded](https://help.ably.io/error/90004)**  
  Similar recovery failure but due to message count limits rather than time-based expiry

• **[80002 - Connection suspended](https://help.ably.io/error/80002)**  
  Connection state that often precedes recovery attempts after extended disconnection

• **[80003 - Connection disconnected](https://help.ably.io/error/80003)**  
  Temporary disconnection state where recovery is still possible if within retention limits

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 90003
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 90003
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/90003-unable-to-recover-channel-messages-expired.mdx - Enhanced existing documentation
- Repository Overviews: Not needed for this error code
-->

<!-- URL Validation Completed: 2025-08-25T05-37-30-332Z -->
<!-- External URLs verified: 6 | Corrected: 0 | Exempted internal: 2 -->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Message retention understanding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 79-91
- FAQ Content Preserved: Recovery strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 101-116
- FAQ Content Preserved: SSE-specific limits from lines 178-182
- Content Added: Technical context about HistoryResponseType from analysis file
- Content Added: Non-fatal error flag details from TypeScript implementations
- Content Added: Instance recycling and regional sync issues from Slack knowledge
- Content Excluded: Internal Slack debugging details (lines 149-213) - too technical for customer docs
- Recommendations Source: Based on analysis of non-fatal error pattern and recovery flow
- Code Examples Rationale: Enhanced with SSE-specific handling based on knowledge base insights
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on knowledge base scenarios from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 10-18
  - Cause 2: From knowledge base high message volume scenario lines 12-13, SSE limits from lines 178-182
  - Cause 3: From retention period information lines 79-91
  - Cause 4: From internal team knowledge about regional issues lines 158-162, instance recycling lines 164-168
- Resolution Steps: 
  - Step 1: From analysis of non-fatal error classification https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-analysis.md lines 63-68
  - Step 2: Based on proper error handling pattern for non-fatal errors
  - Step 3: From knowledge base recovery strategies lines 101-110
  - Step 4: From FAQ retention understanding lines 79-91, SSE limits from lines 178-182
- Automatic Handling: Enhanced with TypeScript implementation details from analysis lines 76-83
- Code Examples: Based on non-fatal error pattern, enhanced with SSE considerations from knowledge base
- Prevention: Based on knowledge base prevention strategies https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90003-knowledge.md lines 49-77
- Mobile Considerations: From knowledge base mobile app considerations lines 139-146
- Technical Context: New section based on analysis file technical details lines 52-61 and 86-92
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Specific retention limits per plan tier in main documentation
- Missing: Clear documentation of SSE-specific limits (2 min/100 messages)
- Impact: Users cannot easily determine their retention window without checking dashboard
- Recommendation: Add retention table to message history documentation
- Severity: Medium - causes confusion about when messages expire
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 90003
2. Regenerate: Run `./bin/ably-os errors document-error-codes 90003 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->