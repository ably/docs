<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80018 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document invalid connection ID format error with emphasis on SDK-managed connection IDs and known SDK bug in specific versions -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80018: Invalid connection ID

## What Happened

The connection ID provided to Ably doesn't match the expected format or is invalid.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80018 | 400 | Connection Error (Authentication) | No - requires valid connection ID |

## Quick Fix

- Let the Ably SDK manage connection IDs automatically
- Don't manually create or modify connection IDs
- If using ably-js versions 1.2.30-1.2.33, upgrade to the latest version

## Error Messages

You may see one of these messages:
- "Invalid connection key WHAT NODE"
- "Invalid connection serial"
- "invalid connection id (invalid format)"
- "invalid connectionKey: [key]. See https://help.ably.io/error/80018"

## Common Causes

1. **SDK bug in ably-js 1.2.30-1.2.33** (most common for SDK users)
   - Known bug causing connection resume failures
   - Fixed in versions after 1.2.33
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 103-105 -->

2. **Manually created connection IDs** (common mistake)
   - Attempting to construct connection IDs instead of using SDK-provided ones
   - Connection IDs must be generated by Ably, not clients
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 15, 134-135 -->

3. **Corrupted connection data** (less common)
   - Connection ID corrupted during storage or transmission
   - Network issues causing data corruption
   - Truncated or incomplete connection IDs
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 11-17 -->

4. **Invalid connection serial number**
   - Connection serial is not a valid number (NaN)
   - Occurs during connection state synchronization
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 36-51 -->

## Resolution Steps

1. **Check your SDK version**
   - If using ably-js versions 1.2.30 through 1.2.33, upgrade immediately
   - This resolves the known connection resume bug
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 103-105 -->

2. **Use SDK-managed connection IDs**
   ```javascript
   // ✅ Correct: Let the SDK handle connection IDs
   const ably = new Ably.Realtime({ key: apiKey });
   ably.connection.on('connected', () => {
     // Connection ID is automatically managed
     console.log('Connected with ID:', ably.connection.id);
   });
   
   // ❌ Wrong: Never manually create connection IDs
   // const fakeConnectionId = 'my-connection-123';
   ```
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 101-108 -->

3. **Establish a new connection**
   - If the error persists, establish a fresh connection
   - Don't try to recover using stored connection IDs
   - Let the SDK handle the entire connection lifecycle
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 24, 74 -->

4. **Review your implementation**
   - Remove any code that manually handles connection IDs
   - Don't store connection IDs in localStorage or databases
   - Don't modify SDK-provided connection IDs
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 50-53, 93-98 -->

## Automatic Handling

Ably SDKs automatically manage connection IDs and connection lifecycle. This error indicates that the automatic handling has been bypassed or a bug exists in older SDK versions. The SDK will not automatically retry this error as it requires a valid connection ID format.
<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 70-79 -->

## Prevention

- **Always use the latest SDK version** to avoid known bugs
- **Never manually create or modify connection IDs** - they have specific format requirements
- **Let the SDK manage the entire connection lifecycle** including ID generation
- **Don't persist connection IDs** across application sessions
- **Implement proper error handling** for connection operations
<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 49-68 -->

## Related Resources

- [Connection State Management](https://ably.com/docs/realtime/connection)
- [FAQ: Error Code 80018](https://faqs.ably.com/error-code-80018-invalid-connection-id-invalid-format)
- Related errors: [80023](./80023-unable-to-resume-connection.md) (connection resume failure)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80018
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 80018)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Connection ID management best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 49-108
  - Troubleshooting steps from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 27-47
- Content Excluded: 
  - "WHAT NODE" unusual message text - not helpful for customers
  - Internal method names (StatefulConnection.inherit) - too technical
- Recommendations Source: 
  - SDK version upgrade based on documented bug in analysis lines 103-105
  - Connection ID handling from knowledge base lines 50-108
- Code Examples Rationale: 
  - Simple correct/incorrect pattern from knowledge base lines 101-108 to demonstrate proper SDK usage
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (SDK bug): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 103-105
  - Cause 2 (Manual IDs): From knowledge base at https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 15, 134-135
  - Cause 3 (Corruption): From knowledge base at https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 11-17
  - Cause 4 (Serial): From analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 36-51
- Resolution Steps: 
  - Step 1: Based on known bug from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-analysis.md lines 103-105
  - Step 2: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 101-108
  - Step 3: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 24, 74
  - Step 4: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 50-53, 93-98
- Prevention: Based on best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80018-knowledge.md lines 49-68
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80018
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80018 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->