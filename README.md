# Ably Docs

This repository is the source for content published to [https://ably.com/docs](https://ably.com/docs).

The source content is written in [Textile](https://github.com/textile/textile-spec) and the site is generated by [Gatsby](https://www.gatsbyjs.com/).

## Run locally

To run the docs site locally, run `bin/dev` from the root directory. Alternatively, follow these steps:

1. Install Node 20 and Yarn 1.22

2. Clone this repository and make it your working directory.

3. Run `yarn install` to install all dependencies.

4. If this is the first time running the site, run `yarn run develop:env-setup` to setup your environment variables. Visit `localhost:8000` to view the site.

5. Run `yarn run develop` and visit `localhost:8000` to view the site.

## Contribute

View the [contribution guide](CONTRIBUTING.md) for information on how to write content and contribute to Ably docs.

## Markdown Static Files

The build process generates both HTML and Markdown versions of each documentation page. This provides a more token-efficient format for LLM crawlers and API clients.

### Content Negotiation

The site supports content negotiation via the `Accept` header:

```bash
# Request markdown version
curl -H "Accept: text/markdown" https://ably.com/docs/channels

# Request HTML version (default)
curl https://ably.com/docs/channels
```

Markdown files are located at `/docs/{page-path}/index.md` alongside their HTML counterparts at `/docs/{page-path}/index.html`.

### Build Process

1. **Source**: Content is written in Textile or MDX format
2. **HTML Generation**: Gatsby converts source files to static HTML
3. **Markdown Generation**: The `generateMarkdown` post-build hook converts HTML to clean Markdown
4. **Compression**: Both HTML and Markdown files are gzip compressed

### Validation

Validate markdown generation after building:

```bash
yarn validate-markdown
```

This ensures all HTML pages have corresponding Markdown files and reports any issues.

## Support

If you have any questions or suggestions, please [raise an issue](https://github.com/ably/docs/issues).

## Website Proxy

The Website app forwards requests to `/docs` to the `docs.ably.com` site.

Asset prefixing is applied only during the app build process and is not available in the dev version.

To ensure proper setup in your local:

1. Set the `ASSET_PREFIX=http://localhost:9000` variable in your environment.
2. Add `DOCS_BASE_URL=http://localhost:9000` to your `.env` file in the root of the Website app.
3. Ensure that `.env.production` exists in the app root for the Yarn build to function correctly.
4. You should be able to view the content and toggle between signed in and signed-out states.

## Review apps

Create a review app by adding the `review-app` label to your PR.

### Access and authentication

Review apps can only be generated by members of the Ably GitHub organisation and are protected by basic authentication.

### Cleanup

Review apps are automatically cleaned up when:

- A PR is closed, or;
- The `review-app` label is removed.
