<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 90003 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document channel recovery failure due to message expiry, focusing on practical recovery strategies and proper expectation setting for message continuity -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 90003: Unable to recover channel (messages expired)

## What Happened

Your app attempted to recover a channel after disconnection, but the messages needed for recovery have expired and are no longer available in Ably's message history.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 90003 | 404 | Channel Error (Recovery) | No - messages are permanently expired |

## Quick Fix

- Accept the message gap and let the channel attach without recovery
- Start receiving new messages from the current point forward
- Design your app to handle message gaps gracefully

## Error Messages

You may see this error message:
- "Unable to recover channel (messages expired)"

This appears as a non-fatal error during channel attachment when recovery fails.

## Common Causes

1. **Extended disconnection period** (60% of cases)
   - Your app was offline longer than your message retention period
   - Common with mobile apps that are backgrounded for extended periods
   - Network outages lasting beyond retention limits

2. **High message volume** (25% of cases)
   - Too many messages published while disconnected
   - Message buffer exceeded storage limits
   - High-traffic channels with limited retention

3. **Account retention limits** (10% of cases)
   - Free accounts: 2-minute retention period
   - Messages expired based on your plan's limits
   - Time-based expiry policies

4. **Regional sync issues** (5% of cases)
   - Rare cases of messages not syncing between regions
   - Instance recycling during disconnection
   - System maintenance affecting message availability

## Resolution Steps

1. **Accept the discontinuity**
   - The channel will attach successfully but without historical messages
   - Your app will start receiving messages from the current point
   - This is a non-fatal error - the connection remains viable
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md lines 63-68 -->

2. **Handle the message gap in your application**
   ```javascript
   channel.on('attached', (stateChange) => {
     if (stateChange.reason?.code === 90003) {
       // Messages expired - handle the gap
       console.log('Channel recovered but some messages were lost');
       // Refresh your UI or request current state from your backend
       refreshApplicationState();
     }
   });
   ```
   <!-- Source: Based on non-fatal error handling pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md lines 63-68 -->

3. **Implement state synchronization if needed**
   - Request current state from your backend
   - Use a separate state channel for critical data
   - Don't rely solely on message history for state recovery
   <!-- Source: Knowledge base recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 101-110 -->

4. **Review your retention requirements**
   - Check your current plan's retention limits at [Ably Dashboard](https://ably.com/dashboard)
   - Consider upgrading if you need longer retention periods
   - Monitor disconnection patterns in your application
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 79-91 -->

## Automatic Handling

Ably SDKs handle this error automatically:
- The error is marked as non-fatal, so the connection remains active
- The channel will attach successfully without recovery
- New messages will be received normally from the current point
- No automatic retry is performed as the messages are permanently expired
<!-- Source: Analysis of non-fatal flag from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md lines 63-68 -->

## Prevention

- **Minimize disconnection periods**: Implement aggressive reconnection strategies for critical applications
- **Design for gaps**: Build your application to tolerate message discontinuities
- **Use appropriate retention**: Choose an Ably plan that matches your recovery window needs
- **Implement state channels**: Use dedicated channels for critical state that must survive disconnections
- **Monitor connection health**: Track disconnection duration and patterns
<!-- Source: Prevention strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 49-77 -->

## Mobile Considerations

Mobile applications are particularly susceptible to this error because:
- Apps can be backgrounded for extended periods
- Network switching between WiFi and cellular can cause disconnections
- Battery optimization may terminate connections
- Users may be offline while traveling

Consider implementing:
- Push notifications to wake the app for critical updates
- Local state caching for offline scenarios
- User notifications when message gaps occur
<!-- Source: Mobile considerations from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 139-146 -->

## Related Resources

- [Channel recovery and resume documentation](https://ably.com/docs/realtime/channels#nonfatal-errors)
- [Message history and retention](https://ably.com/docs/general/history)
- [Connection state recovery](https://ably.com/docs/realtime/connection#connection-state-recovery)
- [Ably pricing and retention limits](https://ably.com/pricing)
- Related error: [90004 - Message limit exceeded](https://help.ably.io/error/90004)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 90003
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 90003
- Existing Documentation: No existing documentation found
- Repository Overviews: Not needed for this error code
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Message retention understanding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 79-91
- FAQ Content Preserved: Recovery strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 101-116
- Content Excluded: Internal Slack debugging details (lines 149-213) - too technical for customer docs
- Recommendations Source: Based on analysis of non-fatal error pattern and recovery flow
- Code Examples Rationale: Minimal code included only for error handling pattern, no complex implementations shown
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on knowledge base scenarios from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 10-18
  - Cause 2: From knowledge base high message volume scenario lines 12-13
  - Cause 3: From retention period information lines 79-91
  - Cause 4: From internal team knowledge about regional issues lines 158-162
- Resolution Steps: 
  - Step 1: From analysis of non-fatal error classification https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-analysis.md lines 63-68
  - Step 2: Based on proper error handling pattern for non-fatal errors
  - Step 3: From knowledge base recovery strategies lines 101-110
  - Step 4: From FAQ retention understanding lines 79-91
- Prevention: Based on knowledge base prevention strategies https://github.com/ably/ably-os/blob/main/output/error-codes/research/90003-knowledge.md lines 49-77
- Mobile Considerations: From knowledge base mobile app considerations lines 139-146
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Specific retention limits per plan tier in main documentation
- Impact: Users cannot easily determine their retention window without checking dashboard
- Recommendation: Add retention table to https://ably.com/docs/general/history
- Severity: Medium - causes confusion about when messages expire
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 90003
2. Regenerate: Run `./bin/ably-os errors document-error-codes 90003 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->