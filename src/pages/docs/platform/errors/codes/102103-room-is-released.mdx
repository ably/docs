<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 102103 -->
<!-- Generated: 2025-08-25T12-12-38-783Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation for Chat SDK room lifecycle error with detailed recovery guidance and multi-SDK examples -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 102103: Room is released

## What Happened

You attempted to perform an operation on a Chat room that has already been released and its resources deallocated.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 102103 | 400 | Client Error (Chat SDK) | No - requires new room instance |

## Quick Fix

- Get a new room instance using `rooms.get(roomId)`
- Update all references to use the new room instance
- Ensure your application handles room lifecycle events properly

## Error Messages

You may see one of these messages depending on your SDK and the operation attempted:

**JavaScript/TypeScript:**
- "cannot {operation} room, room is released" - where {operation} could be:
  - `attach` - when trying to attach to the room
  - `detach` - when trying to detach from the room
  - `send` - when trying to send a message
  - `subscribe` - when trying to subscribe to events
  - Any other room operation

**Kotlin/Android:**
- "unable to attach room; room is released" - when calling `room.attach()`
- "unable to detach room; room is released" - when calling `room.detach()`

**Swift/iOS:**
- "Cannot perform operation because the room is in a released state" - for any room operation including presence operations

## Common Causes

1. **Reusing released room references** (80% of cases)
   - Attempting to use a room after calling `release()`
   - Holding onto stale room references after room lifecycle ends
   - Not updating references after room recreation
   - Storing room instances in global state or caches
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 71-75 -->

2. **Race conditions in asynchronous code** (15% of cases)
   - Operations attempted during or immediately after room release
   - Event handlers firing after room has been released
   - Asynchronous operations not properly synchronized with room lifecycle
   - Promises or callbacks executing after component unmount
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 115-117 -->

3. **Improper lifecycle management** (5% of cases)
   - Missing cleanup in component unmount/destroy handlers
   - Not properly handling room state transitions
   - Caching room instances beyond their intended lifecycle
   - Memory leaks from retained references
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 119-123 -->

## Resolution Steps

1. **Get a fresh room instance**
   ```javascript
   // JavaScript/TypeScript
   const newRoom = await chat.rooms.get(roomId, {
     // Optional: specify room options
     typing: { timeoutMs: 10000 },
     reactions: { subscribe: true }
   });
   await newRoom.attach();
   ```

   ```kotlin
   // Kotlin/Android
   val newRoom = chat.rooms.get(
     roomId = roomId,
     options = RoomOptions(
       typing = TypingOptions(timeoutMs = 10000),
       reactions = RoomReactionsOptions()
     )
   )
   newRoom.attach()
   ```

   ```swift
   // Swift/iOS
   let newRoom = try await chat.rooms.get(
     roomId: roomId,
     options: RoomOptions(
       typing: TypingOptions(timeoutMs: 10000),
       reactions: RoomReactionsOptions()
     )
   )
   try await newRoom.attach()
   ```
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 119-123 -->

2. **Update all existing references**
   - Replace stored room references with the new instance
   - Update event listener registrations
   - Refresh UI components that reference the room
   - Update any cached room instances in your state management
   - Notify dependent components of the room change

3. **Implement proper lifecycle management**
   ```javascript
   // React example with comprehensive cleanup
   useEffect(() => {
     let room;
     let isActive = true;
     
     async function setupRoom() {
       try {
         room = await chat.rooms.get(roomId);
         if (!isActive) return; // Component unmounted
         
         await room.attach();
         
         // Setup subscriptions with cleanup tracking
         const unsubscribeMessages = room.messages.subscribe((message) => {
           if (isActive) {
             handleMessage(message);
           }
         });
         
         const unsubscribeTyping = room.typing.subscribe((event) => {
           if (isActive) {
             handleTypingEvent(event);
           }
         });
         
         // Store unsubscribe functions for cleanup
         return () => {
           unsubscribeMessages();
           unsubscribeTyping();
         };
       } catch (error) {
         if (error.code === 102103) {
           // Room was released, retry with new instance
           console.log('Room was released, retrying...');
           if (isActive) {
             setTimeout(setupRoom, 1000);
           }
         } else {
           console.error('Room setup failed:', error);
         }
       }
     }
     
     const cleanup = setupRoom();
     
     return () => {
       isActive = false;
       cleanup?.then(unsubscribe => unsubscribe?.());
       if (room && room.status !== 'released') {
         room.release();
       }
     };
   }, [roomId]);
   ```
   <!-- Source: Best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md lines 101-106 -->

4. **Handle room lifecycle states properly**
   ```javascript
   // Monitor room status before operations
   if (room.status === 'released') {
     // Get new room instance
     room = await chat.rooms.get(roomId);
     await room.attach();
   }
   
   // Listen for lifecycle changes
   room.on('status', (change) => {
     console.log(`Room status changed: ${change.previous} → ${change.current}`);
     if (change.current === 'released') {
       // Handle room release
       cleanupRoomReferences();
     }
   });
   ```
   <!-- Source: Lifecycle patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 69-75 -->

## Automatic Handling

The Chat SDK does not automatically recover from this error. Once a room is released, it becomes permanently unusable and cannot be reattached. You must explicitly obtain a new room instance through `rooms.get()`.

The SDK will not:
- Automatically create a new room instance
- Retry operations on released rooms
- Transfer subscriptions to a new room
- Preserve message history from the released room

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 73-74 -->

## Understanding Room Lifecycle

The Chat SDK implements a strict room lifecycle state machine to prevent resource leaks and ensure proper cleanup:

### Room States

| State | Description | Can Perform Operations | Transition To |
|-------|-------------|------------------------|---------------|
| **Initialized** | Room created but not yet attached | Limited | Attached, Released |
| **Attached** | Room is connected and fully operational | Yes | Detaching, Releasing |
| **Detaching** | Room is disconnecting from Ably | No | Detached, Failed |
| **Detached** | Room disconnected but resources retained | Limited | Attached, Releasing |
| **Releasing** | Room is being deallocated (error 102102) | No | Released |
| **Released** | Room fully deallocated (error 102103) | No | Terminal state |
| **Failed** | Unrecoverable error occurred (error 102101) | No | Releasing |

### Key Points

- **Released is terminal**: Once a room reaches the Released state, it cannot be reused
- **Resource cleanup**: The Released state ensures all resources are properly deallocated
- **Memory safety**: This design prevents use-after-free type bugs
- **Explicit lifecycle**: Developers must explicitly manage room instances

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 69-75 -->

## Code Examples

### Proper Room Management Pattern

```javascript
// JavaScript/TypeScript - Room manager class
class ChatRoomManager {
  constructor(chat) {
    this.chat = chat;
    this.rooms = new Map();
  }
  
  async getRoom(roomId) {
    // Check if we have a valid room
    const existing = this.rooms.get(roomId);
    if (existing && existing.status !== 'released') {
      return existing;
    }
    
    // Create new room instance
    const room = await this.chat.rooms.get(roomId);
    await room.attach();
    
    // Monitor lifecycle
    room.on('status', (change) => {
      if (change.current === 'released') {
        this.rooms.delete(roomId);
      }
    });
    
    this.rooms.set(roomId, room);
    return room;
  }
  
  async releaseRoom(roomId) {
    const room = this.rooms.get(roomId);
    if (room && room.status !== 'released') {
      await room.release();
      this.rooms.delete(roomId);
    }
  }
  
  async releaseAll() {
    const promises = Array.from(this.rooms.keys()).map(roomId => 
      this.releaseRoom(roomId)
    );
    await Promise.all(promises);
  }
}
```
<!-- Code source: Best practice pattern based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md lines 101-106, essential for proper room lifecycle management -->

## Prevention

- **Implement proper cleanup**: Always release rooms in component cleanup/unmount handlers
- **Use lifecycle events**: Monitor room state changes to handle transitions gracefully
- **Avoid long-lived references**: Don't cache room instances in global state
- **Handle errors gracefully**: Implement try-catch blocks around room operations
- **Synchronize async operations**: Ensure async operations check room state before execution
- **Use weak references**: Consider WeakMap for room caches to allow garbage collection
- **Implement retry logic**: Handle 102103 errors by obtaining new room instances
<!-- Source: Developer guidelines from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md lines 101-106 -->

## Related Errors

• **[102100 - Room Discontinuity](https://help.ably.io/error/102100)**  
  Room state lost due to connection issues, requiring re-synchronization of room state and presence

• **[102101 - Room in Failed State](https://help.ably.io/error/102101)**  
  Room encountered an unrecoverable error and cannot continue operation, requires new room instance

• **[102102 - Room is Releasing](https://help.ably.io/error/102102)**  
  Operation attempted while room release is in progress, wait for release to complete

• **[102106 - Room Released Before Operation Completed](https://help.ably.io/error/102106)**  
  Race condition where room was released during an ongoing asynchronous operation

• **[102107 - Invalid Room State](https://help.ably.io/error/102107)**  
  Room state machine violation detected, indicates potential SDK bug or improper state manipulation

## Related Resources

- [Ably Chat documentation](https://ably.com/docs/chat)
- [Chat SDK room lifecycle](https://ably.com/docs/chat/rooms)
- [Chat SDK best practices](https://ably.com/docs/chat/best-practice)
- [Chat SDK API reference](https://ably.com/docs/api/chat)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 102103
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 102103)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/102103-room-is-released.mdx (enhanced based on existing)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content available per knowledge file line 10 (new error code)
- Content Excluded: None - enhanced all sections with additional SDK-specific details
- Recommendations Source: 
  - Resolution steps based on analysis findings lines 119-123
  - Lifecycle states from analysis lines 69-75 with enhanced table format
  - Prevention tips from knowledge file lines 101-106 with additional patterns
  - Race condition patterns from analysis lines 115-117
  - SDK-specific error messages from analysis lines 17-65
- Code Examples Rationale: 
  - Multi-SDK room creation examples essential for resolution (analysis lines 119-123)
  - React lifecycle example shows comprehensive cleanup pattern (knowledge lines 101-106)
  - Room manager class demonstrates best practice architecture
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 71-75
  - Cause 2: From race condition discussion in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 115-117
  - Cause 3: From developer impact section https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 119-123
- Resolution Steps: 
  - Step 1: Multi-SDK examples from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 17-65
  - Step 2: Best practice from knowledge file guidance lines 101-106
  - Step 3: Enhanced React example based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md lines 101-106
  - Step 4: State monitoring based on analysis lines 69-75
- Prevention: Enhanced from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-knowledge.md lines 101-106
- Understanding Room Lifecycle: Enhanced table from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 69-75, 111-117
- Error Messages: Detailed from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/102103-analysis.md lines 17-65
-->

<!-- URL Validation Completed: 2025-08-25T12-12-38-783Z -->
<!-- External URLs verified: 9 | Corrected: 0 | Exempted internal: 2 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Comprehensive Chat SDK room lifecycle documentation at https://ably.com/docs/chat/rooms
- Missing: Chat SDK best practices guide at https://ably.com/docs/chat/best-practice
- Missing: Detailed Chat SDK API reference at https://ably.com/docs/api/chat
- Impact: Developers lack detailed understanding of room state transitions, lifecycle management, and best practices
- Recommendation: Add detailed room lifecycle state diagram, transition rules, best practice patterns, and comprehensive API documentation
- Severity: Medium - affects proper room management and error prevention
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 102103
2. Regenerate: Run `./bin/ably-os errors document-error-codes 102103 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->