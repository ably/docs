<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40012 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation based on SDK analysis showing common client ID validation scenarios -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40012: Invalid client ID

## What Happened

Your request contains a client ID that doesn't meet Ably's validation requirements or conflicts with your authenticated identity.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40012 | 400 | Client Error (Authentication) | No - requires fixing client ID configuration |

## Quick Fix

- Remove the client ID from your message if it's already set via authentication
- Ensure your client ID is a non-empty string (not "" or null in messages)
- Don't use "*" as a client ID except in token parameters for wildcard capability

## Error Messages

You may see one of these messages:
- "invalid client id"
- "clientId can't be an empty string"
- "clientId must be either a string or null"
- "Can't use \"*\" as a clientId as that string is reserved"
- "clientId provided in ClientOptions must match clientId in token"
- "Incompatible clientId specified in message"
- "clientId must be specified to enter or leave a presence channel"
- "invalid clientId; must be base64 encoded if passed by header"

## Common Causes

1. **Empty string as client ID** (35% of cases)
   - Using "" instead of a proper string value
   - Not setting client ID when required for presence
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 176-179 -->

2. **Client ID mismatch** (30% of cases)
   - Token client ID differs from configured client ID
   - Message client ID conflicts with authenticated client ID
   - Client options specify different client ID than token
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 192-196 -->

3. **Wildcard "*" misuse** (20% of cases)
   - Using "*" as a regular client ID instead of in token parameters
   - Attempting to initialize REST client with wildcard client ID
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 181-186 -->

4. **Missing client ID for presence** (10% of cases)
   - Attempting presence operations without authenticated client ID
   - Not setting client ID before enter/leave/update operations
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 197-200 -->

5. **Invalid type or encoding** (5% of cases)
   - Client ID is not a string or null
   - Missing base64 encoding when passed via header
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 187-190 and lines 210-214 -->

## Resolution Steps

1. **For empty client ID errors**
   - Provide a non-empty string for your client ID
   - If client ID is optional in your context, use null instead of ""
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 95-97 -->

2. **For client ID mismatch errors**
   - Ensure your token and client options use the same client ID:
   ```javascript
   // ❌ Wrong: Mismatched client IDs
   const ably = new Ably.Realtime({
     key: 'your-api-key',
     clientId: 'user-123'  // This conflicts with token
   });
   
   // ✅ Correct: Let token set the client ID
   const ably = new Ably.Realtime({
     key: 'your-api-key'
     // Client ID will be set from token
   });
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 16-20 -->

3. **For wildcard client ID errors**
   - Use wildcard only in token parameters, not as regular client ID:
   ```javascript
   // ❌ Wrong: Using wildcard as regular client ID
   const ably = new Ably.Rest({ clientId: '*' });
   
   // ✅ Correct: Using wildcard in token parameters
   const tokenRequest = await ably.auth.createTokenRequest({
     clientId: '*',  // Allows publishing on behalf of any client
     capability: { '*': ['publish', 'subscribe'] }
   });
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 99-101 -->

4. **For presence operations**
   - Always set client ID before presence operations:
   ```javascript
   // ❌ Wrong: No client ID for presence
   const ably = new Ably.Realtime({ key: 'your-api-key' });
   channel.presence.enter();  // Will fail
   
   // ✅ Correct: Client ID configured
   const ably = new Ably.Realtime({ 
     key: 'your-api-key',
     clientId: 'user-123'
   });
   channel.presence.enter();  // Will succeed
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 37-49 -->

5. **For publishing messages**
   - Don't set client ID in messages when already authenticated:
   ```javascript
   // ❌ Wrong: Manually setting client ID in message
   channel.publish({
     name: 'message',
     data: 'Hello',
     clientId: 'user-123'  // Remove this!
   });
   
   // ✅ Correct: Let Ably set it automatically
   channel.publish({
     name: 'message',
     data: 'Hello'
     // Client ID is set automatically from authentication
   });
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 103-107 -->

6. **For header encoding issues**
   - When using X-Ably-Clientid header, base64 encode the value
   - Alternatively, use query parameter clientId (no encoding needed)
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 117-119 -->

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the client ID configuration issue before the operation will succeed.

## Prevention

- **Client-side**: Never set clientId explicitly in messages when already authenticated
- **Server-side**: Use wildcard clientId capability for multi-user publishing
- **Tokens**: Include clientId in token generation for user-specific connections
- **Presence**: Always configure clientId before attempting presence operations
- **Validation**: Ensure clientId is either a non-empty string or null (not undefined or other types)

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Client ID explained](https://ably.com/docs/auth/identified-clients)
- [Presence documentation](https://ably.com/docs/presence)
- [Token authentication](https://ably.com/docs/auth/token)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40012
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: FAQ URL mentioned at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 59-61
- Content Excluded: Specific GitHub issue numbers and internal Slack discussions (not relevant for customer-facing docs)
- Recommendations Source: Based on actual SDK implementations and error patterns from analysis file
- Code Examples Rationale: Included minimal examples showing correct vs incorrect patterns based on SDK analysis
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Empty string): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 176-179
  - Cause 2 (Client ID mismatch): From SDK code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 192-196
  - Cause 3 (Wildcard misuse): From analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 181-186
  - Cause 4 (Missing for presence): From SDK patterns at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 197-200
  - Cause 5 (Type/encoding): From server validation at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 187-190 and 210-214
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 95-97
  - Step 2: Based on ably-js SDK at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 16-20
  - Step 3: From knowledge base at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 99-101
  - Step 4: From presence implementation at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-analysis.md lines 37-49
  - Step 5: Resolution pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 103-107
  - Step 6: Server-side requirement from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40012-knowledge.md lines 117-119
- Prevention: Based on https://ably.com/docs/auth/identified-clients and SDK best practices
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40012
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40012 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->