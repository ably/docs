---
title: "Error 40099 - Testing/Development Error"
meta_description: "This error occurs during internal testing scenarios or when user claims cannot be added to messages"
meta_keywords: "40099, testing error, user claims, message extras, forced rejection, development"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40099 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Documenting an internal testing error with limited customer visibility, focusing on the two known scenarios where it might appear */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

This error is primarily used for internal testing and development purposes. It may occasionally appear during message publishing operations.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ---------------- | -------- | --------- |
| 40099 | 400 | Testing/Development | No |

## Error messages

You may see one of these messages:

| Error message | Description |
| ------------- | ----------- |
| "Message rejected by request" | Occurs when testing message rejection scenarios |
| "Unable to add userClaim to message" | Occurs when user claims cannot be added to message extras |

## Impact

This error prevents the current message publish operation from completing. The message will not be delivered to subscribers.

The error is not automatically retried by Ably SDKs as it represents an intentional rejection or structural failure.

## Troubleshooting

### Testing scenario with forced rejection

| Error message |
| ------------- |
| "Message rejected by request" |

This occurs when:
- A special testing parameter `_forceNack=true` is included in the publish request
- The system is intentionally testing error handling paths

To resolve this:
- Remove the `_forceNack` parameter from your publish request
- This parameter is intended for internal testing only and should not be used in production

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 22-30 */}

### User claims processing failure

| Error message |
| ------------- |
| "Unable to add userClaim to message" |

This occurs when:
- The system cannot add user claims to the message extras structure
- There are issues with the protobuf message construction
- The message metadata cannot be properly formatted

To resolve this:
- Verify that your message structure is valid
- Check that message extras can be properly constructed
- Contact [Ably support](https://ably.com/support) if you're consistently encountering this error

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 14-21 */}

## Limited documentation available

This error code is primarily used for internal testing and development purposes. If you encounter this error in production:
- Ensure you're not inadvertently using testing parameters
- Verify your message structure and metadata are correctly formatted
- Contact [Ably support](https://ably.com/support) with the full error context

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Additional resources
- [Message publishing documentation](https://ably.com/docs/channels)
- [Ably documentation](https://ably.com/docs)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 40099
- Existing Documentation: None found
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: None available for this error code
- Content Excluded: Detailed internal testing mechanisms that are not relevant to customers
- Recommendations Source:
  - Testing scenario resolution: Based on analysis of _forceNack parameter usage in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 22-30
  - User claims resolution: Based on protobuf handling analysis in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 14-21
- Code Examples Rationale: No code examples included as this is primarily an internal error with no documented customer-facing resolution patterns
*/}

{/* ATTRIBUTION BY SECTION:
- Error Messages:
  - "Message rejected by request": From https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md line 28
  - "unable to add userClaim to message": From https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md line 19
- Troubleshooting:
  - Testing scenario: Based on _forceNack parameter analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 22-30
  - User claims failure: Based on Go implementation analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-analysis.md lines 14-21
- Limited Documentation Notice: Based on knowledge that this is an internal/testing error from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40099-knowledge.md lines 14-19
*/}

{/* DOCUMENTATION SHORTCOMINGS:
Areas where Ably documentation could be improved:
- Missing: Documentation about user claims in message extras feature
- Impact: Makes it difficult to understand when and why user claims might fail
- Recommendation: Document the user claims feature and its requirements
- Severity: Low (appears to be rarely encountered by customers)
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 3 | Corrected: 2 | Exempted internal: 0 */}
{/* Note: ably.com/support validated successfully. Documentation URLs simplified to main docs pages due to validation issues with specific anchors. */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40099
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40099 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}