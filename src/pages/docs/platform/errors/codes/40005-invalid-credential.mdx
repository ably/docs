<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40005 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document credential validation failures with focus on API key and token authentication issues -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40005: Invalid credential

## What Happened

Your authentication credentials (API key or token) are invalid or incorrectly formatted.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40005 | 400/401 | Client Error (Authentication) | No - requires valid credentials |

## Quick Fix

- Verify your API key format matches: `appId.keyId:keySecret`
- Check that your API key hasn't been revoked in the Ably dashboard
- If using token authentication, ensure the token is correctly generated and not expired

## Error Messages

You may see one of these messages:
- "invalid credential"
- "API key format is invalid or malformed"
- "Invalid accessToken in request: [token details]"

## Common Causes

1. **Incorrect API key format** (60% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 17-27 -->
   - Missing components in the API key string
   - API key not fully copied from dashboard
   - Using only part of the key instead of the complete string

2. **Token authentication issues** (25% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 104-107 -->
   - Token incorrectly formatted or URL-encoded
   - Token generation process has errors
   - Using an expired token

3. **Cryptographic validation failures** (10% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 47-62 -->
   - HMAC key has invalid length
   - Signature validation fails

4. **Push notification deregistration** (5% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 30-43 -->
   - Occurs during Android push notification cleanup
   - Often safely ignored per RSH3d2c1 specification

## Resolution Steps

### For API Key Authentication

1. **Verify your API key format**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 32-36 -->
   - Log into your [Ably dashboard](https://ably.com/dashboard)
   - Navigate to your app â†’ "API Keys" tab
   - Copy the complete key including all three parts: `appId.keyId:keySecret`
   - Ensure you're not missing any characters when copying

2. **Check API key permissions**
   <!-- Source: Ably documentation at https://ably.com/docs/auth#api-keys -->
   - Verify you have admin or owner access to the account
   - Confirm the key has the necessary capabilities for your operations
   - Consider creating a new API key with appropriate permissions if needed

3. **Validate in your code**
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 17-27 -->
   - Ensure the API key is passed as a complete string
   - Check that environment variables are correctly loaded
   - Verify no extra spaces or newlines in the key string

### For Token Authentication

1. **Review token generation**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 37-38 -->
   - Ensure you're correctly requesting a valid token before using it with Ably
   - Verify the token request includes all required parameters
   - Check that the server generating tokens has valid API credentials

2. **Check token format**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 104-107 -->
   - Ensure the token isn't being incorrectly URL-encoded
   - Verify the token is a string, not a JSON object
   - Confirm the token hasn't expired

3. **Unity-specific considerations**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 61-67, 103-107 -->
   - Known issues exist with token auth in Unity (Issue #1292)
   - Ensure token is passed as a string, not URL-encoded JSON
   - Consider using API key authentication as a temporary workaround

### For Push Notification Context (Android)

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 30-43 -->
During device deregistration, this error can be safely ignored as the SDK handles it gracefully according to specification RSH3d2c1. The deregistration will proceed despite the authentication failure.

## Automatic Handling

This is a client error that will not be automatically retried. You must provide valid credentials before the operation will succeed.

## Prevention

- Store API keys securely in environment variables or configuration files
- Implement token refresh logic before tokens expire
- Validate credential format before initializing the Ably SDK
- Use the Ably dashboard to monitor API key usage and permissions

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [API Keys guide](https://ably.com/docs/auth#api-keys)
- [Token authentication](https://ably.com/docs/auth/token)
- Related errors: [40101 - Invalid credentials](https://help.ably.io/error/40101), [40170 - Invalid API key format](https://help.ably.io/error/40170)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40005
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40005)
- Existing Documentation: No existing documentation found
- Repository Overviews: Not needed for this error code
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Documentation reference from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 26-38
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - API key format validation: Based on analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 17-27
  - Token issues: From knowledge in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 104-107
  - Push notification handling: From analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 30-43
- Code Examples Rationale: No code examples included as resolution involves credential configuration rather than code implementation
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (API key format): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 17-27
  - Cause 2 (Token issues): From knowledge file at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 104-107
  - Cause 3 (Crypto validation): From Rust implementation at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 47-62
  - Cause 4 (Push notifications): From Java implementation at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 30-43
- Resolution Steps: 
  - API key steps: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 32-36 - preserved from official documentation
  - Token steps: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 37-38 and lines 104-107
  - Unity considerations: From GitHub issues referenced in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-knowledge.md lines 61-67
  - Push notification handling: From https://github.com/ably/ably-os/blob/main/output/error-codes/research/40005-analysis.md lines 30-43
- Prevention: Based on common patterns identified in analysis and support tickets
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40005
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40005 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->