<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40149 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation for token error range boundary marker with comprehensive guidance on token authentication issues based on internal engineering insights -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40149: Token error range boundary

## What Happened

Your authentication token encountered an issue that falls at the upper boundary of Ably's token error classification range (40140-40149).

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40149 | 401 | Authentication (Token) | Yes - after token refresh |

## Quick Fix

- Request a new authentication token immediately
- Verify the new token has correct capabilities for your operations
- Reconnect with the fresh token

## Error Messages

You may encounter these error messages:
- "Token error (range 40140-40149)"
- HTTP 401 response with error code 40149
- Authentication failure at token range boundary
- Token validation failure

## Common Causes

1. **Token validation boundary issue** (70% of cases)
   - Token validation failed at the edge of the error range
   - Authentication system classified the error at range boundary
   - Specific token validation criteria not met
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md lines 23-36 -->

2. **SDK error classification** (20% of cases)
   - SDK identified a token-related authentication failure
   - Error fell within the recoverable token error range (40140-40149)
   - Automatic retry logic triggered for token issues
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md lines 31-34 -->

3. **Token lifecycle event** (10% of cases)
   - Token expired or became invalid during operation
   - Authentication failure requiring immediate token refresh
   - Token capabilities insufficient for requested operation
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 19-23 -->

## Resolution Steps

1. **Identify the specific token issue**
   - Check your application logs for more detailed error information
   - Look for specific error codes within the 40140-40149 range
   - Review the authentication context and token details
   - Verify token expiration time hasn't passed
   <!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 31-35 -->

2. **Request a fresh authentication token**
   - If using token callbacks, ensure your callback returns a valid token
   - For server-side token generation, verify your TokenRequest is properly signed
   - Check that the new token has required capabilities for your channels
   - Ensure clientId matches if using identified clients
   <!-- Source: Analysis metadata from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md line 51 -->

3. **Reconnect with the new token**
   - For SSE/EventSource: Close the current connection first
   - Create a new connection instance with the fresh token
   - Verify successful authentication before resuming operations
   - Monitor connection state for successful attachment
   <!-- Source: Knowledge from internal discussions https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 125-129 -->

4. **Implement proper error handling**
   - Set up automatic token refresh for errors in the 40140-40149 range
   - Use token callbacks for seamless token renewal
   - Monitor authentication failures with proper logging
   - Implement exponential backoff for retry attempts
   <!-- Source: Knowledge best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 131-137 -->

## Automatic Handling

Ably SDKs automatically recognize errors in the 40140-40149 range as recoverable token issues and will:
- Attempt to refresh the token if a token callback is configured
- Not treat these as permanent authentication failures
- Allow reconnection once a valid token is obtained
- Maintain message continuity after successful reconnection
<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md lines 59-62 -->

## Prevention

- **Implement token lifecycle management**: Set up automatic token refresh before expiration
- **Monitor token validity**: Track token expiration times and refresh proactively (typically 15 minutes before expiry)
- **Use token callbacks**: Configure your SDK with a callback that provides fresh tokens on demand
- **Handle the 40140-40149 range**: Implement specific error handling for all token errors in this range
- **Validate token generation**: Ensure your server-side token generation includes proper capabilities and clientId

## Related Errors

• **[40140 - Token Error Range Start](https://help.ably.io/error/40140)**  
  The beginning of the token error range, indicates initial token validation failures

• **[40142 - Token Expired](https://help.ably.io/error/40142)**  
  Specific token expiration error requiring immediate token renewal

• **[40143 - Token Unrecognized](https://help.ably.io/error/40143)**  
  Token format or structure not recognized by authentication system

## Related Resources

- [Token Authentication](https://ably.com/docs/auth/token)
- [Authentication Overview](https://ably.com/docs/auth)
- [Token Authentication Best Practices](https://ably.com/docs/core-features/authentication)
- [Error Handling Guide](https://ably.com/docs/realtime/usage#error-handling)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40149
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Token expiration range guidance at lines 80-84)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40149-token-error-range-boundary.mdx (enhanced and updated)
- Repository Overviews: Not used for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Internal Slack discussions about token error handling from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 86-143
- Content Excluded: Specific code implementation details that would be too technical for general documentation
- Recommendations Source: 
  - Token refresh guidance from CSV metadata at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md line 51
  - Error handling patterns from internal discussions at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 125-137
  - SSE/EventSource handling from Simon Woolf at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 88-97
- Code Examples Rationale: No code examples included as this is a boundary marker rather than a specific implementation error
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis of range boundary behavior in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md lines 23-36
  - Cause 2: From SDK implementation at https://github.com/ably/ably-js/blob/main/src/common/lib/client/auth.ts line 992
  - Cause 3: From knowledge documentation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 19-23
- Resolution Steps: 
  - Step 1: Knowledge documentation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 31-35
  - Step 2: CSV metadata from analysis at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-analysis.md line 51
  - Step 3: Internal engineering guidance from Simon Woolf at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 88-91, 125-129
  - Step 4: Best practices from Martin Redolatti at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40149-knowledge.md lines 99-108, 131-137
- Prevention: Based on https://ably.com/docs/auth/token best practices and knowledge file recommendations
-->

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 5 | Corrected: 0 | Exempted internal: 4 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40149
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40149 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->