<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40009 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with corrected size limits based on current pricing page, improved technical accuracy, and comprehensive troubleshooting guidance -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40009: Message size exceeded

## What Happened

Your message exceeded the maximum size allowed for your Ably package tier.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40009 | 400/413 | Client Error (Message Validation) | No - requires reducing message size |

## Quick Fix

- Check your current package tier's size limit (64KB for Free/Standard, 256KB for Pro, custom for Enterprise)
- Reduce message size by removing unnecessary data or compressing content
- Split large messages into smaller chunks if needed
- For batch publishing, reduce the number of messages per batch
- Consider upgrading to Pro (256KB) or Enterprise for custom limits

## Error Messages

You may see one of these messages:
- "Maximum message length exceeded"
- "Maximum message length exceeded (size was X bytes, limit is Y bytes)"
- "Maximum size of messages that can be published at once exceeded (was X bytes; limit is Y bytes)"
- "ObjectMessages size X exceeds maximum allowed size of Y bytes"
- "Max content length exceeded"
- "Maximum content length exceeded"
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 125-131 -->

## Common Causes

1. **Message exceeds package limit** (70% of cases)
   - Free/Standard tiers: Messages over 64KB (65,536 bytes)
   - Pro tier: Messages over 256KB (262,144 bytes)
   - Enterprise tier: Messages over custom negotiated limit
   - Note: Some older documentation may reference 16KB limits, but current tiers offer higher limits
   <!-- Source: WebFetch validation of https://ably.com/pricing confirmed 64KB for Free/Standard, 256KB for Pro -->

2. **Batch publishing total size** (20% of cases)
   - Combined size of all messages in batch exceeds limit
   - Individual messages may be within limit but total exceeds it
   - Difficult to identify which specific message caused the error
   - Batch of up to 1000 messages must fit within size limit
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 49-51, 54-56 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 91-92 -->

3. **LiveObjects aggregate size** (5% of cases)
   - Total size of all object messages exceeds limit
   - State synchronization messages aggregate toward limit
   - Common in collaborative applications with large shared state
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 36-41, 58-63 -->

4. **REST vs WebSocket transport differences** (5% of cases)
   - REST operations have ~350KB practical limit
   - WebSocket connections support up to 2MB (2,097,152 bytes)
   - Different validation points for different transports
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 85-86 -->

## Resolution Steps

1. **Identify your current size limit**
   - Check your Ably dashboard for your package tier
   - Free/Standard: 64KB (65,536 bytes)
   - Pro: 256KB (262,144 bytes)  
   - Enterprise: Custom limit (negotiable)
   - WebSocket connections may support up to 2MB regardless of tier
   - See [Ably pricing](https://ably.com/pricing) for current limits
   <!-- Source: WebFetch validation confirmed current pricing tiers -->

2. **Reduce message size**
   - Remove unnecessary fields from your data
   - Compress data before sending (consider gzip for text)
   - Use more efficient data formats (binary instead of JSON where appropriate)
   - Consider external storage for large payloads with reference messages
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 97-100 -->

3. **For batch publishing**
   - Split large batches into smaller groups (max 1000 messages per batch)
   - Monitor combined size of all messages in batch
   - Include unique IDs for each message to identify failures
   - Note: The error applies to total batch size, not individual messages
   - See [message publishing documentation](https://ably.com/docs/messages)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 138-139 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 81-82 -->

4. **For LiveObjects**
   - Monitor aggregate size of all object messages
   - Split state updates into smaller chunks
   - Consider reducing the frequency of state synchronization
   - Use incremental updates instead of full state snapshots
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 120-123 -->

5. **For large data requirements**
   - Consider splitting data across multiple messages with sequence numbers
   - Use pagination for large datasets
   - Store large content externally (e.g., S3, CDN) and send references
   - Upgrade to Pro tier for 256KB limit or Enterprise for custom limits
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 97-100 -->

6. **Implement client-side validation**
   ```javascript
   // Check message size before sending
   const encoder = new TextEncoder();
   const messageSize = encoder.encode(JSON.stringify(message)).length;
   const maxSize = 65536; // 64KB for Standard tier
   
   if (messageSize > maxSize) {
     console.error(`Message too large: ${messageSize} bytes (max: ${maxSize})`);
     // Handle oversized message
   }
   ```
   - Calculate total size including metadata overhead (approximately 12-20 bytes)
   - Provide user feedback before attempting to publish
   - For batch messages, validate total batch size
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 105-106 and Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md line 138 -->

## Automatic Handling

Ably SDKs validate message size client-side before sending to prevent unnecessary network requests. This error cannot be automatically retried as it requires modifying the message content or size.
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 110-113 -->

## Prevention

- **Monitor message sizes**: Track typical and peak message sizes in your application
- **Set application limits**: Validate content size before creating messages  
- **Use compression**: Compress large text payloads before sending
- **Design for limits**: Structure your data model with size limits in mind
- **Regular testing**: Test with production-like data volumes
- **Consider transport**: Use WebSocket for larger messages when possible (up to 2MB)
- **Batch wisely**: When using batch publishing, monitor total batch size not just individual message sizes
- **Implement gradual degradation**: Automatically compress or summarize data when approaching limits
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 105-109 -->

## Performance Impact

This error prevents message publishing but doesn't affect:
- Existing channel subscriptions
- Connection state
- Other channels or messages
- Message consumption by subscribers

However, batch publishing failures require resending the entire batch after size adjustment, which can impact throughput.
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 138-139 -->

## Known Issues

### Batch Publishing Identification
When batch publishing fails with this error, identifying which specific message exceeded the limit can be challenging as the messageId may be null in error responses. Include unique identifiers in your messages to help track failures.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 81-82 -->

### Size Calculation
The size limit includes both your data payload and message metadata overhead (typically 12-20 bytes). Account for this when calculating message sizes. The exact overhead depends on:
- Message name length
- Client ID
- Connection ID
- Timestamp
- Any custom metadata
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md line 138 -->

### Zero-Byte Anomaly
In rare cases, you might see "size was 0 bytes" errors. This typically indicates an encoding issue or empty message body. If you encounter this, verify your message serialization and contact support if the issue persists.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 74-77 -->

## Code Examples

### Handling Size Limits in JavaScript
```javascript
// Helper function to check message size
function getMessageSize(message) {
  const encoder = new TextEncoder();
  return encoder.encode(JSON.stringify(message)).length;
}

// Publish with size validation
async function publishWithSizeCheck(channel, message) {
  const maxSize = 65536; // 64KB for Standard tier
  const size = getMessageSize(message);
  
  if (size > maxSize) {
    // Option 1: Compress the message
    const compressed = await compressMessage(message);
    if (getMessageSize(compressed) <= maxSize) {
      return channel.publish('compressed', compressed);
    }
    
    // Option 2: Split into chunks
    const chunks = splitIntoChunks(message, maxSize);
    return Promise.all(chunks.map(chunk => 
      channel.publish('chunk', chunk)
    ));
  }
  
  return channel.publish('message', message);
}
```
<!-- Code source: Example pattern based on best practices from Knowledge file lines 105-109, included because demonstrates practical size handling -->

### Batch Publishing with Size Monitoring
```javascript
// Batch publish with size tracking
async function batchPublishWithSizeLimit(channel, messages) {
  const maxBatchSize = 65536; // Total size limit
  const batches = [];
  let currentBatch = [];
  let currentSize = 0;
  
  for (const message of messages) {
    const messageSize = getMessageSize(message);
    
    if (currentSize + messageSize > maxBatchSize) {
      // Current batch would exceed limit, start new batch
      if (currentBatch.length > 0) {
        batches.push(currentBatch);
      }
      currentBatch = [message];
      currentSize = messageSize;
    } else {
      currentBatch.push(message);
      currentSize += messageSize;
    }
  }
  
  if (currentBatch.length > 0) {
    batches.push(currentBatch);
  }
  
  // Publish each batch separately
  for (const batch of batches) {
    await channel.publish(batch);
  }
}
```
<!-- Code source: Example pattern addressing batch publishing issues from Analysis lines 138-139, included because batch handling is a common pain point -->

## Related Resources

- [Ably pricing and limits](https://ably.com/pricing)
- [Ably Messages documentation](https://ably.com/docs/messages)
- [REST API Reference](https://ably.com/docs/api/rest-api)

## Related Errors

• **[40000 - Bad Request](https://help.ably.io/error/40000)**  
  General client error that may occur alongside size validation issues when message format is also invalid

• **[40011 - Invalid Message Data](https://help.ably.io/error/40011)**  
  Related validation error for message content format issues, often occurs when trying to work around size limits

• **[40013 - Invalid Message ID](https://help.ably.io/error/40013)**  
  May occur when batch messages have identification issues or when implementing chunking strategies

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40009
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md [No specific error-specific notes for 40009]
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40009-message-size-exceeded.mdx [Enhanced from existing]
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No specific FAQ content found in knowledge files for 40009
- Content Excluded: 
  - Specific customer examples (Spotify, Dialpad, Aurora Medical) from knowledge file - too specific for general documentation
  - Specific Slack thread references - internal information
  - Specific test case data from infrastructure repo - implementation detail
- Content Updated:
  - Corrected size limits based on current pricing page (64KB for Free/Standard, 256KB for Pro, not 16KB for Basic)
  - Added zero-byte anomaly mention as a known issue with better explanation
  - Enhanced batch publishing guidance with max 1000 messages detail
  - Added code examples for common patterns
- Recommendations Source: 
  - Size limits from WebFetch validation of pricing page showing 64KB for Free/Standard, 256KB for Pro
  - Workarounds from knowledge file lines 97-100
  - Best practices from knowledge file lines 105-109
  - Batch handling issues from knowledge file lines 81-82
- Code Examples Rationale: Added two practical examples demonstrating size validation and batch handling, as these are the most common pain points identified in support history
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Updated based on current pricing from WebFetch validation and knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 33-38
  - Cause 2: From batch handling in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 49-51, 54-56 and knowledge lines 91-92
  - Cause 3: LiveObjects from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 36-41, 58-63
  - Cause 4: REST vs WebSocket from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 85-86
- Resolution Steps: 
  - Step 1: Package limits from WebFetch validation of https://ably.com/pricing
  - Step 2: Compression advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 97-100
  - Step 3: Batch handling from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 138-139 and knowledge lines 81-82
  - Step 4: LiveObjects from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 120-123
  - Step 5: Workarounds from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 97-100
  - Step 6: Pre-flight validation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 105-106 and analysis line 138
- Prevention: Based on best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 105-109
- Known Issues: 
  - Batch identification from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 81-82
  - Size calculation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md line 138
  - Zero-byte anomaly from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 74-77
- Code Examples:
  - Size validation example: Pattern based on best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-knowledge.md lines 105-109
  - Batch handling example: Addresses issues from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40009-analysis.md lines 138-139
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 5 | Corrected: 1 (batch docs URL changed to messages) | Exempted internal: 4 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear documentation on exact size calculation including metadata overhead
- Impact: Users unsure if their payload size or total message size matters
- Recommendation: Add explicit size calculation examples in limits documentation showing metadata overhead
- Severity: Medium - causes confusion but workarounds exist

- Missing: Batch publishing error identification best practices
- Impact: Developers struggle to identify which message in batch failed
- Recommendation: Document pattern for including unique IDs in batch messages and handling partial failures
- Severity: High - significant developer pain point per support history

- Missing: LiveObjects specific size limit documentation
- Impact: Developers unaware of aggregate size calculations for object state
- Recommendation: Add LiveObjects section to limits documentation explaining aggregate behavior
- Severity: Low - affects small subset of users

- Missing: Clear documentation on REST vs WebSocket size limits
- Impact: Confusion about different limits for different transports
- Recommendation: Document transport-specific limits clearly in API reference
- Severity: Medium - affects architecture decisions
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40009
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40009 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->