<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40022 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document both deprecated API Streamer feature and Control API validation errors with clear resolution paths -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40022: Invalid Resource or Deprecated Feature

## What Happened

Your request failed because you're either trying to use a deprecated feature (API Streamer) or your resource validation failed in the Control API.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40022 | 400 or 422 | Client Error (Validation/Deprecation) | No - requires configuration fix |

## Quick Fix

- If using channels starting with `[product:` - remove these deprecated channel names
- For Control API errors - check the `details` field for specific validation issues
- Contact support@ably.com if migrating from API Streamer

## Error Messages

You may see one of these messages:
- "API Streamer is no longer offered, contact support@ably.com for more information"
- "Invalid resource" (with specific details in the response)
- "API Streamer has been shut down"
- Context-specific validation messages in the `details` field

## Common Causes

### 1. **Deprecated API Streamer Usage** (Most common for channel operations)
   - Attempting to attach to channels starting with `[product:`
   - Using legacy exchange (xchg) channels
   - Following outdated documentation referencing API Streamer
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md lines 86-92 -->

### 2. **Control API Validation Failures** (For app/rule management)
   - **Rule Configuration Issues**:
     - Missing or invalid `enveloped` parameter
     - Invalid `requestMode` (must be 'single' or 'batch')
     - Incompatible enveloped/requestMode combinations
   - **Resource Not Found**:
     - Invalid queue IDs for AMQP rules
     - Non-existent API keys referenced
   - **Invalid Parameters**:
     - Invalid AWS regions for queues
     - Malformed certificates
     - Duplicate resource names
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md lines 38-49 -->

## Resolution Steps

### For API Streamer Errors

1. **Identify deprecated channel names**
   - Check if your channel names start with `[product:`
   - These channels are no longer supported
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md lines 21-25 -->

2. **Update your channel naming**
   - Remove the `[product:` prefix
   - Use standard Ably channel naming conventions
   - See [Channel documentation](https://ably.com/docs/channels)

3. **Contact support for migration assistance**
   - Email support@ably.com with your use case
   - Include your app ID and current channel patterns
   - Support team will help with migration to supported features
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md line 19 -->

### For Control API Validation Errors

1. **Check the error details**
   - The response includes a `details` field with specific validation issues
   - Example: `"queueId": "Could not find queue with id <id>"`
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md lines 150-163 -->

2. **Fix rule configuration issues**
   - For enveloped rules: Use `enveloped=true` with `requestMode=batch`
   - For non-enveloped rules: Use `enveloped=false` with `requestMode=single`
   - Some rule types (CloudFlare, IFTTT, Zapier) don't support enveloped parameter
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md lines 56-60 -->

3. **Validate resource parameters**
   - For queue regions: Use valid regions (us-east-1-a, eu-west-1-a)
   - For resource names: Ensure they're unique within your app
   - For certificates: Ensure proper formatting
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md lines 68-70 -->

## Automatic Handling

This error will not be automatically retried by Ably SDKs as it indicates a configuration issue that must be fixed before the operation will succeed.

## Prevention

### Avoiding API Streamer Errors
- Never use channel names starting with `[product:`
- Follow current Ably documentation for channel naming
- Remove any references to exchange or xchg channels from your code

### Avoiding Control API Validation Errors
- Always validate parameters against the [Control API documentation](https://ably.com/docs/control-api)
- Use the correct enveloped/requestMode combinations for rules
- Check resource existence before referencing in rules
- Use unique names for all resources

## Related Resources

- [Channel documentation](https://ably.com/docs/channels)
- [Control API documentation](https://ably.com/docs/control-api)
- [Integration rules documentation](https://ably.com/docs/integrations/webhooks)

## Related Errors

• **[40000 - Bad Request](https://help.ably.io/error/40000)**  
  General client error for malformed requests or invalid states

• **[40400 - Not Found](https://help.ably.io/error/40400)**  
  Resource not found errors that may occur alongside validation failures

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40022
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40022)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40022-invalid-resource-or-deprecated-feature.mdx (enhanced and updated)
-->

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 5 | Corrected: 3 | Exempted internal: 2 -->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Migration guidance from Knowledge file lines 115-133
- Content Excluded: Internal implementation details about specific server code locations
- Recommendations Source: 
  - API Streamer deprecation handling from Analysis lines 86-92
  - Control API validation patterns from Knowledge lines 38-49, 119-133
- Code Examples Rationale: No code examples included as they would be misleading for a deprecated feature and validation errors are context-specific
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - API Streamer deprecation: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md lines 86-92
  - Control API validation: From Knowledge file at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md lines 38-49
- Resolution Steps: 
  - Step 1 (API Streamer): Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-analysis.md lines 21-25
  - Step 2 (Channel naming): Based on Ably documentation at https://ably.com/docs/channels
  - Step 3 (Support contact): From error message in Analysis line 19
  - Control API steps: Knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40022-knowledge.md lines 56-70, 119-133
- Prevention: Based on patterns identified in Analysis and Knowledge files
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear migration guide from API Streamer to current features
- Impact: Users with legacy implementations have no self-service migration path
- Recommendation: Create a dedicated migration guide for API Streamer users
- Severity: Medium (affects legacy users only)
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40022
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40022 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->