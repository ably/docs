---
title: Spaces authentication
meta_description: "Configure authentication for Spaces applications with the required capabilities."
---

For comprehensive authentication guidance including server implementation, client patterns, and token lifecycle, see [Platform Authentication](/docs/platform/auth/token).

This page covers Spaces-specific capabilities and space scoping.

## Spaces capabilities

Your tokens need specific capabilities depending on which Spaces features you use:

| Feature | Required Capabilities |
|---------|----------------------|
| Avatar stack (member events) | `subscribe`, `presence` |
| Member locations | `subscribe`, `presence` |
| Live cursors | `publish`, `subscribe` |
| Component locking | `subscribe`, `presence` |
| **All Spaces features** | `publish`, `subscribe`, `presence`, `history` |

## Space-scoped capabilities

You can restrict tokens to specific spaces. Spaces use multiple channels for different features:

<Code>
```javascript
// Server-side JWT with space-scoped capabilities
import jwt from 'jsonwebtoken';

const [keyName, keySecret] = process.env.ABLY_API_KEY.split(':');

const ablyJwt = jwt.sign(
  {
    'x-ably-capability': JSON.stringify({
      // Main space channel for presence and locations
      'your-space': ['publish', 'subscribe', 'presence', 'history'],
      // Cursors channel
      'your-space::$cursors': ['publish', 'subscribe'],
    }),
    'x-ably-clientId': userId,
  },
  keySecret,
  { algorithm: 'HS256', keyid: keyName, expiresIn: '1h' }
);
```

```python
# Server-side JWT with space-scoped capabilities
import jwt
import json
import time
import os

key_name, key_secret = os.environ['ABLY_API_KEY'].split(':')

now = int(time.time())
ably_jwt = jwt.encode(
    {
        'iat': now,
        'exp': now + 3600,
        'x-ably-capability': json.dumps({
            # Main space channel for presence and locations
            'your-space': ['publish', 'subscribe', 'presence', 'history'],
            # Cursors channel
            'your-space::$cursors': ['publish', 'subscribe'],
        }),
        'x-ably-clientId': user_id,
    },
    key_secret,
    algorithm='HS256',
    headers={'kid': key_name}
)
```
</Code>

<Aside data-type='important'>
If you use API key authentication on the client, any user can claim any `clientId`, undermining the collaborative features that Spaces provides. Always use [token authentication](/docs/platform/auth/token) in production.
</Aside>

## Client setup

Use `authCallback` to fetch JWTs from your auth server:

<Code>
```javascript
import Spaces from '@ably/spaces';
import { Realtime } from 'ably';

const client = new Realtime({
  authCallback: async (tokenParams, callback) => {
    try {
      const response = await fetch('/api/ably-token');
      const jwt = await response.text();
      callback(null, jwt);
    } catch (error) {
      callback(error, null);
    }
  },
});

const spaces = new Spaces(client);
```
</Code>

See [token authentication](/docs/platform/auth/token#auth-callback) for complete examples in all languages.

## Further reading

- [Token authentication](/docs/platform/auth/token) - Complete token authentication guide
- [Capabilities](/docs/platform/auth/capabilities) - Fine-grained permission control
- [Identified clients](/docs/platform/auth/identified-clients) - Assigning trusted client identities
