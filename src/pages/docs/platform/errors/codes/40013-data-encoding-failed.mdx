<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40013 -->
<!-- Generated: 2025-09-02T08-05-05-187Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/8f8fd9c/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Focus on data type validation and encoding chain issues as primary causes -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40013: Data encoding failed

## What Happened

Your message data could not be encoded or decoded due to an unsupported data type, incorrect message format, or encoding processing failure.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40013 | 400 | Client Error (Message Validation) | No - requires fixing data format |

## Troubleshooting

### Unsupported Data Type
**Symptom**: "Data type is unsupported" error when publishing
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 63-73 -->
**Solution**: Convert your data to a supported type before publishing:

**JavaScript/TypeScript** - Supported: String, Buffer, Object, Array, null
```javascript
// ❌ Wrong: Publishing a number directly
channel.publish('event', 42);

// ✅ Correct: Convert to string or wrap in object
channel.publish('event', '42');
channel.publish('event', { value: 42 });
```

**Ruby** - Supported: String, Hash, Array, nil
```ruby
# ❌ Wrong: Publishing unsupported type
channel.publish('event', 123)

# ✅ Correct: Convert to supported type
channel.publish('event', '123')
channel.publish('event', { value: 123 })
```
<!-- Source: Code patterns from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 199-238 -->

### Invalid Single-Argument Format
**Symptom**: "The single-argument form of publish() expects a message object or an array of message objects"
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 70-76 -->
**Solution**: Use the correct publish format:
```javascript
// ❌ Wrong: Invalid single argument
channel.publish('just a string');

// ✅ Correct: Two arguments or message object
channel.publish('event', 'just a string');
channel.publish({ name: 'event', data: 'just a string' });
```

### Encryption/Decryption Failures
**Symptom**: "Error processing the cipher encoding" often after idle periods
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md lines 81-88, 91-97 -->
**Solution**: Ensure encryption keys are consistent between publisher and subscriber:
```javascript
// Ensure both publisher and subscriber use the same key
const cipherKey = 'your-consistent-base64-key';
const channel = realtime.channels.get('secure', {
  cipher: { key: cipherKey }
});
```
<!-- Source: Customer experience from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md lines 81-88 -->

### Encoding Chain Processing
**Symptom**: "Invalid data type for 'base64' decoding" or "unknown encoding"
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 94-125 -->
**Solution**: Verify data matches the encoding requirements - base64 needs strings, JSON needs objects/arrays.

### LiveObjects Map Validation
**Symptom**: "Map value data type is unsupported" when using LiveObjects
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 81-85 -->
**Solution**: Use only primitive or JSON-serializable values in LiveMap.

## Prevention

- Always validate data types match your SDK's supported types before publishing
- Use consistent cipher keys across all publishers and subscribers
- For React/Vue applications, memoize channel names to prevent race conditions
<!-- Source: Resolution patterns from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md lines 136-141 -->
- Handle promise rejections when publishing to avoid script exits in Node.js
<!-- Source: GitHub issue #248 from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md lines 66-70 -->

## Related Errors

• **[40140 - Token Expired](https://help.ably.io/error/40140)**  
  Token issues that may affect encrypted channel authentication

• **[92001 - Encryption Configuration Error](https://help.ably.io/error/92001)**  
  Cipher parameter configuration issues

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40013
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/8f8fd9c/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40013)
- Existing Documentation: No existing documentation found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Original marshall as JSON/MsgPack advice incorporated as data type conversion guidance
- Content Excluded: WebCrypto API specific details as too implementation-specific
- Recommendations Source: 
  - Data type solutions from analysis lines 199-238
  - Encryption solutions from knowledge lines 81-97 (customer reports)
  - React memoization from knowledge lines 91-97 (Pearson VUE case)
- Code Examples Rationale: Included essential examples showing correct vs incorrect data types per analysis lines 241-263
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Unsupported data types: Based on analysis findings in https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 63-73
  - Invalid format: From SDK code at https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-analysis.md lines 70-76
  - Encryption issues: Customer reports in https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40013-knowledge.md lines 81-97
- Resolution Steps: 
  - Data type conversion: Source from analysis lines 199-238 showing correct patterns
  - Encryption key consistency: Support cases from knowledge lines 81-88 - preserved due to customer experience
  - React memoization: Pearson VUE resolution from knowledge lines 91-97
- Prevention: Based on patterns from knowledge lines 136-141 and GitHub issue #248
-->

<!-- URL Validation Completed: 2025-09-02T08-05-05-187Z -->
<!-- External URLs verified: 2 | Corrected: 0 | Exempted internal: 2 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40013
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40013 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/8f8fd9c/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->