Each enveloped message will have the following fields:

- source := the source for the webhook, namely "@channel.message@" or "@channel.presence@"
- appId := the Ably app this message came from
- channel := the Ably channel where the event occurred
- site := the Ably datacenter which sent the message
- timestamp := a timestamp represented as milliseconds since the epoch for the presence event

In addition, it will contain another field which will contain the actual message, which is named according to the message type.

h4(#envelope-example-message). Enveloped message events

For @message@ events, the @messages@ array contains a 'raw' message.

minimize. View enveloped @message@ payload example
  ```[json]
  {
    "source": "channel.message",
    "appId": "aBCdEf",
    "channel": "channel-name",
    "site": "eu-central-1-A",
    "ruleId": "1-a2Bc",
    "messages": [{
      "id": "ABcDefgHIj:1:0",
      "connectionId": "ABcDefgHIj",
      "timestamp": 1123145678900,
      "data": "some message data",
      "name": "my message name"
    }]
  }
  ```

h5(#envelope-example-message-decoding). Decoding enveloped messages

Messages sent "over the realtime service":/realtime/channels are automatically decoded into "@Messages@":/realtime/types#message object by the Ably client library. With webhooks you need to to do this explicitly, using "@Message.fromEncodedArray@":/realtime/messages#message-from-encoded-array on the @messages@ array, or "@Message.fromEncoded@":/realtime/messages#message-from-encoded or an individual member of that array. This will transform them into an array of "@Messages@":/realtime/types#message (or in the case of @fromEncoded@, an individual "@Message@":/realtime/types#message). This has several advantages, e.g.:

* It will fully decode any @data@ (using the @encoding@) back into the same datatype that it was sent in (or an equivalent in each client library's language)
* If you are using "encryption":/realtime/encryption, you can pass your encryption key to the method and it will decrypt the @data@ for you

We recommend you do this for all messages you receive over webhooks. For example (using ably-js):

```[javascript]
const messages = Ably.Realtime.Message.fromEncodedArray(webhookMessage.messages);
messages.forEach((message) => {
  console.log(message.toString());
})
```

h4(#envelope-example-presence). Enveloped presence events

For @presence@ events, there will be a @presence@ field, which will contain the "@Presence@":/realtime/presence#presence-message event.

minimize. View enveloped @message@ payload example
  ```[json]
  {
    "source": "channel.message",
    "appId": "aBCdEf",
    "channel": "channel-name",
    "site": "eu-central-1-A",
    "ruleId": "1-a2Bc",
    "presence": [{
      "id": "abCdEFgHIJ:1:0",
      "clientId": "bob",
      "connectionId": "Ab1CDE2FGh",
      "timestamp": 1582270137276,
      "data": "some data in the presence object",
      "action": 4
    }]
  }
  ```