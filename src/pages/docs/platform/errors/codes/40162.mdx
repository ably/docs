---
title: "Error 40162 - Token revocation requires basic auth"
meta_description: "Information and troubleshooting for Ably error code 40162 - Token revocation requires basic auth"
meta_keywords: "Ably, error, error codes, 40162, token revocation, basic auth, authentication, API key"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40162 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Documenting privileged operation restriction - token revocation requires API key authentication for security */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

Token revocation is a privileged operation that requires basic authentication (API key) rather than token authentication.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ---------------- | -------- | --------- |
| 40162 | 401 | Client error (authentication) | No |

## Error messages

The following error messages can be returned with error code 40162:

| Message | Description |
| ------- | ----------- |
| Cannot revoke tokens when using token auth | Client-side error when attempting token revocation with token authentication. |
| Unable to revoke token except with basic auth, using the key from which the token was issued | Server-side validation error requiring API key authentication. |

## Impact

This error prevents the token revocation operation from completing. However, it has no impact on:

- Existing authenticated connections or sessions.
- Other authentication operations like token creation or renewal.
- The validity of the tokens you're trying to revoke.
- Normal messaging and channel operations.

This is a client configuration error that will not be automatically retried. You must use basic authentication (API key) instead of token authentication to perform token revocation operations.

## Quick fixes

Try the following quick fixes to resolve the error:

- Use an API key-authenticated client for token revocation operations.
- Move token revocation to server-side code where API keys are available.
- Design your architecture to avoid needing token revocation (use short TTLs instead).

## Troubleshooting

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-analysis.md lines 31-36 */}
{/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 14-24 */}

### Authentication method mismatch

| Error messages |
| -------------- |
| Cannot revoke tokens when using token auth |
| Unable to revoke token except with basic auth, using the key from which the token was issued |

This occurs when:

- A client authenticated with a token attempts to revoke tokens.
- Token-authenticated services try to perform token lifecycle management.
- JWT or token-authenticated requests call revocation endpoints.

To resolve this:

- Switch to API key authentication for token revocation.
{/* Source: Knowledge resolution from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 41-52 */}
- Ensure your client is instantiated with an API key instead of a token:

<Code>
```javascript
// Wrong: Token-authenticated client cannot revoke tokens
const client = new Ably.Rest({
  token: 'your-token'
});
await client.auth.revokeTokens([...]); // Will fail with 40162

// Correct: API key-authenticated client has full privileges
const client = new Ably.Rest({
  key: 'your-api-key' // Basic auth with full privileges
});
await client.auth.revokeTokens([
  { type: 'clientId', value: 'client-to-revoke' }
]); // Will succeed
```
</Code>
{/* Code source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 43-52, essential for demonstrating correct authentication method */}

### Server-side revocation pattern

{/* Source: Knowledge architectural pattern from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 54-70 */}

For security best practices, token revocation should be performed server-side:

<Code>
```javascript
// Server-side with API key
const adminClient = new Ably.Rest({
  key: process.env.ABLY_API_KEY
});

// Revocation endpoint
app.post('/revoke-tokens', async (req, res) => {
  try {
    await adminClient.auth.revokeTokens(req.body.tokenSpecs);
    res.json({ success: true });
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});
```
</Code>
{/* Code source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 56-70, showing recommended server-side pattern */}

## Prevention

{/* Source: Knowledge prevention strategies from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 80-90 */}

To avoid encountering this error:

- **Separate authentication concerns**: Use API keys for administrative operations and tokens for user-facing clients.
- **Keep revocation server-side**: Perform token management operations only from backend services with API key access.
- **Design for token expiration**: Use short token TTLs instead of revocation where possible.
- **Understand privilege boundaries**: Accept that token-authenticated clients cannot manage other tokens.

### Alternative approaches to token management

{/* Source: Knowledge alternatives from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md lines 105-115 */}

Instead of token revocation, consider:

- **Short token TTL**: Set token lifetimes to minutes rather than hours.
- **Regular token renewal**: Implement automatic token refresh patterns.
- **Capability restrictions**: Use narrow token capabilities to limit scope.
- **Session management**: Handle user sessions at the application level rather than through token revocation.

## Security considerations

{/* Source: Analysis security implications from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-analysis.md lines 52-58 */}

This restriction enforces critical security boundaries:

- Prevents tokens from revoking other tokens (privilege escalation).
- Ensures only API key holders can perform administrative operations.
- Maintains clear separation between user and administrative operations.
- Protects against unauthorized token lifecycle management.

## Related errors

The following errors are related to error 40162:

| Error code | Description |
| ---------- | ----------- |
| [40160 - Token authentication error](/docs/platform/errors/codes/40160) | Related token authentication issue that may occur alongside revocation attempts. |
| [40161 - Token capability error](/docs/platform/errors/codes/40161) | Token capability restrictions that prevent certain operations. |
| [40102 - Token expired](/docs/platform/errors/codes/40102) | Token expiration error - consider using expiration instead of revocation. |

{/* Source: Related errors from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-analysis.md lines 60-63 */}

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Resources

The following resources provide further context or assistance with this error:

- [Authentication documentation](https://ably.com/docs/auth)
- [Token authentication](https://ably.com/docs/auth/token)
- [Basic authentication](https://ably.com/docs/auth/basic)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40162-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md (no specific notes for 40162)
- Existing Documentation: None existed
- Repository Overviews: Not needed for this straightforward error
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file lines 41-52 (API key authentication), lines 56-70 (server-side pattern), lines 105-115 (alternatives)
- Content Excluded: None - all relevant content included
- Recommendations Source:
  - Switch to API key: Knowledge lines 41-52
  - Server-side pattern: Knowledge lines 56-70
  - Alternative approaches: Knowledge lines 105-115
- Code Examples Rationale: Included essential code showing correct vs incorrect authentication method and server-side pattern as these are critical for resolution
*/}

{/* ATTRIBUTION BY SECTION:
- Error messages:
  - Client message: Analysis line 17
  - Server message: Analysis line 26
- Impact: Based on security boundary context from Analysis lines 52-58
- Quick fixes: Knowledge lines 37-40, 54-55, 73-77
- Troubleshooting:
  - Authentication mismatch: Analysis lines 31-36, Knowledge lines 14-24
  - API key solution: Knowledge lines 41-52
  - Server-side pattern: Knowledge lines 56-70
- Prevention: Knowledge lines 80-90
- Alternative approaches: Knowledge lines 105-115
- Security considerations: Analysis lines 52-58
- Related errors: Analysis lines 60-63
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 4 | Corrected: 0 | Exempted internal: 9 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40162
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40162 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}