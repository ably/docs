---
title: "Unauthorized - action refused due to lack of authentication"
meta_description: "Understand and resolve Ably error 40100 which occurs when an action cannot be performed due to authentication or authorization issues."
meta_keywords: "Ably error, error code 40100, unauthorized, authentication failure, device token mismatch, API key invalid, push notification error, access refused"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40100 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Comprehensive documentation covering both general authentication failures and specific device push notification issues based on extensive support ticket analysis */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

# Unauthorized - action refused due to lack of authentication

This error occurs when an action cannot be performed due to missing or invalid authentication credentials, insufficient permissions, or authorization failures.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ----------- | -------- | --------- |
| 40100 | 401 | Client Error (Authentication) | No |

## Error messages

You may see one of these messages:

| Message | Context |
| ------- | ------- |
| `Access refused` | Generic authentication failure |
| `Unauthorized` | Standard HTTP 401 mapping |
| `Invalid API key. Ensure you have a valid key configured.` | API key validation failure |
| `Token deviceId does not match requested device operation` | Device token mismatch |
| `Incompatible deviceSecret specified for device access` | Device credential validation failure |
| `Incompatible updateToken specified for device access` | Device update token failure |
| `Unable to authenticate device credentials; device not found` | Non-existent device |
| `cannot update device id or appId` | Immutable property update attempt |
| `cannot update transportType` | Insufficient permissions for transport update |
| `push not enabled for this channel` | Push capability not configured |
| `Failed to get a token` | Token request failure |

## Impact

This error prevents the current operation from completing. The connection will not be established or the requested action will be denied. The SDK will not automatically retry this error because it indicates an authentication or authorization problem that requires correcting credentials or permissions.

For connection attempts, this error causes the connection to enter the `failed` state, requiring creation of a new connection with valid credentials.

## Troubleshooting

The following are common causes and resolutions for error 40100:

### Invalid or missing API key
{/* Source: Knowledge base from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 73-74 */}
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 108-118 */}

| Error message | Description |
| ------------- | ----------- |
| `Invalid API key. Ensure you have a valid key configured.` | API key is invalid, expired, or revoked |
| `Access refused` | Generic authentication failure |

This occurs when:
- The API key is malformed or incomplete
- The key has been revoked or regenerated
- Using a key from the wrong Ably app or environment

To resolve this:
1. Log into your [Ably dashboard](https://ably.com/dashboard)
2. Navigate to your app and select the "API Keys" tab
3. Copy the complete key including all three parts: `appId.keyId:keySecret`
4. Ensure you're using the correct environment (production vs sandbox)

<Code>
```javascript
// Correct - complete API key with all three parts
const ably = new Ably.Realtime('xVLyHw.Ke5A1w:dTfJtg-OP2L8B...');

// Incorrect - partial key missing parts
const ably = new Ably.Realtime('xVLyHw.Ke5A1w');
```
</Code>
{/* Code source: Ably documentation at https://ably.com/docs/auth/basic#api-key-format, essential for demonstrating correct key format */}

### Device token mismatch for push notifications
{/* Source: Knowledge base support tickets from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 125-151 */}
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 41-49 */}

| Error message | Description |
| ------------- | ----------- |
| `Token deviceId does not match requested device operation` | Device ID in token doesn't match the requested operation |

This occurs when:
- Switching between Ably environments (staging to production) with existing device registrations
- Device credentials persist across environment changes
- Token claims don't match the device being operated on

To resolve this:
1. Always deactivate push notifications before switching environments
2. If deactivation fails with 40100, reset the device registration:
   - Uninstall and reinstall the app, or
   - Clear app data/storage to remove persisted device credentials
3. Re-register the device in the new environment

This is a known issue when using multiple Ably environments within a single application.
{/* Source: Bank Jago support tickets from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 125-151 */}

### Device credential validation failures
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 27-35, 53-54 */}

| Error message | Description |
| ------------- | ----------- |
| `Incompatible deviceSecret specified for device access` | Device secret doesn't match stored credentials |
| `Incompatible updateToken specified for device access` | Update token validation failed |
| `Unable to authenticate device credentials; device not found` | Device doesn't exist |

This occurs when:
- Device secrets or update tokens don't match stored values
- Attempting operations on non-existent devices
- Credentials from one device used for another

To resolve this:
1. Ensure device credentials are correctly stored and retrieved
2. Verify the device exists before attempting operations
3. Implement proper device credential management in your app
4. Consider re-registering the device if credentials are lost

### Attempting to modify immutable device properties
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 17-19, 21-25, 165-167 */}

| Error message | Description |
| ------------- | ----------- |
| `cannot update device id or appId` | Attempting to change device ID or app ID |
| `cannot update transportType` | Non-admin attempting to change transport type |

This occurs when:
- Trying to update a device's ID or app ID (these are immutable)
- Non-admin users attempting to modify push transport type

To resolve this:
1. Device ID and app ID cannot be changed after creation
2. To change these properties, delete and re-create the device
3. Only admin users can modify transport type settings

### Push notifications not enabled
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 36-39 */}

| Error message | Description |
| ------------- | ----------- |
| `push not enabled for this channel` | Channel lacks push notification capability |

This occurs when:
- Attempting push operations on channels without push capabilities configured
- Channel rules don't include push notifications

To resolve this:
1. Enable push notifications for the channel in your [Ably dashboard](https://ably.com/dashboard)
2. Configure appropriate channel rules for push delivery
3. Ensure your API key has push admin capabilities

### Token request failures
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 86-88 */}

| Error message | Description |
| ------------- | ----------- |
| `Failed to get a token` | Token request to authURL or authCallback failed |

This occurs when:
- Your auth endpoint returns a non-200 status code
- The auth callback throws an exception
- Token request is malformed

To resolve this:
1. Verify your auth endpoint is returning HTTP 200 status
2. Check auth endpoint response includes valid token request/token
3. Ensure your authCallback doesn't throw exceptions
4. Review token request format in the [authentication documentation](https://ably.com/docs/auth/token)

## Prevention

To prevent this error:

1. **Credential Management**: Store and retrieve API keys and tokens securely
2. **Environment Separation**: Maintain separate device registrations per environment
3. **Token Refresh**: Implement proper token renewal before expiry
4. **Error Handling**: Catch 40100 errors and implement re-authentication flows
5. **Device Lifecycle**: Properly deactivate devices before environment switches
{/* Source: Best practices from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 197-210 */}

## Related errors

The following errors are related to error code 40100:

| Error code | Description |
| ---------- | ----------- |
| [40101 - Invalid credentials](/docs/platform/errors/codes/40101) | Occurs when API key format is invalid or credentials don't match |
| [40102 - Client ID mismatch](/docs/platform/errors/codes/40102) | Token client ID doesn't match connection client ID |
| [40103 - Basic auth over non-TLS](/docs/platform/errors/codes/40103) | Basic authentication attempted over insecure connection |
| [40104 - Timestamp not current](/docs/platform/errors/codes/40104) | Token timestamp outside acceptable window |
| [40130-40149 - Token errors](/docs/platform/errors/codes/40130) | Various token-related authentication failures |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Additional resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Push notifications setup](https://ably.com/docs/push)
- [Device registration guide](https://ably.com/docs/push/activate)
- [Token authentication](https://ably.com/docs/auth/token)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: Device environment switching guidance from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 125-151 (Bank Jago support tickets)
- Content Excluded: Specific internal Slack thread references and implementation details
- Recommendations Source:
  - API key validation from FAQ at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 73-74
  - Device management from support analysis at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 197-210
- Code Examples Rationale: Minimal code included only for API key format demonstration, essential for understanding correct vs incorrect formats
*/}

{/* ATTRIBUTION BY SECTION:
- Common Causes:
  - Invalid API key: Based on CLI tool implementation in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 108-118
  - Device token mismatch: From Bank Jago support tickets in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 125-151
  - Device credentials: From realtime server code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 27-35, 53-54
  - Immutable properties: From device management code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 17-25
  - Push not enabled: From push service at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 36-39
  - Token failures: From PHP SDK at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 86-88
- Resolution Steps:
  - Step 1 (API key): Source from https://ably.com/docs/auth/basic - standard key format
  - Step 2 (Device token): FAQ advice from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 125-151 - preserved due to extensive customer impact
  - Step 3 (Device credentials): Based on error patterns in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 27-54
  - Step 4 (Immutable properties): From code analysis at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 17-25, 165-167
  - Step 5 (Push enablement): From push service code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 36-39
  - Step 6 (Token requests): From PHP SDK at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-analysis.md lines 86-88
- Prevention: Based on best practices discovered from support tickets at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40100-knowledge.md lines 197-210
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 5 | Corrected: 0 | Exempted internal: 10 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40100
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40100 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}