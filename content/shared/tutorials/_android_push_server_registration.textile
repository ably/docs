With the server created and able to generate simplistic tokens, we can now allow it to also setup *device registration*, which will allow devices to register to notifications from Ably via the server. It is also possible to have a device register directly for notifications, as covered in "step 7":#step-7, and you can use either or depending on your own preference.

Add the following code to your @main.js@ file:

```[nodejs]
app.get('/register', (req, res) => {
  console.log('Registering device');
  var deviceId = req.query.deviceId;
  var registrationToken = req.query.registrationToken;
  var clientId = req.query.clientId;
  // var deviceId and deviceToken to be received in the request object
  var recipientDetails = {
    // It's "fcm" for Android.
    transportType: 'fcm',
    // Replace with actual device token
    registrationToken: registrationToken
  };

  var myDevice = {
    id: deviceId,
    clientId:clientId,
    formFactor: 'phone',
    metadata: 'PST',
    platform: 'android',
    push: {
      recipient: recipientDetails
    }
  };
  client.push.admin.deviceRegistrations.save(myDevice, (err, device) => {
    if (err) {
      console.log(err);
    } else {
      console.log(device);
      subscribeDevice(device);
      res.setHeader('Content-Type', 'application/json');
      res.send(device);
    }
  });
});
```

In the above code we use the @save()@ method on the @realtime.push.admin.deviceRegistrations@ to register the device with Ably, using its @device ID@, that was sent as part of the request. If the registration is successful, we go on to subscribe the device (or client) to the push channel over which we intend to send the required messages.

This function is shown below:

```[nodejs]
// Device subscription
function subscribeDevice (device) {
  var channelSub = {
    channel: 'push:test_push_channel',
    deviceId: device.id
  };
  client.push.admin.channelSubscriptions.save(channelSub, (err, channelSub) => {
    if(err){
      console.log(err);
    } else{
      console.log('Device subscribed to push channel with deviceId' + device.id);
    }
  });
}
```

Our server is all set to register devices and subscribe them to the push channel.