---
title: "Getting started: Pub/Sub in Go"
meta_description: "Get started with Pub/Sub in Go using Ably. Learn how to publish, subscribe, track presence, fetch message history, and manage realtime connections."
meta_keywords: "Pub/Sub Go, Go PubSub, Ably Go SDK, realtime messaging Go, publish subscribe Go, Ably Pub/Sub guide, Go realtime communication, Ably tutorial Go, Go message history, presence API Go, Ably Pub/Sub example, realtime Pub/Sub Go, subscribe to channel Go, publish message Go, Ably CLI Pub/Sub"
---

This guide will get you started with Ably Pub/Sub in Go.

It will take you through the following steps:

* Create a client and establish a realtime connection to Ably.
* Attach to a channel and subscribe to its messages.
* Publish a message to the channel for your client to receive.
* Join and subscribe to the presence set of the channel.
* Retrieve the messages you sent in the guide from history.
* Close a connection to Ably when it is no longer needed.

## Prerequisites <a id="prerequisites"/>

1. [Sign up](https://ably.com/signup) for an Ably account.
2. Create a [new app](https://ably.com/accounts/any/apps/new), and create your first API key in the "API Keys" tab of the dashboard.
3. Your API key will need the `publish`, `subscribe`, `presence` and `history` capabilities.
4. Install [Go](https://go.dev/dl/) version 1.18 or greater.
5. Create a new project in your IDE and install the Ably Pub/Sub Go SDK:

<Code>
```shell
mkdir ably-go-quickstart
cd ably-go-quickstart
go mod init ably-go-quickstart

go get -u github.com/ably/ably-go/ably
```
</Code>

### (Optional) Install Ably CLI <a id="install-cli"/>

1. Install the Ably CLI:

<Code>
```shell
npm install -g @ably/cli
```
</Code>

2. Run the following to log in to your Ably account and set the default app and API key:

<Code>
```shell
ably login
```
</Code>

<Aside data-type='note'>
The code examples in this guide include a demo API key. If you wish to interact with the Ably CLI and view outputs within your Ably account, ensure that you replace them with your own API key.
</Aside>

## Step 1: Connect to Ably <a id="step-1"/>

Clients establish a connection with Ably when they instantiate an SDK instance. This enables them to send and receive messages in realtime across channels.

Create a `main.go` file in your project and add the following function to instantiate the SDK and establish a connection to Ably. At the minimum you need to provide an authentication mechanism. Use an API key for simplicity, but you should use [token authentication](/docs/auth/token) in production environments. A [`clientId`](/docs/auth/identified-clients) ensures the client is identified, which is required to use certain features, such as presence:

<Code>
```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/ably/ably-go/ably"
)

func main() {
	client, err := ably.NewRealtime(
		ably.WithKey("{{API_KEY}}"),
		ably.WithClientID("my-first-client"),
	)
	if err != nil {
		log.Fatal(err)
	}
	defer client.Close()

	// Wait for the connection to be connected
	connStateChan := make(chan ably.ConnectionStateChange, 1)
	client.Connection.On(ably.ConnectionEventConnected, func(change ably.ConnectionStateChange) {
		connStateChan <- change
	})
	select {
	case <-connStateChan:
		fmt.Println("Made my first connection!")
	case <-context.Background().Done():
		log.Fatal("Context cancelled before connection established")
	}

	// Keep the program running
	select {}
}
```
</Code>

You can monitor the lifecycle of clients' connections by registering a listener that will emit an event every time the connection state changes. For now, run the function with `go run main.go` to log a message to the console to know that the connection attempt was successful. You'll see the message printed to your console, and you can also inspect the connection event in the dev console of your app.

## Step 2: Subscribe to a channel and publish a message <a id="step-2"/>

Messages contain the data that a client is communicating, such as a short 'hello' from a colleague, or a financial update being broadcast to subscribers from a server. Ably uses channels to separate messages into different topics, so that clients only ever receive messages on the channels they are subscribed to.

In your `main()` function, before the line `// Keep the program running`, add the following to create a channel instance and register a listener to subscribe to the channel. Then run it with `go run main.go`:

<Code>
```go
channel := client.Channels.Get("my-first-channel")

// Subscribe to messages
unsubscribe, err := channel.SubscribeAll(context.Background(), func(msg *ably.Message) {
  fmt.Printf("Received message: %s\n", msg.Data)
})

if err != nil {
  log.Fatal(err)
}
defer unsubscribe()
```
</Code>

Use the Ably CLI to publish a message to your first channel. The message will be received by the client you've subscribed to the channel, and be logged to the console.

<Code>
```shell
ably channels publish my-first-channel 'Hello!'
```
</Code>

In a new terminal tab, subscribe to the same channel using the CLI:

<Code>
```shell
ably channels subscribe my-first-channel
```
</Code>

Publish another message using the CLI and you will see that it's received instantly by the client you have running locally, as well as the subscribed terminal instance.

To publish a message in your code, you can add the following line to your `main` function after subscribing to the channel:

<Code>
```go
err = channel.Publish(context.Background(), "example", "A message sent from my first client!")
if err != nil {
	log.Fatal(err)
}
```
</Code>

## Step 3: Join the presence set <a id="step-3"/>

Presence enables clients to be aware of one another if they are present on the same channel. You can then show clients who else is online, provide a custom status update for each, and notify the channel when someone goes offline.

In your `main()` function, before the line `// Keep the program running`, add the following to subscribe to, and join, the presence set of the channel. Then run it with `go run main.go`:

<Code>
```go
// Subscribe to presence events
presenceUnsubscribe, err := channel.Presence.Subscribe(context.Background(), ably.PresenceActionEnter, func(msg *ably.PresenceMessage) {
  fmt.Printf("Event type: %s from %s with the data %v\n", msg.Action, msg.ClientID, msg.Data)
})
if err != nil {
  log.Fatal(err)
}
defer presenceUnsubscribe()

// Enter the presence set
err = channel.Presence.Enter(context.Background(), "I'm here!")
if err != nil {
  log.Fatal(err)
}
```
</Code>

You can have another client join the presence set using the Ably CLI:

<Code>
```shell
ably channels presence enter my-first-channel --client-id "my-cli" --data '{"status":"learning about Ably!"}'
```
</Code>

## Step 4: Retrieve message history <a id="step-4"/>

You can retrieve previously sent messages using the history feature. Ably stores all messages for 2 minutes by default in the event a client experiences network connectivity issues. The [message storage](/docs/storage-history/storage) page has more information on how to extend the storage period.

If more than 2 minutes has passed since you published a regular message (excluding the presence events), then you can publish some more before trying out history. You can use the Pub/Sub SDK, Ably CLI or the dev console to do this.

For example, using the Ably CLI to publish 5 messages:

<Code>
```shell
ably channels publish --count 5 my-first-channel "Message number {{.Count}}"
```
</Code>

Update your `main()` function to retrieve any messages that were recently published to the channel. Then run it with `go run main.go`:

<Code>
```go
// Add this after channel subscription
pages, err := channel.History().Pages(context.Background())
if err != nil {
	log.Fatal(err)
}

var messages []string
for pages.Next(context.Background()) {
	for _, msg := range pages.Items() {
		messages = append(messages, fmt.Sprintf("%v", msg.Data))
	}
}
if err := pages.Err(); err != nil {
	log.Fatal(err)
}

// Print messages in reverse order (newest first)
for i := len(messages) - 1; i >= 0; i-- {
	fmt.Println(messages[i])
}
```
</Code>

The output will look similar to the following:

<Code>
```json
[
  'Message number 5',
  'Message number 4',
  'Message number 3',
  'Message number 2',
  'Message number 1'
]
```
</Code>

## Step 5: Close the connection <a id="step-5"/>

Connections are automatically closed approximately 2 minutes after no heartbeat is detected by Ably. Explicitly closing connections when they are no longer needed is good practice to help save costs. It will also remove all listeners that were registered by the client.

Note that messages are streamed to clients as soon as they attach to a channel, as long as they have the necessary capabilities. Clients are implicitly attached to a channel when they call `subscribe()`. Detaching from a channel using the `detach()` method will stop the client from being streamed messages by Ably.

Listeners registered when subscribing to a channel are registered client-side. Unsubscribing by calling `unsubscribe()`  will remove previously registered listeners for that channel. Detaching from a channel has no impact on listeners. As such, if a client reattaches to a channel that they previously registered listeners for, then those listeners will continue to function upon reattachment.

Update your `main()` function to close the connection after a simulated 10 seconds. Run it with `go run main.go`.

First add the `time` package to your imports:

<Code>
```go
import (
	"context"
	"fmt"
	"log"
	"time"

	"github.com/ably/ably-go/ably"
)
```
</Code>

Now replace the `select {}` statement with a sleep statement to simulate a delay before closing the connection:

<Code>
```go
// Replace the select {} with:
time.Sleep(10 * time.Second)
fmt.Println("Closing the connection to Ably!")
```
</Code>

Note that the `defer client.Close()` statement at the beginning of the function ensures the connection is properly closed when the program exits.

## Next steps <a id="next-steps"/>

Continue to explore the documentation with Go as the selected language:

Read more about the concepts covered in this guide:

* Learn the basics of [Pub/Sub](/docs/pub-sub?lang=go)
* Explore more [advanced](/docs/pub-sub/advanced?lang=go) Pub/Sub concepts
* Understand realtime [connections](/docs/connect?lang=go) to Ably
* Read more about how to use [presence](/docs/presence-occupancy/presence?lang=go) in your apps
* Fetch message [history](/docs/storage-history/history?lang=go) in your apps

You can also explore the Ably CLI further, or visit the Pub/Sub [API references](/docs/api/realtime-sdk?lang=go).
