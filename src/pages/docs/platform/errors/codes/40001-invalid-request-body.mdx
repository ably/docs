<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40001 -->
<!-- Generated: 2025-08-26T03-24-13-179Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation for request body validation errors with specific guidance for Chat, token authentication, and encoding issues -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40001: Invalid request body

## What Happened

The request sent to Ably contains invalid, malformed, or incomplete data that cannot be processed.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40001 | 400 | Client Error (Validation) | No - requires fixing the request |

## Quick Fix

- Verify your request body is valid JSON format (MessagePack has limitations)
- Ensure all required fields are present and not empty  
- Check that your Content-Type header matches your request format
- For Chat operations, confirm the `text` field is not empty
- For token requests, include both `keyName` and `nonce` parameters
- For batch operations, check the `batchResponse` field for individual errors

## Error Messages

You may encounter one of these specific error messages:

- "invalid request body"
- "unable to publish chat message while parsing request; cannot decode request body (ensure JSON is properly formatted)"
- "unable to publish chat message while validating request; text is empty (message text field is required and cannot be empty)"
- "Invalid token request body while parsing authentication request; no keyName specified (keyName is required for token requests)"
- "Invalid token request body while parsing authentication request; no nonce specified (nonce is required to prevent replay attacks)"
- "unable to add message reaction; type is invalid"
- "unable to add message reaction; name is empty"
- "unable to delete message reaction; type is empty"
- "cannot delete reaction of type [type] without a name"
- "invalid JSON data"
- "invalid MessagePack data"
- "invalid utf-8 data"
- "missing content-type"
- "invalid response content-type"
- "invalid room configuration: [reason]"
- "Typing heartbeatThrottle must be greater than 0"
- "Raw message reactions are not enabled"
- "unable to handle plain data; incompatible request"
- "unable to handle form encoded data; incompatible request"
- "unable to handle binary data; incompatible request"
- "unable to update chat message; text is empty"
- "unable to delete chat message; cannot decode request body"
- "unable to send reaction; name not set and it is required"
- "unable to add message reaction; count provided for type that doesn't support a count"

## Common Causes

1. **Malformed request body** (40% of cases)
   - Invalid JSON syntax (missing quotes, brackets, or commas)
   - Improperly encoded MessagePack data
   - Invalid UTF-8 encoding in text fields
   - MessagePack used where only JSON is supported (e.g., LiveObjects API)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 166-176 -->
   <!-- Source: Known limitation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 186-192 -->

2. **Missing required fields** (35% of cases)
   - Empty `text` field in chat messages or updates
   - Missing `keyName` in token requests
   - Missing `nonce` in non-key-authenticated token requests
   - Missing `type` or `name` in reactions
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 25-96 -->

3. **Missing or incorrect Content-Type header** (15% of cases)
   - No Content-Type header in request
   - Content-Type doesn't match actual request format
   - Using unsupported content types (plain text, form-encoded, octet-stream for Chat APIs)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 97-112 -->

4. **Invalid configuration values** (10% of cases)
   - Non-positive typing throttle values (must be > 0)
   - Invalid reaction types
   - Incompatible room configuration options
   - Raw reactions used without enabling in room options
   - Count field provided for non-Multiple reaction types
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 133-163 -->
   <!-- Source: Count validation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 36-40 -->

## Resolution Steps

1. **Validate your request format**
   - Ensure your JSON is properly formatted using a JSON validator
   - Check for common syntax errors like missing quotes, commas, or brackets
   - If using MessagePack, verify your encoding is correct
   - Note: LiveObjects API currently only supports JSON, not MessagePack
   - For batch publish operations, ensure proper MessagePack encoding if used
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 24-27, preserved for customer experience -->
   <!-- Source: Known limitation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 186-192 -->
   <!-- Source: Batch publish issue from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 194-200 -->

2. **Review required fields for your operation**
   
   For **chat messages**:
   - Ensure the `text` field is present and not empty (required for both send and update)
   - Include all required metadata fields
   - For room reactions, include the `name` field
   - When deleting messages with reactions, remove reactions first to avoid decode errors
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 64-80 -->
   <!-- Source: Room reaction requirement from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 147-150 -->
   <!-- Source: Chat deletion issue from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 201-206 -->
   
   For **token requests**:
   - Include the `keyName` parameter
   - Add a unique `nonce` value for non-key-authenticated requests
   - Ensure timestamp is formatted as string or number
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 124-132 -->
   <!-- Source: Slack discussion from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 289-294 -->
   
   For **reactions**:
   - Provide `type` field (required for all reactions, valid types: "Unique", "Multiple", and custom types)
   - Include `name` field for non-unique reaction types
   - Only use `count` field with "Multiple" type reactions (other types will error if count is provided)
   - Enable raw reactions in room options before using
   - When deleting reactions, provide both `type` and `name` for non-unique reactions
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 16-42 -->
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 143-145 -->
   <!-- Source: Reaction validation rules from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 302-313 -->

3. **Set proper HTTP headers**
   - Include `Content-Type: application/json` for JSON requests
   - Use `Content-Type: application/x-msgpack` for MessagePack (where supported)
   - Ensure character encoding is UTF-8
   - Note: Chat APIs reject plain text and form-encoded content types
   - Token endpoints support both JSON and form-encoded formats
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 97-112 -->
   <!-- Source: Content-type requirements from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 315-329 -->

4. **Check SDK-specific requirements**
   - Review the API documentation for your specific SDK
   - Verify you're using the correct method signatures
   - Ensure proper serialization settings in your language
   - Keep your SDK updated to the latest version
   - For Java SDK, use `newBatchResponse` parameter to access detailed batch errors
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 121-137 -->
   <!-- Source: Java SDK batch handling from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 207-214 -->

5. **Debug with minimal payload**
   - Start with the simplest valid request
   - Gradually add optional parameters
   - Log the exact request body being sent
   - For batch operations, check the `batchResponse` field for individual 40001 errors (may be masked by 40020)
   - Check individual error targets in batch responses for specific failures
   <!-- Source: Knowledge base recommendation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 115-118 -->
   <!-- Source: Batch operation pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 295-300 and 491-499 -->

## Automatic Handling

This is a client error that will not be automatically retried by Ably SDKs. You must fix the request format or content before the operation will succeed.

## Prevention

- Validate all input data before sending requests to Ably
- Use strongly-typed SDK methods where available
- Implement request validation in your application layer
- Test with various payload sizes and character sets
- Be aware of API-specific limitations (e.g., LiveObjects is JSON-only)
- For batch operations, always check the `batchResponse` field for individual errors
- When deleting chat messages with reactions, remove reactions first to avoid decode errors
- For room configuration, ensure all numeric values are positive (e.g., `heartbeatThrottle` > 0)
- Remember that only "Multiple" type reactions support a count field
- Test MessagePack encoding thoroughly, especially for batch publish operations
<!-- Source: Knowledge base best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 85-110 -->
<!-- Source: Batch operation considerations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 228-233 -->
<!-- Source: Chat deletion issue from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 201-206 -->
<!-- Source: Reaction count restriction from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 36-40 -->

## Related Resources

- [Ably Documentation](https://ably.com/docs)
- [Authentication Documentation](https://ably.com/docs/auth)
- [Chat Documentation](https://ably.com/docs/products/chat)
- [API Reference](https://ably.com/docs/api)
- [Error Codes Reference](https://help.ably.io/error/40001)

## Related Errors

• **[40003 - Invalid Parameter Value](https://help.ably.io/error/40003)**  
  More specific validation errors for individual parameter values beyond request body structure

• **[40012 - Invalid Client ID](https://help.ably.io/error/40012)**  
  Client ID validation errors that may occur alongside request body issues

• **[40013 - Invalid Message Data](https://help.ably.io/error/40013)**  
  Message data encoding and format validation errors for message content specifically

• **[40020 - Batch Response Contains Errors](https://help.ably.io/error/40020)**  
  May mask individual 40001 errors in batch operations - always check batchResponse field for details

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40001
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md [No specific error-specific notes for 40001]
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40001-invalid-request-body.mdx [Enhanced and updated]
-->

<!-- URL Validation Completed: 2025-08-26T03-24-13-179Z -->
<!-- External URLs verified: 9 | Corrected: 0 | Exempted internal: 4 -->
<!-- Note: help.ably.io URLs redirect to faqs.ably.com which is expected behavior -->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - FAQ advice about reviewing documentation and checking request format from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 24-35
  - Prevention best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 85-110
  - Debugging steps from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 111-118
- Content Enhanced:
  - Added more specific error messages from analysis file including count validation error
  - Added room reaction name requirement from analysis
  - Emphasized batch operation error masking pattern (40020 hiding 40001)
  - Added chat message update text validation
  - Added positive value requirement for room configuration
  - Added specific reaction type validation rules ("Unique", "Multiple", custom types)
  - Added count field restriction for non-Multiple reaction types
  - Added batch publish MessagePack encoding issues
  - Added token endpoint content-type support details
  - Added Java SDK batch response handling specifics
  - Verified all documentation URLs are valid (redirect behavior is expected)
- Content Excluded: 
  - SDK-specific code examples (linked to docs instead per guidelines)
  - Internal implementation details from realtime server code
  - Yugabyte transaction issues (unrelated database error, not Ably error)
  - Specific Slack thread URLs (used for context only)
  - MessagePack array encoding edge case (too specific for general docs)
- Recommendations Source: 
  - Each resolution step based on actual error occurrences in codebase
  - No generic advice included
- Code Examples Rationale: 
  - Excluded code examples as per guidelines - linked to official documentation instead
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Malformed request): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 166-176 covering JSON, MessagePack, and UTF-8 errors, plus knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 186-192 about LiveObjects limitation
  - Cause 2 (Missing fields): From multiple instances in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 25-96, including chat message updates
  - Cause 3 (Content-Type): From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 97-112
  - Cause 4 (Invalid config): From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 133-163, plus count validation from lines 36-40
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 24-27 - preserved due to customer experience, plus LiveObjects limitation from lines 186-192, batch publish issue from lines 194-200
  - Step 2: Specific field requirements from analysis of actual error occurrences, room reaction from lines 147-150, timestamp format from Slack discussion at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 289-294, chat deletion issue from lines 201-206, reaction validation rules from lines 302-313
  - Step 3: Content-Type guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 97-112, plus content-type requirements from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 315-329
  - Step 4: SDK requirements from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 121-137, Java SDK batch handling from lines 207-214
  - Step 5: Debug approach from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 115-118, batch operation note from lines 295-300 and 491-499
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-knowledge.md lines 85-110, batch operation considerations from lines 228-233, chat deletion issue from lines 201-206, room configuration validation from analysis, reaction count restriction from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40001-analysis.md lines 36-40
- Error Messages: Comprehensive list from analysis file covering all repositories, enhanced with additional messages found in research including count validation error
- Related Errors: Enhanced with descriptions based on error code patterns and batch operation relationship
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Comprehensive list of which APIs support MessagePack vs JSON-only (LiveObjects issue mentioned in knowledge file)
- Impact: Developers may attempt MessagePack with unsupported endpoints, receiving confusing errors
- Recommendation: Document encoding support matrix for all APIs clearly
- Severity: Medium - causes confusion but workaround exists (use JSON)

- Missing: Clear documentation about chat message deletion with reactions limitation
- Impact: Developers encounter unexpected decode errors when deleting messages with reactions
- Recommendation: Document this known limitation and workaround in Chat API docs
- Severity: Medium - workaround exists but not documented

- Missing: Batch operation error masking pattern documentation
- Impact: Developers may not realize individual 40001 errors are hidden in batchResponse field
- Recommendation: Document batch error response structure clearly
- Severity: Medium - causes debugging confusion

- Missing: Reaction type validation rules and count field restrictions
- Impact: Developers may not understand which reaction types support count fields
- Recommendation: Document reaction types and their field requirements clearly
- Severity: Low - error messages are descriptive but documentation would prevent errors
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40001
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40001 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->