---
title: "Error 40020: Partial failure in batch operation"
meta_description: "Understand and resolve Ably error 40020, which indicates partial failures in batch operations where some requests succeed while others fail."
meta_keywords: "Ably error 40020, batch error, partial failure, batch operations, message publishing, presence retrieval, token revocation"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40020 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Document partial batch failures with focus on accessing individual results in batchResponse array */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

This error occurs when a batch request partially fails, meaning that some operations succeed while others fail. The response includes both an error indicator and detailed results for each individual operation.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ---------------- | -------- | --------- |
| 40020 | 400 | Batch Operation | Partial |

## Error messages

| Message | Context |
| ------- | ------- |
| "Batched response includes errors" | Standard server response when any operation in a batch fails |
| "Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)" | JavaScript SDK browser compatibility issue (misuse of 40020) |

## Impact

This error indicates a partial success where:
- Some operations in the batch completed successfully
- Other operations failed with specific errors
- The overall request returns HTTP 400 status

Unlike complete failures, you can still access successful results from the `batchResponse` array. The SDK does not automatically retry this error as individual failures may have different causes.

## Troubleshooting

Error 40020 requires examining the `batchResponse` array to identify which specific operations failed and why.

### Accessing partial results in batch operations

| Error message | Affected endpoints |
| ------------- | ------------------ |
| "Batched response includes errors" | `POST /messages`, `POST /revokeTokens`, `GET /presence` |

This occurs when:
- One or more operations in your batch request fail
- Individual operations encounter validation errors, permission issues, or resource problems

To resolve this:

1. **Check the batchResponse array for individual results**
   {/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-knowledge.md lines 73-74 */}
   Each entry in `batchResponse` contains either success data or an error object with details about the specific failure.

2. **Handle partial success appropriately**
   {/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md lines 55-60 */}
   ```javascript
   if (response.error && response.error.code === 40020) {
     // Partial success - check individual results
     response.batchResponse.forEach((result, index) => {
       if (result.error) {
         console.log(`Operation ${index} failed: ${result.error.message}`);
         // Handle failed operation (retry, log, alert)
       } else {
         console.log(`Operation ${index} succeeded`);
         // Process successful result
       }
     });
   }
   ```
   {/* Code source: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-knowledge.md lines 120-131, essential for demonstrating partial success handling */}

3. **Identify common failure patterns**
   Review the error details in failed operations to identify patterns:
   - Invalid channel names or patterns
   - Insufficient permissions for specific operations
   - Rate limits on individual channels
   - Malformed message data

### Browser compatibility issue (JavaScript SDK)

| Error message | Context |
| ------------- | ------- |
| "Delta decoding not supported on this browser" | Message decoding with vcdiff encoding |

This occurs when:
{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md lines 25-29 */}
- Attempting delta decompression on browsers without `Uint8Array` support
- Processing messages with 'vcdiff' encoding

To resolve this:
- Upgrade to a modern browser that supports `ArrayBuffer` and `Uint8Array`
- Disable delta compression if supporting legacy browsers

## SDK-specific handling

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md lines 61-66 */}
Different SDKs handle error 40020 in specific ways:

- **Java SDK**: Explicitly allows 40020 errors to pass through without throwing exceptions, enabling access to partial results
- **JavaScript SDK**: Uses 40020 for browser compatibility warnings (appears to be a misuse of this error code)
- **CLI**: Detects 40020 to provide user-friendly feedback about which specific channels or operations failed

## Response format

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md lines 77-89 */}
A standard batch error response includes:

```json
{
  "error": {
    "message": "Batched response includes errors",
    "code": 40020,
    "statusCode": 400
  },
  "batchResponse": [
    { "channel": "channel1", "messageId": "abc123" },
    {
      "error": {
        "message": "Channel 'invalid-name!' contains invalid characters",
        "code": 40006,
        "statusCode": 400
      }
    }
  ]
}
```

## Prevention

To minimize partial batch failures:

- Validate all input data before sending batch requests
- Ensure proper authentication and channel capabilities for all operations
- Keep batch sizes reasonable to avoid timeout issues
- Implement retry logic for failed individual operations
- Monitor patterns in failures to identify systematic issues

## Related errors

The following errors are related to error code 40020:

| Error code | Description |
| ---------- | ----------- |
| [40006 - Invalid channel name](/docs/platform/errors/codes/40006) | Individual batch operations may fail due to invalid channel names. |
| [40010 - Invalid message data](/docs/platform/errors/codes/40010) | Message batches can partially fail if some messages have invalid data. |
| [40030 - Rate limit exceeded](/docs/platform/errors/codes/40030) | Individual operations in a batch may hit rate limits. |
| [40140 - Token expired](/docs/platform/errors/codes/40140) | Token expiration during batch processing can cause partial failures. |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Resources

- [Ably batch operations documentation](https://ably.com/docs)
- [API reference](https://ably.com/docs)
- [Error handling best practices](https://ably.com/docs)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40020-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md [No specific error-specific notes for 40020]
- Existing Documentation: None found
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: Code example from knowledge file lines 120-131 showing partial success handling pattern
- Content Excluded: Browser compatibility issue appears to be misuse of error code, included with caveat
- Recommendations Source:
  - Partial success handling: Knowledge file lines 105-118
  - Response format: Analysis file lines 77-89
  - SDK variations: Analysis file lines 61-66
- Code Examples Rationale: Included essential pattern for handling batchResponse as this is critical for resolution
*/}

{/* ATTRIBUTION BY SECTION:
- Error Overview: Based on knowledge file lines 29-38 and analysis file lines 8-10
- Error Messages:
  - Main message from analysis file line 18
  - Browser message from analysis file lines 27-28
- Impact: Based on analysis file lines 55-60
- Troubleshooting:
  - Batch handling: Knowledge file lines 105-118, analysis file lines 55-60
  - Code example: Knowledge file lines 120-131
  - Browser issue: Analysis file lines 25-29
- SDK Handling: Analysis file lines 61-66
- Response Format: Analysis file lines 77-89
- Related Errors: Inferred from batch operation context and common error patterns
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 1 (Ably support) | Corrected: 0 | Exempted internal: 3 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40020
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40020 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}