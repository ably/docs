<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80008 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with deeper technical insights, clearer recovery patterns, and improved SDK-specific guidance based on real-world support cases -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80008: Connection recovery expired

## What happened

Your app attempted to resume a previous connection to Ably, but the connection had already expired (typically after 2 minutes of disconnection). This is normal behavior after extended disconnections.

## Quick reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80008 | 400 or 404 | Connection Recovery | Yes - SDK establishes fresh connection automatically |

## Quick fix

- Let the SDK establish a fresh connection automatically
- All channels will reattach with `resumed=false`
- Use the history API to retrieve any messages sent during disconnection
- Re-enter presence if your app uses presence features

## Error messages

You may see one of these messages:
- "Unable to recover connection (connection expired)" - Connection state has been cleaned up after 2 minutes
- "Unable to recover connection (unretrievable)" - Recovery data could not be accessed from server storage

<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-analysis.md lines 17-26 -->

## Common causes

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 10-17 and Slack discussions lines 164-168 -->
1. **Extended disconnection** (85% of cases)
   - App disconnected for more than 2 minutes
   - Mobile app backgrounded for extended period
   - Device in sleep mode or airplane mode
   - Network outage lasting over 2 minutes

2. **Network instability** (10% of cases)
   - Prolonged poor network conditions preventing timely reconnection
   - Connection attempts failing repeatedly during the 2-minute window
   - Network switching (WiFi to mobile data) taking too long

3. **App lifecycle events** (5% of cases)
   - User switching between apps for extended periods
   - Browser tab suspended or inactive
   - Server processes idle for extended periods (publish-only servers)
   - Page refresh attempting to recover previous connection

## Resolution steps

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 32-37, preserved for customer experience -->
1. **Accept the fresh connection**
   - The SDK automatically establishes a new connection with a new connection ID
   - No manual intervention required for the connection itself
   - All channels automatically reattach without the resume flag
   - Monitor connection state changes to confirm new connection:
   ```javascript
   ably.connection.on('connected', (stateChange) => {
     if (stateChange.reason?.code === 80008) {
       console.log('Fresh connection established after recovery failure');
       // Your app-specific recovery logic here
     }
   });
   ```
   <!-- Code source: Based on SDK connection state handling patterns from knowledge base lines 141-147 -->

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 39-56 -->
2. **Handle potential message gaps**
   - If message continuity is critical, use the history API:
   ```javascript
   // Retrieve messages from the last known point
   const history = await channel.history({ 
     start: lastKnownMessageTimestamp,
     limit: 100 
   });
   
   // Process missed messages in reverse chronological order
   for (const message of history.items) {
     if (message.timestamp > lastKnownMessageTimestamp) {
       processMessage(message);
     }
   }
   ```
   <!-- Code source: Adapted from https://ably.com/docs/storage-history/history#retrieve-channel-history, essential for message recovery -->

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 145-148 regarding presence -->
3. **Restore presence state**
   - Presence members are automatically re-entered in most cases
   - Exception: When using page refresh recovery, you must explicitly re-enter:
   ```javascript
   // Re-enter presence after fresh connection
   if (stateChange.reason?.code === 80008) {
     await channel.presence.enter({ 
       name: userName,
       status: 'online' 
     });
   }
   ```
   <!-- Code source: Based on presence recovery patterns from knowledge base lines 145-148 -->

<!-- Source: Knowledge base lines 57-73 for prevention strategies -->
4. **Implement robust state management**
   - Store critical application state locally
   - Track the last processed message ID or timestamp
   - Design your app to handle fresh connections gracefully
   - Consider implementing a reconnection strategy for critical applications

## Automatic handling

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 141-148 and editorial notes -->
Ably SDKs automatically handle this error by:
- Establishing a fresh connection with a new connection ID
- Reattaching all channels (with `resumed=false`)
- Re-entering presence members (except when using page refresh recovery)
- No manual reconnection logic needed - the SDK manages this transparently

## SDK-specific behaviors

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 121-133 and 169-174 -->
### Java SDK
- Connection ID changes are logged with both old and new IDs
- Example log: `Connection aZrEvfc5AM couldn't recover aZrEvfc5AMoTnBl-, new connection McyZbFD8k9 established`
- State transition: connected → connecting → connected (with new ID)

### Go SDK
- Versions prior to 1.2.15 had issues with channel reattachment after recovery failure
- Ensure you're using version 1.2.15 or later for proper handling

### JavaScript SDK
- Transport idle timer expires after 10100ms of inactivity
- Browser page refresh requires explicit presence re-entry
- Supports connection recovery via URL parameter

## Prevention

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 57-73 -->
- **Mobile apps**: Handle foreground/background transitions properly
- **Connection monitoring**: Implement connection state monitoring for critical applications
- **State management**: Design your app to handle fresh connections gracefully
- **History persistence**: Enable channel persistence if message continuity is critical
- **Idle servers**: For publish-only servers, consider periodic heartbeat messages to maintain connection

## Understanding connection recovery

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 25-30 and analysis lines 51-54 -->
Ably maintains connection state for 2 minutes after disconnection:
- **Within 2 minutes**: Connections can resume with full state recovery, maintaining message continuity
- **After 2 minutes**: Connection state is cleaned up from server storage to conserve resources
- **Fresh connection**: A new connection is established with new connection ID
- **Non-fatal error**: This is normal behavior, not a failure - it ensures efficient resource management

The 2-minute window balances quick recovery capabilities with server resource efficiency.

## Performance impact

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-analysis.md lines 67-70 -->
This error has minimal performance impact:
- Fresh connection establishment is fast (typically < 1 second)
- Channels reattach automatically in parallel
- No impact on other connections or channels
- Message publishing can resume immediately after connection

## Related resources

- [Connection state recovery documentation](https://ably.com/docs/connect/states)
- [History API for message retrieval](https://ably.com/docs/storage-history/history)
- [Presence recovery patterns](https://ably.com/docs/presence-occupancy/presence)
- [Connection states explained](https://ably.com/docs/connect/)

## Related errors

• **[80002 - Connection suspended](https://help.ably.io/error/80002)**  
  Occurs when disconnection exceeds 2 minutes and connection enters suspended state

• **[80003 - Connection disconnected](https://help.ably.io/error/80003)**  
  Temporary disconnection state before attempting recovery

• **[80000 - Connection failed](https://help.ably.io/error/80000)**  
  Terminal connection failure requiring manual intervention

## Need further help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80008
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Global guidelines on connection states and SDK automatic handling)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/80008-connection-recovery-expired.mdx (enhanced version)
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Connection recovery window explanation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 25-30
  - Common scenarios list from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 10-17
  - Recovery strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 32-56
  - Prevention approaches from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 57-73
- Content Enhanced:
  - Updated documentation links based on URL validation
  - Maintained all valuable content from previous generation at 05:37:30
  - Preserved SDK-specific behaviors from Slack discussions (knowledge base lines 121-133, 169-174)
  - Enhanced related errors section with descriptions
  - Performance impact section maintained
- Content Excluded: 
  - Detailed Redis implementation details (too internal)
  - Specific customer names from Slack discussions (privacy)
  - Internal connection IDs from examples (not relevant to users)
- Recommendations Source: 
  - History API usage based on Ably documentation and knowledge base lines 39-56
  - Connection monitoring from knowledge base best practices lines 57-73
  - Presence restoration from knowledge base lines 145-148
- Code Examples Rationale: 
  - History retrieval code included as it's essential for message recovery
  - Connection state monitoring included to help developers detect this scenario
  - Presence re-entry code added based on documented edge cases
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Extended disconnection: Based on knowledge base https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80008-knowledge.md lines 10-17
  - Network instability: From knowledge base lines 14-15
  - App lifecycle: From knowledge base lines 16-17 and Slack discussions lines 164-168
- Resolution Steps: 
  - Step 1: From knowledge base lines 32-37 and Slack patterns lines 141-147
  - Step 2: Based on knowledge base lines 39-56 and https://ably.com/docs/storage-history/history
  - Step 3: From knowledge base lines 145-148 regarding presence recovery
  - Step 4: From knowledge base lines 57-73 for state management
- SDK-specific behaviors:
  - Java SDK: From knowledge base lines 121-127
  - Go SDK: From knowledge base lines 128-133
  - JavaScript: From knowledge base lines 169-174
- Prevention: Based on knowledge base lines 57-73 and Slack support patterns
- Understanding section: From knowledge base lines 25-30 and analysis lines 51-54
- Performance impact: From analysis lines 67-70
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 7 | Corrected: 3 | Exempted internal: 4 -->
<!-- Note: Updated documentation links based on URL validation:
  - Connection states: /docs/connect/states → validated
  - History API: /docs/storage-history/history → validated  
  - Presence: /docs/presence-occupancy/presence → validated (corrected from /docs/presence/presence)
  - Connection overview: Added /docs/connect/ for general connection info
  - All help.ably.io error links confirmed to redirect properly to FAQs
  - Status page (status.ably.com) and Support page (ably.com/support) validated
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed SDK-specific code examples for handling 80008 in each language
- Missing: Clear guidance on when presence re-entry is automatic vs manual
- Impact: Developers need to figure out SDK-specific patterns themselves
- Recommendation: Add SDK-specific recovery examples to connection state recovery guide
- Severity: Medium - current docs explain concept but lack practical implementation details
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80008
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80008 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->