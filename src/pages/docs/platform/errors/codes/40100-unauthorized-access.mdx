<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40100 -->
<!-- Generated: 2025-08-21T17-17-40-434Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation focused on device management and authentication issues, emphasizing the distinction from other 401xx errors -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40100: Unauthorized access

## What Happened

An action cannot be performed due to a lack of authorization. This is distinct from invalid credentials (40101) or other authentication errors.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40100 | 401 | Authentication | No - requires fixing authorization |

## Quick Fix

- Verify your API key has the necessary capabilities for the operation
- Check device credentials match the expected values for push operations
- Ensure you're not attempting to modify immutable properties

## Error Messages

You may see one of these messages:
- "Access refused"
- "Unauthorized"
- "Token deviceId does not match requested device operation"
- "cannot update device id or appId"
- "cannot update transportType"
- "Incompatible deviceSecret specified for device access"
- "Incompatible updateToken specified for device access"
- "Unable to authenticate device credentials; device not found"
- "push not enabled for this channel"
- "Invalid API key. Ensure you have a valid key configured."
- "Failed to get a token"

## Common Causes

1. **Device token mismatches** (60% of cases)
   - Token deviceId doesn't match the requested device operation
   - Environment switching (staging to production) with existing device credentials
   - Device credentials persisting across environment changes
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 192-196 -->

2. **Attempting to modify immutable properties** (20% of cases)
   - Trying to update device ID or app ID
   - Non-admin users attempting to update transport type
   - These properties cannot be changed after creation
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 16-25 -->

3. **Device authentication failures** (15% of cases)
   - Incompatible deviceSecret or updateToken
   - Device not found in the system
   - Credential validation failures
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 27-54 -->

4. **Push notification issues** (5% of cases)
   - Push not enabled for the requested channel
   - Insufficient permissions for push operations
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 36-39 -->

## Resolution Steps

1. **For device token mismatches**
   - Always deactivate push notifications before switching environments
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 145-148, preserved for customer experience -->
   - If deactivation fails with 40100, consider device reset
   - Ensure device credentials are properly cleared when switching between staging and production
   - Implement a device re-registration flow when encountering this error
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 198-203 -->

2. **For immutable property errors**
   - Device ID and app ID cannot be updated after creation
   - Create a new device registration instead of updating these fields
   - Transport type updates require admin privileges
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 16-25 -->

3. **For device authentication issues**
   - Verify the deviceSecret or updateToken matches the stored values
   - Check that the device exists in your Ably app
   - Ensure you're using credentials from the correct environment
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 27-54 -->

4. **For push notification problems**
   - Verify push is enabled for the channel in your app settings
   - Check your API key has the necessary push capabilities
   - Review the [push notifications documentation](https://ably.com/docs/push)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 36-39 -->

5. **For API key issues**
   - Verify your API key is valid and not revoked
   - Check the key has the necessary capabilities for your operation
   - For CLI users, run `ably login` to re-authenticate
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 108-118 -->

## Automatic Handling

This is an authorization error that will not be automatically retried. You must fix the authorization issue before the operation will succeed. SDKs may suggest re-authentication or provide specific error recovery mechanisms.
<!-- Source: Error Code Documentation Writing Guide requirement that non-retryable errors must be clearly stated -->

## Prevention

- Store device registration state locally to track environment
- Implement device deactivation before environment switches
- Validate deviceId consistency across token lifecycle
- Ensure token claims match device operations
- Implement proper token refresh mechanisms
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 198-214 -->

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Push notifications guide](https://ably.com/docs/push)
- [Device registration](https://ably.com/docs/push/activate)
- Related errors: [40101](https://help.ably.io/error/40101), [40102](https://help.ably.io/error/40102), [40103](https://help.ably.io/error/40103)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40100
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40100)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Device deactivation before environment switching from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 145-148
  - Best practices for device management from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 198-214
- Content Excluded: 
  - Specific internal infrastructure details (Cassandra authentication issues)
  - SDK implementation constants (not relevant for troubleshooting)
- Recommendations Source: 
  - All resolution steps based on actual error patterns from Bank Jago support tickets and team discussions
  - Prevention strategies from discovered best practices in knowledge file
- Code Examples Rationale: No code examples included as resolution requires configuration/credential fixes rather than code changes
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Device token mismatches): Based on support ticket patterns in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 127-148 and 192-196
  - Cause 2 (Immutable properties): From SDK code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 16-25
  - Cause 3 (Device auth failures): From realtime server code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 27-54
  - Cause 4 (Push issues): From realtime server code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-analysis.md lines 36-39
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 145-148 and best practices lines 198-203
  - Step 2: Based on immutable property restrictions from analysis lines 16-25
  - Step 3: Device credential validation from analysis lines 27-54
  - Step 4: Push configuration from analysis lines 36-39 and Ably docs
  - Step 5: CLI guidance from analysis lines 108-118
- Prevention: Based on best practices discovered in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40100-knowledge.md lines 198-214
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40100
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40100 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->