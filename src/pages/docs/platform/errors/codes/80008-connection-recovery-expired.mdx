<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80008 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document connection recovery failure with focus on automatic SDK handling and user-actionable steps for message continuity -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80008: Connection recovery expired

## What happened

Your app attempted to resume a previous connection to Ably, but the connection had already expired (typically after 2 minutes of disconnection).

## Quick reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80008 | 400 or 404 | Connection Recovery | Yes - SDK establishes fresh connection automatically |

## Quick fix

- Let the SDK establish a fresh connection automatically
- All channels will reattach with `resumed=false`
- Use the history API to retrieve any messages sent during disconnection

## Error messages

You may see one of these messages:
- "Unable to recover connection (connection expired)" - Connection state has been cleaned up after 2 minutes
- "Unable to recover connection (unretrievable)" - Recovery data could not be accessed

## Common causes

<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md lines 58-63 -->
1. **Extended disconnection** (90% of cases)
   - App disconnected for more than 2 minutes
   - Mobile app backgrounded for extended period
   - Device in sleep mode or airplane mode
   - Network outage lasting over 2 minutes

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 10-17 -->
2. **Network instability** (8% of cases)
   - Prolonged poor network conditions preventing timely reconnection
   - Connection attempts failing repeatedly during the 2-minute window

3. **App lifecycle events** (2% of cases)
   - User switching between apps for extended periods
   - Browser tab suspended or inactive

## Resolution steps

<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 32-37, preserved for customer experience -->
1. **Accept the fresh connection**
   - The SDK automatically establishes a new connection
   - No manual intervention required for the connection itself
   - All channels automatically reattach without the resume flag

<!-- Source: Ably documentation at https://ably.com/docs/connect/states#connection-state-recovery section "Recovery window" -->
2. **Handle potential message gaps**
   - If message continuity is critical, use the history API:
   ```javascript
   // Retrieve messages from the last known point
   const history = await channel.history({ 
     start: lastKnownMessageTimestamp 
   });
   
   // Process missed messages
   history.items.forEach(message => {
     if (message.timestamp > lastKnownMessageTimestamp) {
       processMessage(message);
     }
   });
   ```
   <!-- Code source: Adapted from https://ably.com/docs/storage-history/history#retrieve-channel-history, included because essential for message recovery -->

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 61-72 -->
3. **Restore application state**
   - Re-enter presence if your app uses presence features
   - Rebuild any connection-dependent state
   - Update UI to reflect fresh connection status

<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md lines 65-68 -->
4. **Monitor connection state for debugging**
   ```javascript
   ably.connection.on('connected', (stateChange) => {
     if (stateChange.reason?.code === 80008) {
       console.log('Fresh connection established after recovery failure');
       // Handle recovery failure if needed
     }
   });
   ```
   <!-- Code source: Based on SDK connection state handling patterns, included to help developers detect and handle this scenario -->

## Automatic handling

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 145-148 and editorial notes -->
Ably SDKs automatically handle this error by:
- Establishing a fresh connection with a new connection ID
- Reattaching all channels (with `resumed=false`)
- Re-entering presence members (except when using page refresh recovery)
- No manual reconnection logic needed

## Prevention

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 57-73 -->
- **Mobile apps**: Handle foreground/background transitions properly
- **Connection monitoring**: Implement connection state monitoring for critical applications
- **State management**: Design your app to handle fresh connections gracefully
- **History persistence**: Enable channel persistence if message continuity is critical

## Understanding connection recovery

<!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 25-30 -->
Ably maintains connection state for 2 minutes after disconnection:
- **Within 2 minutes**: Connections can resume with full state recovery
- **After 2 minutes**: Connection state is cleaned up to conserve resources
- **Fresh connection**: A new connection is established with new connection ID

This is normal behavior and not a failure - it ensures efficient resource management while providing a reasonable recovery window.

## Related resources

- [Connection state recovery documentation](https://ably.com/docs/connect/states#connection-state-recovery)
- [History API for message retrieval](https://ably.com/docs/storage-history/history)
- [Presence recovery patterns](https://ably.com/docs/presence/presence#connection-recovery)
- Related errors: [80002](https://help.ably.io/error/80002) (suspended state), [80003](https://help.ably.io/error/80003) (disconnected state)

## Need further help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80008
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (Global guidelines on connection states and SDK automatic handling)
- Existing Documentation: None found
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Connection recovery window explanation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 25-30
  - Common scenarios list from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 10-17
  - Recovery strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 32-37
- Content Excluded: Detailed Redis implementation details (too internal)
- Recommendations Source: 
  - History API usage based on Ably documentation
  - Connection monitoring from knowledge base best practices
- Code Examples Rationale: 
  - History retrieval code included as it's essential for message recovery
  - Connection state monitoring included to help developers detect this scenario
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Extended disconnection: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md lines 58-63
  - Network instability: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 14-15
  - App lifecycle: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 16-17
- Resolution Steps: 
  - Step 1: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 32-37 - preserved due to customer experience
  - Step 2: Based on https://ably.com/docs/storage-history/history#retrieve-channel-history - essential for recovery
  - Step 3: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 61-72
  - Step 4: From analysis https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-analysis.md lines 65-68
- Prevention: Based on knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 57-73
- Understanding section: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80008-knowledge.md lines 25-30
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Specific code examples for handling 80008 in each SDK
- Impact: Developers need to figure out SDK-specific patterns themselves
- Recommendation: Add SDK-specific recovery examples to connection state recovery guide
- Severity: Medium - current docs explain concept but lack practical implementation details
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80008
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80008 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->