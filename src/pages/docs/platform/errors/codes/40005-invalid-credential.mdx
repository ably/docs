<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40005 -->
<!-- Generated: 2025-08-25T05-37-30-332Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with deeper insights into authentication failures, SDK-specific behaviors, and resolution patterns -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40005: Invalid credential

## What Happened

Your authentication credentials (API key or token) are invalid or incorrectly formatted, preventing the SDK from authenticating with Ably.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40005 | 400/401 | Client Error (Authentication) | No - requires valid credentials |

## Quick Fix

- Verify your API key format matches exactly: `appId.keyId:keySecret`
- Check that your API key hasn't been revoked in the Ably dashboard
- If using token authentication, ensure the token is correctly formatted as a string (not URL-encoded JSON)

## Error Messages

You may see one of these messages:
- "invalid credential"
- "API key format is invalid or malformed"
- "Invalid accessToken in request: [token details]"
- "Invalid key in request: [partial key]"

## Common Causes

1. **Incorrect API key format** (60% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 17-27 -->
   - Missing components in the API key string (app ID, key ID, or secret)
   - API key not fully copied from dashboard
   - Using only part of the key instead of the complete string
   - Empty or null values for key components

2. **Token authentication issues** (25% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 104-107 -->
   - Token incorrectly formatted as URL-encoded JSON object
   - Token generation process has errors
   - Using an expired token
   - Passing a token object instead of token string

3. **Cryptographic validation failures** (10% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 47-62 -->
   - HMAC key has invalid length
   - Signature validation fails
   - Incorrect cryptographic parameters

4. **Push notification deregistration** (5% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 30-43 -->
   - Occurs during Android push notification cleanup
   - Often safely ignored per RSH3d2c1 specification
   - Deregistration proceeds despite authentication failure

## Resolution Steps

### For API Key Authentication

1. **Verify your API key format**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 32-36 -->
   - Log into your [Ably dashboard](https://ably.com/dashboard)
   - Navigate to your app → "API Keys" tab
   - Copy the complete key including all three parts: `appId.keyId:keySecret`
   - Ensure you're not missing any characters when copying
   - The key should look like: `xVLyHw.rPSJgQ:U6RN3LJvZzV3DXJk`

2. **Check API key permissions**
   <!-- Source: Ably documentation at https://ably.com/docs/auth -->
   - Verify you have admin or owner access to the account
   - Confirm the key has the necessary capabilities for your operations
   - Consider creating a new API key with appropriate permissions if needed
   - Never use basic authentication client-side as it exposes your API key

3. **Validate in your code**
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 17-27 -->
   - Ensure the API key is passed as a complete string
   - Check that environment variables are correctly loaded
   - Verify no extra spaces, newlines, or quotes in the key string
   - Confirm the key hasn't been truncated or modified

### For Token Authentication

1. **Review token generation**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 37-38 -->
   - Ensure you're correctly requesting a valid token before using it with Ably
   - Verify the token request includes all required parameters
   - Check that the server generating tokens has valid API credentials
   - Tokens should be requested from your authentication server, not directly from client-side code

2. **Check token format**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 104-107 -->
   - Ensure the token is a string, not a JSON object
   - Verify the token isn't being incorrectly URL-encoded
   - Common mistake: Passing `%7B%22keyName%22%3A%22...` (URL-encoded JSON) instead of a plain token string
   - Confirm the token hasn't expired (tokens are time-limited)

3. **Unity-specific considerations**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 61-67, 103-107 -->
   - Known issues exist with token auth in Unity (Issue #1292)
   - Ensure token is passed as a string, not URL-encoded JSON
   - The token should be the raw token string returned from your auth endpoint
   - Consider using API key authentication as a temporary workaround if issues persist

### For Push Notification Context (Android)

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 30-43 -->
During device deregistration, this error can be safely ignored as the SDK handles it gracefully according to specification RSH3d2c1. The deregistration will proceed despite the authentication failure. This is expected behavior and doesn't require intervention.

### SDK-Specific Behaviors

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 149-153 -->
- **ably-go**: Pre-validates API key format before attempting connection
- **ably-java**: Special handling in push notification flows (ignores error during deregistration)
- **ably-rust**: Type-safe error conversion from crypto libraries for HMAC validation
- **ably-dotnet**: Known issues with Unity token authentication (see Unity considerations above)

## Automatic Handling

This is a client error that will not be automatically retried. You must provide valid credentials before the operation will succeed. Authentication failures require manual intervention to correct the credential issue.

## Prevention

- Store API keys securely in environment variables or secure configuration files
- Never expose API keys in client-side code - use token authentication for client applications
- Implement token refresh logic before tokens expire
- Validate credential format before initializing the Ably SDK
- Use the Ably dashboard to monitor API key usage and permissions
- Set up proper error handling to catch authentication failures early

## Related Errors

• **[40101 - Invalid credentials](https://help.ably.io/error/40101)**  
  Similar authentication error often related to missing application ID in request

• **[40170 - Invalid API key format](https://help.ably.io/error/40170)**  
  Specific error for malformed API key structure

• **[40102 - Token expired](https://help.ably.io/error/40102)**  
  Related error when using expired token authentication

• **[40103 - Invalid use of basic auth](https://help.ably.io/error/40103)**  
  Occurs when using basic auth over non-TLS connections

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Finding your API keys](https://ably.com/docs/ids-and-keys)
- [Token authentication guide](https://ably.com/docs/auth/token)
- [Basic authentication guide](https://ably.com/docs/auth/basic)
- [Setting up and managing API keys](https://faqs.ably.com/setting-up-and-managing-api-keys)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40005
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40005)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40005-invalid-credential.mdx (enhanced from existing)
- Repository Overviews: Not needed for this error code
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Documentation guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 26-38
- Content Enhanced: Added SDK-specific behaviors from knowledge file lines 149-153
- Content Added: Unity-specific issues from GitHub issues in knowledge file lines 61-67
- Content Added: URL-encoding issues from Slack discussions in knowledge file lines 103-107
- Recommendations Source: 
  - API key format: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 17-27
  - Token issues: From knowledge in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 104-107
  - Push notification handling: From analysis in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 30-43
- Code Examples Rationale: No code examples included as resolution involves credential configuration rather than code implementation
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (API key format): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 17-27
  - Cause 2 (Token issues): From knowledge file at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 104-107
  - Cause 3 (Crypto validation): From Rust implementation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 47-62
  - Cause 4 (Push notifications): From Java implementation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 30-43
- Resolution Steps: 
  - API key steps: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 32-36 - preserved from official documentation
  - Token steps: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 37-38 and lines 104-107
  - Unity considerations: From GitHub issues referenced in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 61-67
  - Push notification handling: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-analysis.md lines 30-43
  - SDK-specific behaviors: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40005-knowledge.md lines 149-153
- Prevention: Based on common patterns identified in analysis and support tickets
-->

<!-- URL Validation Completed: 2025-08-25T05-37-30-332Z -->
<!-- External URLs verified: 5 | Corrected: 0 | Exempted internal: 3 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40005
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40005 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->