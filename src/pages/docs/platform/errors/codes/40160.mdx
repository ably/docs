---
title: "Error 40160: Insufficient token capabilities"
meta_description: "Learn how to resolve error 40160 when your token or API key lacks required capabilities for Ably operations."
meta_keywords: "Ably error 40160, insufficient capabilities, token permissions, API key permissions, authentication error, capability error"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40160 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Document capability validation failures and provide clear resolution steps for token permission issues */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

This error occurs when your authentication token or API key lacks the required capabilities (permissions) to perform the requested operation on an Ably channel.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ----------- | -------- | --------- |
| 40160 | 401 | Authentication Error | No |

## Impact

This error prevents the specific operation from completing and may block access to channels or features. The connection remains active, but the operation fails.

Ably SDKs do not automatically retry this error as it requires updating token capabilities or using different credentials.

## Troubleshooting

The following are common causes and resolutions for error 40160:

### Missing channel permissions

| Error message | Context |
| ------------- | ------- |
| `operation not permitted with provided capability` | General capability failure |
| `Channel denied access based on given capability; channelId = [channel]` | Channel-specific permission issue |

This occurs when:
- Your token lacks `publish`, `subscribe`, or `presence` capabilities for the channel
- You're attempting operations outside your granted channel patterns
- The channel name doesn't match your token's capability patterns exactly

To resolve this:
1. Review your token's capability configuration in the Ably dashboard
2. Ensure your token includes the required capabilities for your operations:
   - `publish` for sending messages
   - `subscribe` for receiving messages
   - `presence` for presence operations
   - `history` for accessing message history
3. Verify the channel name matches your capability patterns (case-sensitive)
4. For API keys, regenerate with appropriate capabilities
5. For tokens, request a new token with the required capabilities

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md lines 26-35, 45-47 */}
{/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-knowledge.md lines 16-30 */}

### Publishing with privileged extras

| Error message | Context |
| ------------- | ------- |
| `Unauthorized to publish messages with privileged extras` | Publishing messages with special metadata |

This occurs when:
- You're attempting to publish messages with privileged extras
- Your token lacks the `privileged` capability

To resolve this:
- Include `privileged` capability in addition to `publish` when creating tokens
- Remove privileged extras from your messages if not required
- Use a token with appropriate elevated permissions

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md lines 21-25 */}

### TLS-only namespace access

| Error message | Context |
| ------------- | ------- |
| `Access denied to channel: namespace requires TLS connection` | Accessing secure channels without TLS |

This occurs when:
- You're accessing a channel namespace that requires TLS encryption
- Your connection is not using TLS/SSL

To resolve this:
- Ensure you're connecting to `realtime.ably.io` or `rest.ably.io` (which use TLS)
- Avoid connecting to non-TLS endpoints
- Check your connection configuration to ensure TLS is enabled

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md lines 31-35 */}

### Missing authentication options

| Error message | Context |
| ------------- | ------- |
| `No authentication options provided` | SDK initialization without credentials |

This occurs when:
- Creating an Ably client without any authentication method
- Missing key, authUrl, authCallback, or token in configuration

To resolve this:
- Provide an API key: `new Ably.Realtime({ key: 'your-api-key' })`
- Or configure token authentication with authUrl or authCallback
- Ensure authentication credentials are properly configured

{/* Source: Analysis from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md lines 54-58 */}

## Prevention

To avoid capability-related errors:

1. **Plan capabilities carefully**: Define all required permissions when creating tokens or API keys
2. **Use capability patterns effectively**: Leverage wildcards (`*`) for channel namespaces
3. **Test in development**: Verify token capabilities before production deployment
4. **Implement token renewal**: Some SDKs (Laravel Echo, Asset Tracking) automatically handle capability upgrades
5. **Document requirements**: Maintain clear documentation of required capabilities per operation

{/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-knowledge.md lines 79-91 */}

## Related errors

The following errors are related to error code 40160:

| Error code | Description |
| ---------- | ----------- |
| [40101 - Invalid API key](/docs/platform/errors/codes/40101) | Occurs when the API key itself is invalid, rather than just lacking capabilities |
| [40102 - Token expired](/docs/platform/errors/codes/40102) | Token has expired and needs renewal, may occur alongside capability issues |
| [40142 - Token expired](/docs/platform/errors/codes/40142) | Another token expiration variant often seen with capability errors |
| [40103 - Invalid use of basic auth](/docs/platform/errors/codes/40103) | Basic auth used incorrectly, may need token auth instead |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID
- The full error message including the error code
- Steps to reproduce the issue
- Any relevant code snippets (without any sensitive credentials)
- The SDK and version you're using

### Additional resources

- [Token capabilities documentation](https://ably.com/docs/auth/capabilities)
- [Authentication guide](https://ably.com/docs/auth)
- [Channel permissions](https://ably.com/docs/realtime/channels#permissions)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40160-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md (Global guidelines applied)
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file's immediate actions and resolution approaches from lines 44-91
- Content Excluded: Internal implementation details and test coverage specifics that don't help customers
- Recommendations Source: Based on documented SDK behaviors and official Ably documentation patterns
- Code Examples Rationale: Minimal code included only for authentication configuration as it's essential for resolution
*/}

{/* ATTRIBUTION BY SECTION:
- Common Causes:
  - Channel permissions: Analysis lines 26-35, 45-47; Knowledge lines 16-30
  - Privileged extras: Analysis lines 21-25
  - TLS namespace: Analysis lines 31-35
  - Missing auth: Analysis lines 54-58
- Resolution Steps:
  - Token capabilities: Knowledge lines 79-91
  - Prevention strategies: Knowledge lines 79-91
- Prevention: Based on Knowledge lines 79-91 and analysis of SDK automatic recovery patterns
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 2 | Corrected: 0 | Exempted internal: 5 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40160
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40160 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}