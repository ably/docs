---
title: LiveCounter
meta_description: "Create, update and receive updates for a numerical counter that synchronizes state across clients in realtime."
---

<Aside data-type='experimental'>
LiveObjects is currently Experimental. Its features are still in development and subject to rapid change.

**Building with LiveObjects?** Help shape its future by [sharing your use case](https://44qpp.share.hsforms.com/2fZobHQA1ToyRfB9xqZYQmQ).
</Aside>

LiveCounter is a synchronized numerical counter that supports increment and decrement operations. It ensures that all updates are correctly applied and synchronized across users in realtime, preventing inconsistencies when multiple users modify the counter value simultaneously.

## Create LiveCounter <a id="create"/>

A `LiveCounter` instance can be created using the `channel.objects.createCounter()` method. It must be stored inside a `LiveMap` object that is reachable from the [root object](/docs/liveobjects/concepts/objects#root-object).

`channel.objects.createCounter()` is asynchronous, as the client sends the create operation to the Ably system and waits for an acknowledgment of the successful counter creation.

<Aside data-type='note'>
Note that you need to first [attach to the channel](/docs/liveobjects/quickstart/javascript#step-3) before creating a new `LiveCounter` instance, as this operation requires sending a message to the Ably system.
</Aside>

<Code>
```javascript
const counter = await channel.objects.createCounter();
await root.set('counter', counter);
```

```swift
let counter = try await channel.objects.createCounter()
try await root.set("counter", .liveCounter(counter))
```

```java
LiveCounter counter = channel.getObjects().createCounter();
root.set("counter", LiveMapValue.of(counter));
```
</Code>

Optionally, you can specify an initial value when creating the counter:

<Code>
```javascript
const counter = await channel.objects.createCounter(100); // Counter starts at 100
```

```swift
let counter = try await channel.objects.createCounter(count: 100) // Counter starts at 100
```

```java
LiveCounter counter = channel.getObjects().createCounter(100); // Counter starts at 100
```
</Code>

## Get counter value <a id="value"/>

Get the current value of a counter using the `LiveCounter.value()` method:

<Code>
```javascript
console.log('Counter value:', counter.value());
```

```swift
print("Counter value: \(try counter.value)")
```

```java
System.out.println("Counter value: " + counter.value());
```
</Code>

## Subscribe to data updates <a id="subscribe-data"/>

You can subscribe to data updates on a counter to receive realtime changes made by you or other clients.

<Aside data-type='note'>
`LiveCounter` mutation methods do not directly modify the local counter state. Instead, they send the intended operation to the Ably system, and the change is applied only when the corresponding realtime operation is echoed back to the client. This means that the state retrieved immediately after a mutation may not reflect the latest updates yet. You will be notified via subscription when the counter is updated.
</Aside>

Subscribe to data updates on a counter using the `LiveCounter.subscribe()` method:

<Code>
```javascript
counter.subscribe((update) => {
  console.log('Counter updated:', counter.value());
  console.log('Update details:', update);
});
```

```swift
try counter.subscribe { update, _ in
    do {
        print("Counter updated: \(try counter.value)")
    } catch {
        // Error handling of counter.value omitted for brevity
    }
    print("Update details: \(update)")
}
```

```java
counter.subscribe((counterUpdate) -> {
    System.out.println("Counter updated: " + counter.value());
    System.out.println("Update details: " + counterUpdate.getUpdate());
});
```
</Code>

The update object provides details about the change, such as the amount by which the counter value was changed.

It may also include the client ID of the client that made the change, if the change can be attributed to a specific client. For example, the client ID may be missing if the update was triggered by data resynchronization after a disconnection and the change occurred while the client was offline.

Example structure of an update object when the counter was incremented by 5 by a client with the ID `my-client`:

<Code>
```json
{
  "update": {
    "amount": 5
  },
  "clientId": "my-client"
}
```
</Code>

Or decremented by 10:

<Code>
```json
{
  "amount": -10
}
```
</Code>

### Unsubscribe from data updates <a id="unsubscribe-data"/>

Use the `unsubscribe()` function returned in the `subscribe()` response to remove a counter update listener:

<Code>
```javascript
// Initial subscription
const { unsubscribe } = counter.subscribe(() => console.log(counter.value()));
// To remove the listener
unsubscribe();
```

```swift
// Initial subscription
let subscriptionResponse = try counter.subscribe { _, _ in
    do {
        print(try counter.value)
    } catch {
        // Error handling of counter.value omitted for brevity
    }
}
// To remove the listener
subscriptionResponse.unsubscribe()
```

```java
// Initial subscription
ObjectsSubscription subscription = counter.subscribe((counterUpdate) ->
    System.out.println(counter.value())
);
// To remove the listener
subscription.unsubscribe();
```
</Code>

<If lang="swift">
To remove a counter update listener from _inside_ the listener function, you can call `unsubscribe()` on the subscription response that is passed as the second argument to the listener function:

<Code>
```swift
try counter.subscribe { _, subscriptionResponse in
    // Remove the listener so that this callback
    // no longer gets called
    subscriptionResponse.unsubscribe()
}
```
</Code>
</If>

<If lang="javascript,java">
Use the `LiveCounter.unsubscribe()` method to deregister a provided listener:

<Code>
```javascript
// Initial subscription
const listener = () => console.log(counter.value());
counter.subscribe(listener);
// To remove the listener
counter.unsubscribe(listener);
```

```java
// Initial subscription
LiveCounter.Listener listener = (counterUpdate) ->
    System.out.println(counter.value());
counter.subscribe(listener);
// To remove the listener
counter.unsubscribe(listener);
```
</Code>
</If>

Use the `LiveCounter.unsubscribeAll()` method to deregister all counter update listeners:

<Code>
```javascript
counter.unsubscribeAll();
```

```swift
counter.unsubscribeAll();
```

```java
counter.unsubscribeAll();
```
</Code>

## Update LiveCounter <a id="update"/>

Update the counter value by calling <If lang="javascript,java">`LiveCounter.increment()` or `LiveCounter.decrement()`</If><If lang="swift">`LiveCounter.increment(amount:)` or `LiveCounter.decrement(amount:)`</If>. These operations are synchronized across all clients and trigger data subscription callbacks for the counter, including on the client making the request.

These operations are asynchronous, as the client sends the corresponding update operation to the Ably system and waits for acknowledgment of the successful counter update.

<Code>
```javascript
await counter.increment(5); // Increase value by 5
await counter.decrement(2); // Decrease value by 2
```

```swift
try await counter.increment(amount: 5) // Increase value by 5
try await counter.decrement(amount: 2) // Decrease value by 2
```

```java
counter.increment(5); // Increase value by 5
counter.decrement(2); // Decrease value by 2
```
</Code>

## Subscribe to lifecycle events <a id="subscribe-lifecycle"/>

Subscribe to lifecycle events on a counter using the <If lang="javascript,java">`LiveCounter.on()`</If><If lang="swift">`LiveCounter.on(event:callback:)`</If> method:

<Code>
```javascript
counter.on('deleted', () => {
  console.log('Counter has been deleted');
});
```

```swift
counter.on(event: .deleted) { _ in
  print("Counter has been deleted")
}
```

```java
counter.on(ObjectLifecycleEvent.DELETED, (lifecycleEvent) -> {
    System.out.println("Counter has been deleted");
});
```
</Code>

Read more about [objects lifecycle events](/docs/liveobjects/lifecycle#objects).

### Unsubscribe from lifecycle events <a id="unsubscribe-lifecycle"/>

Use the `off()` function returned in the `on()` response to remove a lifecycle event listener:

<Code>
```javascript
// Initial subscription
const { off } = counter.on('deleted', () => console.log('Counter deleted'));
// To remove the listener
off();
```

```swift
// Initial subscription
let eventResponse = counter.on(event: .deleted) { _ in
  print("Counter deleted")
}
// To remove the listener
eventResponse.off()
```

```java
// Initial subscription
ObjectsSubscription subscription = counter.on(ObjectLifecycleEvent.DELETED, (lifecycleEvent) ->
    System.out.println("Counter deleted")
);
// To remove the listener
subscription.unsubscribe();
```
</Code>

<If lang="javascript,java">
Use the `LiveCounter.off()` method to deregister a provided lifecycle event listener:

<Code>
```javascript
// Initial subscription
const listener = () => console.log('Counter deleted');
counter.on('deleted', listener);
// To remove the listener
counter.off('deleted', listener);
```

```java
// Initial subscription
ObjectLifecycleChange.Listener listener = (lifecycleEvent) ->
    System.out.println("Counter deleted");
counter.on(ObjectLifecycleEvent.DELETED, listener);
// To remove the listener
listener.unsubscribe()
// Alternatively, remove the shared listener from all event registrations
counter.off(listener);
```
</Code>
</If>

Use the `LiveCounter.offAll()` method to deregister all lifecycle event listeners:

<Code>
```javascript
counter.offAll();
```

```swift
counter.offAll()
```

```java
counter.offAll();
```
</Code>
