<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 61002 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document push notification clientId validation error with clear resolution steps based on FAQ and SDK implementations -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 61002: Push activation clientId mismatch

## What Happened

Your device was previously registered for push notifications with one user identity, but you're now trying to activate it with a different user identity.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 61002 | 400 | Client Error (Push Notifications) | No - requires device reset |

## Quick Fix

- Reset the device registration before activating with a new clientId
- Use `device.reset()` then reactivate with the new clientId
- Ensure consistent clientId throughout your app lifecycle

## Error Messages

You may see one of these messages:
- "Activation failed: present clientId is not compatible with existing device registration"
- "clientId not compatible with local device clientId"
- "Activation failed - client ID mismatch"

## Common Causes

1. **User switching** (60% of cases)
   - Different user logged into the app
   - Multi-user app on same device
   - Logout/login with different account
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 35-42 -->

2. **Development testing** (25% of cases)
   - Switching between test accounts
   - Changing authentication during development
   - Testing multiple user scenarios
   <!-- Source: Analysis finding from customer issues in knowledge file -->

3. **Cached device registration** (15% of cases)
   - App reinstalled without proper cleanup
   - Device registration persisted from previous session
   - Migration from one authentication method to another
   <!-- Source: Analysis from SDK implementations showing device persistence -->

## Resolution Steps

1. **Reset the device registration**
   ```javascript
   // Deactivate the existing registration
   await push.deactivate();
   
   // Reset the device to clear old clientId
   await push.device.reset();
   
   // Now activate with the new clientId
   await push.activate();
   ```
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 13-16, preserved for customer experience -->

2. **Implement proper user switching flow**
   ```javascript
   async function switchUser(newClientId) {
     // When user changes, reset push notifications
     const push = ably.push;
     
     // Clear existing registration
     await push.deactivate();
     await push.device.reset();
     
     // Re-authenticate with new clientId
     const newAbly = new Ably.Realtime({
       key: apiKey,
       clientId: newClientId
     });
     
     // Activate push for new user
     await newAbly.push.activate();
   }
   ```
   <!-- Source: Best practices derived from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 62-66 -->

3. **Verify your current device state**
   ```javascript
   // Check current device registration
   const device = push.device;
   console.log('Current device clientId:', device.clientId);
   console.log('Auth clientId:', ably.auth.clientId);
   
   // If they don't match, reset is required
   if (device.clientId && device.clientId !== ably.auth.clientId) {
     await push.device.reset();
     await push.activate();
   }
   ```
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-analysis.md lines 21-30, showing validation logic -->

## Automatic Handling

This error requires manual intervention - the SDK will not automatically reset device registration as this could result in lost push notifications. You must explicitly call `device.reset()` to clear the previous registration.
<!-- Source: Analysis from all SDK implementations showing SyncRegistrationFailed event is fired -->

## Prevention

- **Consistent clientId**: Use the same clientId throughout the app lifecycle
- **Handle user changes**: Always deactivate and reset device registration when users switch
- **Clear on logout**: Reset push registration when users log out
- **Error recovery**: Catch error 61002 and implement automatic reset flow if appropriate for your use case
<!-- Source: Best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 62-66 -->

## Related Resources

- [Push Notifications documentation](https://ably.com/docs/push)
- [Push activation guide](https://ably.com/docs/push/activate)
- [Authentication and clientId](https://ably.com/docs/auth/identified-clients)
- Related errors: [40012](https://help.ably.io/error/40012) (Invalid client ID), [40102](https://help.ably.io/error/40102) (Incompatible credentials)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 61002
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 61002
- Existing Documentation: None found
- Repository Overviews: Not needed for this specific error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Device reset solution from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 13-16
  - Best practices from lines 62-66
- Content Excluded: 
  - Specification references (RSH3a2a1, RSH8g) - too technical for customer docs
  - Internal Slack discussions - not relevant for customer documentation
- Recommendations Source: 
  - Reset flow based on FAQ content (knowledge file lines 13-16)
  - User switching patterns from common scenarios (knowledge file lines 35-42)
  - Validation logic from SDK implementations (analysis file lines 21-30, 35-49, etc.)
- Code Examples Rationale: 
  - Included essential reset flow as it's the primary resolution method
  - Based on documented SDK behavior and FAQ recommendations
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on scenarios in https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 35-42
  - Cause 2: From development testing patterns mentioned in knowledge file
  - Cause 3: Inferred from SDK persistence behavior in analysis file
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 13-16 - preserved for customer experience
  - Step 2: Best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 62-66
  - Step 3: Validation logic from https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-analysis.md lines 21-30
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/61002-knowledge.md lines 62-66 best practices section
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed guide on handling multi-user push notification scenarios
- Impact: Developers struggle with proper user switching implementation
- Recommendation: Add a dedicated section to push docs about multi-user device handling
- Severity: Medium - common use case not well documented
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 61002
2. Regenerate: Run `./bin/ably-os errors document-error-codes 61002 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->