<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40017 -->
<!-- Generated: 2025-08-21T17-17-40-434Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document protocol version requirements for manual API connections with SSE and WebSocket, emphasizing SDK users won't encounter this error -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40017: Unsupported protocol version

## What Happened

The request did not specify a protocol version or provided an invalid version in the request parameters.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40017 | 400 | Client Error (Protocol) | No - requires fixing request parameters |

## Quick Fix

- Add `?v=1.1` or higher to SSE connection requests
- Ensure WebSocket connections use valid API versions
- Update to latest SDK version (SDK users won't see this error)

## Error Messages

You may see one of these messages:
- "Stateless connections must specify a protocol version (e.g. ?v=1.1)"
- "Invalid api version specified: [version]. See https://help.ably.io/error/40017"
- "Unsupported protocol version"

## Common Causes

1. **Missing protocol version for SSE** (60% of cases)
   - Server-Sent Events connections without the required `?v=` parameter
   - Direct API calls to SSE endpoints without version specification
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md lines 35-38 -->

2. **Invalid version format** (25% of cases)
   - Incorrectly formatted version strings (e.g., "3.0" when not supported)
   - Using version numbers not recognized by the platform
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 67-68 -->

3. **Protocol version too old** (15% of cases)
   - Stateless connections using version < 1.1
   - Using deprecated protocol versions
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md lines 23-26 -->

## Resolution Steps

1. **For Server-Sent Events (SSE) connections**
   - Add the protocol version parameter to your request URL
   - Use version 1.1 or higher for stateless connections
   - Example: `https://rest.ably.io/event-stream?v=1.1&key=YOUR_KEY`
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 81-82 -->

2. **For WebSocket connections**
   - Verify the API version specified in your connection parameters
   - Check Ably documentation for supported version numbers
   - Remove or correct any invalid version parameters
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 29-30 -->

3. **For SDK users**
   - Update to the latest SDK version
   - SDKs automatically handle protocol versioning
   - You should not encounter this error with properly configured SDKs
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md line 31 -->

4. **Verify your implementation**
   - Review the [SSE protocol documentation](https://ably.com/docs/protocols/sse)
   - Check the [API versioning guide](https://ably.com/docs/api-versioning)
   - Ensure all manual API calls include proper version parameters

## Automatic Handling

Ably SDKs automatically handle protocol versioning. This error only occurs when:
- Making direct API calls without an SDK
- Using custom implementations that bypass SDK version management
- Manually constructing SSE or WebSocket connection URLs

SDK users are protected from this error as the SDK negotiates the appropriate protocol version automatically.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 61-62 -->

## Prevention

- **Always use official SDKs** when possible for automatic version handling
- **Include version parameters** in all manual SSE connection requests
- **Test protocol compatibility** before deploying custom implementations
- **Keep SDKs updated** to ensure support for latest protocol versions
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 83-85 -->

## Related Resources

- [SSE Protocol Documentation](https://ably.com/docs/protocols/sse)
- [Ably Protocol Specification](https://github.com/ably/specification)
- [Connection State Management](https://ably.com/docs/realtime/connection)
- Related errors: [80015](./80015-incompatible-connection-parameters.md) (connection parameter issues), [40021](./40021-newer-platform-version-required.md) (feature version requirements)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40017
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40017)
- Existing Documentation: None found - creating new documentation
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content found for this error
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - SSE version requirement from analysis lines 35-38 and knowledge lines 81-82
  - WebSocket version validation from knowledge lines 29-30
  - SDK protection from knowledge lines 31, 61-62
- Code Examples Rationale: No code examples included as this is a configuration issue, not a coding pattern issue. Linked to documentation instead.
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md lines 35-38
  - Cause 2: From Slack discussion in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 67-68
  - Cause 3: From code analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-analysis.md lines 23-26
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 81-82 - protocol version requirement for SSE
  - Step 2: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 29-30 - WebSocket version validation
  - Step 3: SDK guidance from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md line 31 - automatic version handling
  - Step 4: Documentation links from standard Ably resources
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 83-85 resolution patterns
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40017
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40017 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->