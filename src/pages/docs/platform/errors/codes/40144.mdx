---
title: "Invalid JWT token format"
meta_description: "Understand and resolve Ably error code 40144 related to JWT token format issues and validation failures."
meta_keywords: "Ably error 40144, JWT token error, invalid token format, authentication error, token validation"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40144 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Comprehensive documentation covering all JWT validation failures, focusing on specific error messages and known library compatibility issues */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

This error occurs when your JWT token fails validation due to format, structure, or content issues during authentication with Ably.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ----------- | -------- | --------- |
| 40144 | 400/401 | Client Error (Authentication) | No |

## Error messages

| Message | Cause |
| ------- | ----- |
| `Invalid token; iat must be specified` | JWT payload missing required `iat` (issued at) field |
| `Invalid token; iat must be a number` | JWT `iat` field is not a numeric Unix timestamp |
| `Invalid token; exp must be specified` | JWT payload missing required `exp` (expires) field |
| `Invalid token; exp must be a number` | JWT `exp` field is not a numeric Unix timestamp |
| `Invalid token request body; capability must not be the empty string` | JWT capability field is an empty string |
| `Invalid capability` | JWT capability cannot be JSON stringified |
| `Invalid token; revocationKey must not be the empty string` | Revocation key field is an empty string |
| `Invalid token; revocationKey must be a string` | Revocation key is not a string type |
| `Invalid token; embedded JWT tokens cannot be nested more than once` | Attempting to nest JWT tokens more than one level deep |
| `Invalid embedded access token` | Embedded JWT token fails validation |
| `HS384 is not supported` | JWT uses unsupported HS384 algorithm |

## Impact

This error prevents authentication and blocks all operations requiring valid credentials.

The error is not automatically retried by Ably SDKs. You must fix the token format issues and create a new valid token before retrying authentication.

## Troubleshooting

The following are common causes and how to resolve them for error 40144:

### Missing or invalid timestamp fields

| Error message |
| ------------- |
| `Invalid token; iat must be specified` |
| `Invalid token; iat must be a number` |
| `Invalid token; exp must be specified` |
| `Invalid token; exp must be a number` |

This occurs when:
- Your JWT is missing the required `iat` (issued at) or `exp` (expires) fields
- The timestamp fields are present but not numeric Unix timestamps
- JWT libraries generate timestamps with decimal points or microseconds

To resolve this:
1. Ensure your JWT includes both required timestamp fields as integers:
   {/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 16-33 */}
   - `iat`: Unix timestamp when the token was issued (must be an integer)
   - `exp`: Unix timestamp when the token expires (must be an integer)

2. For PHP developers using Lcobucci/JWT library, configure it to use integer timestamps:
   {/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 118-125 */}
   - The library creates timestamps with microseconds by default
   - See the [library documentation](https://github.com/lcobucci/jwt/discussions/623) for integer timestamp configuration

3. Verify your token structure using [JWT.io](https://jwt.io) or similar debugging tools

### Empty or invalid capability strings

| Error message |
| ------------- |
| `Invalid token request body; capability must not be the empty string` |
| `Invalid capability` |

This occurs when:
- The capability field is provided but set to an empty string
- The capability value cannot be properly JSON stringified

To resolve this:
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 35-44 */}
- Either omit the capability field entirely, or
- Provide a valid non-empty capability string
- Ensure capability follows [Ably's capability format](https://ably.com/docs/auth/capabilities)

### Unsupported cryptographic algorithms

| Error message |
| ------------- |
| `HS384 is not supported` |

This occurs when:
- Your JWT uses the HS384 algorithm which Ably doesn't support

To resolve this:
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 66-69 */}
- Use a supported algorithm (HS256, RS256)
- Regenerate your JWT with a supported signing algorithm
- See [Ably's JWT documentation](https://ably.com/docs/auth/token#jwt-process) for supported algorithms

### Excessive token nesting

| Error message |
| ------------- |
| `Invalid token; embedded JWT tokens cannot be nested more than once` |
| `Invalid embedded access token` |

This occurs when:
- You attempt to embed JWT tokens more than one level deep
- An embedded token within your JWT fails validation

To resolve this:
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 56-63 */}
- Limit token embedding to a single level
- Validate embedded tokens independently before nesting
- Use direct authentication instead of nested tokens where possible

### Kafka Connect and integration issues

For Kafka Connect Ably connector authentication failures:
{/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 126-133 */}
- Add the required converter configuration:
  - `key.converter: org.apache.kafka.connect.converters.ByteArrayConverter`
  - `value.converter: org.apache.kafka.connect.converters.ByteArrayConverter`
  - `value.converter.schemas.enable: false`

### Python SDK authorization header issues

{/* Source: Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 141-152 */}
If you encounter this error when using auth_url with authorization headers in the Python SDK:
- Return a JWT or Ably token directly instead of a TokenRequest
- Use auth_callback instead of auth_url
- This is a known SDK behavior difference tracked in [GitHub issue #577](https://github.com/ably/ably-python/issues/577)

## Prevention

To avoid JWT format validation errors:
- Use established JWT libraries with proper configuration for integer timestamps
- Test token generation with JWT debugging tools before deployment
- Include all required fields (`iat`, `exp`) as integer Unix timestamps
- Avoid empty strings for optional fields - omit them instead
- Use only supported cryptographic algorithms (HS256, RS256)
- Limit token nesting to a single level
- Implement proper error handling in your token generation code

## Related errors

The following errors are related to error code 40144:

| Error code | Description |
| ---------- | ----------- |
| [40140 - Token expired](/docs/platform/errors/codes/40140) | Token has passed its expiration time but is otherwise valid |
| [40142 - Invalid token](/docs/platform/errors/codes/40142) | Token signature verification failed or token is malformed |
| [40143 - Unrecognized token](/docs/platform/errors/codes/40143) | Token format is not recognized as valid JWT or Ably token |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Resources

- [JWT Authentication documentation](https://ably.com/docs/auth/token)
- [Token capabilities guide](https://ably.com/docs/auth/capabilities)
- [JWT.io debugging tool](https://jwt.io)
- [JWT specification (RFC 7519)](https://datatracker.ietf.org/doc/html/rfc7519)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: PHP JWT library microseconds issue from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 118-125
- FAQ Content Preserved: Kafka Connect configuration from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 126-133
- FAQ Content Preserved: Python SDK authorization header workarounds from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 141-152
- Content Excluded: Internal Slack thread links (not accessible to customers)
- Recommendations Source: Based on actual error messages and validation patterns from analysis file
- Code Examples Rationale: No code examples included as JWT generation varies by library, linked to documentation instead
*/}

{/* ATTRIBUTION BY SECTION:
- Error messages table: Based on analysis findings in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 16-69
- Timestamp validation: From JWT validation code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 16-33
- Capability validation: From JWT validation code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 35-44
- Token nesting: From validation logic at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-analysis.md lines 56-63
- PHP library issue: From customer support pattern at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 118-125
- Kafka configuration: From integration issue at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 126-133
- Python SDK issue: From GitHub issue tracking at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40144-knowledge.md lines 141-152
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 6 | Corrected: 0 | Exempted internal: 4 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40144
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40144 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}