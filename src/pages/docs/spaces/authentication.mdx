---
title: Spaces authentication
meta_description: "Configure authentication for Spaces applications with the required capabilities."
---

This page covers Spaces-specific capabilities and space scoping. For client setup and server implementation, see [SDK setup](/docs/spaces/setup).

## Spaces capabilities

Capabilities are permissions that control what operations a client can perform. When you create a token for a Spaces user, you specify which capabilities they have. Each Spaces feature requires specific capabilities:

| Feature | Required Capabilities |
|---------|----------------------|
| Avatar stack (member events) | `subscribe`, `presence` |
| Member locations | `subscribe`, `presence` |
| Live cursors | `publish`, `subscribe` |
| Component locking | `subscribe`, `presence` |
| **All Spaces features** | `publish`, `subscribe`, `presence`, `history` |

## Space-scoped capabilities

You can restrict tokens to specific spaces. Spaces uses multiple channels per space:
- The main space channel (`your-space`) handles presence and member locations
- A dedicated cursors channel (`your-space::$cursors`) handles live cursor positions

Cursors have their own channel because cursor updates are very frequent (potentially 60+ times per second per user), while presence and location updates are less frequent. This separation improves performance.

<Code>
```javascript
// Server-side JWT with space-scoped capabilities
import jwt from 'jsonwebtoken';

const [keyName, keySecret] = process.env.ABLY_API_KEY.split(':');

const ablyJwt = jwt.sign(
  {
    'x-ably-capability': JSON.stringify({
      // Main space channel for presence and locations
      'your-space': ['publish', 'subscribe', 'presence', 'history'],
      // Cursors channel
      'your-space::$cursors': ['publish', 'subscribe'],
    }),
    'x-ably-clientId': userId,
  },
  keySecret,
  { algorithm: 'HS256', keyid: keyName, expiresIn: '1h' }
);
```

```python
# Server-side JWT with space-scoped capabilities
import jwt
import json
import time
import os

key_name, key_secret = os.environ['ABLY_API_KEY'].split(':')

now = int(time.time())
ably_jwt = jwt.encode(
    {
        'iat': now,
        'exp': now + 3600,
        'x-ably-capability': json.dumps({
            # Main space channel for presence and locations
            'your-space': ['publish', 'subscribe', 'presence', 'history'],
            # Cursors channel
            'your-space::$cursors': ['publish', 'subscribe'],
        }),
        'x-ably-clientId': user_id,
    },
    key_secret,
    algorithm='HS256',
    headers={'kid': key_name}
)
```
</Code>

<Aside data-type='important'>
If you use API key authentication on the client, any user can claim any `clientId`, undermining the collaborative features that Spaces provides. Always use [token authentication](/docs/auth/token) in production.
</Aside>

## Client setup

Use `authCallback` to fetch JWTs from your auth server:

<Code>
```javascript
import Spaces from '@ably/spaces';
import { Realtime } from 'ably';

const client = new Realtime({
  authCallback: async (tokenParams, callback) => {
    try {
      const response = await fetch('/api/ably-token');
      const jwt = await response.text();
      callback(null, jwt);
    } catch (error) {
      callback(error, null);
    }
  },
});

const spaces = new Spaces(client);
```
</Code>

See [token authentication](/docs/auth/token#auth-callback) for complete examples in all languages.

## Further reading

- **Token lifecycle**: Tokens expire and the SDK automatically refreshes them via your `authCallback` - see [Token authentication](/docs/auth/token)
- **Revoke access**: You can instantly revoke tokens for users who leave a collaboration session - see [Token revocation](/docs/auth/revocation)
- **Dynamic permissions**: Users can get new capabilities by re-authenticating (e.g., when granted edit access) - see [Capabilities](/docs/auth/capabilities)
- **Large capability sets**: If your capability JSON exceeds JWT size limits, use an Ably TokenRequest instead - see [Token authentication](/docs/auth/token#token-request)
