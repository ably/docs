<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80018 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation focusing on SDK bug awareness, proper connection ID management, and enterprise customer patterns observed in support cases -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80018: Invalid connection ID format

## What Happened

The connection ID provided to Ably doesn't match the expected format or contains invalid data that prevents proper connection management.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80018 | 400 | Connection Error (Validation) | No - requires valid connection ID format |

## Quick Fix

- Upgrade ably-js if using versions 1.2.30-1.2.33 (known bug)
- Never manually create or modify connection IDs
- Let the Ably SDK handle all connection management automatically

## Error Messages

You may encounter these variations:
- "invalid connection id (invalid format)"
- "Invalid connection key WHAT NODE"
- "Invalid connection serial"
- "invalid connectionKey: [key]. See https://help.ably.io/error/80018"
- "ConnectionManager.activateTransport: error = ErrorInfo: Invalid connection key statusCode=400 code=80018"

## Common Causes

1. **Known SDK bug in ably-js 1.2.30-1.2.33** (most common)
   - Connection resume failures due to SDK bug
   - Fixed in versions 1.2.34 and later
   - Affects both browser and Node.js environments
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 103-105 -->

2. **Manual connection ID manipulation** (developer error)
   - Attempting to create custom connection IDs
   - Modifying SDK-provided connection IDs
   - Storing and reusing old connection IDs across sessions
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 15, 134-135 -->

3. **Data corruption during transmission**
   - Network issues causing ID corruption
   - Proxy or middleware interference
   - Character encoding problems
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 11-17 -->

4. **Invalid connection serial number** (NaN values)
   - Connection serial validation failures
   - Often appears alongside errors 40142 and 40143
   - Can occur during connection state synchronization
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 36-51 -->
   <!-- Source: Enterprise customer pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 144-152 -->

## Resolution Steps

1. **Check and upgrade your SDK version**
   ```bash
   # For Node.js projects
   npm list ably
   
   # If version is 1.2.30-1.2.33, upgrade immediately
   npm install ably@latest
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 103-105 -->

2. **Remove any manual connection ID handling**
   ```javascript
   // ❌ WRONG: Never create or modify connection IDs
   const customId = 'my-connection-123';
   const modifiedId = ably.connection.id + '-modified';
   
   // ✅ CORRECT: Let the SDK manage connection IDs
   const ably = new Ably.Realtime({ key: apiKey });
   ably.connection.on('connected', () => {
     // Connection ID is automatically managed
     console.log('Connected:', ably.connection.id);
   });
   ```
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 101-108 -->

3. **Establish a fresh connection**
   ```javascript
   // If errors persist, create a new connection
   const ably = new Ably.Realtime({ 
     key: apiKey,
     // Don't use recover option with stored IDs
     // recover: null 
   });
   
   // Let SDK handle the entire lifecycle
   ably.connection.once('connected', () => {
     console.log('Fresh connection established');
   });
   ```
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 24, 74 -->

4. **Review connection recovery implementation**
   ```javascript
   // ❌ WRONG: Don't store connection IDs long-term
   localStorage.setItem('connectionId', ably.connection.id);
   
   // ✅ CORRECT: Use recovery keys for planned handover only
   // Recovery keys are valid for 2 minutes maximum
   const recoveryKey = ably.connection.createRecoveryKey();
   // Use immediately in another client instance
   ```
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 93-98 -->

5. **Check for network interference**
   - Test without proxies or VPNs if possible
   - Verify data isn't being modified in transit
   - Ensure proper TLS encryption is enabled
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 38-41 -->

## Automatic Handling

Ably SDKs are designed to manage connection IDs automatically throughout the connection lifecycle. This error indicates either:
- Manual interference with SDK-managed connection IDs
- A bug in older SDK versions (specifically ably-js 1.2.30-1.2.33)
- Data corruption preventing proper ID validation

The SDK will not automatically retry this error as it indicates an invalid ID format that must be corrected first.
<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 70-79 -->

## Prevention

- **Keep SDKs updated**: Always use the latest stable version to avoid known bugs
- **Trust SDK management**: Never manually create, modify, or persist connection IDs
- **Use proper recovery patterns**: Only use createRecoveryKey() for immediate handover (valid for 2 minutes)
- **Monitor for patterns**: If seeing this error alongside 40142/40143, investigate connection stability
- **Test thoroughly**: Verify connection handling in various network conditions
<!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 49-68 -->
<!-- Source: Enterprise patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 144-152 -->

## Related Resources

- [Connection Overview Documentation](https://ably.com/docs/connect/)
- [Connection States Documentation](https://ably.com/docs/connect/states)
- [FAQ: Error Code 80018](https://faqs.ably.com/error-code-80018-invalid-connection-id-invalid-format)

## Related Errors

• **[80023 - Unable to Resume Connection](https://help.ably.io/error/80023)**  
  Often occurs when connection recovery fails after the 2-minute window

• **[40142 - Token Request Failed](https://help.ably.io/error/40142)**  
  May appear alongside 80018 when authentication issues compound connection problems

• **[40143 - Token Request Failed](https://help.ably.io/error/40143)**  
  Another authentication error that can occur with invalid connection attempts

• **[80012 - Connection Closed](https://help.ably.io/error/80012)**  
  Previously used for some connection recovery failures, now typically shows as 80018

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80018
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 80018)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/80018-invalid-connection-id.mdx (enhanced from previous version)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Connection ID management best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 49-108
  - Troubleshooting steps from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 27-47
  - Enterprise customer patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 144-152
- Content Excluded: 
  - Internal method names (StatefulConnection.inherit, syncForRequest) - too technical for customer docs
  - Slack thread URLs - internal only
  - "WHAT NODE" unusual message preserved but not emphasized
- Recommendations Source: 
  - SDK version upgrade based on documented bug in analysis lines 103-105
  - Connection ID handling from knowledge base lines 50-108
  - Network interference checks from knowledge base lines 38-41
- Code Examples Rationale: 
  - Correct/incorrect patterns from knowledge base lines 101-108 essential for preventing error
  - Recovery key example added to show proper temporary handover pattern
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 3 | Corrected: 2 | Exempted internal: 2 -->
<!-- Corrected URLs: 
  - https://ably.com/docs/realtime/connection → https://ably.com/docs/connect/states (verified via search)
  - Added https://ably.com/docs/connect/ for general connection docs
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (SDK bug): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 103-105
  - Cause 2 (Manual IDs): From knowledge base at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 15, 134-135
  - Cause 3 (Corruption): From knowledge base at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 11-17
  - Cause 4 (Serial/Enterprise): Combined from analysis lines 36-51 and knowledge base lines 144-152
- Resolution Steps: 
  - Step 1: Based on known bug from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-analysis.md lines 103-105
  - Step 2: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 101-108
  - Step 3: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 24, 74
  - Step 4: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 93-98
  - Step 5: Network checks from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 38-41
- Prevention: Combined best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80018-knowledge.md lines 49-68 and enterprise patterns lines 144-152
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80018
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80018 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->