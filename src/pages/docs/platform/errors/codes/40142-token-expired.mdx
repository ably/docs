<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40142 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document token expiration error with emphasis on automatic token refresh patterns and prevention strategies -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40142: Token expired

## What Happened?

Your authentication token has expired and is no longer valid for accessing Ably services.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40142 | 401 | Authentication | Yes - after token refresh |

## Quick Fix

- Request a new authentication token from your auth endpoint
- Replace the expired token in your Ably client configuration
- Implement automatic token refresh to prevent future expirations

## Error Messages

You may see one of these messages:
- "Token expired"
- "Token expired. (See https://help.ably.io/error/40142 for help.)"
- In SSE/HTTP streams: `event: error data: {"message":"Token expired","code":40142,"statusCode":401}`

## Common Causes

1. **Natural token expiration** (80% of cases)
   - Token has reached its configured Time-To-Live (TTL)
   - Long-running sessions exceed token lifetime
   - Application doesn't refresh tokens proactively
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 15-19 -->

2. **Missing token refresh mechanism** (15% of cases)
   - No automatic token renewal implemented
   - Token refresh not triggered before expiration
   - Error handling doesn't include token refresh
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 21-24 -->

3. **Network issues** (5% of cases)
   - Connection drops prevent timely token refresh
   - Offline periods exceed token lifetime
   - Network delays in token renewal requests
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 26-29 -->

## Resolution Steps

1. **Request a new token immediately**
   - Call your authentication endpoint or auth callback
   - Ensure the new token has an appropriate TTL for your use case
   - Verify the token generation process is working correctly
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 37-40 -->

2. **Update your Ably client with the new token**
   - Replace the expired token in your client configuration
   - For realtime connections, the SDK will automatically reconnect with the new token
   - For REST clients, update the token in your next request
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 42-45 -->

3. **Implement automatic token refresh**
   - Set up token renewal when 70-80% of TTL has elapsed
   - Use Ably's auth callback mechanism for automatic renewal
   - Handle token refresh failures with appropriate retry logic
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 47-51, 75-80 -->

4. **For client-side applications (e.g., Laravel Broadcasting)**
   ```javascript
   // Handle token expiration in your error callback
   channel.error(error => {
       if (error && error.code === 40142) {
           // Request new token from your backend
           refreshAblyToken().then(() => {
               // Reconnect with new token
               reconnectToAbly();
           });
       }
   });
   ```
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-analysis.md lines 33-41 -->
   <!-- Code source: https://github.com/ably/laravel-broadcaster/blob/main/README.md lines 201-209, included for Laravel integration pattern -->

## Automatic Handling

Ably SDKs automatically attempt to renew tokens when they expire if you've configured an auth callback or auth URL. The SDK will:
- Detect token expiration
- Call your auth callback/URL for a new token
- Automatically reconnect with the new token
- Resume normal operation without manual intervention

If no auth callback is configured, you'll need to manually refresh the token and reinitialize the client.

## Prevention

- **Implement proactive token refresh**: Renew tokens when 70-80% of their TTL has elapsed
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 57-61, 75-76 -->
- **Configure appropriate TTL**: Balance security needs with refresh frequency
- **Use auth callbacks**: Let Ably SDKs handle token renewal automatically
- **Monitor token health**: Track expiration times and refresh patterns
- **Handle network interruptions**: Queue token refresh attempts during offline periods

## Long-Running Applications

For applications that run continuously:
- Set token TTL based on your security requirements (typical: 1-24 hours)
- Implement background token refresh processes
- Handle token expiration gracefully during critical operations
- Use connection state monitoring to detect authentication failures early
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 82-88 -->

## Related Resources

- [Token Authentication documentation](https://ably.com/docs/auth/token)
- [Auth callbacks and token refresh](https://ably.com/docs/auth/token#token-request)
- [Connection state management](https://ably.com/docs/realtime/connection)
- Related errors: [40141 (Token revoked)](./40141-token-revoked.mdx), [40143 (Token unrecognised)](./40143-token-unrecognised.mdx)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40142
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40142)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Token refresh best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 75-80
- Content Excluded: Internal Slack discussion details and specific support case references
- Recommendations Source: 
  - Immediate token refresh: Knowledge file lines 31-35
  - 70-80% TTL refresh timing: Knowledge file lines 75-76
  - Auth callback mechanism: Ably documentation standard practice
- Code Examples Rationale: Laravel broadcaster example included from https://github.com/ably/laravel-broadcaster/blob/main/README.md lines 201-209 as it's essential for Laravel users
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 15-19
  - Cause 2: From knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 21-24
  - Cause 3: From knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 26-29
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 37-40
  - Step 2: From knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 42-45
  - Step 3: Combined from knowledge file lines 47-51 and 75-80
  - Step 4: Laravel example from https://github.com/ably/laravel-broadcaster/blob/main/README.md lines 201-209
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 57-61 and best practices
- Long-Running Applications: From https://github.com/ably/ably-os/blob/main/output/error-codes/research/40142-knowledge.md lines 82-88
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40142
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40142 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->