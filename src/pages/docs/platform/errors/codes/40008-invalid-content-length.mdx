<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40008 -->
<!-- Generated: 2025-09-02T08-05-05-187Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/8f8fd9c/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document HTTP Content-Length validation error with clear technical explanations and practical solutions -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40008: Invalid content length

## What Happened

The request body contains more bytes than specified in the Content-Length header.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40008 | 400 | Client Error (Validation) | No - requires fixing the request |

## Troubleshooting

### Content-Length Mismatch
**Symptom**: "Invalid content length: received X bytes but Content-Length header specified Y bytes"
**Solution**: 
- Calculate Content-Length using byte length, not character count
- Use `Buffer.byteLength()` in Node.js or equivalent in your language
- For dynamic content, consider using chunked transfer encoding instead

<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-analysis.md lines 34-39 -->

### Multi-byte Character Issues
**Symptom**: Error occurs when sending non-ASCII characters (emojis, accented characters)
**Solution**: 
- Always calculate byte length, not string length
- UTF-8 characters can be 1-4 bytes each
- Example: "Hello üëã" is 10 bytes, not 7 characters

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md lines 11-13 -->

### HTTP Client Library Issues
**Symptom**: Content-Length is automatically set incorrectly by your HTTP client
**Solution**: 
- Update to the latest version of your HTTP client library
- Verify the library correctly handles Content-Length for your use case
- Consider switching to a well-maintained HTTP client if issues persist

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md lines 14-15 -->

### Proxy or Middleware Interference
**Symptom**: Error occurs in production but not in development
**Solution**: 
- Check if any proxies or middleware are modifying the request body
- Ensure all intermediate systems preserve Content-Length accuracy
- Review logs from load balancers or API gateways

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md line 16 -->

## Code Examples

### Correct Content-Length Calculation
```javascript
// ‚úÖ Correct: Use byte length for Content-Length
const body = JSON.stringify({ message: 'Hello ‰∏ñÁïå' });
const request = {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Content-Length': Buffer.byteLength(body) // Correct byte calculation
  },
  body: body
};

// ‚ùå Wrong: Using string length
const incorrectLength = body.length; // This counts characters, not bytes
```
<!-- Code source: Analysis from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-analysis.md lines 55-66, essential for demonstrating correct Content-Length calculation -->

### Using Chunked Transfer Encoding
For dynamic content where the final size is unknown, use chunked transfer encoding:
```javascript
// Most modern HTTP clients handle this automatically
const request = {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Transfer-Encoding': 'chunked'
    // No Content-Length header needed
  },
  body: streamOfData
};
```
<!-- Code source: Resolution pattern from https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md line 56 -->

## Prevention

- Always calculate Content-Length using byte length functions appropriate for your language
- Test with multi-byte characters (emojis, non-Latin scripts) during development
- Consider using chunked transfer encoding for streaming or dynamic content
- Keep HTTP client libraries up to date

## Related Errors

‚Ä¢ **[40009 - Max Content Length Exceeded](https://help.ably.io/error/40009)**  
  Occurs when the request body exceeds the maximum allowed size limit

‚Ä¢ **[40000 - Bad Request](https://help.ably.io/error/40000)**  
  General validation error for malformed requests

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40008
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/8f8fd9c/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40008)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No FAQ content was available for error 40008
- Content Excluded: None
- Recommendations Source: 
  - Byte length calculation: Analysis file lines 55-66
  - Chunked encoding: Knowledge file line 56
  - Multi-byte character handling: Knowledge file lines 11-13
- Code Examples Rationale: Included correct Content-Length calculation as it's essential for resolution (Analysis lines 55-66)
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Content-Length mismatch: Based on analysis findings in https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-analysis.md lines 34-39
  - Multi-byte issues: From knowledge at https://github.com/ably/ably-os/blob/8f8fd9c/output/error-codes/research/40008-knowledge.md lines 11-13
  - HTTP client bugs: Knowledge file lines 14-15
  - Proxy interference: Knowledge file line 16
- Resolution Steps: 
  - Byte length calculation: Analysis file lines 55-66 - essential for avoiding the error
  - Chunked encoding: Knowledge file line 56 - alternative approach for dynamic content
- Prevention: Based on common causes analysis and resolution patterns
-->

<!-- URL Validation Completed: 2025-09-02T08-05-05-187Z -->
<!-- External URLs verified: 1 | Corrected: 0 | Exempted internal: 4 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40008
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40008 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/8f8fd9c/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->