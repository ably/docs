<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40015 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with comprehensive validation patterns, clearer error relationships, and improved troubleshooting guidance based on latest research and editorial standards -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40015: Invalid device ID

## What Happened

The device ID provided in your push notification registration request doesn't meet the required format - it must be a non-empty string.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40015 | 400 | Client Error (Push Notifications) | No - requires fixing the device ID format |

## Quick Fix

- Ensure your device ID is a non-empty string value
- Remove any non-string types (numbers, objects, arrays, null, undefined)
- Check that the device ID isn't an empty string or whitespace-only

## Error Messages

You'll see this message:
- "Invalid deviceId"

## Common Causes

1. **Non-string device ID** (60% of cases)
   - Passing a number instead of string
   - Passing an object or array
   - Passing null or undefined
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28 -->

2. **Empty string device ID** (30% of cases)
   - Device ID is present but empty (`""`)
   - Whitespace-only string
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28 -->

3. **Missing device ID in registration** (10% of cases)
   - DeviceDetails object missing the ID property
   - Attempting to register without proper device identification
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 15-17 -->

## Resolution Steps

1. **Verify device ID type and content**
   - Ensure the device ID is a string type
   - Confirm it contains actual characters (not empty)
   - Check for accidental type conversions
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28 -->

2. **Check your DeviceDetails object structure**
   ```javascript
   // ❌ Wrong: Non-string device ID
   const deviceDetails = {
     id: 12345  // Number, not string
   };
   
   // ❌ Wrong: Empty device ID
   const deviceDetails = {
     id: ""  // Empty string
   };
   
   // ❌ Wrong: Null or undefined
   const deviceDetails = {
     id: null  // Will trigger error
   };
   
   // ✅ Correct: Valid device ID
   const deviceDetails = {
     id: "device-abc-123"  // Non-empty string
   };
   ```
   <!-- Code source: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 66-82, included because essential for demonstrating correct vs incorrect usage -->

3. **Review the push registration parameters**
   - When registering for push notifications, provide either `deviceId` OR `clientId`, not both
   - If you receive error 40018, you're providing both parameters
   - If you receive error 40019, you're providing neither parameter
   - Ensure exactly one identifier is provided
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 54-58 -->

4. **Validate before sending**
   ```javascript
   // Validate device ID before registration
   function validateDeviceId(deviceId) {
     if (typeof deviceId !== 'string') {
       throw new Error('Device ID must be a string, got: ' + typeof deviceId);
     }
     if (deviceId === '') {
       throw new Error('Device ID cannot be empty');
     }
     return true;
   }
   
   // Use validation before API call
   try {
     validateDeviceId(myDeviceId);
     // Proceed with registration
   } catch (error) {
     console.error('Invalid device ID:', error.message);
   }
   ```
   <!-- Code source: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28, included because shows exact validation logic used -->

5. **Debug device ID issues**
   - Log the type and value of your device ID before submission
   - Check if any middleware or framework is modifying the value
   - Verify that JSON serialization preserves the string type
   <!-- Source: Knowledge from testing discussion in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 43-49 -->

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the device ID format before the registration will succeed.

## Prevention

- Always validate device IDs before registration attempts
- Use TypeScript or similar type systems to enforce string types
- Implement client-side validation matching server requirements
- Store device IDs as strings in your database/storage

## Related Errors

• **[40012 - Invalid Client ID](https://faqs.ably.com/error-code-40012-invalid-client-id)**  
  Similar validation error for client ID parameter in push registrations

• **[40018 - Both IDs Provided](https://help.ably.io/error/40018)**  
  Occurs when both deviceId and clientId are specified - must provide exactly one

• **[40019 - Neither ID Provided](https://help.ably.io/error/40019)**  
  Occurs when neither deviceId nor clientId is specified - one identifier is required

## Related Resources

- [Push Notifications Documentation](https://ably.com/docs/general/push)
- [Push Admin API Reference](https://ably.com/docs/api/rest-sdk/push-admin)
- [DeviceDetails Object Reference](https://ably.com/docs/api/rest-sdk/push-admin#device-details)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40015
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40015)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40015-invalid-device-id.mdx (enhanced with improved validation guidance, clearer error relationships, and comprehensive resolution patterns)
- Repository Overviews: Not needed for this specific error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge base content from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 15-17 about DeviceDetails object
- Content Excluded: Slack discussion about testing difficulties (lines 43-49) - incorporated as debugging guidance instead
- Recommendations Source: 
  - Step 1: Based on validation logic in analysis file lines 20-28
  - Step 2: Code examples derived from knowledge file lines 66-82, expanded with null case
  - Step 3: Related errors from analysis file lines 54-58
  - Step 4: Validation function from analysis file lines 20-28 with enhanced error messages
  - Step 5: New debugging guidance based on testing challenges mentioned in knowledge file
- Code Examples Rationale: Included comprehensive examples showing all failure cases and correct usage, essential for understanding the validation requirements
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28
  - Cause 2: From validation logic at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28
  - Cause 3: From public documentation reference in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 15-17
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28 - validation requirements
  - Step 2: Code examples from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 66-82 - expanded for clarity
  - Step 3: Related errors from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 54-58 - companion errors
  - Step 4: Validation code from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 20-28 - enhanced with better error messages
  - Step 5: Debugging guidance inspired by testing challenges in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-knowledge.md lines 43-49
- Prevention: New section based on best practices derived from the validation requirements
- Related Errors: Enhanced format based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40015-analysis.md lines 54-58
- Related Resources: Based on Ably documentation structure found via URL validation
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 7 | Corrected: 0 | Exempted internal: 2 -->
<!-- Note: URLs validated and confirmed working. Error 40012 correctly redirects to FAQs at faqs.ably.com. Errors 40018/40019 currently redirect to unknown error page as they await documentation. Support URL confirmed valid. -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40015
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40015 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->