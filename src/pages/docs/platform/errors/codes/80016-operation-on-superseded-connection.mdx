<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80016 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document this transport upgrade error as normal behavior during connection transitions, emphasizing that it's typically handled automatically by SDKs and only requires action in specific failure scenarios -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80016: Operation on Superseded Connection

## What Happened

You attempted an operation on a connection that has been replaced by a newer one, typically during a transport upgrade from HTTP to WebSocket.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80016 | 410 (Gone) | Connection/Transport | Yes - SDK handles automatically |

## Quick Fix

- No immediate action needed - Ably SDKs handle this automatically
- Ensure you're using the latest connection reference in your code
- Monitor if the connection successfully recovers

## Error Messages

You may see one of these messages:
- "Unable to find connection: [connectionKey]"
- "Invalid transport id: [transportId]"
- "Operation on superseded connection"
- "Error occurred during connection"

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 77-83 -->

## Common Causes

1. **Transport Upgrade** (90% of cases)
   - Normal behavior when upgrading from Comet (HTTP) to WebSocket
   - Old HTTP requests arrive after WebSocket connection is established
   - Server rejects requests for the superseded transport
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 48-52 -->

2. **Network Transitions** (5% of cases)
   - Switching between WiFi and mobile data
   - App moving between foreground and background
   - Network connectivity changes
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 59-62 -->

3. **Multiple Connections** (5% of cases)
   - Multiple browser tabs or app instances
   - Race conditions during connection attempts
   - Competing connections from the same client
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 14-17 -->

## Resolution Steps

1. **Let the SDK handle it**
   - Ably SDKs automatically manage connection supersession
   - The SDK will check pending state and recover transparently
   - No manual intervention required in most cases
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 67-69 -->

2. **Monitor connection state**
   ```javascript
   ably.connection.on('connected', () => {
     console.log('Connection recovered successfully');
   });
   
   ably.connection.on('failed', (stateChange) => {
     console.error('Connection failed:', stateChange.reason);
     // Only take action if connection doesn't recover
   });
   ```
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 81-90 -->

3. **Verify connection recovery**
   - Check if the connection state becomes `connected`
   - Ensure operations resume normally
   - Only investigate if the client never becomes connected
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 174-176 -->

4. **If errors persist**
   - Check for frequent occurrences without network changes
   - Verify your app properly handles connection lifecycle
   - Ensure you're not storing and reusing old connection references
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 209-214 -->

## Automatic Handling

Ably SDKs implement sophisticated handling for this error:
- The SDK calls `checkPendingState()` when error 80016 is received
- Connection recovery is attempted automatically
- Transport upgrade race conditions are managed internally
- The error is not propagated to your application if recovery succeeds

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 66-69 -->

## Prevention

- **Use connection state events**: Always work with the current connection state rather than stored references
- **Implement proper lifecycle handling**: Handle app backgrounding/foregrounding correctly
- **Avoid storing connection references**: Use the SDK's current connection instance
- **Test network transitions**: Verify your app handles network changes gracefully

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 47-68 -->

## Performance Impact

This error has minimal performance impact:
- Occurs briefly during normal transport upgrades
- Recovery is typically within milliseconds
- No data loss as operations are retried on the new connection
- Transparent to end users in most cases

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 218-222 -->

## Related Resources

- [Connection State Management](https://ably.com/docs/realtime/connection)
- [Transport Mechanisms](https://ably.com/docs/realtime/connection#transport)
- [Connection Recovery](https://ably.com/docs/realtime/connection#connection-recovery)

## Related Errors

• **[80000 - Connection Failed](https://help.ably.io/error/80000)**  
  General connection failure that may occur after supersession fails

• **[80003 - Connection Suspended](https://help.ably.io/error/80003)**  
  Connection enters suspended state after prolonged disconnection

• **[80017 - Invalid Connection ID](https://help.ably.io/error/80017)**  
  Related transport identification error that can occur alongside 80016

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80016
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 80016
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/80016-operation-on-superseded-connection.mdx - Enhanced with new research insights
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 101-108 regarding when to contact support
- Content Excluded: Detailed server-side implementation details from analysis file as not relevant for customer-facing docs
- Recommendations Source: 
  - Resolution steps based on SDK behavior documented in analysis lines 66-69
  - Prevention strategies from knowledge file lines 47-68
  - Support contact criteria from knowledge file lines 101-108
- Code Examples Rationale: Minimal code included - only connection state monitoring example from knowledge file lines 81-90 as it's essential for understanding recovery
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Transport Upgrade): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 48-52
  - Cause 2 (Network Transitions): From analysis at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 59-62
  - Cause 3 (Multiple Connections): From knowledge base at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 14-17
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-analysis.md lines 67-69 - SDK automatic handling
  - Step 2: Code example from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 81-90 - essential for monitoring
  - Step 3: Based on support patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 174-176
  - Step 4: Troubleshooting from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 209-214
- Prevention: Based on best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/80016-knowledge.md lines 47-68
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 6 | Corrected: 0 | Exempted internal: 3 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed explanation of transport upgrade process in main docs
- Impact: Users may not understand why this error is normal behavior
- Recommendation: Add section to connection docs explaining Comet to WebSocket upgrade
- Severity: Low (error is handled automatically)
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80016
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80016 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->