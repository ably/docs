<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40101 -->
<!-- Generated: 2025-08-25T12-12-38-783Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with latest research findings, improved error message clarity, and comprehensive resolution guidance based on real-world patterns -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40101: Invalid credentials

## What Happened

Your authentication credentials are invalid, incorrectly formatted, or cannot be verified by Ably's authentication system.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40101 | 401 | Authentication | No - requires fixing credentials |

## Quick Fix

- Verify your API key is complete with all three parts: `[AppId].[keyId]:[keySecret]`
- Remove any leading or trailing spaces from your API key
- For token auth, ensure the token hasn't been modified after generation
- Check that clientId matches between token and client initialization

## Error Messages

You may see one of these messages:
- "Invalid credentials"
- "No key specified"
- "Invalid key specified"
- "Ably key was empty. Ably key must be in the following format [AppId].[keyId]:[keyValue]"
- "Request mac does not match"
- "Invalid clientId for credentials"
- "Unable to set different clientId from that given in options"
- "Unable to handle request no application id found in request"
- "No key specified: no means to generate a token"
- "Missing key"
- "Invalid token while decoding legacy token format"
- "Invalid token while verifying token signature"
- "Malformed auth credentials while decoding authentication parameters"

## Common Causes

1. **Incorrect API key format** (70% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 16-30, 44-62 -->
   - Missing characters or typos in the API key
   - Key doesn't follow format: `[AppId].[keyId]:[keySecret]`
   - Empty or whitespace-only key string
   - Copy-paste errors with leading/trailing spaces
   - Incomplete key from environment variables
   - Key not splitting into exactly 2 parts at the colon

2. **Token MAC verification failures** (15% of cases)
   <!-- Source: FAQ content from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 18-35, analysis from lines 136-143 -->
   - Token request JSON modified after MAC generation
   - Incorrect key used for token generation vs verification
   - Token tampering or corruption during transmission
   - Legacy token format validation failures
   - MAC comparison fails during token verification

3. **ClientId mismatches** (10% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 63-67, knowledge from lines 37-42 -->
   - Different clientId between token and client constructor
   - Attempting to change clientId on existing connection
   - Empty or wildcard clientId when binding is required
   - JWT missing x-ably-clientId header

4. **Browser or network issues** (5% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 273-280, 337-344 -->
   - Browser extensions stripping Authorization headers (Chrome/Edge)
   - Corporate proxies removing authentication
   - Network timeouts during authentication (especially in APAC region)
   - Frontdoor vs frontend routing inconsistencies
   - High latency causing authentication timeouts

## Resolution Steps

1. **Verify your API key format**
   <!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 21-30, FAQ from knowledge file lines 44-46 -->
   - Log into your [Ably dashboard](https://ably.com/dashboard)
   - Navigate to your app → "API Keys" tab
   - Copy the complete key including all three parts:
     - App ID (e.g., `xVLyHw`)
     - Key ID (e.g., `rPSJgQ`)
     - Key Secret (e.g., `U6RN3LJvZzV3DXJk`)
   - Full format example: `xVLyHw.rPSJgQ:U6RN3LJvZzV3DXJk`
   - Ensure no spaces before or after the key
   - Verify the key contains exactly one period (.) and one colon (:)

2. **Check your implementation**
   <!-- Source: Code patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 69-91 -->
   - Verify environment variables are loading correctly
   - Ensure the key contains exactly one period (.) and one colon (:)
   - Check that your key isn't being truncated or modified
   - Enable debug logging to see the actual key being used
   - Confirm the key splits into exactly 2 parts when split at the colon

3. **For token authentication issues**
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 24-35, preserved for customer experience -->
   - Ensure the token request JSON hasn't been modified after MAC generation
   - Verify the same API key is used for both token generation and verification
   - Check that clientId in token matches clientId in client options
   - For JWT, confirm clientId is set in the x-ably-clientId header
   - Generate a fresh token to rule out expiration issues
   - Ensure MAC is generated AFTER all other token request fields are set

4. **Debug authentication problems**
   <!-- Source: Support recommendations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 43-49, 273-280 -->
   - Enable debug logging in your SDK to see detailed authentication flow
   - Check for browser extensions that might strip Authorization headers (Chrome/Edge)
   - Test with a different browser or incognito mode
   - Verify corporate proxies aren't interfering with authentication
   - Test with a fresh API key to rule out key-specific issues
   - Try forcing backend routing with `_forceHandleBy=frontend` parameter if intermittent
   - For APAC region users, check if high latency is causing timeouts

5. **For clientId issues**
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 63-67, knowledge lines 37-42, 153-155 -->
   - Ensure clientId is consistent across token generation and client initialization
   - Don't attempt to change clientId on an existing connection
   - Avoid using empty strings or wildcards ('*') for clientId when binding
   - Review [Client ID documentation](https://ably.com/docs/auth/identified-clients)
   - Note that empty or wildcard clientIds are rejected for security reasons

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the authentication configuration before the operation will succeed. The SDK will not attempt to recover from invalid credentials as this indicates a configuration issue rather than a transient problem.

## Code Examples

### Correct API Key Format
<!-- Code guidance based on analysis patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 16-30, 44-62 -->
```javascript
// ✅ Correct: Complete API key with all three parts
const ably = new Ably.Realtime('xVLyHw.rPSJgQ:U6RN3LJvZzV3DXJk');

// ❌ Wrong: Missing app ID
const ably = new Ably.Realtime('rPSJgQ:U6RN3LJvZzV3DXJk');

// ❌ Wrong: Missing key secret
const ably = new Ably.Realtime('xVLyHw.rPSJgQ');

// ❌ Wrong: Incomplete key with typo
const ably = new Ably.Realtime('xVLyHw.rPSJ:U6RN3LJvZzV3DXJk');

// ❌ Wrong: Empty or whitespace-only key
const ably = new Ably.Realtime('');

// ✅ Correct: From environment variable (ensure it's loaded)
const ably = new Ably.Realtime(process.env.ABLY_API_KEY);
```

### ClientId Configuration
<!-- Code pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 63-67, knowledge lines 37-42 -->
```javascript
// ✅ Correct: Consistent clientId
const tokenParams = { clientId: 'user123' };
const token = await ably.auth.requestToken(tokenParams);

const client = new Ably.Realtime({
  token: token,
  clientId: 'user123' // Must match token clientId
});

// ❌ Wrong: Mismatched clientId
const client = new Ably.Realtime({
  token: token,
  clientId: 'differentUser' // Will cause 40101 error
});

// ❌ Wrong: Empty or wildcard clientId when binding
const client = new Ably.Realtime({
  token: token,
  clientId: '' // Cannot be empty when binding
});

// ❌ Wrong: Attempting to change clientId
// This will fail with "Unable to set different clientId from that given in options"
```

### Token Request Validation
<!-- Code pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 24-35 -->
```javascript
// ✅ Correct: Valid token request structure
const tokenRequest = {
  keyName: "I2E_JQ.r_aOYg",
  clientId: "foo",
  ttl: 43200000,
  timestamp: Date.now(),
  capability: JSON.stringify({"*":["*"]}),
  nonce: generateNonce()
};
// MAC must be generated AFTER all other fields are set
tokenRequest.mac = generateMac(tokenRequest);

// ❌ Wrong: Modifying after MAC generation
tokenRequest.mac = generateMac(tokenRequest);
tokenRequest.clientId = "bar"; // This invalidates the MAC
```

## Prevention

- Store API keys securely in environment variables, not in code
- Implement proper error handling for authentication failures
- Use token authentication for client-side applications
- Test authentication in development before deploying
- Monitor authentication error rates to detect issues early
- Use debug logging during development to catch authentication problems
- For enterprise deployments, test with corporate proxy configurations
- In high-latency regions (APAC), implement appropriate timeout handling

## Performance Impact

Authentication failures prevent all Ably operations:
- No messages can be published
- No channels can be subscribed
- Presence operations will fail
- Connection cannot be established

The error does not trigger automatic retries, preventing unnecessary load on the authentication system.

## Related Errors

• **[40102 - Token expired](https://help.ably.io/error/40102)**  
  Token has exceeded its TTL and needs renewal

• **[40400 - Not found](https://help.ably.io/error/40400)**  
  Related error when app ID or key ID portions are invalid

• **[40005 - Invalid credential](https://help.ably.io/error/40005)**  
  Similar authentication error with different validation context

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [API key best practices](https://ably.com/docs/auth/basic)
- [Token authentication guide](https://ably.com/docs/auth/token)
- [Client ID explained](https://ably.com/docs/auth/identified-clients)
- [Debug logging guide](https://ably.com/docs/realtime/connection#connection-state-recovery)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40101
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using
- Whether the error is intermittent or consistent
- Browser and version (for web applications)
- Your region (especially if in APAC where latency issues are more common)

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (lines 69-72 for 40101 - no specific notes)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40101-invalid-credentials.mdx (enhanced based on new research)
- Error Code Documentation Writing Guide: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/shared-resources/error-code-doc-writing-guide.md
- Ably Style Guide: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/shared-resources/ably-style-guide.md
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Token MAC verification guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 18-35
  - ClientId mismatch resolution from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 37-42
  - Debug logging recommendation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 43-49
  - Browser extension issues from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 273-280
- Content Enhanced from Previous Version:
  - Maintained comprehensive structure from existing documentation
  - Updated generation timestamp and SHA reference
  - Preserved all valuable content from previous version
- Content Excluded: 
  - Internal Slack discussion URLs (not appropriate for customer documentation)
  - Specific customer names from support tickets
  - Technical implementation details about internal routing
  - HTTP status inconsistency details (403 vs 401) to avoid confusion
  - GitHub issue/PR references (too implementation-specific)
- Recommendations Source: 
  - Resolution steps based on code analysis patterns and FAQ content
  - No exponential backoff recommended per editorial notes
  - Browser troubleshooting from support patterns
  - Regional considerations from support ticket patterns
- Code Examples Rationale: 
  - API key format examples essential (70% of cases per analysis)
  - ClientId configuration critical for token auth issues
  - Token request validation shows MAC generation timing
  - Environment variable example added based on common issues
  - All examples verified against SDK patterns in analysis file
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (API key format): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 16-30, 44-62
  - Cause 2 (Token MAC): From FAQ content in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-knowledge.md lines 18-35, analysis lines 136-143
  - Cause 3 (ClientId): Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40101-analysis.md lines 63-67
  - Cause 4 (Browser issues): Knowledge file lines 273-280, 337-344 (Mentimeter case and APAC patterns)
- Resolution Steps: 
  - Step 1: Based on API key format validation patterns from analysis file lines 21-30, 59-61
  - Step 2: Implementation checking from code patterns lines 69-91
  - Step 3: FAQ advice from knowledge file lines 24-35 - preserved due to customer experience
  - Step 4: Support recommendations from knowledge file lines 43-49, 273-280, 335-340
  - Step 5: ClientId guidance from analysis lines 63-67, knowledge lines 37-42, 153-155
- Code Examples:
  - API key format: Based on error patterns from analysis file lines 16-30, 44-62
  - ClientId configuration: From analysis file lines 63-67
  - Token request: From knowledge file lines 24-35 showing valid structure
- Prevention: Based on best practices from knowledge file support patterns and regional insights
- Performance Impact: Derived from authentication failure consequences
- Related Errors: Enhanced with descriptions based on knowledge file lines 100-105
-->

<!-- URL Validation Completed: 2025-08-25T12-12-38-783Z -->
<!-- External URLs verified: 8 | Corrected: 0 | Exempted internal: 2 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear explanation of the three-part API key structure in main auth docs
- Missing: Troubleshooting guide for browser extension interference
- Missing: Regional latency considerations for APAC users
- Impact: Users don't understand what "application ID" or "key ID" mean in error messages
- Impact: Chrome/Edge users experience intermittent failures without understanding why
- Impact: APAC users may experience timeouts without understanding the cause
- Recommendation: Add visual diagram of API key structure to authentication guide
- Recommendation: Add browser-specific troubleshooting section for enterprise users
- Recommendation: Document regional considerations for high-latency environments
- Severity: Medium - causes significant confusion for new developers and enterprise deployments
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40101
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40101 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->