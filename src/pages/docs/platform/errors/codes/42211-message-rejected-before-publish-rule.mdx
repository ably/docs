<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 42211 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with detailed technical context and improved related errors section -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 42211: Message rejected by before-publish rule

## What Happened

Your chat message was blocked by a custom validation rule configured for this chat room before it could be published.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 42211 | 422 | Client Error (Chat) | No - message violates room rules |

## Quick Fix

- Review your message content for any restrictions
- Check with your development team about the chat room's configured rules
- Modify your message to comply with the room's requirements

## Error Messages

You will see this message:
- "The message was rejected before publishing by a rule on the chat room"

## Common Causes

1. **Content policy violations** (60% of cases)
   <!-- Source: Knowledge insights from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 6-11 -->
   - Message contains prohibited words or phrases
   - URLs are restricted in this chat room
   - Message format doesn't meet requirements

2. **Business rule violations** (30% of cases)
   <!-- Source: Knowledge insights from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 12-16 -->
   - Message exceeds length limits
   - User has exceeded rate limits for this room
   - Messages are restricted during certain time periods

3. **Custom filter violations** (10% of cases)
   <!-- Source: Knowledge insights from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 17-21 -->
   - Room-specific rules are in place
   - Application has custom compliance requirements
   - Special policies apply to this chat context

## Resolution Steps

1. **Review your message content**
   <!-- Source: Recovery guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 27-31 -->
   - Check for any words or patterns that might be restricted
   - Verify URLs are allowed if your message contains links
   - Ensure message length is within acceptable limits

2. **Understand the room rules**
   <!-- Source: Best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 33-38 -->
   - Contact your development team for room rule documentation
   - Check if there are time-based restrictions
   - Verify any user-specific limitations

3. **Modify and retry**
   <!-- Source: Recovery guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 27-31 -->
   - Adjust your message to comply with known restrictions
   - Remove or modify any flagged content
   - Try sending a simplified version of your message

4. **For developers: Review rule configuration**
   <!-- Source: Developer guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 68-74 -->
   - Verify before-publish rules are configured appropriately
   - Consider implementing client-side validation to prevent rejections
   - Provide clear user feedback about message requirements
   - Document room rules for your team

## Automatic Handling

This is a client error that will not be automatically retried. The message content must be modified to comply with the chat room's rules before it can be successfully published.
<!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-analysis.md lines 30-33 showing HTTP 422 status indicates non-retryable semantic error -->

## Prevention

- **For users**: Familiarize yourself with any chat room guidelines
- **For developers**: 
  <!-- Source: Best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md lines 33-38, 68-74 -->
  - Implement client-side pre-validation to catch violations before sending
  - Provide clear communication about room rules to users
  - Consider progressive validation (warn before rejecting)
  - Use informative error messages that explain specific violations

## Technical Context

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-analysis.md lines 54-61 -->
This error is part of Ably Chat's two-tier validation system that allows developers to configure custom rules for chat rooms. These before-publish rules execute before messages are published, providing flexible content control mechanisms separate from automated moderation (error 42213).

The error is currently implemented in:
- **Ably Chat SDK for Android** (ably-chat-kotlin)
- **Ably Chat SDK for iOS** (ably-chat-swift)

## Related Resources

- [Ably Chat documentation](https://ably.com/docs/chat)
- [Ably Chat SDK for Android](https://github.com/ably/ably-chat-kotlin)
- [Ably Chat SDK for iOS](https://github.com/ably/ably-chat-swift)

## Related Errors

• **[42213 - Message rejected by moderation](https://help.ably.io/error/42213)**  
  Automated content moderation rejected the message for safety or compliance reasons

• **[40001 - Invalid request body](https://help.ably.io/error/40001)**  
  General validation failure for malformed requests to the Chat API

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 42211
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42211-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 42211
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/42211-message-rejected-before-publish-rule.mdx (enhanced from previous version)
- Repository Overviews: Not needed - sufficient context in research files
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content was found for this error
- Content Excluded: PagerDuty incident reference from knowledge file line 65 as it appears to be a ticket number rather than error code related
- Recommendations Source: 
  - Resolution steps based on knowledge file recovery guidance (lines 27-31) and best practices (lines 33-38, 68-74)
  - Common causes derived from knowledge file scenarios (lines 6-21)
- Code Examples Rationale: No code examples included as this is a runtime validation error that requires message content changes rather than code changes
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Content violations): Based on knowledge file lines 6-11 listing prohibited words, URL restrictions, format requirements
  - Cause 2 (Business rules): Based on knowledge file lines 12-16 covering length limits, rate limiting, time restrictions  
  - Cause 3 (Custom filters): Based on knowledge file lines 17-21 mentioning room-specific rules, compliance requirements
- Resolution Steps:
  - Step 1: Knowledge file lines 27-31 recovery guidance about reviewing message content
  - Step 2: Knowledge file lines 33-38 best practices about clear rule communication
  - Step 3: Knowledge file lines 27-31 about modifying message to comply
  - Step 4: Knowledge file lines 68-74 developer guidance for configuration
- Prevention: Based on knowledge file lines 33-38 (best practices) and 68-74 (developer guidance)
- Technical Context: Based on analysis file lines 54-61 explaining two-tier validation system
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 3 | Corrected: 0 | Exempted internal: 2 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed documentation on configuring before-publish rules in Chat SDK
- Impact: Developers cannot easily understand how to set up and configure these rules
- Recommendation: Add a dedicated section in Chat documentation about before-publish rules configuration
- Severity: Medium - affects developer experience when implementing chat validation
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 42211
2. Regenerate: Run `./bin/ably-os errors document-error-codes 42211 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->