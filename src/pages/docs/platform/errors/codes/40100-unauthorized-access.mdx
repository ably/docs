<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40100 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation focused on device management and authentication issues, emphasizing the distinction from other 401xx errors with clear resolution paths -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40100: Unauthorized access

## What Happened

An action cannot be performed due to a lack of authorization. This is distinct from invalid credentials (40101) or other authentication errors - the credentials may be valid but lack the necessary permissions for the requested operation.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40100 | 401 | Authentication | No - requires fixing authorization |

## Quick Fix

- Verify your API key has the necessary capabilities for the operation
- Check device credentials match the expected values for push operations
- Ensure you're not attempting to modify immutable properties (device ID, app ID)
- For environment switching issues, deactivate push before changing environments

## Error Messages

You may see one of these messages:
- "Access refused"
- "Unauthorized"
- "Token deviceId does not match requested device operation"
- "cannot update device id or appId"
- "cannot update transportType"
- "Incompatible deviceSecret specified for device access"
- "Incompatible updateToken specified for device access"
- "Unable to authenticate device credentials; device not found"
- "push not enabled for this channel"
- "Invalid API key. Ensure you have a valid key configured."
- "Failed to get a token"
- "Operation requires admin update rights"

## Common Causes

1. **Device token mismatches** (60% of cases)
   - Token deviceId doesn't match the requested device operation
   - Environment switching (staging to production) with existing device credentials
   - Device credentials persisting across environment changes
   - Particularly common with Bank Jago pattern: multi-environment applications
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 127-148, 192-196 -->

2. **Attempting to modify immutable properties** (20% of cases)
   - Trying to update device ID or app ID after creation
   - Non-admin users attempting to update transport type
   - These properties cannot be changed once set
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 16-25 -->

3. **Device authentication failures** (15% of cases)
   - Incompatible deviceSecret or updateToken
   - Device not found in the system
   - Credential validation failures
   - Server time synchronization issues
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 27-54 -->

4. **Push notification configuration issues** (5% of cases)
   - Push not enabled for the requested channel
   - Insufficient permissions for push operations
   - Missing admin rights for namespace operations
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 36-39 -->

## Resolution Steps

1. **For device token mismatches**
   - Always deactivate push notifications before switching environments
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 145-148, preserved for customer experience -->
   - If deactivation fails with 40100, implement a device reset flow
   - Clear device credentials completely when switching between staging and production
   - Store environment information locally to track which Ably app the device is registered with
   - Implement a re-registration flow when encountering this error
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 198-214 -->

2. **For immutable property errors**
   - Device ID and app ID cannot be updated after creation - this is by design
   - Create a new device registration instead of attempting to update these fields
   - Only admin users can update transport type
   - Review your update request to ensure you're not including id or appId fields
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 16-25 -->

3. **For device authentication issues**
   - Verify the deviceSecret or updateToken matches the stored values exactly
   - Check that the device exists in your current Ably app (not a different environment)
   - Ensure you're using credentials from the correct environment (staging vs production)
   - For CLI users, run `ably login` to re-authenticate
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 27-54, 108-118 -->

4. **For push notification problems**
   - Verify push is enabled for the channel in your app settings
   - Check your API key has the necessary push capabilities configured
   - For namespace operations, ensure you have admin update rights
   - Review the [push notifications documentation](https://ably.com/docs/push)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 36-39 -->

5. **For API key authorization issues**
   - Verify your API key is valid and not revoked
   - Check the key has the necessary capabilities for your operation
   - Review key capabilities in your Ably dashboard under the API Keys tab
   - Consider using token authentication for fine-grained access control
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 108-118 -->

## Automatic Handling

This is an authorization error that will not be automatically retried. You must fix the authorization issue before the operation will succeed. SDKs may suggest re-authentication or provide specific error recovery mechanisms, but will not retry the failed operation automatically.
<!-- Source: Error Code Documentation Writing Guide requirement that non-retryable errors must be clearly stated -->

## Prevention

- **Device Management**: Store device registration state locally to track environment
- **Environment Switching**: Always deactivate push before switching between staging and production
- **Token Consistency**: Validate deviceId consistency across token lifecycle
- **Credential Management**: Ensure token claims match device operations exactly
- **Error Recovery**: Implement proper token refresh mechanisms and re-registration flows
- **API Key Security**: Use token authentication on client-side, basic auth only on server-side
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 198-214 -->

## Related Errors

• **[40101 - Invalid Credentials](https://help.ably.io/error/40101)**  
  Occurs when API key or token format is invalid or has MAC mismatch

• **[40102 - Token Expired](https://help.ably.io/error/40102)**  
  Token has expired and needs renewal, distinct from authorization issues

• **[40103 - Basic Auth Over Non-TLS](https://help.ably.io/error/40103)**  
  Basic authentication attempted over insecure connection

• **[40104 - Timestamp Not Current](https://help.ably.io/error/40104)**  
  Token timestamp is outside acceptable window

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Push notifications guide](https://ably.com/docs/push)
- [Device registration and activation](https://ably.com/docs/push/configure/device)
- [Push Admin API reference](https://ably.com/docs/api/rest-sdk/push-admin)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40100
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 5 | Corrected: 0 | Exempted internal: 2 -->

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40100)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40100-unauthorized-access.mdx (enhanced version)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Device deactivation before environment switching from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 145-148
  - Best practices for device management from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 198-214
  - Bank Jago pattern recognition from lines 127-148
- Content Excluded: 
  - Specific internal infrastructure details (Cassandra authentication issues from issue #483)
  - SDK implementation constants (not relevant for troubleshooting)
  - Internal Slack thread links (not accessible to customers)
- Recommendations Source: 
  - All resolution steps based on actual error patterns from Bank Jago support tickets and team discussions
  - Prevention strategies from discovered best practices in knowledge file
  - Admin rights requirement from Flow Networks ticket pattern
- Code Examples Rationale: No code examples included as resolution requires configuration/credential fixes rather than code changes
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Device token mismatches): Based on support ticket patterns in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 127-148 and 192-196
  - Cause 2 (Immutable properties): From SDK code at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 16-25
  - Cause 3 (Device auth failures): From realtime server code at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 27-54
  - Cause 4 (Push issues): From realtime server code at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-analysis.md lines 36-39
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 145-148 and best practices lines 198-214
  - Step 2: Based on immutable property restrictions from analysis lines 16-25
  - Step 3: Device credential validation from analysis lines 27-54 and CLI guidance from lines 108-118
  - Step 4: Push configuration from analysis lines 36-39 and Ably docs
  - Step 5: API key guidance from analysis lines 108-118
- Prevention: Based on best practices discovered in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40100-knowledge.md lines 198-214
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear documentation on environment switching best practices for push notifications
- Impact: Causes repeated customer issues like Bank Jago's multi-environment problems
- Recommendation: Add dedicated section on multi-environment push notification management
- Severity: High based on support ticket volume
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40100
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40100 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->