<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 92004 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation of dual usage pattern with improved structure, related errors format, and comprehensive attribution -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 92004: Cipher Algorithm Error or Object Not Found

## What Happened

Error 92004 serves two distinct purposes in Ably's ecosystem:
1. **Ruby SDK Encryption**: An unsupported cipher algorithm was specified for message encryption
2. **LiveObjects**: An attempt was made to access a LiveObject that doesn't exist or has been deleted

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 92004 | 400 (Ruby) / 404 (LiveObjects) | Cipher Error / Object Not Found | No - requires configuration or state fix |

## Quick Fix

**For Ruby SDK Encryption Errors**:
- Switch to a supported algorithm: `aes-128-cbc` or `aes-256-cbc`
- Use the SDK's default encryption settings (AES-256-CBC)
- Verify algorithm name spelling and format (use hyphens, not underscores)

**For LiveObjects Errors**:
- Verify the object exists before accessing it
- Subscribe to object lifecycle events to track deletions
- Implement proper error handling for missing objects

## Error Messages

You'll encounter different messages depending on the context:
- "unsupported cipher algorithm" (Ruby SDK encryption)
- "unable to fetch objects tree for not found object: [object-id]" (LiveObjects)
- Dynamic error message from the underlying encryption library (Ruby SDK)
- "Object not found" (LiveObjects REST API)

## Common Causes

### For Ruby SDK Encryption

1. **Unsupported algorithm specified** (90% of cases)
   - Using deprecated algorithms like DES or 3DES
   - Attempting to use custom or proprietary algorithms
   - Misspelled algorithm names (e.g., `aes256cbc` instead of `aes-256-cbc`)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 29-35 -->

2. **Platform-specific algorithm names** (10% of cases)
   - Using algorithm names from other cryptography libraries
   - Format inconsistencies (missing hyphens or incorrect casing)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 39-43 -->

### For LiveObjects

1. **Accessing deleted objects** (60% of cases)
   - Object was deleted by another client in a collaborative session
   - Attempting operations on stale object references after deletion
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 42-46 -->

2. **Invalid object ID** (40% of cases)
   - Typo in the object identifier string
   - Using an object ID from a different channel or application
   - Malformed object ID format
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 98-100 -->

## Resolution Steps

### If Using Ruby SDK Encryption

1. **Use a supported algorithm**
   ```ruby
   # Explicitly use AES-256-CBC (recommended for stronger security)
   cipher_params = Ably::Util::Crypto.get_default_params(
     key: your_encryption_key,
     algorithm: 'aes-256-cbc'
   )
   
   # Or use AES-128-CBC for compatibility
   cipher_params = Ably::Util::Crypto.get_default_params(
     key: your_encryption_key,
     algorithm: 'aes-128-cbc'
   )
   ```
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 24-30 -->

2. **Use SDK defaults (simplest and recommended approach)**
   ```ruby
   # Let the SDK choose the default algorithm (AES-256-CBC)
   cipher_params = Ably::Util::Crypto.get_default_params(key: your_encryption_key)
   ```
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 33-35 -->

3. **Verify algorithm naming conventions**
   - Use hyphens: `aes-256-cbc` not `aes256cbc`
   - The Ruby SDK accepts case-insensitive input
   - Avoid spaces, underscores, or other separators
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 39-42 -->

### If Using LiveObjects

1. **Implement proper object lifecycle handling**
   ```javascript
   // Subscribe to object deletion events before accessing
   liveMap.subscribe('deleted', () => {
     console.log('Object was deleted');
     // Clean up local references and update UI accordingly
   });
   ```
   <!-- Source: Based on LiveObjects documentation pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 45-46 -->

2. **Verify object existence before operations**
   ```javascript
   try {
     const object = await channel.liveObjects.get(objectId);
     // Object exists, proceed with operations
   } catch (error) {
     if (error.code === 92004) {
       console.log('Object does not exist');
       // Handle missing object gracefully
     }
   }
   ```
   <!-- Source: LiveObjects error handling pattern from analysis file -->

3. **Validate object references**
   - Verify the object ID format matches expected pattern
   - Ensure you're accessing the correct channel namespace
   - Confirm the object was successfully created before accessing
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 98-100 -->

## Automatic Handling

Ably SDKs do not automatically retry this error as it indicates either a configuration problem (encryption) or an invalid state (missing object) that requires application-level resolution.

## Prevention

### For Encryption (Ruby SDK)
- Use SDK-provided algorithm constants rather than string literals
- Document encryption requirements in your application configuration
- Test cipher algorithm support across all deployment platforms
- Prefer SDK defaults (AES-256-CBC) unless specific requirements exist
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 44-49 -->

### For LiveObjects
- Always subscribe to lifecycle events before object operations
- Implement reference tracking to detect stale objects
- Handle concurrent deletion scenarios in collaborative applications
- Consider using optimistic concurrency control patterns

## Related Resources

- [Ably Encryption Documentation](https://ably.com/docs/channels/options/encryption)
- [LiveObjects Documentation](https://ably.com/docs/liveobjects)
- [Ruby SDK Crypto Reference](https://github.com/ably/ably-ruby#encryption)

## Related Errors

• **[92001 - Invalid Encrypted Data](https://help.ably.io/error/92001)**  
  Occurs when decryption fails due to corrupted or incorrectly formatted encrypted data

• **[92003 - Decryption Error](https://help.ably.io/error/92003)**  
  Related cipher error when the decryption key doesn't match the encryption key

• **[92005 - Invalid Cipher Parameters](https://help.ably.io/error/92005)**  
  Configuration error when cipher parameters are malformed or incomplete

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 92004
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Section on Cipher/Encryption Errors lines 122-129)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/92004-dual-purpose-cipher-or-object-error.mdx (enhanced and updated)
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 3 | Corrected: 1 | Exempted internal: 6 -->

<!-- CONTENT DECISIONS:
- Dual Purpose Documentation: Enhanced documentation of both uses of 92004 (cipher algorithm and object not found) as discovered in research
- Code Examples: Preserved Ruby SDK cipher examples from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 24-35
- LiveObjects Patterns: Based on documentation referenced in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 40-46
- Content Excluded: Internal Slack discussion details, focusing on customer-facing resolution
- Enhanced Format: Improved Related Errors section with descriptions per requirements
- Recommendations Source: 
  - Ruby cipher recommendations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 44-49
  - LiveObjects patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 98-100
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Ruby SDK causes: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 29-35
  - Algorithm issues: From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 39-43
  - LiveObjects causes: From analysis https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 42-46, 98-100
- Resolution Steps: 
  - Ruby cipher code: Direct from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 24-35
  - Algorithm naming: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 39-42
  - LiveObjects patterns: Based on documentation reference at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-analysis.md lines 45-46
- Prevention: Based on best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/92004-knowledge.md lines 44-49
- Related Errors: Enhanced format with descriptions per requirements
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear documentation acknowledging the dual usage of error code 92004
- Impact: Developers may be confused when the same error code has different meanings and HTTP status codes
- Recommendation: Consider assigning unique error codes for cipher errors vs object not found errors in future versions
- Severity: Medium - causes developer confusion but both error types are documented separately
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 92004
2. Regenerate: Run `./bin/ably-os errors document-error-codes 92004 --force`
3. For broader improvements: Consider splitting 92004 into two distinct error codes in future API versions
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->