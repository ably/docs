<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 90000 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document common channel operation failures, focusing on attach/detach race conditions and state issues as primary causes. Provide clear resolution steps while acknowledging SDK implementation variations. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 90000: Channel operation failed

## What Happened?

A channel operation couldn't be completed due to conflicting requests, invalid state, or timing issues with attach/detach operations.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 90000 | 400/409/500 | Channel Operation | Yes - after resolving conflict |

## Quick Fix

- Ensure sequential channel operations (await attach before detach)
- Check channel state before operations
- Implement debouncing for rapid DOM manipulation scenarios

## Error Messages

You may see one of these messages:

- "Attach request superseded by a subsequent detach request"
- "Detach request superseded by a subsequent attach request"
- "Unable to attach; reason unknown; state = {state}"
- "Unable to detach; reason unknown; state = {state}"
- "Can't attach when not in an active state"
- "Channel state is failed"
- "channel is being DETACHED"

## Common Causes

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md lines 122-150 -->
1. **Race conditions between attach/detach** (60% of cases)
   - Calling detach() while attach() is pending
   - Calling attach() while detach() is pending
   - Rapid DOM manipulation triggering multiple operations
   
2. **Invalid channel or connection state** (30% of cases)
   - Attempting operations on failed channels
   - Operations when connection isn't active
   - Channel already in detaching state

3. **Unknown attachment failures** (10% of cases)
   - Connection issues during attachment
   - Internal server errors
   - Timeout during channel operations

## Resolution Steps

1. **For attach/detach conflicts**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md lines 328-341 -->
   - Wait for current operation to complete:
   ```javascript
   // Ensure sequential operations
   await channel.detach();
   await channel.attach();
   ```
   - Never call conflicting operations simultaneously

2. **For rapid DOM manipulation**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md lines 342-347 -->
   - Implement debouncing to reduce operation frequency:
   ```javascript
   const debouncedAttach = debounce(() => {
     channel.attach();
   }, 300);
   ```

3. **For state-related errors**
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md lines 130-138 -->
   - Check channel state before operations:
   ```javascript
   if (channel.state === 'attached') {
     channel.publish('event', data);
   }
   ```
   - Monitor connection state to ensure it's active

4. **For persistent failures**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md lines 329-335 -->
   - Implement retry with exponential backoff (only for this specific error):
   ```javascript
   channel.attach((err) => {
     if (err && err.code === 90000 && err.statusCode === 409) {
       setTimeout(() => channel.attach(), 1000);
     }
   });
   ```

## Automatic Handling

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md lines 122-127 and Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md lines 86-92 -->
Ably SDKs do not automatically retry error 90000. This is an application-level error requiring:
- Proper sequencing of channel operations
- State validation before operations
- Manual retry logic with appropriate delays

Note: Based on internal discussions, channels often remain functional despite this error appearing in logs.

## Prevention

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md lines 227-230 -->
- **Sequential Operations**: Always await channel operations to complete
- **State Management**: Track channel state in your application
- **Debouncing**: Implement delays for high-frequency scenarios
- **Error Boundaries**: Handle errors gracefully without disrupting user experience

## SDK Implementation Variations

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md lines 151-163 -->
Different Ably SDKs may return different HTTP status codes with error 90000:
- **JavaScript**: 409 for conflicts, 500 for unknown errors, 400 for generic failures
- **iOS/macOS**: Consistently uses 500
- **Python**: 409 for conflicts
- **Java**: 400 for state failures
- **Go**: No explicit status code

## Related Resources

- [Channel lifecycle documentation](https://ably.com/docs/channels#lifecycle)
- [Connection state management](https://ably.com/docs/realtime/connection)
- [Channel attach/detach best practices](https://ably.com/docs/best-practice#channel-lifecycle)
- Related errors: [80000](https://ably.com/docs/errors/80000) (Connection Failed)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 90000
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90000-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 90000, used general Channel/Operation errors guidance)
- Existing Documentation: None found at initial check
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file lines 218-230 preserved as FAQ-style recommendations in Prevention section
- Content Excluded: Specification compliance issues (RTL4h violation discussion) excluded as too technical for customer docs
- Recommendations Source: 
  - Sequential operations: Knowledge file lines 336-340
  - Debouncing: Knowledge file lines 342-347
  - State checking: Knowledge file lines 322-326
  - Retry logic: Knowledge file lines 329-335
- Code Examples Rationale: Included minimal examples from knowledge file as they directly address resolution
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Race conditions: Analysis file lines 122-129
  - State validation: Analysis file lines 130-138  
  - Unknown errors: Analysis file lines 139-145
- Resolution Steps:
  - Step 1: Knowledge file lines 336-340 - FAQ recommendation for sequential operations
  - Step 2: Knowledge file lines 342-347 - FAQ recommendation for debouncing
  - Step 3: Analysis file lines 130-138 - State checking pattern from SDK implementations
  - Step 4: Knowledge file lines 329-335 - FAQ retry pattern recommendation
- Prevention: Knowledge file lines 227-230 - FAQ prevention recommendations
- SDK Variations: Analysis file lines 151-163 - Status code analysis across SDKs
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear specification of expected behavior for RTL4h compliance
- Impact: Confusion about whether immediate error or queuing is correct behavior
- Recommendation: Clarify specification and standardize SDK implementations
- Severity: Medium - causes inconsistent behavior across SDKs
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 90000
2. Regenerate: Run `./bin/ably-os errors document-error-codes 90000 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->