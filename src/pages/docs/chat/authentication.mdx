---
title: Chat authentication
meta_description: "Configure authentication for Chat applications with the required capabilities."
---

Chat authentication is handled by the underlying Pub/Sub SDK. You authenticate an Ably Realtime client, then pass that authenticated client into `ChatClient`.

## Authentication flow

1. Your auth server authenticates the user.
2. Your auth server issues an Ably-compatible token (JWT format is recommended for most apps).
3. The client SDK fetches tokens with `authCallback` and refreshes them automatically before expiry.
4. The authenticated Pub/Sub client is passed into `ChatClient`.


## Chat capabilities

Capabilities are permissions that control what operations a client can perform. When you create a token for a Chat user, you specify which capabilities they have. Each Chat feature requires specific capabilities:

| Feature | Required Capabilities |
|---------|----------------------|
| Send messages | `publish` |
| Receive messages | `subscribe` |
| Update messages | `message-update-any` or `message-update-own` |
| Delete messages | `message-delete-any` or `message-delete-own` |
| Message history | `subscribe`, `history` |
| Message reactions | `annotation-publish`, optionally `annotation-subscribe` |
| Presence | `subscribe`, `presence` |
| Typing indicators | `publish`, `subscribe` |
| Room reactions | `publish`, `subscribe` |
| Occupancy | `subscribe`, `channel-metadata` |
| **All Chat features** | `publish`, `subscribe`, `presence`, `history`, `channel-metadata`, `annotation-publish`, `annotation-subscribe`, `message-update-own`, `message-delete-own` |

## Room-scoped capabilities

Capability resource specifiers for Chat rooms use the `::$chat` suffix. For example, a room called `support` maps to `support::$chat` in capability expressions.

<Code>
```javascript
// Server-side JWT with room-scoped capabilities
import jwt from 'jsonwebtoken';

const [keyName, keySecret] = process.env.ABLY_API_KEY.split(':');

const ablyJwt = jwt.sign(
  {
    'x-ably-capability': JSON.stringify({
      // Only allow access to a specific room
      'your-room::$chat': ['publish', 'subscribe', 'presence', 'history'],
    }),
    'x-ably-clientId': userId,
  },
  keySecret,
  { algorithm: 'HS256', keyid: keyName, expiresIn: '1h' }
);
```

```python
# Server-side JWT with room-scoped capabilities
import jwt
import json
import time
import os

key_name, key_secret = os.environ['ABLY_API_KEY'].split(':')

now = int(time.time())
ably_jwt = jwt.encode(
    {
        'iat': now,
        'exp': now + 3600,
        'x-ably-capability': json.dumps({
            # Only allow access to a specific room
            'your-room::$chat': ['publish', 'subscribe', 'presence', 'history'],
        }),
        'x-ably-clientId': user_id,
    },
    key_secret,
    algorithm='HS256',
    headers={'kid': key_name}
)
```
</Code>

## Client examples

### JavaScript

<Code>
```javascript
import * as Ably from 'ably';
import { ChatClient } from '@ably/chat';

const realtimeClient = new Ably.Realtime({
  authCallback: async (tokenParams, callback) => {
    try {
      const response = await fetch('/api/ably-token', { credentials: 'include' });
      if (!response.ok) throw new Error('Auth failed');
      const jwt = await response.text();
      callback(null, jwt);
    } catch (error) {
      callback(error, null);
    }
  },
});

const chatClient = new ChatClient(realtimeClient);
```
</Code>

### React

<Code>
```react
import { useMemo } from 'react';
import * as Ably from 'ably';
import { ChatClient } from '@ably/chat';
import { ChatClientProvider } from '@ably/chat/react';

export function App() {
  const realtimeClient = useMemo(
    () =>
      new Ably.Realtime({
        authCallback: async (tokenParams, callback) => {
          try {
            const response = await fetch('/api/ably-token', { credentials: 'include' });
            if (!response.ok) throw new Error('Auth failed');
            callback(null, await response.text());
          } catch (error) {
            callback(error, null);
          }
        },
      }),
    []
  );

  const chatClient = useMemo(() => new ChatClient(realtimeClient), [realtimeClient]);

  return (
    <ChatClientProvider client={chatClient}>
      <YourChatUI />
    </ChatClientProvider>
  );
}
```
</Code>

### Swift

<Code>
```swift
import Ably
import AblyChat

let realtimeOptions = ARTClientOptions()
realtimeOptions.authCallback = { tokenParams, callback in
    fetchAblyJwt { result in
        switch result {
        case .success(let jwt):
            callback(jwt as ARTTokenDetailsCompatible, nil)
        case .failure(let error):
            callback(nil, error)
        }
    }
}

let realtime = ARTRealtime(options: realtimeOptions)
let chatClient = ChatClient(realtime: realtime)
```
</Code>

### Kotlin

<Code>
```kotlin
import com.ably.chat.ChatClient
import io.ably.lib.realtime.AblyRealtime
import io.ably.lib.rest.Auth
import io.ably.lib.types.ClientOptions

val realtimeClient = AblyRealtime(
    ClientOptions().apply {
        authCallback = Auth.TokenCallback { _ ->
            // Return JWT string from your auth server
            fetchAblyJwt()
        }
    }
)

val chatClient = ChatClient(realtimeClient)
```
</Code>

In each example, the authenticated Pub/Sub client is passed into `ChatClient` and Chat uses that connection for authentication and token renewal.

## Token lifecycle and permission updates

- With `authCallback` or `authUrl`, token refresh is automatic and handled by the SDK.
- To change a user's capabilities during an active session, issue a new token from your auth server and re-authenticate.
- To immediately remove access, revoke issued tokens.
- If your capability JSON is too large for JWT or must remain confidential, use native [Ably Tokens](/docs/auth/ably-tokens).

<Code>
```javascript
// Re-authenticate to pick up updated capabilities
await realtimeClient.auth.authorize();
```
</Code>
