<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40101 -->
<!-- Generated: 2025-08-21T08-59-27-982Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation focusing on API key format validation errors, token MAC verification failures, and clientId mismatches based on extensive code analysis and support insights -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40101: Invalid credentials

## What Happened

Your authentication credentials are invalid or incorrectly formatted, preventing access to Ably services.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40101 | 401 | Authentication | No - requires fixing credentials |

## Quick Fix

- Verify your API key is complete and correctly formatted: `[AppId].[keyId]:[keySecret]`
- Check for typos or missing characters in your API key
- Ensure clientId matches between token generation and client initialization

## Error Messages

You may see one of these messages:
- "Invalid credentials"
- "No key specified"
- "Invalid key specified"
- "Ably key was empty. Ably key must be in the following format [AppId].[keyId]:[keyValue]"
- "Request mac does not match"
- "Invalid clientId for credentials"
- "Unable to set different clientId from that given in options"
- "Unable to handle request no application id found in request"

## Common Causes

1. **Incorrect API key format** (70% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 16-30, 44-62 -->
   - Missing characters or typos in the API key
   - Key doesn't follow format: `[AppId].[keyId]:[keySecret]`
   - Empty or whitespace-only key string
   - Copy-paste errors with leading/trailing spaces

2. **Token MAC verification failures** (20% of cases)
   <!-- Source: FAQ content from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 18-35 -->
   - Altered token request JSON after signature generation
   - Incorrect key used for token generation
   - Token tampering or corruption during transmission

3. **ClientId mismatches** (10% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 63-67, knowledge from lines 37-42 -->
   - Different clientId between token and client constructor
   - Attempting to change clientId on existing connection
   - Empty or wildcard clientId when binding is required

## Resolution Steps

1. **Verify your API key format**
   <!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 21-23, 28-30 -->
   - Log into your [Ably dashboard](https://ably.com/dashboard)
   - Navigate to your app → "API Keys" tab
   - Copy the complete key including all three parts:
     - App ID (e.g., `xVLyHw`)
     - Key ID (e.g., `rPSJgQ`)
     - Key Secret (e.g., `U6RN3LJvZzV3DXJk`)
   - Full format: `xVLyHw.rPSJgQ:U6RN3LJvZzV3DXJk`

2. **Check your implementation**
   <!-- Source: Code patterns from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 69-91 -->
   - Remove any leading or trailing whitespace from the key
   - Ensure the key contains exactly one period (.) and one colon (:)
   - Verify environment variables are loading correctly if used

3. **For token authentication issues**
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 24-35, preserved for customer experience -->
   - Ensure the token request JSON hasn't been modified after MAC generation
   - Verify the same API key is used for both token generation and verification
   - Check that clientId in token matches clientId in client options
   - For JWT, confirm clientId is set in the x-ably-clientId header

4. **Debug authentication problems**
   <!-- Source: Support recommendations from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 43-49 -->
   - Enable debug logging in your SDK to see detailed authentication flow
   - Check for browser extensions or proxies that might strip Authorization headers
   - Test with a fresh API key to rule out key-specific issues

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the authentication configuration before the operation will succeed. The SDK will not attempt to recover from invalid credentials as this indicates a configuration issue rather than a transient problem.

## Code Examples

### Correct API Key Format
<!-- Code guidance based on analysis patterns from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 157-163 -->
```javascript
// ✅ Correct: Complete API key with all three parts
const ably = new Ably.Realtime('xVLyHw.rPSJgQ:U6RN3LJvZzV3DXJk');

// ❌ Wrong: Missing app ID
const ably = new Ably.Realtime('rPSJgQ:U6RN3LJvZzV3DXJk');

// ❌ Wrong: Missing key secret
const ably = new Ably.Realtime('xVLyHw.rPSJgQ');

// ❌ Wrong: Incomplete key with typo
const ably = new Ably.Realtime('xVLyHw.rPSJ:U6RN3LJvZzV3DXJk');
```

### ClientId Configuration
<!-- Code pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 63-67 -->
```javascript
// ✅ Correct: Consistent clientId
const tokenParams = { clientId: 'user123' };
const token = await ably.auth.requestToken(tokenParams);

const client = new Ably.Realtime({
  token: token,
  clientId: 'user123' // Must match token clientId
});

// ❌ Wrong: Mismatched clientId
const client = new Ably.Realtime({
  token: token,
  clientId: 'differentUser' // Will cause 40101 error
});
```

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [API key best practices](https://ably.com/docs/auth/basic)
- [Token authentication guide](https://ably.com/docs/auth/token)
- [Client ID explained](https://ably.com/docs/auth/identified-clients)
- Related errors: [40102 - Token expired](https://help.ably.io/error/40102), [40400 - Not found](https://help.ably.io/error/40400)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40101
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (lines 69-72 for 40101 - no specific notes)
- Error Code Documentation Writing Guide: https://github.com/ably/ably-os/blob/main/src/prompts/shared-resources/error-code-doc-writing-guide.md
- Ably Style Guide: https://github.com/ably/ably-os/blob/main/src/prompts/shared-resources/ably-style-guide.md
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Token MAC verification guidance from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 18-35
  - ClientId mismatch resolution from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 37-42
  - Debug logging recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 43-49
- Content Excluded: 
  - Internal Slack discussion URLs (not appropriate for customer documentation)
  - Specific customer names from support tickets
  - Technical implementation details about frontdoor/frontend routing
- Recommendations Source: 
  - Resolution steps based on code analysis patterns and FAQ content
  - No exponential backoff recommended per editorial notes
- Code Examples Rationale: 
  - Included API key format examples as this is the primary cause of the error (70% of cases)
  - Included clientId configuration as it's a common confusion point
  - Examples verified against SDK patterns in analysis file
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (API key format): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 16-30, 44-62
  - Cause 2 (Token MAC): From FAQ content in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-knowledge.md lines 18-35
  - Cause 3 (ClientId): Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40101-analysis.md lines 63-67
- Resolution Steps: 
  - Step 1: Based on API key format validation patterns from analysis file lines 21-30
  - Step 2: Implementation checking from code patterns lines 69-91
  - Step 3: FAQ advice from knowledge file lines 24-35 - preserved due to customer experience
  - Step 4: Support recommendations from knowledge file lines 43-49
- Code Examples:
  - API key format: Based on error patterns from analysis file lines 157-163
  - ClientId configuration: From analysis file lines 63-67
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear explanation of the three-part API key structure in main auth docs
- Impact: Users don't understand what "application ID" or "key ID" mean in error messages
- Recommendation: Add visual diagram of API key structure to authentication guide
- Severity: Medium - causes significant confusion for new developers
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40101
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40101 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->