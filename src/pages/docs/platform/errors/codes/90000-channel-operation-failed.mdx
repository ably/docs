<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 90000 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document comprehensive channel operation failures with emphasis on attach/detach race conditions based on extensive production data and customer reports. Focus on practical resolution steps validated by support team experience. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 90000: Channel operation failed

## What Happened?

A channel operation couldn't be completed due to conflicting requests, invalid state, or timing issues with attach/detach operations.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 90000 | 400/409/500 | Channel Operation | Yes - after resolving conflict |

## Quick Fix

- Ensure sequential channel operations (await attach before detach)
- Check channel state before operations
- Implement debouncing for rapid DOM manipulation scenarios
- Monitor connection state to ensure it's active

## Error Messages

You may see one of these messages:

- "Attach request superseded by a subsequent detach request"
- "Detach request superseded by a subsequent attach request"
- "Unable to attach; reason unknown; state = {state}"
- "Unable to detach; reason unknown; state = {state}"
- "Can't attach when not in an active state"
- "Can't detach when not in an active state"
- "Channel state is failed"
- "channel is being DETACHED"
- "Unable to satisfy channel request internal error"

## Common Causes

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md lines 122-150 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 73-97 -->
1. **Race conditions between attach/detach** (60% of cases)
   - Calling detach() while attach() is pending
   - Calling attach() while detach() is pending
   - Rapid DOM manipulation triggering multiple operations
   - Fast scrolling with dynamic elements (commonly reported by Front customers)
   
2. **Invalid channel or connection state** (30% of cases)
   - Attempting operations on failed channels
   - Operations when connection isn't active
   - Channel already in detaching state
   - Connection in suspended or failed state

3. **Channel request failures** (10% of cases)
   - Server unable to satisfy channel request
   - Connection issues during attachment
   - Internal server errors
   - Timeout during channel operations
   - Missing client ID for presence operations

## Resolution Steps

1. **For attach/detach conflicts**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 336-340 -->
   - Wait for current operation to complete:
   ```javascript
   // Ensure sequential operations
   await channel.detach();
   await channel.attach();
   ```
   - Never call conflicting operations simultaneously
   <!-- Source: Support engineer guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 90-92 -->

2. **For rapid DOM manipulation scenarios**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 342-347 and customer case lines 73-82 -->
   - Implement debouncing to reduce operation frequency:
   ```javascript
   const debouncedAttach = debounce(() => {
     channel.attach();
   }, 300);
   ```
   - This pattern is especially important for scrolling interfaces with dynamic elements

3. **For state-related errors**
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md lines 130-138 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 321-326 -->
   - Check channel state before operations:
   ```javascript
   if (channel.state === 'attached') {
     channel.publish('event', data);
   }
   ```
   - Monitor connection state to ensure it's active:
   ```javascript
   if (ably.connection.state === 'connected') {
     // Safe to perform channel operations
   }
   ```

4. **For persistent failures**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 329-335 -->
   - Implement retry with exponential backoff (only for this specific error):
   ```javascript
   channel.attach((err) => {
     if (err && err.code === 90000 && err.statusCode === 409) {
       setTimeout(() => channel.attach(), 1000);
     }
   });
   ```

5. **For production chat systems**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 44-67 -->
   - Monitor for "unable to satisfy channel request" messages
   - Check server logs for subscribe errors
   - Verify chat message channel configuration

## Automatic Handling

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md lines 122-127 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 90-92 -->
Ably SDKs do not automatically retry error 90000. This is an application-level error requiring:
- Proper sequencing of channel operations
- State validation before operations
- Manual retry logic with appropriate delays

**Important**: Based on production experience and support team reports, channels often remain functional despite this error appearing in logs. The error typically indicates a timing issue rather than a complete failure.

## Prevention

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 227-230 and production patterns from lines 188-193 -->
- **Sequential Operations**: Always await channel operations to complete
- **State Management**: Track channel state in your application
- **Debouncing**: Implement delays for high-frequency scenarios (300ms recommended)
- **Error Boundaries**: Handle errors gracefully without disrupting user experience
- **Connection Monitoring**: Check connection state before channel operations
- **Lifecycle Management**: Properly manage channel lifecycle in component mount/unmount

## SDK Implementation Variations

<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md lines 151-163 -->
Different Ably SDKs may return different HTTP status codes with error 90000:
- **JavaScript**: 409 for conflicts, 500 for unknown errors, 400 for generic failures
- **iOS/macOS**: Consistently uses 500
- **Python**: 409 for conflicts
- **Java**: 400 for state failures
- **Go**: No explicit status code
- **.NET**: Status code varies by context

## Known Issues

<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md lines 24-41 -->
**Specification Compliance (RTL4h)**: The current behavior in ably-js may not fully comply with specification RTL4h, which states that attach operations should wait for pending requests to complete rather than error immediately. This behavior is unique to ably-js and possibly ably-python. Engineering teams are aware of this inconsistency.

## Related Resources

- [Channel state documentation](https://ably.com/docs/realtime/channels)
- [Connection state management](https://ably.com/docs/realtime/connection)
- [Error handling best practices](https://ably.com/docs/best-practice#error-handling)
- [GitHub Issue #2056](https://github.com/ably/ably-js/issues/2056) - Community discussion on error handling

## Related Errors

• **[80000 - Connection Failed](https://help.ably.io/error/80000)**  
  Connection failures that can prevent channel operations from succeeding

• **[80002 - Connection Suspended](https://help.ably.io/error/80002)**  
  Connection suspended state prevents channel operations after extended disconnection

• **[91000 - Unable to Enter Presence](https://help.ably.io/error/91000)**  
  Channel presence operations that fail due to missing client ID or state issues

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 90000
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/90000-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Lines 31-113 for channel operation errors guidance)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/90000-channel-operation-failed.mdx (enhanced version)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - Knowledge file lines 218-230 preserved as FAQ-style recommendations in Prevention section
  - Knowledge file lines 336-347 preserved for resolution steps
  - Knowledge file lines 90-92 preserved regarding channel functionality despite error
- Content Excluded: 
  - Detailed specification compliance technical discussion (too complex for customer docs)
  - Internal Slack message URLs (not useful for customers)
  - Engineering team internal discussions
- Recommendations Source: 
  - Sequential operations: Knowledge file lines 336-340
  - Debouncing: Knowledge file lines 342-347 and customer case lines 73-82
  - State checking: Knowledge file lines 321-326
  - Retry logic: Knowledge file lines 329-335
  - Production patterns: Knowledge file lines 44-67
- Code Examples Rationale: 
  - Included minimal examples from knowledge file as they directly address resolution
  - Based on actual customer cases (Front, LSports) documented in knowledge file
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Race conditions: Analysis file lines 122-129 and Knowledge file lines 73-97
  - State validation: Analysis file lines 130-138  
  - Channel request failures: Knowledge file lines 44-67 (production logs)
- Resolution Steps:
  - Step 1: Knowledge file lines 336-340 - FAQ recommendation for sequential operations
  - Step 2: Knowledge file lines 342-347 - FAQ recommendation for debouncing, validated by Front customer case
  - Step 3: Analysis file lines 130-138 and Knowledge file lines 321-326 - State checking pattern
  - Step 4: Knowledge file lines 329-335 - FAQ retry pattern recommendation
  - Step 5: Knowledge file lines 44-67 - Production chat system patterns
- Prevention: Knowledge file lines 227-230 and 188-193 - FAQ prevention recommendations
- SDK Variations: Analysis file lines 151-163 - Status code analysis across SDKs
- Known Issues: Knowledge file lines 24-41 - RTL4h specification compliance discussion
-->

<!-- URL Validation Completed: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 4 | Corrected: 0 | Exempted internal: 2 -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Clear documentation for channel lifecycle at /docs/channels#lifecycle (returns CSS only)
- Missing: Connection state management documentation at /docs/realtime/connection (returns CSS only)
- Missing: Best practices page at /docs/best-practice#channel-lifecycle (404 error)
- Impact: Developers cannot find detailed guidance on proper channel lifecycle management
- Recommendation: Create comprehensive channel lifecycle and connection state documentation
- Severity: High - these are critical references for understanding error 90000
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 90000
2. Regenerate: Run `./bin/ably-os errors document-error-codes 90000 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->