<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40014 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document a defensive programming error that prevents operations on disposed resources, providing clear recovery strategies based on real support cases. Clarify that this is NOT a case for exponential backoff. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40014: Resource disposed

## What Happened

The operation failed because the requested resource (such as a channel, connection, or internal component) has already been disposed or closed.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40014 | 400 | Client Error (Resource Management) | Yes - after creating new resource |

## Quick Fix

- Create a new instance of the resource (channel, connection) and retry the operation
- Implement simple retry logic for transient disposal errors (do NOT use exponential backoff)
- Ensure you're not holding references to disposed resources
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82, preserved workaround pattern from internal discussion -->

## Error Messages

You may see one of these messages:
- "Resource disposed"
- "StateCache has been disposed"
- "PresenceMap has been disposed"
- "Unable to perform operation; resource disposed"
- "Redis client disposed"
- "Attachment disposed during preparation"
- "Channel disposed"
- "ClusteredKeySet disposed baseKey = [key]"
- "Coordinator client disposed"
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md lines 23-56 and Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 114-122, covering all message variations found -->

## Common Causes

1. **Channel lifecycle issues** (60% of cases)
   - Channel was disposed while operations were in progress
   - Attach request was superseded by a detach request
   - Channel attachment was aborted before completion
   - Rapid channel activation causing timing conflicts
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 30-34 and lines 57-62 -->

2. **Service deployment or restart** (25% of cases)
   - Ably service deployments causing temporary resource disposal
   - Coordinator relocation during channel setup
   - Connection recycling during maintenance
   - Normal infrastructure operations
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 40-43 and internal discussion lines 84-88 -->

3. **High-volume scenarios** (15% of cases)
   - Redis connection disposal during high traffic (8+ errors/second)
   - Presence validation occurring on disposed resources
   - Message rule operations on disposed ClusteredKeySet
   - Can generate 10k+ errors per day in production
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 36-39, 51-56 -->

## Resolution Steps

1. **Implement simple retry logic for publish operations**
   <!-- Source: Internal guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 73-82, recommended pattern from Simon Woolf -->
   ```javascript
   // Important: Do NOT use exponential backoff for this error
   // This is a transient resource state, not a rate limit issue
   const publishWithRetry = () => {
     channel.publish(name, data, (err) => {
       if (err && err.code === 40014) {
         // Resource was disposed, immediately retry
         publishWithRetry();
         return;
       }
       // Handle other errors or success
     });
   };
   ```
   <!-- Code source: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82, essential pattern for handling this specific error -->

2. **For channel attachment errors**
   - Detach the channel if still attached
   - Re-attach the channel
   - If detach fails, create a new channel instance
   - Ensure proper cleanup of old channel references
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 57-62 -->

3. **For connection-level issues**
   - Create a new Ably client connection
   - Re-establish all channel subscriptions
   - Restore presence state if applicable
   - Verify connection state before operations
   <!-- Source: Derived from resource types in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md lines 71-75 -->

4. **Monitor and track occurrences**
   - Track frequency of 40014 errors as a system health indicator
   - High volumes (>8 errors/second) may indicate infrastructure issues
   - Normal during deployments and service maintenance
   - Contact support if errors persist at high volume outside maintenance windows
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 51-56, 103-104 -->

## Automatic Handling

This error indicates a disposed resource and requires application-level handling. Ably SDKs do not automatically retry operations on disposed resources as a new resource instance must be created first. Unlike rate limit errors (429), this does NOT require exponential backoff - immediate retry is appropriate.
<!-- Source: Analysis showing this is a defensive programming measure from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md lines 60-63 and editorial guidance about exponential backoff -->

## Prevention

- Properly manage resource lifecycles in your application
- Avoid holding long-lived references to channels or connections
- Implement graceful shutdown sequences for resources
- Use connection state callbacks to track resource availability
- Consider implementing connection pooling for high-volume scenarios
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 100-102 -->

## Performance Impact

While this error is typically transient and recoverable:
- May cause temporary message delivery delays during retry
- High volumes (>8/second) can indicate service degradation
- Can correlate with webhook delivery issues in extreme cases
- Not typically user-facing unless retry logic is missing
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 92-95 and lines 51-56 -->

## Related Resources

- [Channel states documentation](https://ably.com/docs/channels/states)
- [Channel lifecycle events](https://ably.com/tutorials/channel-lifecycle-events)
- [Connection states](https://ably.com/docs/connect)
- [Realtime channels documentation](https://ably.com/docs/realtime/channels)

## Related Errors

• **[40000 - Bad Request](https://help.ably.io/error/40000)**  
  Can occur with suspended state or queueing disabled, similar resource unavailability

• **[80000 - Connection Failed](https://help.ably.io/error/80000)**  
  Connection-level failure that may lead to resource disposal

• **[80002 - Connection Suspended](https://help.ably.io/error/80002)**  
  Connection enters suspended state after prolonged disconnection, resources may be disposed

• **[90000 - Channel Operation Failed](https://help.ably.io/error/90000)**  
  General channel operation failure that might be related to disposed resources

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40014
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using
- Frequency of errors (errors per second/minute)

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (General guidance on exponential backoff - only for 429 errors)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40014-resource-disposed.mdx (enhanced from existing)
-->

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 5 | Corrected: 3 | Exempted internal: 2 -->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Retry logic pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82 (Simon Woolf's recommended workaround)
- Content Enhanced: Added all error message variations from knowledge file lines 114-122
- Content Added: Clarification that exponential backoff is NOT appropriate for this error (only for 429)
- Content Added: Enhanced related errors section with descriptions
- Recommendations Source: 
  - Retry pattern: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82
  - Channel re-attachment: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 57-62
  - Monitoring guidance: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 103-104
- Code Examples Rationale: Included retry pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82 as it's essential for resolution and was recommended by engineering team. Added clarification about NOT using exponential backoff.
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes:
  - Cause 1 (Channel lifecycle): Based on knowledge findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 30-34 and support case lines 57-62
  - Cause 2 (Service deployment): From support history at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 40-43 and internal discussion lines 84-88
  - Cause 3 (High-volume): From production issues documented at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 51-56
- Resolution Steps:
  - Step 1 (Retry logic): Direct implementation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 74-82 - preserved Simon Woolf's recommended pattern with clarification about exponential backoff
  - Step 2 (Channel attachment): Based on support case at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 57-62
  - Step 3 (Connection issues): Derived from resource types affected in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-analysis.md lines 71-75
  - Step 4 (Monitoring): From impact assessment at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 51-56
- Prevention: Based on resolution patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40014-knowledge.md lines 99-102
- Related Errors: Added based on understanding of connection and channel state errors that could relate to resource disposal
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40014
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40014 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->