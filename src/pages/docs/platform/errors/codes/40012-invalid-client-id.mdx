<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40012 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation with enhanced resolution steps, SDK-specific behaviors, and improved related errors section -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40012: Invalid client ID

## What Happened

Your request contains a client ID that doesn't meet Ably's validation requirements or conflicts with your authenticated identity.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40012 | 400 | Client Error (Authentication) | No - requires fixing client ID configuration |

## Quick Fix

- Remove the client ID from your message if it's already set via authentication
- Ensure your client ID is a non-empty string (not "" or null in messages)
- Don't use "*" as a client ID except in token parameters for wildcard capability
- For Laravel Echo users: Check compatibility with Pusher protocol adapter
- For presence operations: Always set a client ID before entering/leaving channels

## Error Messages

You may see one of these messages:
- "invalid client id" - Generic validation failure
- "clientId can't be an empty string" - Empty string provided as client ID
- "clientId must be either a string or null" - Invalid type provided
- "Can't use \"*\" as a clientId as that string is reserved" - Wildcard misuse
- "clientId provided in ClientOptions must match clientId in token" - Configuration mismatch
- "Incompatible clientId specified in message" - Message client ID conflicts with auth
- "clientId must be specified to enter or leave a presence channel" - Missing for presence
- "invalid clientId; must be base64 encoded if passed by header" - Encoding issue
- "Malformed message; no clientId in message or inferred from connection" - Server-side validation failure
- "Invalid client ID provided" - General validation failure
- "Wildcard client_id is reserved and cannot be used when publishing messages" - Python-specific wildcard error
- "Client ID provided doesn't match existing authenticated client ID" - Go SDK mismatch error
- "Invalid client ID in API key" - .NET parsing error

## Common Causes

1. **Empty string as client ID** (35% of cases)
   - Using "" instead of a proper string value
   - Not setting client ID when required for presence
   - Empty string in token requests
   - Validated across all SDKs and server
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 176-179 -->

2. **Client ID mismatch** (30% of cases)
   - Token client ID differs from configured client ID
   - Message client ID conflicts with authenticated client ID
   - Client options specify different client ID than token
   - Common during auth upgrades or token refresh
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 192-196 -->

3. **Wildcard "*" misuse** (20% of cases)
   - Using "*" as a regular client ID instead of in token parameters
   - Attempting to initialize REST client with wildcard client ID
   - Wildcard in request headers or URLs
   - PHP SDK specifically blocks REST initialization with wildcard
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 181-186 -->

4. **Missing client ID for presence** (10% of cases)
   - Attempting presence operations without authenticated client ID
   - Not setting client ID before enter/leave/update operations
   - Presence channel requirements not met
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 197-200 -->

5. **Invalid type or encoding** (5% of cases)
   - Client ID is not a string or null
   - Missing base64 encoding when passed via header
   - Non-string values in JWT tokens
   - Server-side validation failures
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 187-190 and lines 210-214 -->

## Resolution Steps

1. **For empty client ID errors**
   - Provide a non-empty string for your client ID
   - If client ID is optional in your context, use null instead of ""
   - Validate before sending to Ably
   ```javascript
   // ❌ Wrong: Empty string
   const ably = new Ably.Realtime({ clientId: '' });
   
   // ✅ Correct: Valid string or null
   const ably = new Ably.Realtime({ clientId: 'user-123' });
   // or
   const ably = new Ably.Realtime({ /* no clientId */ });
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 95-97 -->

2. **For client ID mismatch errors**
   - Ensure your token and client options use the same client ID
   - Let the token set the client ID rather than overriding in options
   ```javascript
   // ❌ Wrong: Mismatched client IDs
   const ably = new Ably.Realtime({
     key: 'your-api-key',
     clientId: 'user-123'  // This conflicts with token
   });
   
   // ✅ Correct: Let token set the client ID
   const ably = new Ably.Realtime({
     key: 'your-api-key'
     // Client ID will be set from token
   });
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 16-20 -->

3. **For wildcard client ID errors**
   - Use wildcard only in token parameters, not as regular client ID
   - Wildcard enables publishing on behalf of any client
   ```javascript
   // ❌ Wrong: Using wildcard as regular client ID
   const ably = new Ably.Rest({ clientId: '*' });
   
   // ✅ Correct: Using wildcard in token parameters
   const tokenRequest = await ably.auth.createTokenRequest({
     clientId: '*',  // Allows publishing on behalf of any client
     capability: { '*': ['publish', 'subscribe'] }
   });
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 99-101 -->

4. **For presence operations**
   - Always set client ID before presence operations
   - Configure via authentication or client options
   ```javascript
   // ❌ Wrong: No client ID for presence
   const ably = new Ably.Realtime({ key: 'your-api-key' });
   channel.presence.enter();  // Will fail with 40012
   
   // ✅ Correct: Client ID configured
   const ably = new Ably.Realtime({ 
     key: 'your-api-key',
     clientId: 'user-123'
   });
   channel.presence.enter();  // Will succeed
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 37-49 -->

5. **For publishing messages**
   - Don't set client ID in messages when already authenticated
   - Client ID is automatically populated from authentication
   ```javascript
   // ❌ Wrong: Manually setting client ID in message
   channel.publish({
     name: 'message',
     data: 'Hello',
     clientId: 'user-123'  // Remove this!
   });
   
   // ✅ Correct: Let Ably set it automatically
   channel.publish({
     name: 'message',
     data: 'Hello'
     // Client ID is set automatically from authentication
   });
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 103-107 -->

6. **For header encoding issues**
   - Base64 encode when using X-Ably-Clientid header
   - Alternatively, use query parameter (no encoding needed)
   ```bash
   # ❌ Wrong: Plain text in header
   curl -H "X-Ably-Clientid: user-123" ...
   
   # ✅ Correct: Base64 encoded
   curl -H "X-Ably-Clientid: dXNlci0xMjM=" ...
   
   # ✅ Or use query parameter
   curl "https://rest.ably.io/channels/test?clientId=user-123" ...
   ```
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 117-119 -->

7. **For Laravel Echo with Pusher Protocol**
   - Known compatibility issue with presence channels
   - Consider using native Ably SDK instead of Pusher adapter
   - Ensure client ID format matches Pusher expectations
   - Test presence functionality thoroughly
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 72-74 -->

8. **For type validation errors**
   - Ensure client ID is string or null (not undefined, number, or object)
   - Validate types before SDK operations
   ```javascript
   // ❌ Wrong: Invalid types
   clientId: undefined  // Not allowed
   clientId: 123       // Must be string
   clientId: {}        // Must be string
   
   // ✅ Correct: Valid types
   clientId: 'user-123'  // String
   clientId: null        // Null is allowed
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 26-29 -->

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the client ID configuration issue before the operation will succeed. The SDK will not attempt to recover from this error as it indicates a configuration problem that requires manual intervention.

## Prevention

- **Client-side**: Never set clientId explicitly in messages when already authenticated
- **Server-side**: Use wildcard clientId capability for multi-user publishing
- **Tokens**: Include clientId in token generation for user-specific connections
- **Presence**: Always configure clientId before attempting presence operations
- **Validation**: Ensure clientId is either a non-empty string or null (not undefined or other types)
- **Laravel Echo**: Test presence channels thoroughly when using Pusher protocol adapter
- **Headers**: Always base64 encode clientId when using X-Ably-Clientid header

## SDK-Specific Behaviors

Different Ably SDKs have slightly different validation and error messages:

- **JavaScript (ably-js)**: Most comprehensive validation with specific messages for each scenario
  - Validates type, empty string, wildcard, and presence requirements
  - Clear error messages for debugging
- **Java (ably-java)**: Uses "Incompatible clientId" terminology
  - Focus on message/auth compatibility
- **Python (ably-python)**: Includes actual values in error messages
  - Shows both attempted and configured client IDs for debugging
- **Ruby (ably-ruby)**: Defines custom IncompatibleClientId exception
  - Connection manager validates client ID during connection
- **PHP (ably-php)**: Specifically blocks wildcard in REST context
  - Prevents REST client initialization with "*" client ID
- **.NET (ably-dotnet)**: Reports "Invalid client ID in API key"
  - Additional validation during API key parsing
- **Go (ably-go)**: Provides detailed mismatch information
  - Shows both existing and requested client IDs
- **Rust (ably-rust)**: Combined validation for wildcard and empty string
  - Single error for both conditions

## Performance Impact

This error prevents the operation but doesn't affect:
- Existing connections (unless during connection establishment)
- Other channels or presence sets
- Message delivery for properly authenticated clients
- Overall system performance

## Related Errors

• **[40102 - Token expired](https://help.ably.io/error/40102)**  
  Authentication token has expired and needs renewal - may occur alongside 40012 if new token has different client ID

• **[40103 - Invalid use of basic auth over non-TLS](https://help.ably.io/error/40103)**  
  Related authentication error when using basic auth incorrectly

• **[40140-40149 - Token error range](https://help.ably.io/error/40140)**  
  Various token-related errors that may involve client ID validation

• **[91000 - Unable to enter presence](https://help.ably.io/error/91000)**  
  Specific presence error that often relates to missing or invalid client ID

## Related Resources

- [Authentication documentation](https://ably.com/docs/auth)
- [Identified clients documentation](https://ably.com/docs/auth/identified-clients)
- [Presence documentation](https://ably.com/docs/realtime/presence)
- [Token authentication](https://ably.com/docs/auth/token)
- [Laravel Echo integration](https://ably.com/docs/general/laravel-echo)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40012
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using
- If using Laravel Echo, your configuration details

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40012-invalid-client-id.mdx (enhanced from existing)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: FAQ URL mentioned at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 59-61
- Laravel Echo Issue Added: Based on customer impact from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 72-74
- SDK-Specific Behaviors Enhanced: Detailed breakdown based on analysis findings showing implementation variations across all SDKs
- Content Excluded: Specific GitHub issue numbers and internal Slack discussions (not relevant for customer-facing docs)
- Recommendations Source: Based on actual SDK implementations and error patterns from analysis file
- Code Examples Rationale: Included minimal examples showing correct vs incorrect patterns based on SDK analysis
- Related Errors Enhanced: Added descriptions explaining relationships between errors
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Empty string): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 176-179
  - Cause 2 (Client ID mismatch): From SDK code at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 192-196
  - Cause 3 (Wildcard misuse): From analysis at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 181-186
  - Cause 4 (Missing for presence): From SDK patterns at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 197-200
  - Cause 5 (Type/encoding): From server validation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 187-190 and 210-214
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 95-97
  - Step 2: Based on ably-js SDK at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 16-20
  - Step 3: From knowledge base at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 99-101
  - Step 4: From presence implementation at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 37-49
  - Step 5: Resolution pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 103-107
  - Step 6: Server-side requirement from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 117-119
  - Step 7: Laravel Echo issue from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-knowledge.md lines 72-74
  - Step 8: Type validation from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 26-29
- SDK-Specific Behaviors: Based on implementation variations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40012-analysis.md lines 203-211
- Prevention: Based on https://ably.com/docs/auth/identified-clients and SDK best practices
-->

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 6 | Corrected: 0 | Exempted internal: 2 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40012
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40012 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->