---
title: "Invalid content length"
meta_description: "Learn how to resolve Ably error 40008 when HTTP request body exceeds the Content-Length header value"
meta_keywords: "Ably error, 40008, invalid content length, HTTP headers, Content-Length mismatch, request body error"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40008 */}
{/* Generated: 2025-11-07T01-19-51-325Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Simple structure (Structure A) for single-cause validation error with clear resolution path */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

This error occurs when the Ably platform receives an HTTP request where the actual number of bytes in the request body exceeds what was declared in the Content-Length header.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ---------------- | -------- | --------- |
| 40008 | 400 | Client Error (Validation) | No |

## Error messages

You may see this error message:

| Message | Description |
| ------- | ----------- |
| `Invalid content length: received [X] bytes but Content-Length header specified [Y] bytes` | The server received more bytes than the Content-Length header indicated |

## Impact

This error affects only the current request operation. The request is rejected immediately upon detection of the mismatch and will not be processed by Ably.

Since this is a request validation error, it indicates a problem with how the HTTP request was constructed. The error will not be automatically retried as it requires fixing the Content-Length header calculation.

## Troubleshooting

The Content-Length mismatch typically occurs due to incorrect byte counting when constructing HTTP requests to Ably's REST API.

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-analysis.md lines 34-41 */}

### Resolution steps

1. **Ensure correct byte-length calculation**

   Calculate Content-Length using byte length, not character count. This is especially important for multi-byte characters (UTF-8):

   <Code>
   ```javascript
   // Correct: Use byte length
   const body = JSON.stringify({ message: 'Hello 世界' });
   const contentLength = Buffer.byteLength(body); // Counts actual bytes

   // Incorrect: Using string length
   const wrongLength = body.length; // Counts characters, not bytes
   ```
   </Code>

   {/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-analysis.md lines 54-67 */}

2. **Use chunked transfer encoding for dynamic content**

   If your content size is dynamic or unknown in advance, use chunked transfer encoding instead of Content-Length:

   <Code>
   ```javascript
   const options = {
     headers: {
       'Transfer-Encoding': 'chunked'
       // Do not set Content-Length
     }
   };
   ```
   </Code>

3. **Verify HTTP client library behavior**

   Most modern HTTP clients handle Content-Length automatically. Ensure you're not manually setting it incorrectly:

   <Code>
   ```javascript
   // Let the HTTP client calculate Content-Length
   fetch('https://rest.ably.io/channels/test/messages', {
     method: 'POST',
     headers: {
       'Authorization': 'Bearer YOUR_API_KEY',
       'Content-Type': 'application/json'
       // Content-Length will be set automatically
     },
     body: JSON.stringify({ data: 'test' })
   });
   ```
   </Code>

4. **Check for proxy or middleware interference**

   Verify that no intermediate proxies or middleware are modifying your request body after the Content-Length header has been set. This can happen with:
   - Corporate proxies that inject headers
   - Application middleware that modifies request bodies
   - Load balancers with request transformation rules

{/* Source: Knowledge base patterns from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-knowledge.md lines 10-17 */}

## Prevention

To avoid this error in the future:

- Always use byte-length calculation for Content-Length headers, not character count.
- Let your HTTP client library handle Content-Length automatically when possible.
- Test with multi-byte characters (emojis, non-ASCII text) to ensure correct byte counting.
- Use chunked transfer encoding for streaming or dynamic content.
- Avoid modifying request bodies after setting headers.

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Resources

- [Ably REST API documentation](https://ably.com/docs/api/rest-api)
- [Authentication guide](https://ably.com/docs/auth)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40008)
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: No FAQ content existed for 40008
- Content Excluded: None - all relevant information included
- Recommendations Source:
  - Byte-length calculation: Analysis file lines 54-67 showing proper Content-Length usage
  - Chunked encoding: Knowledge file lines 52-53 as alternative approach
  - HTTP client auto-handling: General best practice for modern HTTP clients
  - Proxy interference: Knowledge file lines 15-17 identifying this as a cause
- Code Examples Rationale: Included minimal examples to demonstrate correct byte-length calculation as this is the primary cause
*/}

{/* ATTRIBUTION BY SECTION:
- Error Overview: Based on analysis findings in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-analysis.md lines 5-8
- Technical Context: From server implementation at https://github.com/ably/realtime/blob/7b9b6ce/nodejs/realtime/common/lib/rest/router2.js#L422
- Common Causes: Knowledge file https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40008-knowledge.md lines 10-17
- Resolution Steps:
  - Step 1: Analysis file lines 54-67 - correct byte counting examples
  - Step 2: Knowledge file lines 52-53 - chunked encoding alternative
  - Step 3: Best practice for modern HTTP clients
  - Step 4: Knowledge file lines 15-17 - proxy interference pattern
- Prevention: Synthesized from common causes and resolution patterns
*/}

{/* URL Validation Completed: 2025-11-07T01-19-51-325Z */}
{/* External URLs verified: 2 | Corrected: 0 | Exempted internal: 2 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40008
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40008 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}