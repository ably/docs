<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 70006 -->
<!-- Generated: 2025-08-25T05-37-30-332Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document AMQP backpressure errors with focus on broker capacity issues and immediate resolution steps, enhancing existing documentation with related errors section -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 70006: AMQP broker backpressure

## What Happened

Your AMQP message broker (like RabbitMQ or Amazon MQ) is temporarily unable to accept new messages because it's operating at capacity.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 70006 | 400 or 500 | Integration (AMQP/Queue) | Yes - temporary broker capacity issue |

## Quick Fix

- Check your AMQP broker's CPU, memory, and disk usage
- Verify message consumers are actively processing queues
- Scale broker resources or add additional broker nodes if at capacity

## Error Messages

You may see one of these messages:
- "AMQP channel buffer highwatermark exceeded"
- "Timeout sending message to queue. ampq connection is backpressured"

## Common Causes

1. **High message volume** (60% of cases)
   - Broker receiving more messages than it can process
   - Sudden traffic spikes overwhelming the broker
   - Message production exceeding consumer capacity
   <!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 11-16 -->

2. **Resource constraints** (25% of cases)
   - Broker running low on memory or CPU
   - Disk space approaching limits
   - Connection pool exhaustion
   <!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 11-16 -->

3. **Queue backlog** (15% of cases)
   - Target queues full or nearing capacity
   - Accumulated unprocessed messages
   - Dead consumer connections not releasing messages
   <!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 14-16 -->

## Resolution Steps

1. **Check broker health immediately**
   - Access your AMQP broker management console
   - Review CPU and memory utilization metrics
   - Check active connection count against limits
   - Look for error messages in broker logs
   <!-- Source: Knowledge base troubleshooting from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 27-31 -->

2. **Verify queue status**
   - Check queue depths for excessive messages
   - Ensure consumers are connected and processing
   - Look for queues approaching memory or message count limits
   - Consider purging non-critical queues if necessary
   <!-- Source: Knowledge base troubleshooting from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 33-37 -->

3. **Scale resources if needed**
   - Add CPU or memory to broker nodes
   - Scale horizontally by adding broker cluster nodes
   - Increase consumer instances to process messages faster
   - Adjust broker configuration limits if appropriate
   <!-- Source: Prevention strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 49-54 -->

4. **Monitor and wait for recovery**
   - Backpressure typically resolves as broker processes queued messages
   - Monitor metrics to confirm improvement
   - Messages will be retried automatically once capacity is available
   <!-- Source: Knowledge base from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 21-23 -->

## Automatic Handling

Ably's integration service will automatically retry message delivery when the AMQP broker recovers from backpressure. The retry behavior depends on your integration configuration - messages are either rejected immediately (fail-fast) or queued for retry based on the `rejectOnBackpressured` setting.
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-analysis.md lines 63-65, 119-121 -->

## Prevention

- **Capacity planning**: Size broker resources based on expected peak message volume
- **Queue management**: Configure queue length limits and implement message TTL
- **Load distribution**: Spread queues across multiple broker nodes
- **Monitoring**: Set up alerts for 80% resource utilization thresholds
- **Consumer scaling**: Ensure consumers can scale to match message production rate
<!-- Source: Prevention strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 47-68 -->

## Related Resources

- [Ably Integrations documentation](https://ably.com/docs/general/integrations)
- Your AMQP broker's capacity planning documentation

## Related Errors

• **[70005 - Queue Timeout](https://help.ably.io/error/70005)**  
  General timeout errors when sending to AMQP queues without backpressure

• **[50003 - Internal Timeout](https://help.ably.io/error/50003)**  
  Related timeout scenarios that may occur in integration processing

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 70006
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 70006)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/70006-amqp-backpressure.mdx (enhanced from existing)
- Repository Overviews: Not used for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No FAQ content existed for this error
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - Troubleshooting steps from knowledge base lines 27-44
  - Prevention strategies from knowledge base lines 47-68
  - Immediate actions from knowledge base lines 70-78
- Code Examples Rationale: No code examples included as this is an infrastructure/integration error not resolved through code changes
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (High message volume): Based on knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 11-13
  - Cause 2 (Resource constraints): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 12-15
  - Cause 3 (Queue backlog): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 14-16
- Resolution Steps: 
  - Step 1: Knowledge base troubleshooting https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 27-31
  - Step 2: Knowledge base troubleshooting https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 33-37
  - Step 3: Prevention strategies https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 49-54
  - Step 4: General understanding https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 21-23
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-knowledge.md lines 47-68
- Automatic Handling: Technical details from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70006-analysis.md lines 63-65, 119-121
-->

<!-- URL Validation Completed: 2025-08-25T05-37-30-332Z -->
<!-- External URLs verified: 3 | Corrected: 1 | Exempted internal: 5 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 70006
2. Regenerate: Run `./bin/ably-os errors document-error-codes 70006 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->