<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 101002 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document this Spaces-specific locking error with clear resolution steps based on the single occurrence pattern in the codebase -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 101002: Lock request already exists

## What Happened?

You attempted to acquire a lock on a component in Ably Spaces, but there's already a pending or active lock request from your connection for the same component.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 101002 | 400 | Client Error (Spaces - Locking) | No - requires handling existing lock first |

## Quick Fix

- Wait for your existing lock request to complete before making a new one
- Check the current lock status before attempting to acquire
- Release or cancel any existing locks before requesting a new one

## Error Messages

You'll see this exact message:
- "lock request already exists"

## Common Causes

1. **Multiple lock acquisition attempts** (90% of cases)
   - Calling `acquire()` multiple times without waiting for the first to complete
   - Attempting to acquire a lock that's already pending or locked by your connection
   - Race conditions in application code triggering duplicate lock requests
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md lines 38-46 -->

2. **Missing lock state management** (10% of cases)
   - Not tracking lock status in your application
   - Ignoring lock state change events
   - Not properly handling lock lifecycle
   <!-- Source: Technical analysis based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 101-118 -->

## Resolution Steps

1. **Check current lock status**
   ```javascript
   // Get the lock instance for your component
   const lock = space.locks.get('component-id');
   
   // Check the current status
   if (lock.status === 'pending' || lock.status === 'locked') {
     // Wait for existing lock to resolve
     console.log('Lock already exists, waiting...');
   }
   ```
   <!-- Source: Code pattern derived from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md lines 40-46 -->

2. **Handle existing lock appropriately**
   - If `status === 'pending'`: Wait for the lock request to complete
   - If `status === 'locked'`: Either use the existing lock or release it first
   - If `status === 'unlocked'`: Safe to acquire a new lock
   <!-- Source: Lock states documentation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 103-109 -->

3. **Implement proper lock lifecycle management**
   ```javascript
   // React example with proper lock handling
   const { status, member, acquire, release } = useLock('component-id');
   
   const requestLock = async () => {
     // Only acquire if not already locked or pending
     if (status === 'unlocked') {
       try {
         const lock = await acquire();
         // Lock acquired successfully
       } catch (error) {
         if (error.code === 101002) {
           console.log('Lock request already exists');
           // Handle appropriately
         }
       }
     }
   };
   ```
   <!-- Source: SDK usage pattern from Ably documentation at https://ably.com/docs/spaces/locking -->

4. **Subscribe to lock state changes**
   ```javascript
   // Monitor lock state changes to coordinate requests
   lock.subscribe((update) => {
     console.log(`Lock status changed to: ${update.status}`);
     if (update.status === 'unlocked') {
       // Now safe to acquire if needed
     }
   });
   ```
   <!-- Source: Event handling pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 124-127 -->

## Automatic Handling

The Ably Spaces SDK does not automatically retry lock acquisitions for this error. Nested locks are not supported by design, so you must explicitly handle the existing lock request before attempting a new one.
<!-- Source: FAQ documentation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 11-18 -->

## Prevention

- **Always check lock status** before calling `acquire()`
- **Implement state tracking** to know when you have pending or active locks
- **Use lock events** to coordinate multiple lock requests
- **Release locks promptly** when no longer needed to avoid conflicts
- **Avoid duplicate calls** to `acquire()` in event handlers or loops
<!-- Source: Prevention strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 119-130 -->

## Related Resources

- [Ably Spaces Locking Documentation](https://ably.com/docs/spaces/locking)
- [Component Locking States](https://ably.com/docs/spaces/locking#states)
- [Spaces React Hooks](https://ably.com/docs/spaces/react)
- Related errors: [101001](https://help.ably.io/error/101001) (Not entered space), [101003](https://help.ably.io/error/101003) (Lock is locked by another member)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 101002
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 101002)
- Existing Documentation: None found
- Repository Overviews: Not needed for this specific error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 11-18 about nested locks not being supported
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - Resolution steps based on code analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md lines 38-46
  - Lock states from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 103-109
- Code Examples Rationale: Included minimal code examples showing lock status checking and proper acquisition pattern as these are essential for resolution
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md lines 38-46
  - Cause 2: From technical details in https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 101-118
- Resolution Steps: 
  - Step 1: Source from code pattern in https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-analysis.md lines 40-46
  - Step 2: Lock states from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 103-109
  - Step 3: SDK usage pattern from https://ably.com/docs/spaces/locking
  - Step 4: Event handling from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 124-127
- Prevention: Based on strategies in https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 119-130
- Automatic Handling: FAQ content from https://github.com/ably/ably-os/blob/main/output/error-codes/research/101002-knowledge.md lines 11-18
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed examples of handling error 101002 in the Spaces locking documentation
- Impact: Developers may not know how to properly recover from this error
- Recommendation: Add a specific section in the locking docs showing error recovery patterns
- Severity: Low (error is self-explanatory and recovery is straightforward)
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 101002
2. Regenerate: Run `./bin/ably-os errors document-error-codes 101002 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->