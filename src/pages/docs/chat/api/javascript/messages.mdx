---
title: Messages
meta_description: ""
---

The `Messages` interface is used to send and subscribe to messages in a chat room.

Access it via `room.messages`.

---

## Properties

| Property | Description | Type |
| -------- | ----------- | ---- |
| reactions | Add, delete, and subscribe to message reactions. | [`MessageReactions`](/docs/chat/api/javascript/messages-reactions) |

---

## Send a message <a id="send"/>

`room.messages.send()`

Send a message in the chat room.

This method uses the Ably Chat API endpoint for sending messages.

Note that the Promise may resolve before OR after the message is received from the realtime channel. This means you may see the message that was just sent in a callback to `subscribe()` before the returned promise resolves.

`send(params: SendMessageParams): Promise<Message>`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `params` | An object containing the text, headers and metadata for the message. | [`SendMessageParams`](#sendmessageparams) |

#### SendMessageParams

The following `SendMessageParams` can be set:

| Parameters | Description | Type |
| ---------- | ----------- | ---- |
| `text` | The text content of the message. | String |
| `metadata` | *Optional* Metadata to attach to the message. Allows for attaching extra info to a message, which can be used for various features such as animations, effects, or simply to link it to other resources such as images, relative points in time, etc. This value is always set on received messages. If there is no metadata, this is an empty object. Do not use metadata for authoritative information. There is no server-side validation. When reading the metadata, treat it like user input. | [`MessageMetadata`](#messagemetadata) |
| `headers` | *Optional* Headers to attach to the message. Headers enable attaching extra info to a message, which can be used for various features such as linking to a relative point in time of a livestream video or flagging this message as important or pinned. This value is always set on received messages. If there are no headers, this is an empty object. Do not use the headers for authoritative information. There is no server-side validation. When reading the headers, treat them like user input. | [`MessageHeaders`](#messageheaders) |

#### MessageMetadata <a id="messagemetadata"/>

Metadata enables attaching extra info to a message. Uses include animations, effects, or simply to link it to other resources such as images or relative points in time.

`MessageMetadata: Record<string, unknown>`

#### MessageHeaders <a id="messageheaders"/>

Headers enable attaching extra info to a message. Uses include linking to a relative point in time of a livestream video or flagging this message as important or pinned.

`MessageHeaders: Record<string, number | string | boolean | null | undefined>`

### Returns

Returns a promise. On success, the promise is fulfilled with the [`Message`](/docs/chat/api/javascript/message) object that was sent. On failure, the promise is rejected with an [`ErrorInfo`](/docs/chat/api/javascript/error-info).

<Code>
```javascript
const message = await room.messages.send({
  text: 'Hello, world!',
  metadata: { priority: 'high' },
  headers: { timestamp: Date.now() }
});
```
</Code>

---

## Update a message <a id="update"/>

`room.messages.update()`

Update a message in the chat room.

Note that the Promise may resolve before or after the updated message is received from the room. This means you may see the update that was just sent in a callback to `subscribe()` before the returned promise resolves.

The [`Message`](/docs/chat/api/javascript/message) instance returned by this method is the state of the message as a result of the update operation. If you have a subscription to message events via `subscribe()`, you should discard the message instance returned by this method and use the event payloads from the subscription instead.

This method uses PUT-like semantics: if headers and metadata are omitted from the [`updateParams`](#updateparams), then the existing headers and metadata are replaced with the empty objects.

`update(serial: Serial, updateParams: UpdateMessageParams, details?: OperationDetails): Promise<Message>`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `serial` | A string or object that conveys the serial of the message to update. | [`Serial`](#serial) |
| `updateParams` | The parameters for updating the message. | [`UpdateMessageParams`](#updatemessageparams) |
| `details` | *Optional* Optional details to record about the update action. | [`OperationDetails`](#operationdetails) |

#### Serial

A serial is used to identify a particular message, reaction or other chat event. It is the identifier for that event in the chat history.

Serials can be conveyed either as a string, or an object that contains serial as a property. Message is included for type hinting and LLM purposes.

The string-form of the serial should not be parsed or interpreted in any way, as it is subject to change without warning.

`Serial: Message | string | { serial: string }`

#### UpdateMessageParams

The following `UpdateMessageParams` can be set:

| Parameters | Description | Type |
| ---------- | ----------- | ---- |
| `text` | The new text content for the message. | String |
| `metadata` | *Optional* Metadata to attach to the message. This will replace the existing metadata on the message. Do not use metadata for authoritative information. There is no server-side validation. When reading the metadata, treat it like user input. | [`MessageMetadata`](#messagemetadata) |
| `headers` | *Optional* Headers to attach to the message. This will replace the existing headers on the message. Do not use the headers for authoritative information. There is no server-side validation. When reading the headers, treat them like user input. | [`MessageHeaders`](#messageheaders) |

#### OperationDetails

Details to record about an operation (update or delete).

| Parameters | Description | Type |
| ---------- | ----------- | ---- |
| `description` | *Optional* A description of the operation. | String |
| `metadata` | *Optional* Metadata associated with the operation. Do not use metadata for authoritative information. There is no server-side validation. When reading the metadata, treat it like user input. | [`OperationMetadata`](#operationmetadata) |

#### MessageOperationMetadata

The metadata contained in the `operations` field of a message. It represents the metadata supplied to a message update or deletion request.

Do not use metadata for authoritative information. There is no server-side validation. When reading the metadata, treat it like user input.

`OperationMetadata: Record<string, unknown>`

### Returns

Returns a promise. On success, the promise is fulfilled with the updated [`Message`](/docs/chat/api/javascript/message) object. On failure, the promise is rejected with an [`ErrorInfo`](/docs/chat/api/javascript/error-info).

<Code>
```javascript
const updatedMessage = await room.messages.update(
  message.serial,
  {
    text: 'Updated message text',
    metadata: { edited: true, editedAt: Date.now() }
  },
  {
    description: 'Fixed typo'
  }
);
```
</Code>

---

## Delete a message <a id="delete"/>

`room.messages.delete()`

Delete a message in the chat room.

This method performs a 'soft' delete, meaning the message is marked as deleted.

Note that the Promise may resolve before or after the message is deleted from the realtime channel. This means you may see the message that was just deleted in a callback to `subscribe` before the returned promise resolves.

The [`Message`](/docs/chat/api/javascript/message) instance returned by this method is the state of the message as a result of the delete operation. If you have a subscription to message events via `subscribe()`, you should discard the message instance returned by this method and use the event payloads from the subscription instead.

Should you wish to restore a deleted message, and providing you have the appropriate permissions, you can simply send an update to the original message.

`delete(serial: Serial, deleteMessageParams?: DeleteMessageParams): Promise<Message>`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `serial` | A string or object that conveys the serial of the message to delete. | [`Serial`](#serial) |
| `deleteMessageParams` | *Optional* Optional details to record about the delete action. | [`DeleteMessageParams`](#deletemessageparams) |

#### DeleteMessageParams

The following `DeleteMessageParams` can be set:

| Parameters | Description | Type |
| ---------- | ----------- | ---- |
| `description` | *Optional* A description of why the message was deleted. | String |
| `metadata` | *Optional* Metadata associated with the deletion. Do not use metadata for authoritative information. There is no server-side validation. When reading the metadata, treat it like user input. | [`OperationMetadata`](#operationmetadata) |

### Returns

Returns a promise. On success, the promise is fulfilled with the deleted [`Message`](/docs/chat/api/javascript/message) object. On failure, the promise is rejected with an [`ErrorInfo`](/docs/chat/api/javascript/error-info).

<Code>
```javascript
const deletedMessage = await room.messages.delete(
  message.serial,
  {
    description: 'Message violated community guidelines',
    metadata: { reason: 'inappropriate content' }
  }
);
```
</Code>

---

## Get message history <a id="history"/>

`room.messages.history()`

Get messages that have been previously sent to the chat room, based on the provided options.

Note that the [`historyBeforeSubscribe()`](#historybeforesubscribe) method enables clients to retrieve messages in a continuous manner when they first subscribe to a room, or rejoin after a period of disconnection.

`history(options: QueryOptions): Promise<PaginatedResult<Message>>`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `options` | Options for the query. | [`QueryOptions`](#queryoptions) |

#### QueryOptions

The following `QueryOptions` can be set:

| Parameters | Description | Type |
| ---------- | ----------- | ---- |
| `start` | *Optional* The start of the time window to query from. Messages with `timestamps` equal to or greater than this value will be returned. The default is the beginning of time. | Number |
| `end` | *Optional* The end of the time window to query to. Messages with `timestamps` less than this value will be returned. The default is now. | Number |
| `orderBy` | *Optional* The direction to query messages in. The default is `NewestFirst`. | [`OrderBy`](#orderby) |
| `limit` | *Optional* The maximum number of messages to return. The default is 100. | Number |

#### OrderBy

The order in which messages are returned in a history request.

It has the following members:

| Member | Description |
| ------ | ----------- |
| `NewestFirst` | Query messages in descending order (newest to oldest). |
| `OldestFirst` | Query messages in ascending order (oldest to newest). |

### Returns

Returns a promise. On success, the promise is fulfilled with a [`PaginatedResult`](#paginatedresult) containing an array of [`Message`](/docs/chat/api/javascript/message) objects. This paginated result can be used to fetch more messages if available. On failure, the promise is rejected with an [`ErrorInfo`](/docs/chat/api/javascript/error-info).

#### PaginatedResult

A paginated result containing messages and methods to navigate through pages.

It has the following properties:

| Property | Description | Type |
| -------- | ----------- | ---- |
| `items` | The array of messages in the current page. | [`Message`](/docs/chat/api/javascript/message)[] |
| `next` | A method to fetch the next page of results. Returns a promise with the next `PaginatedResult`. Throws if there are no more pages. | `() => Promise<PaginatedResult<Message>>` |
| `hasNext` | Indicates whether there are more pages available. | Boolean |
| `isLast` | Indicates whether this is the last page. | Boolean |

<Code>
```javascript
const result = await room.messages.history({
  limit: 50,
  direction: 'backwards'
});

console.log(`Retrieved ${result.items.length} messages`);

if (result.hasNext) {
  const nextPage = await result.next();
  console.log(`Retrieved ${nextPage.items.length} more messages`);
}
```
</Code>

---

## Subscribe to message events <a id="subscribe"/>

`room.messages.subscribe()`

Subscribe to new messages in this chat room.

`subscribe(listener: MessageListener): MessageSubscriptionResponse`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `listener` | Callback that will be called when a message event is received. | [`MessageListener`](#messagelistener) |

#### MessageListener

A listener that listens for message events.

`MessageListener: (event: ChatMessageEvent) => void`

It uses the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `event` | A message event. | [`ChatMessageEvent`](#chatmessageevent) |

#### ChatMessageEvent

An interface that represents a message event.

It has the following properties:

| Property | Description | Type |
| -------- | ----------- | ---- |
| `type` | The type of message event. | [`ChatMessageEventType`](#chatmessageeventtype) |
| `message` | The message associated with the event. | [`Message`](/docs/chat/api/javascript/message) |

#### ChatMessageEventType

An enum that represents the types of message events.

It has the following members:

| Member | Description |
| ------ | ----------- |
| `Created` | A new message was created. |
| `Updated` | A message was updated. |
| `Deleted` | A message was deleted. |

### Returns

Returns a [`MessageSubscriptionResponse`](#messagesubscriptionresponse) object that allows you to control the subscription.

#### MessageSubscriptionResponse

A response object that allows you to control the subscription.

It has the following properties:

| Property | Description | Type |
| -------- | ----------- | ---- |
| `unsubscribe` | A method to unsubscribe from message events. | `() => Promise<void>` |

There is a difference between unsubscribing from messages and detaching from a room. Messages are sent to users as soon as they attach to a room, irrespective of whether a listener has been registered by calling `subscribe()`. Calling `unsubscribe()` only deregisters the listener. The `detach()` method detaches a user from the room. At that point a user will no longer receive any messages that are sent to the room.

It has the following methods:

| Method | Description |
| ------ | ----------- |
| [`historyBeforeSubscribe()`](#historybeforesubscribe) | Get the messages sent before the listener was subscribed. |

<Code>
```javascript
const subscription = room.messages.subscribe((event) => {
  switch (event.type) {
    case 'message.created':
      console.log('New message:', event.message.text);
      break;
    case 'message.updated':
      console.log('Updated message:', event.message.text);
      break;
    case 'message.deleted':
      console.log('Deleted message:', event.message.serial);
      break;
  }
});

// Unsubscribe when done
await subscription.unsubscribe();
```
</Code>

---

## Get message history from before a subscription <a id="historyBeforeSubscribe"/>

`historyBeforeSubscribe()`

Get the messages that were sent to the room before the [listener was subscribed](#subscribe). This method is useful for providing conversational context when a user first joins a room, or when they subsequently rejoin it later on. It also ensures that the message history they see is continuous, without any overlap of messages being returned between their subscription and their history call.

If the client experiences a discontinuity event, where the connection was lost and could not be resumed, the starting point of `historyBeforeSubscribe` is reset. Calls to `historyBeforeSubscribe` will wait for continuity to be restored before resolving.

To ensure that no messages are missed, you should call `historyBeforeSubscribe` after any period of discontinuity to fill any gaps in the message history.

`historyBeforeSubscribe( params: Omit<QueryOptions, "orderBy">,): Promise<PaginatedResult<Message>>`

### Parameters

Use the following parameters:

| Parameter | Description | Type |
| --------- | ----------- | ---- |
| `params` | The options for the query, omitting `orderBy`. | [`QueryOptions`](#queryoptions) |


### Returns

Returns a promise. On success, the promise is fulfilled with a [`PaginatedResult`](#paginatedresult) containing an array of [`Message`](/docs/chat/api/javascript/message) objects from newest to oldest. This paginated result can be used to fetch more messages if available. On failure, the promise is rejected with an [`ErrorInfo`](/docs/chat/api/javascript/error-info).

<Code>
```javascript
const { historyBeforeSubscribe } = room.messages.subscribe(listener);

await historyBeforeSubscribe({ limit: 10 });
```
</Code>
