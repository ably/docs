<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40144 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive JWT validation error documentation focusing on specific field requirements and known library issues -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40144: Invalid JWT token format

## What Happened

Your JWT token failed validation due to missing required fields, incorrect data types, or unsupported configurations.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40144 | 400/401 | Client Error (Authentication) | No - requires fixing token format |

## Quick Fix

- Ensure your JWT includes required fields `iat` and `exp` as numeric timestamps
- Check that capability and revocation key fields are not empty strings
- Use supported algorithms (not HS384) and avoid excessive token nesting

## Error Messages

You may see one of these messages:
- "Invalid token; iat must be specified"
- "Invalid token; iat must be a number"
- "Invalid token; exp must be specified"
- "Invalid token; exp must be a number"
- "Invalid token request body; capability must not be the empty string"
- "Invalid capability"
- "Invalid token; revocationKey must not be the empty string"
- "Invalid token; revocationKey must be a string"
- "Invalid token; embedded JWT tokens cannot be nested more than once"
- "Invalid embedded access token"
- "HS384 is not supported"

## Common Causes

1. **Missing or invalid timestamps** (60% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 16-33 -->
   - JWT missing `iat` (issued at) field
   - JWT missing `exp` (expires) field
   - Timestamps not formatted as numbers (e.g., strings or decimals with microseconds)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 119-124 -->

2. **Library-generated format issues** (25% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 118-125 -->
   - PHP Lcobucci/JWT library creating timestamps with microseconds
   - JWT libraries producing string timestamps instead of numbers
   - Demo token generators with incorrect field types

3. **Invalid capability or configuration** (10% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 35-48 -->
   - Empty capability string when specified
   - Empty revocation key when specified
   - Unsupported HS384 algorithm

4. **Token nesting issues** (5% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 55-63 -->
   - Embedded JWT tokens nested more than once
   - Invalid embedded access tokens

## Resolution Steps

1. **Validate your JWT structure**
   - Decode your token using [JWT.io](https://jwt.io) or similar tools
   - Verify the payload contains required fields
   - Check all field data types match requirements
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 89-93 -->

2. **Ensure required fields are correct**
   Your JWT payload must include:
   - `iat`: Unix timestamp as a whole number (e.g., `1234567890`)
   - `exp`: Unix timestamp as a whole number (e.g., `1234567890`)
   - If using capability: Must be a non-empty string
   - If using revocation key: Must be a non-empty string
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 16-48 -->

3. **Fix library-specific issues**
   
   **For PHP Lcobucci/JWT users:**
   Configure the library to use integer timestamps only. By default, it creates timestamps with microseconds which Ably rejects.
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 118-125, 167-170 -->
   
   **For Kafka Connect/Confluent integration:**
   Add these converter configurations:
   - `key.converter: org.apache.kafka.connect.converters.ByteArrayConverter`
   - `value.converter: org.apache.kafka.connect.converters.ByteArrayConverter`
   - `value.converter.schemas.enable: false`
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 126-134 -->

4. **Test with a minimal valid token**
   Create a simple token with only required fields to isolate the issue.
   See the [Ably JWT authentication documentation](https://ably.com/docs/auth/token) for token structure requirements.
   <!-- Source: Ably documentation at https://ably.com/docs/auth/token -->

5. **Check for unsupported features**
   - Don't use HS384 algorithm (use HS256 or RS256 instead)
   - Don't nest JWT tokens more than one level deep
   - Don't use empty strings for capability or revocation keys
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 65-68, 35-48 -->

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the token format issue before authentication will succeed.

## Prevention

- Use established JWT libraries with proper configuration for integer timestamps
- Validate tokens after generation using JWT debugging tools
- Test your token generation with the specific Ably SDK you're using
- Monitor authentication failures during development to catch format issues early
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 71-87 -->

## Related Resources

- [Ably JWT Authentication Guide](https://ably.com/docs/auth/token)
- [Token Generation Documentation](https://ably.com/docs/auth/token#token-request-process)
- [JWT Specification (RFC 7519)](https://tools.ietf.org/html/rfc7519)
- Related errors: [40140](./40140-token-expired), [40141](./40141-token-unrecognized), [40142](./40142-token-revoked)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40144
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 40144
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - PHP Lcobucci/JWT microseconds issue from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 118-125
  - Kafka Connect configuration requirements from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 126-134
- Content Excluded: 
  - Specific internal Slack thread URLs (kept context but not URLs)
  - Python SDK authorization header issue (too specific for general documentation)
- Recommendations Source: 
  - All resolution steps based on actual error triggers from analysis file
  - Library workarounds from real customer issues in knowledge file
- Code Examples Rationale: 
  - No code examples included as they would require showing JWT generation which varies by library
  - Linked to official documentation instead for implementation details
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 16-33 and knowledge file lines 119-124
  - Cause 2: From customer reports in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 118-125, 135-140
  - Cause 3: From code analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 35-48
  - Cause 4: From code analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 55-63
- Resolution Steps: 
  - Step 1: Based on debugging advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 89-93
  - Step 2: Source from code requirements in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 16-48
  - Step 3: PHP workaround from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 118-125, 167-170; Kafka config from lines 126-134
  - Step 4: General best practice linked to https://ably.com/docs/auth/token
  - Step 5: Unsupported features from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-analysis.md lines 65-68, 35-48
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/40144-knowledge.md lines 71-87
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40144
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40144 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->