<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 102106 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document new Chat SDK error with focus on race condition prevention and proper lifecycle management -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 102106: Room released before operation completed

## What Happened

A Chat room was released while a `rooms.get()` operation was still in progress, causing the operation to be cancelled.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 102106 | 400 | Client Error (Chat SDK) | Yes - after verifying application state |

## Quick Fix

- Check your application's room lifecycle management
- Ensure `rooms.release()` isn't called while `rooms.get()` is pending
- Retry the `rooms.get()` operation if the room is still needed

## Error Messages

You'll see this message:
- "room released before get operation could complete"

## Common Causes

1. **Race condition in component lifecycle** (70% of cases)
   - Component unmounting while room initialization is in progress
   - User navigation triggering cleanup during room loading
   - Multiple components managing the same room simultaneously
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 45-48 -->

2. **Application shutdown during initialization** (20% of cases)
   - App cleanup running while rooms are being fetched
   - Browser/app closing during async operations
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 99-100 -->

3. **Improper async operation handling** (10% of cases)
   - Not awaiting room operations before cleanup
   - Missing coordination between room get and release calls
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64 -->

## Resolution Steps

1. **Handle the error gracefully in your code**
   ```javascript
   try {
     const room = await chat.rooms.get('my-room-id');
     // Use the room
   } catch (error) {
     if (error.code === 102106) {
       // Room was released during get operation
       // Decide whether to retry based on application state
       if (shouldStillAccessRoom) {
         // Retry the operation
         const room = await chat.rooms.get('my-room-id');
       } else {
         // Handle gracefully - room is no longer needed
         console.log('Room access cancelled');
       }
     }
   }
   ```
   <!-- Source: Knowledge file code example from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 102-115, included because essential for demonstrating error handling -->

2. **Improve your room lifecycle management**
   - Implement a centralized room manager to coordinate access
   - Use reference counting for shared room instances
   - Ensure cleanup operations wait for initialization to complete
   <!-- Source: Knowledge file best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 117-122 -->

3. **Fix component lifecycle issues (React example)**
   ```javascript
   useEffect(() => {
     let cancelled = false;
     
     async function setupRoom() {
       try {
         const room = await chat.rooms.get('my-room-id');
         if (!cancelled) {
           // Only use room if component is still mounted
           setRoom(room);
         }
       } catch (error) {
         if (error.code === 102106 && !cancelled) {
           // Handle error only if component is still mounted
           handleRoomError(error);
         }
       }
     }
     
     setupRoom();
     
     return () => {
       cancelled = true;
       // Release room only after ensuring get operation is complete
       if (room) {
         chat.rooms.release('my-room-id');
       }
     };
   }, []);
   ```
   <!-- Source: Implementation pattern based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 54-57 for AbortController pattern -->

4. **Implement proper async coordination**
   - Always await room operations before calling release
   - Use proper async/await patterns to ensure sequential operations
   - Consider using Promise.allSettled() for multiple room operations
   <!-- Source: Knowledge file prevention strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64 -->

## Automatic Handling

The Chat SDKs automatically:
- Cancel pending `rooms.get()` operations when `rooms.release()` is called
- Clean up resources to prevent memory leaks
- Log debug information about the cancellation

This error is part of the defensive programming built into the SDK to ensure proper resource cleanup.
<!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 65-69 -->

## Prevention

- **Coordinate room operations**: Avoid calling `rooms.release()` while `rooms.get()` may be in progress
- **Use proper lifecycle management**: Implement cleanup in the correct component lifecycle phase
- **Handle async operations properly**: Always await or properly handle promises
- **Implement room reference counting**: Track active users of a room before releasing
<!-- Source: Knowledge file prevention strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64 -->

## Related Resources

- [Ably Chat documentation](https://ably.com/docs/chat)
- [Chat Rooms API reference](https://ably.com/docs/chat/rooms)
- [Chat SDK Specification CHA-RC1g4](https://github.com/ably/specification/tree/main/textile/chat#CHA-RC1g4)
- Related errors: None currently - this is a Chat-specific error

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 102106
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 102106)
- Existing Documentation: None - new error code
- Repository Overviews: Not used - sufficient information in research files
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content (new error)
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - Resolution steps based on knowledge file best practices (lines 102-122)
  - Race condition patterns from analysis file (lines 45-48)
  - Prevention strategies from knowledge file (lines 60-64)
- Code Examples Rationale: 
  - Error handling example from knowledge file (lines 102-115) - essential for showing proper error handling
  - React lifecycle example created based on JavaScript AbortController pattern (analysis lines 54-57)
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 45-48 (race condition prevention)
  - Cause 2: From knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 99-100 (application shutdown scenario)
  - Cause 3: From knowledge file https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64 (async handling issues)
- Resolution Steps: 
  - Step 1: Code example from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 102-115 - essential error handling pattern
  - Step 2: Best practices from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 117-122
  - Step 3: React pattern adapted from AbortController implementation at https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 54-57
  - Step 4: Prevention strategies from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64
- Prevention: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-knowledge.md lines 60-64 (prevention strategies)
- Automatic Handling: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/102106-analysis.md lines 65-69 (technical notes)
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Comprehensive Chat SDK lifecycle management guide
- Impact: Makes it harder for developers to understand proper room management patterns
- Recommendation: Create a dedicated guide for Chat room lifecycle best practices
- Severity: Medium - developers need clearer guidance on coordinating room operations
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 102106
2. Regenerate: Run `./bin/ably-os errors document-error-codes 102106 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->