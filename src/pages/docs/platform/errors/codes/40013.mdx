---
title: "Error 40013 - Data type unsupported"
meta_description: "Information and troubleshooting for Ably error code 40013 - Data type is unsupported or failed to encode/decode message data"
meta_keywords: "Ably, error, error codes, 40013, data type, encoding, decoding, message serialization, unsupported data"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40013 */}
{/* Generated: 2025-11-07T01-37-30-412Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Complex error with multiple causes - using Structure B for comprehensive coverage of data type validation, encoding issues, and encryption failures */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

The message data provided cannot be processed because it uses an unsupported data type, has an invalid format, or failed encoding/decoding operations.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ---------------- | -------- | --------- |
| 40013 | 400 | Client error (message validation) | No |

## Error messages

The following error messages can be returned with error code 40013:

| Message | Description |
| ------- | ----------- |
| Data type is unsupported | The data type provided is not supported by the SDK. |
| The single-argument form of publish() expects a message object or an array of message objects | Invalid format for single-argument publish. |
| Failed to encode/decode message data | Message encoding or decoding operation failed. |
| Map value data type is unsupported | LiveObjects Map doesn't support the provided data type. |
| Invalid data payload: [class] is not supported. Use String, Hash, Array, or nil | Ruby SDK data type validation. |
| Invalid data type for 'base64' decoding | Non-string data provided for base64 decoding. |
| Invalid data type for 'json' decoding | Invalid data structure for JSON decoding. |
| Error processing the cipher encoding, decoder returned statusCode=400 code=40013 | Encryption/decryption operation failed. |

## Impact

This error prevents the current message operation from completing, however it has no impact on:

- Existing connections or channel attachments.
- Other messages that use supported data types.
- Messages on other channels.
- Overall system performance.

This is a client error that will not be automatically retried. You must fix the data type or encoding issue before the operation will succeed. The SDK will not attempt to recover from this error as it indicates a data format problem that requires manual correction.

## Quick fixes

Try the following quick fixes to resolve the error:

- Ensure your data is one of the supported types for your SDK (String, Object/Hash, Array, Buffer/NSData, or null/nil).
- Convert numbers to strings or wrap them in objects before publishing.
- Use the correct publish format: either `publish(name, data)` or `publish({name, data})`.
- Check that your encryption keys match between publisher and subscriber.
- Verify that data matches the encoding type (e.g., strings for UTF-8, objects for JSON).

## Troubleshooting

The following are common causes and how to resolve them for error 40013:

### Unsupported data types

| Error messages |
| -------------- |
| Data type is unsupported |
| Map value data type is unsupported |
| Invalid data payload: [class] is not supported |

This occurs when:

- Publishing numbers, functions, or other non-serializable types directly.
- Using class instances or complex objects that can't be serialized.
- Attempting to store non-primitive values in LiveObjects Maps.

To resolve this:

- Convert unsupported types to supported ones before publishing.
- For numbers, either convert to string or wrap in an object.
- Extract plain data from class instances.

<Code>
```javascript
// Wrong: Number not supported directly
channel.publish('event', 42); // Error 40013

// Correct: Convert to string or wrap in object
channel.publish('event', '42');
// or
channel.publish('event', { value: 42 });

// Wrong: Function not serializable
channel.publish('event', () => console.log('hello')); // Error 40013

// Correct: Don't publish functions

// Wrong: Class instance
channel.publish('event', new MyClass()); // Error 40013

// Correct: Extract serializable data
channel.publish('event', { type: 'MyClass', data: {...} });
```
</Code>

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 155-165 */}

### Invalid publish format

| Error messages |
| -------------- |
| The single-argument form of publish() expects a message object or an array of message objects |

This occurs when:

- Using single-argument publish with incorrect format.
- Passing a plain string instead of a message object.
- Missing the required message structure.

To resolve this:

- Use the two-argument form: `publish(name, data)`.
- Or provide a proper message object: `publish({name, data})`.
- For batch publishing, provide an array of message objects.

<Code>
```javascript
// Wrong: Invalid single-argument format
channel.publish('just a string'); // Error 40013

// Correct: Use two-argument form
channel.publish('event', 'just a string');

// Correct: Or use message object
channel.publish({
  name: 'event',
  data: 'just a string'
});

// Correct: Array for batch publishing
channel.publish([
  { name: 'event1', data: 'data1' },
  { name: 'event2', data: 'data2' }
]);
```
</Code>

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 169-173 */}

### Encryption and decryption failures

| Error messages |
| -------------- |
| Error processing the cipher encoding, decoder returned statusCode=400 code=40013 |
| decrypt failed |

This occurs when:

- Cipher keys don't match between publisher and subscriber.
- Encrypted data is corrupted or malformed.
- Channel idle for extended periods with dynamic encryption keys.
- Race conditions during channel setup with encryption.

To resolve this:

- Ensure encryption keys are identical on all clients.
- Verify cipher configuration consistency across publishers/subscribers.
- For dynamic channels, ensure channel names are fully constructed before use.
- Consider key rotation timing if using dynamic keys.

<Code>
```javascript
// Ensure consistent cipher configuration
const cipherKey = 'your-256-bit-key'; // Must be same on all clients

// Publisher
const encryptedChannel = ably.channels.get('secure', {
  cipher: { key: cipherKey }
});
await encryptedChannel.publish('secret', data);

// Subscriber (must use same key)
const encryptedChannel = ably.channels.get('secure', {
  cipher: { key: cipherKey } // Same key required
});
encryptedChannel.subscribe((message) => {
  console.log(message.data); // Automatically decrypted
});
```
</Code>

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 155-165 and Knowledge from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-knowledge.md lines 79-97 */}

### Encoding chain failures

| Error messages |
| -------------- |
| Invalid data type for 'base64' decoding |
| Invalid data type for 'json' decoding |
| unknown encoding |
| Failed to encode/decode message data |

This occurs when:

- Data doesn't match the specified encoding requirements.
- Non-string data provided for base64 operations.
- Invalid JSON structure for JSON encoding.
- Unknown or unsupported encoding specified.

To resolve this:

- Ensure data matches encoding requirements (strings for UTF-8/base64, objects for JSON).
- Validate JSON structure before publishing.
- Use only supported encoding types.

<Code>
```javascript
// Wrong: Non-string for base64
channel.publish({
  name: 'event',
  data: 123,
  encoding: 'base64'
}); // Error 40013

// Correct: String data for base64
channel.publish({
  name: 'event',
  data: Buffer.from('data').toString('base64'),
  encoding: 'base64'
});

// Correct: Object for JSON encoding
channel.publish({
  name: 'event',
  data: { key: 'value' },
  encoding: 'json'
});
```
</Code>

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 174-178 */}

### LiveObjects data validation

| Error messages |
| -------------- |
| Map value data type is unsupported |

This occurs when:

- Setting functions or non-serializable objects as LiveMap values.
- Using complex class instances in LiveObjects.
- Attempting to store non-primitive types.

To resolve this:

- Use only primitive or serializable types in LiveObjects.
- Extract plain data from complex objects.
- Convert to supported formats before storing.

<Code>
```javascript
// Wrong: Class instance in LiveMap
map.set('key', new MyClass()); // Error 40013

// Correct: Use serializable data
map.set('key', {
  type: 'MyClass',
  data: { /* plain properties */ }
});

// Correct: Primitives work fine
map.set('count', 42);
map.set('name', 'John');
map.set('active', true);
```
</Code>

{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 179-183 */}

## Prevention

To prevent this error:

- Always validate data types before publishing to channels.
- Use SDK-provided type checking where available.
- Implement consistent cipher key management for encrypted channels.
- Test serialization of complex objects before deployment.
- Use TypeScript or type hints to catch type errors during development.
- Follow Ably's documentation for supported data types in your SDK.

## Related errors

The following errors are related to error code 40013:

| Error code | Description |
| ---------- | ----------- |
| [40010 - Invalid message data or name](/docs/platform/errors/codes/40010) | Related validation error for message structure and naming. |
| [40011 - Invalid channel name](/docs/platform/errors/codes/40011) | Channel naming validation that may occur alongside data issues. |
| [92001 - Encryption error](/docs/platform/errors/codes/92001) | Specific encryption configuration errors. |
| [92005 - Decryption error](/docs/platform/errors/codes/92005) | Decryption failures that may manifest as 40013. |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Resources

The following resources provide further context or assistance with this error:

- [Ably JavaScript SDK documentation](https://ably.com/docs/sdks/javascript)
- [Message structure and publishing](https://ably.com/docs/channels#publish)
- [Encryption documentation](https://ably.com/docs/realtime/encryption)
- [LiveObjects documentation](https://ably.com/docs/products/liveobjects)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40013)
- Writing Guide: https://github.com/ably/ably-os/blob/b819713/src/prompts/shared-resources/error-code-doc-writing-guide.md
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: No FAQ content found for 40013 in knowledge file
- Content Excluded: Detailed code examples from analysis (lines 194-263) to keep documentation concise
- Recommendations Source:
  - Data type validation: Analysis lines 64-67, 136-142
  - Publish format: Analysis lines 69-78, 169-173
  - Encryption issues: Knowledge lines 79-97, Analysis lines 113-118
  - LiveObjects: Analysis lines 80-85
- Code Examples Rationale: Included minimal examples only where essential for understanding correct vs incorrect usage
*/}

{/* ATTRIBUTION BY SECTION:
- Common Causes:
  - Unsupported types: Based on analysis findings in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 155-165
  - Invalid publish format: From SDK code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 69-78
  - Encryption failures: Knowledge from customer reports https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-knowledge.md lines 79-97
  - Encoding issues: Analysis https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 95-124
  - LiveObjects: Analysis https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40013-analysis.md lines 80-85
- Resolution Steps:
  - Step 1 (Data types): Source from analysis lines 155-165 - based on SDK validation logic
  - Step 2 (Publish format): From analysis lines 169-173 - based on actual error messages
  - Step 3 (Encryption): Knowledge lines 79-97 - preserved customer experience from support tickets
  - Step 4 (Encoding): Analysis lines 95-124 - based on encoding validation in SDKs
  - Step 5 (LiveObjects): Analysis lines 179-183 - based on LiveMap validation
- Prevention: Based on common patterns found across all repositories in analysis
*/}

{/* URL Validation Completed: 2025-11-07T01-37-30-412Z */}
{/* External URLs verified: 4 | Corrected: 0 | Exempted internal: 8 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40013
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40013 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}