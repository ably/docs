---
title: "Invalid request body"
meta_description: "Understand and resolve the Ably error 40001 which occurs when the request sent to Ably contains invalid or malformed data."
meta_keywords: "Ably error, error code 40001, invalid request body, JSON parsing error, Chat SDK error, token request error, message validation, API request validation"
---

{/* Generated by: ably-os errors document-error-codes */}
{/* Repository: https://github.com/ably/ably-os */}
{/* Command: ./bin/ably-os errors document-error-codes 40001 */}
{/* Generated: 2025-11-07T01-19-51-325Z */}
{/* Sources:
     - Analysis: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
*/}
{/* Key Approach: Comprehensive documentation of request body validation errors with specific Chat SDK, token request, and encoding scenarios based on research findings */}
{/* Citations: Complete source attribution with line numbers available at bottom of document */}

# Invalid request body

This error occurs when the request sent to Ably contains invalid, malformed, or missing data that prevents the server from processing it.

| Error code | HTTP status code | Category | Retryable |
| ---------- | ----------- | -------- | --------- |
| 40001 | 400 | Client Error (Request Validation) | No |

## Error messages

You may see one of these messages:

| Message | Context |
| ------- | ------- |
| `invalid request body` | Generic validation failure |
| `unable to publish chat message while parsing request; cannot decode request body (ensure JSON is properly formatted)` | Chat message JSON parsing error |
| `unable to publish chat message while validating request; text is empty (message text field is required and cannot be empty)` | Chat message validation |
| `Invalid token request body while parsing authentication request; no keyName specified (keyName is required for token requests)` | Token request missing keyName |
| `Invalid token request body while parsing authentication request; no nonce specified (nonce is required to prevent replay attacks)` | Token request missing nonce |
| `unable to add message reaction; type is empty` | Reaction missing type field |
| `unable to add message reaction; name is empty` | Reaction missing name field |
| `invalid JSON data` | JSON parsing failure |
| `invalid MessagePack data` | MessagePack parsing failure |
| `missing content-type` | Missing Content-Type header |

## Impact

This error prevents the current operation from completing. The request is rejected immediately without any processing, and no retry will succeed unless the request data is corrected.

The Ably SDK will not automatically retry this error because it indicates a problem with the request data itself, not a transient network or server issue.

## Troubleshooting

The following are common causes and resolutions for error 40001:

### Invalid JSON formatting
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 16-19, 64, 178-179 */}

| Error message | Description |
| ------------- | ----------- |
| `cannot decode request body (ensure JSON is properly formatted)` | Malformed JSON syntax |

This occurs when:
- The JSON structure is malformed (missing quotes, brackets, or commas)
- The request body contains invalid UTF-8 characters
- The Content-Type header doesn't match the actual body format

To resolve this:
1. Validate your JSON using a JSON validator before sending
2. Ensure all strings are properly quoted and escaped
3. Verify your Content-Type header is set to `application/json`
4. Check that all text data is UTF-8 encoded

### Chat message validation failures
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 46-51, 66-71 */}
{/* Source: Knowledge base from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 49-52 */}

| Error message | Description |
| ------------- | ----------- |
| `text is empty (message text field is required and cannot be empty)` | Missing or empty message text |

This occurs when:
- Attempting to send a Chat message without the required `text` field
- The `text` field is present but contains an empty string

To resolve this:
- Ensure your Chat message includes a non-empty `text` field:

<Code>
```javascript
// Correct - includes required text field
await room.messages.send({
  text: 'Hello, world!',
  metadata: { priority: 'high' }
});

// Incorrect - missing or empty text
await room.messages.send({
  text: '',  // This will trigger error 40001
  metadata: { priority: 'high' }
});
```
</Code>
{/* Code source: Ably Chat documentation pattern, included because essential for demonstrating required text field */}

### Token request validation errors
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 124-133 */}
{/* Source: Knowledge base FAQ from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 39-46 */}

| Error message | Description |
| ------------- | ----------- |
| `no keyName specified (keyName is required for token requests)` | Missing keyName parameter |
| `no nonce specified (nonce is required to prevent replay attacks)` | Missing nonce parameter |

This occurs when:
- Creating a token request without the required `keyName` field
- Missing the `nonce` field needed for replay attack prevention

To resolve this:
- Include all required fields in your token request
- See [Authentication documentation](https://ably.com/docs/auth) for complete requirements

### Reaction validation errors
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 16-43, 82-96 */}
{/* Source: Knowledge base from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 53-59, 301-313 */}

| Error message | Description |
| ------------- | ----------- |
| `unable to add message reaction; type is empty` | Missing reaction type |
| `unable to add message reaction; type is invalid` | Invalid reaction type |
| `unable to add message reaction; name is empty` | Missing reaction name |
| `unable to add message reaction; count provided for type that doesn't support a count` | Invalid count for reaction type |

This occurs when:
- Adding a reaction without specifying the required `type` field
- Using an invalid reaction type value
- Missing the `name` field for non-unique reactions
- Providing a `count` field for reaction types that don't support counts

To resolve this:
- All reactions require a `type` field
- Most reaction types require a `name` field
- Only "Multiple" type reactions support the `count` field
- Review the [Chat documentation](https://ably.com/docs/products/chat) for valid reaction types

### Missing or incorrect Content-Type header
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 97-104, 166-176 */}
{/* Source: Knowledge base from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 66-72, 315-329 */}

| Error message | Description |
| ------------- | ----------- |
| `missing content-type` | No Content-Type header provided |
| `unable to handle plain data; incompatible request` | Wrong Content-Type for endpoint |

This occurs when:
- The Content-Type header is missing from the request
- Using an incompatible Content-Type for the specific endpoint
- Attempting to use MessagePack where only JSON is supported

To resolve this:
- Always include the Content-Type header: `application/json`
- For Chat operations, use only `application/json`
- For LiveObjects, use only `application/json` (MessagePack not currently supported)
- For token requests, use `application/json` or `application/x-www-form-urlencoded`

### Room configuration validation
{/* Source: Analysis finding from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 159-163 */}
{/* Source: Knowledge base from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 74-81 */}

| Error message | Description |
| ------------- | ----------- |
| `Typing heartbeatThrottle must be greater than 0` | Invalid typing throttle value |
| `invalid room configuration: [reason]` | General room configuration error |

This occurs when:
- Setting `heartbeatThrottle` to 0 or a negative value
- Providing invalid values for room configuration options

To resolve this:
- Set `heartbeatThrottle` to a positive value (in milliseconds)
- Review [Chat documentation](https://ably.com/docs/products/chat) for valid option values

## Prevention

To avoid this error:
{/* Source: Knowledge base best practices from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 85-110 */}

1. **Validate input data before sending**
   - Check that all required fields are present
   - Ensure data types match API expectations
   - Validate UTF-8 encoding for all text data

2. **Set proper headers**
   - Always include `Content-Type: application/json`
   - Match the Content-Type to your actual payload format

3. **Use SDK methods correctly**
   - Follow SDK documentation for proper method usage
   - Use type-safe languages/TypeScript to catch errors at compile time

4. **Test with minimal payloads first**
   - Start with the minimum required fields
   - Gradually add optional parameters once basic requests work

## Related errors

The following errors are related to error code 40001:

| Error code | Description |
| ---------- | ----------- |
| [40003 - Invalid parameter value](/docs/platform/errors/codes/40003) | More specific validation errors for individual parameter values. |
| [40012 - Invalid client ID](/docs/platform/errors/codes/40012) | Client ID validation failures in authentication or presence operations. |
| [40013 - Invalid message data or encoding](/docs/platform/errors/codes/40013) | Message-specific data or encoding validation issues. |

## Need further help?

Contact [Ably support](https://ably.com/support) if you're still experiencing issues after trying the steps listed above.

You'll need to provide:

- Your account ID and app ID.
- The full error message including the error code.
- Steps to reproduce the issue.
- Any relevant code snippets (without any sensitive credentials).
- The SDK and version you're using.

### Additional resources

- [Ably documentation](https://ably.com/docs)
- [Authentication documentation](https://ably.com/docs/auth)
- [Chat documentation](https://ably.com/docs/products/chat)
- [FAQ: Error Code 40001](https://faqs.ably.com/error-code-40001-invalid-request-body)

{/* =============================================== */}
{/* INTERNAL DOCUMENTATION (NOT RENDERED) */}
{/* =============================================== */}

{/* SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/b819713/src/prompts/errors/editorial-notes.md
- Existing Documentation: None found
*/}

{/* CONTENT DECISIONS:
- FAQ Content Preserved: Validation steps and debugging guidance from https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 85-119
- Content Excluded: Platform-specific implementation details that are too technical for customer docs
- Recommendations Source: Based on actual error patterns from code analysis and support tickets
- Code Examples Rationale: Minimal code included only for Chat message text field demonstration as it's the most common scenario
*/}

{/* ATTRIBUTION BY SECTION:
- Common Causes:
  - JSON formatting: Based on analysis findings in https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 16-19, 64, 178-179
  - Chat validation: From SDK code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 46-51, 66-71
  - Token validation: From realtime server code at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 124-133
  - Reaction validation: From Chat SDK handlers at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 16-43
  - Content-Type issues: From request handler analysis at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 97-104
  - Room configuration: From Chat SDK validation at https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-analysis.md lines 159-163
- Resolution Steps:
  - JSON validation: Standard debugging practice confirmed by error messages
  - Chat requirements: From Ably Chat documentation and error message guidance
  - Token fields: From https://ably.com/docs/auth/token and FAQ content
  - Reaction rules: From code analysis showing validation logic
  - Content-Type requirements: From knowledge base findings about endpoint requirements
  - Room config: From Chat SDK documentation references
- Prevention: Based on https://github.com/ably/ably-os/blob/b819713/output/error-codes/research/40001-knowledge.md lines 85-110 - preserved FAQ best practices
*/}

{/* URL Validation Completed: 2025-11-07T01-19-51-325Z */}
{/* External URLs verified: 5 | Corrected: 4 | Exempted internal: 6 */}

{/* IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40001
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40001 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/b819713/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
*/}