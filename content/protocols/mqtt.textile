---
title: MQTT
meta_description: "Any MQTT-enabled client can communication with the Ably service through the Ably MQTT protocol adapter. This is especially useful where an Ably client library SDK is not available for your language of choice."
---

The Ably MQTT protocol adapter is able to translate back and forth between "MQTT":https://mqtt.org/ and Ably's own protocol, allowing for seamless integration of any systems you may have. MQTT (MQ Telemetry Transport) is a "publish/subscribe":https://ably.com/topic/pub-sub , lightweight messaging protocol designed for constrained devices and low-bandwidth networks. One of the major uses of MQTT is with IoT (Internet of Things), where these principles are key to having effective communication between various devices.

h2(#when-to-use). When to use the MQTT adapter

The MQTT adapter is our recommended way of interacting with Ably from devices which do not have a native Ably client library, such as Arduino platforms, C/C++ applications, and so on. Anyone who has previously been using Pubnub or Pusher client libraries for this purpose may want to consider switching to MQTT. Compared to the Pubnub protocol, using MQTT will result in better performance with lower latency. Compared to the Pusher protocol, MQTT will give you connection state recovery.

We recommend you use MQTT to interact with Ably when:

* Using devices which do not have a device-specific Ably Client Library SDK, such as Arduino platforms, C/C++ applications, and so on
* If bandwidth is limited and you want to keep network traffic to a minimum
* You want to keep network traffic to a minimum.

Note, we do not currently support MQTT over websockets but let us know if you are interested.

h2(#limitations). Known limitations 

Our MQTT adapter only supports features supported by both the MQTT protocol and the Ably platform. So:

* It only supports MQTT 3.1.1 clients only. Connection attempts using earlier protocol versions will be rejected
* Publishing supports QoS 0 or 1. Subscribing only supports QoS 0
* Session resumption is supported within the usual "Ably time limit of two minutes":/history-storage/storage
* It doesn’t support any MQTT features that aren’t normally supported by Ably, such as @WILL@ messages, the @RETAIN@ flag or "wildcard channel subscriptions":/channels
* It doesn't support any Ably features that aren't supported by the MQTT protocol, such as presence, history and push notifications (though presence may be supported soon). Of course, you can always use the Ably REST API in conjunction with the MQTT adapter to access features available over REST

h2(#config). Configuration

We recommend that you always make use of "Token Authentication over Basic Authentication":/auth when trying to connect from devices you may not trust. In addition, if you're using Basic Authentication you'll be required to use SSL to connect to our adapter to ensure the API key cannot be accessed by someone listening in.

h3(#token-auth). Token Authentication

For Token Authentication you'll be required to "create a token from your own servers":/auth/token. Once you have the token, you can simply pass it through when trying to connect to Ably as the connection's @username@, leaving the @password@ empty.

If using Token Authentication, you can subscribe to a special topic, @[mqtt]tokenevents@, to get a warning when the current connection's token is about to expire. This will be a single message, sent 30 seconds before the token expires, with the 13 byte payload @expirywarning@.

On receiving this, the client is recommended to get a new token, then disconnect and reconnect with the new token themselves. If this is not done, the server will abruptly disconnect the connection once the token expires.

An example of this with the NodeJS "MQTT package":https://www.npmjs.com/package/mqtt would be:

```[nodejs]
var client = mqtt.connect('mqtts:mqtt.ably.io', options);
client.subscribe('[mqtt]tokenevents');

client.on('message', function(topic, message) {
  if(topic === '[mqtt]tokenevents') {
    /* some function that fetches a new token from an auth server */
    getNewToken(function(err, newToken) {
      if(err) {
        // error handling
        return;
      }
      /* reconnect with the new token */
      client.end();
      options.username = newToken;
      client = mqtt.connect('mqtts:mqtt.ably.io', options);
    });
    return;
  }
});
```

h2(#pub-sub). Pub/Sub with MQTT

"Ably's channels":/channels correlate to topics in MQTT. An example of how to publish and subscribe with the NodeJS "MQTT package":https://www.npmjs.com/package/mqtt would be as follows:

```[nodejs]
const mqtt = require('mqtt');
const encoding = require('text-encoding');
var decoder = new encoding.TextDecoder();
var options = {
  keepalive: 30,
  username: '{{API_KEY_NAME}}', /* API key's name */
  password: '{{API_KEY_SECRET}}', /* API key's secret */
  port: 8883
};

var client = mqtt.connect('mqtts:mqtt.ably.io', options);

client.on('message', function(topic, message) {
  console.log(decoder.decode(message));
});

client.subscribe('my_channel', function (err) {
  if (!err) {
    client.publish('my_channel', 'my_message', { qos: 0 });
  }
});
```

h2(#decode-messages). Decode messages

Any data published through or received by the MQTT adapter will be binary encoded, due to MQTT being a binary protocol. This means that you'll need to interpret the message to get the original contents out. For example, to interpret a message using Ably Realtime with JavaScript you'd need to do the following, using the "text-encoding NPM module's TextDecoder":https://www.npmjs.com/package/text-encoding to decode from binary to text:

```[javascript] 
var ably = new Ably.Realtime('{{API_KEY}}');
var decoder = new TextDecoder();
var channel = ably.channels.get('my_channel');

channel.subscribe(function(message) {
  var command = decoder.decode(message.data);
});
```

Or, if you wish to decode messages received through MQTT, you can use the following in NodeJS:

```[nodejs]
const encoding = require('text-encoding');
var decoder = new encoding.TextDecoder();
var client = mqtt.connect('mqtts:mqtt.ably.io', options);

client.on('connect', function () {
  client.subscribe('my_channel');
});

client.on('message', function (topic, message) {
  console.log(decoder.decode(message));
});
```

In the above example, @command@ will now contain the message in its original string form.

h2(#ssl-tls). SSL/TLS

We support both SSL and non-SSL connections (the latter uses a different port, see above), but strongly recommend using SSL wherever possible. If you are not using SSL, note that the same restrictions apply as if you were using an Ably client without SSL. That is, "connection attempts using Basic Authentication (i.e. an API key) are disallowed":https://faqs.ably.com/error-code-40103-invalid-use-of-basic-auth-over-non-tls-transport, and any "namespaces which you've enabled 'require TLS' on":https://faqs.ably.com/what-is-a-channel-namespace-and-how-can-i-use-them will be inaccessible. "Contact us":https://ably.com/contact if this is a problem for you.

To use the Ably MQTT protocol adapter, you'll need to ensure you correctly configure your MQTT client as follows:
* Set the host to "mqtt.ably.io"
* Set SSL / TLS to true and the port to 8883. (If your MQTT client does not support SSL, you should instead use port 1883, but in this case we disallow api-key auth—see "SSL usage note":#ssl below)
* Set the keep alive time to somewhere between 15 and 60 seconds. (60s will maximize battery life, 15s will maximize responsiveness to network issues. It must not be any higher than 60s to avoid our load balancer terminating the TCP socket for inactivity)
* If using an API key, set the username to the part of the API key before the colon, and the password to the part after the colon
* If using a token, set the username to the token, and leave the password blank

For example, in the NodeJS "MQTT package":https://www.npmjs.com/package/mqtt, you'd need to specify the following:

```[nodejs]
var options = {
  keepalive: 30,
  username: '{{API_KEY_NAME}}', /* API key's name */
  password: '{{API_KEY_SECRET}}', /* API key's secret */
  port: 8883
};

var client = mqtt.connect('mqtts:mqtt.ably.io', options);
```

This will connect using TLS through MQTT to Ably.