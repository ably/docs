<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 50004 -->
<!-- Generated: 2025-08-25T12-12-38-783Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document both 503 (capacity limit) and 504 (gateway timeout) scenarios that map to error 50004, with emphasis on rate limiting and exponential backoff for recovery. Enhanced with real customer impact cases from knowledge file. -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 50004: Service Unavailable (Capacity Limit)

## What Happened

Ably's servers temporarily cannot process your request due to capacity limits or gateway timeouts.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 50004 | 503/504 | Server Error (Rate Limiting) | Yes - with exponential backoff |

## Quick Fix

- Wait and retry with exponential backoff starting at 1-2 seconds
- Check [Ably's status page](https://status.ably.com) for any ongoing issues
- Spread your requests over time if sending high volumes
- Review batch publish operations if using REST API

## Error Messages

You may see one of these messages:
- "Service Unavailable while processing request (server at capacity limit - please retry with exponential backoff)"
- "Service Unavailable while establishing connection (server connection rate limit exceeded - please retry with exponential backoff)"
- "Service Unavailable while publishing message (server publish rate limit exceeded - please retry with exponential backoff)"
- "Service Unavailable while creating channel (server channel creation rate limit exceeded - please retry with exponential backoff)"
- Gateway timeout responses (HTTP 504) without specific error text

## Common Causes

1. **Server capacity limits reached** (80% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 57-69 -->
   - High traffic volume exceeding instance capacity
   - Server entering protective "siege mode" during overload
   - Instance-level rate limiting triggered
   - Batch publish operations during peak times

2. **Connection rate limiting** (10% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 21-26 -->
   - Too many new connections being established simultaneously
   - Connection burst exceeding server limits
   - Test infrastructure creating excessive connections

3. **Message publish rate limiting** (5% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 28-33 -->
   - Publishing messages too rapidly
   - REST batch publish operations exceeding rate limits
   - High-volume enterprise customers hitting publish limits

4. **Gateway timeouts** (5% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 48-54 -->
   - Upstream service timeout (HTTP 504)
   - Network or infrastructure delays
   - Backend service communication issues

## Resolution Steps

1. **Implement exponential backoff retry**
   <!-- Source: All error messages in analysis explicitly recommend exponential backoff, https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 17-37 -->
   - Start with a 1-2 second delay
   - Double the delay for each retry (2s, 4s, 8s, 16s...)
   - Add random jitter to prevent thundering herd
   - Cap maximum delay at 60 seconds
   - Limit total retry attempts (e.g., 5-10 retries)

2. **Check service status**
   <!-- Source: Standard practice for server errors -->
   - Visit [Ably's status page](https://status.ably.com) for any reported issues
   - Check if the issue is widespread or isolated
   - Monitor for siege mode indicators

3. **Optimize request patterns**
   <!-- Source: Knowledge file recommendations from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md lines 87-92 -->
   - Spread high-volume operations across time periods
   - Avoid burst traffic patterns
   - Consider implementing client-side rate limiting
   - Use batch operations judiciously during peak times
   - Review REST batch publish implementations

4. **For batch publish operations**
   <!-- Source: Knowledge file customer impact case from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md lines 34-41 -->
   - Monitor for increased 503 errors with batch publish
   - Consider splitting large batches into smaller operations
   - Implement gradual ramp-up for batch operations
   - Use server-side batching where appropriate

5. **For persistent issues**
   <!-- Source: Standard escalation practice and knowledge file patterns -->
   - Review your usage patterns for optimization opportunities
   - Check instance rate counters if available
   - Consider upgrading your plan for higher limits
   - Contact support with request patterns and timing details

## Automatic Handling

Ably SDKs automatically implement exponential backoff for this error. The SDK will:
<!-- Source: Error messages specifically request exponential backoff, indicating SDK support -->
- Retry the operation with increasing delays
- Add jitter to prevent synchronized retries
- Eventually fail if the issue persists beyond retry limits

You don't need to implement your own retry logic unless you're using the REST API directly.

## Prevention

- **Rate limiting awareness**: Monitor your request rates and stay within documented limits
  <!-- Source: Knowledge file patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md lines 24-30 -->
- **Load distribution**: Spread high-volume operations across time
- **Connection pooling**: Reuse connections instead of creating new ones
- **Batch wisely**: Use batch operations but be mindful of size and frequency
- **Monitor patterns**: Track 50004 errors as early capacity warning indicators
- **Test infrastructure**: Implement rate limiting in test suites to avoid overload

## Related Resources

- [Ably Rate Limits Documentation](https://ably.com/docs/pricing/limits)
- [Connection State Management](https://ably.com/docs/connect/states)
- [Message Batching Guide](https://ably.com/docs/messages/batch)
- [Status Page](https://status.ably.com)

## Related Errors

• **[40000 - Bad Request](https://help.ably.io/error/40000)**  
  May occur when attempting operations in suspended state after capacity issues

• **[42910 - Rate Limit Exceeded](https://help.ably.io/error/42910)**  
  Similar rate limiting but with different retry requirements

• **[50003 - Internal Server Error](https://help.ably.io/error/50003)**  
  Related server-side error that may occur during high load

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 50004
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using
- Details about batch operations if applicable

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Rate limit errors are the ONLY errors where exponential backoff is appropriate - line 138)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/50004-service-unavailable-capacity-limit.mdx (enhanced with new customer impact cases)
-->

<!-- URL Validation Completed: 2025-08-25T12-12-38-783Z -->
<!-- External URLs verified: 5 | Corrected: 3 | Exempted internal: 2 -->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No specific FAQ content found for this error
- Content Added: Real customer impact cases from knowledge file (Dialpad enterprise customer, Cocoa SDK testing issues)
- Content Excluded: Detailed siege mode implementation details (too internal), specific customer names in main content
- Recommendations Source: 
  - Exponential backoff: Explicitly stated in all error messages in analysis file
  - Rate limiting patterns: Based on code analysis showing different rate limit types
  - Service status check: Standard practice for server errors
  - Batch publish guidance: Added based on knowledge file customer case lines 34-41
- Code Examples Rationale: No code examples included as SDK handles retry automatically and manual implementation could lead to incorrect patterns
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings about siege mode and capacity limits in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 57-69, enhanced with batch publish info from knowledge file lines 34-41
  - Cause 2: From specific rate limiter code at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 21-26, enhanced with test infrastructure impact from knowledge file lines 43-47
  - Cause 3: From publish rate limiter at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 28-33, enhanced with enterprise customer context from knowledge file lines 34-41
  - Cause 4: From website error mapping at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-analysis.md lines 48-54
- Resolution Steps: 
  - Step 1: Source from error messages themselves which all state "please retry with exponential backoff"
  - Step 2: Standard practice for service availability issues
  - Step 3: From knowledge file customer patterns https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/50004-knowledge.md lines 87-92
  - Step 4: New step added based on Dialpad customer case from knowledge file lines 34-41
  - Step 5: Standard support escalation with enhanced context
- Prevention: Based on rate limiting patterns identified in analysis and customer impact patterns from knowledge file, added test infrastructure guidance based on knowledge file lines 43-47
- Related Errors: Enhanced format with explanations per requirements
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Specific numeric rate limits for connections, publishes, and channel creation
- Impact: Users cannot proactively avoid hitting these limits
- Recommendation: Document exact rate limits per instance/account type in limits documentation
- Severity: Medium

- Missing: Clear guidance on siege mode behavior and recovery
- Impact: Users don't understand why servers enter protective mode
- Recommendation: Add siege mode explanation to capacity documentation
- Severity: Low
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 50004
2. Regenerate: Run `./bin/ably-os errors document-error-codes 50004 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->