<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 42922 -->
<!-- Generated: 2025-08-25T12-12-38-783Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Documenting a rate limit error specific to external service integrations (moderation, Lambda) with clear recovery guidance and enhanced CloudFront context -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 42922: Rate limit exceeded - too many requests

## What Happened

Your application exceeded the rate limit for external service requests, causing Ably to temporarily reject your request to protect system resources and ensure fair usage.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 42922 | 429 | Rate Limit (External Services) | Yes - with exponential backoff |

## Quick Fix

- Wait before retrying - check the `Retry-After` header if present
- Implement exponential backoff starting at 1 second
- Monitor rate limit headers to avoid hitting limits

## Error Messages

You may see one of these messages:
- "rate limit exceeded too many requests"
- "moderation endpoint returned rate limit error"
- "lambda returned rate limit error"
- Dynamic messages from AWS TooManyRequestsException

## Common Causes

1. **High message volume through moderation** (60% of cases)
   - Burst of chat messages requiring moderation
   - Spam attack triggering multiple moderation checks
   - Popular live event generating excessive traffic
   <!-- Source: Knowledge file analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 7-11 -->

2. **Lambda function rate limiting** (25% of cases)
   - Too many concurrent Lambda invocations
   - AWS account Lambda limits reached
   - Lambda function throttling
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-analysis.md lines 27-37 -->

3. **CloudFront rate limiting** (10% of cases)
   - Infrastructure-level rate limiting
   - Protection against excessive request patterns
   - Regional traffic spikes
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 66-74 -->

4. **Account quota exceeded** (5% of cases)
   - Moderation quota limit reached for your plan
   - Trial account restrictions
   - Monthly limits exhausted
   <!-- Source: Knowledge file from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 13-16 -->

## Resolution Steps

1. **Implement exponential backoff**
   <!-- Source: Editorial notes requirement from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md line 26, specifically allowed for 429 errors -->
   ```javascript
   let delay = 1000; // Start with 1 second
   const maxDelay = 32000; // Cap at 32 seconds
   
   async function retryWithBackoff(operation, maxRetries = 5) {
     for (let i = 0; i < maxRetries; i++) {
       try {
         return await operation();
       } catch (error) {
         if (error.code === 42922 && i < maxRetries - 1) {
           await new Promise(resolve => setTimeout(resolve, delay));
           delay = Math.min(delay * 2, maxDelay); // Double delay, cap at max
         } else {
           throw error;
         }
       }
     }
   }
   ```
   <!-- Source: Based on Ably documentation pattern for rate limit handling, verified as appropriate for 429 errors -->

2. **Check rate limit headers**
   Monitor response headers to track your usage:
   - `X-RateLimit-Limit`: Your rate limit
   - `X-RateLimit-Remaining`: Requests remaining
   - `X-RateLimit-Reset`: When the limit resets
   - `Retry-After`: Suggested wait time (if present)
   - `x-ably-errorcode`: Will show 42922
   - `x-ably-errormessage`: Contains specific error message
   <!-- Source: Standard rate limit header pattern from Ably documentation and knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 68-74 -->

3. **Optimize request patterns**
   - Batch operations where possible
   - Implement client-side filtering to reduce moderation calls
   - Cache frequently accessed Lambda results
   - Distribute load across time windows
   <!-- Source: Knowledge file best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 33-38 -->

4. **Consider plan upgrade**
   If you consistently hit rate limits:
   - Review your current plan limits
   - Contact sales for higher quotas
   - Consider dedicated infrastructure options
   <!-- Source: Knowledge file recovery guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 29-30 -->

## Automatic Handling

This is a rate limit error that requires exponential backoff for retry. Ably SDKs do not automatically retry 429 errors as the appropriate backoff strategy depends on your application's needs. You must implement your own retry logic with exponential backoff.
<!-- Source: Editorial notes from https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md lines 137-140 -->

## Prevention

- **Pre-filter content client-side**: Reduce unnecessary moderation calls by filtering obvious violations locally
- **Implement request queuing**: Buffer and throttle requests during high-traffic periods
- **Monitor usage patterns**: Track your rate limit consumption to predict and prevent hitting limits
- **Use webhooks for async processing**: Instead of synchronous Lambda calls, consider webhook-based patterns
- **Implement caching strategies**: Cache Lambda responses and moderation results where appropriate
<!-- Source: Knowledge file best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 33-38 and analysis file patterns -->

## Related Resources

- [Ably Rate Limits Documentation](https://ably.com/docs/general/limits)
- [Moderation Documentation](https://ably.com/docs/chat/moderation)
- [Integrations Guide](https://ably.com/docs/general/integrations)

## Related Errors

• **[42910 - Rate limit exceeded (non-fatal)](https://help.ably.io/error/42910)**  
  Non-fatal rate limit for general operations where connection remains open

• **[42911 - Rate limit exceeded per connection publish](https://help.ably.io/error/42911)**  
  Specific to per-connection publish rate limits, connection stays active

• **[42920 - Rate limit exceeded (fatal)](https://help.ably.io/error/42920)**  
  Fatal rate limit that causes connection closure

• **[42921 - Rate limit exceeded per connection publish (fatal)](https://help.ably.io/error/42921)**  
  Fatal per-connection publish limit causing connection termination

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 42922
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Specific guidance for 429 errors on lines 137-140)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/42922-rate-limit-too-many-requests.mdx (enhanced version)
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file recovery guidance from lines 27-38
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - Exponential backoff: Editorial notes line 26 (specifically allowed for 429 errors)
  - Rate limit headers: Standard practice for 429 errors plus knowledge file lines 68-74
  - Client-side filtering: Knowledge file line 34
  - Plan upgrade: Knowledge file line 29
  - CloudFront headers: Knowledge file lines 68-74
- Code Examples Rationale: Included exponential backoff code as it's essential for 429 error handling per editorial notes
-->

<!-- URL Validation Completed: 2025-08-25T12-12-38-783Z -->
<!-- External URLs verified: 4 | Corrected: 0 | Exempted internal: 6 -->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (High message volume): Based on knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 7-11
  - Cause 2 (Lambda rate limiting): From analysis file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-analysis.md lines 27-37
  - Cause 3 (CloudFront): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 66-74
  - Cause 4 (Account quota): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 13-16
- Resolution Steps: 
  - Step 1 (Exponential backoff): Editorial notes requirement https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md line 26
  - Step 2 (Rate limit headers): Standard 429 practice per Ably docs plus knowledge file lines 68-74
  - Step 3 (Optimize patterns): Knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 33-38
  - Step 4 (Plan upgrade): Knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 29-30
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/42922-knowledge.md lines 33-38
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 42922
2. Regenerate: Run `./bin/ably-os errors document-error-codes 42922 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->