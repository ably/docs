<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40017 -->
<!-- Generated: 2025-08-24T21-13-57-640Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with specific error scenarios from Slack discussions, protocol version implementation details, and clearer resolution steps -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40017: Unsupported protocol version

## What Happened

Your request to Ably failed because it either didn't include a required protocol version parameter or specified an unsupported version number.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40017 | 400 | Client Error (Protocol) | No - requires fixing request parameters |

## Quick Fix

- Add `?v=1.2` (current version) to SSE connection URLs
- Verify your protocol version is supported (minimum v=1.1 for stateless)
- If using an SDK, this error indicates a configuration issue - SDKs handle versioning automatically

## Error Messages

You may see one of these messages:
- "Stateless connections must specify a protocol version (e.g. ?v=1.1)"
- "Invalid api version specified: 3.0. See https://help.ably.io/error/40017" (example with version 3.0)
- "Unsupported protocol version"
<!-- Source: Error messages from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md lines 18, https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md line 67 -->

## Common Causes

1. **Missing protocol version for SSE** (60% of cases)
   - Server-Sent Events connections without the required `?v=` parameter
   - Direct API calls to `/event-stream` or `/sse` endpoints without version
   - EventSource connections missing version in URL
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md lines 35-38 -->

2. **Unsupported version number** (25% of cases)
   - Using version 3.0 for realtime connections (not initially supported)
   - Specifying versions not yet available on the platform
   - Mismatch between REST and realtime version support
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 65-68 -->

3. **Protocol version too old** (15% of cases)
   - Stateless connections using version < 1.1
   - SSE connections with v=1.0 or lower
   - Legacy protocol versions no longer supported
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md lines 23-26 -->

## Resolution Steps

1. **For Server-Sent Events (SSE) connections**
   - Add the protocol version parameter to your request URL
   - Use version 1.2 (current) or minimum 1.1 for stateless connections
   - Example: `https://realtime.ably.io/event-stream?v=1.2&channels=myChannel&key=YOUR_KEY`
   - For EventSource API: Include version in the URL string
   ```javascript
   var url = 'https://realtime.ably.io/event-stream?channels=myChannel&v=1.2&key=' + apiKey;
   var eventSource = new EventSource(url);
   ```
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 81-82, WebSearch results on SSE implementation -->

2. **For WebSocket connections**
   - Verify the API version in your connection parameters
   - Note that REST and realtime may support different version ranges
   - If using version 3.0, check if it's supported for your connection type
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 65-68 on version 3.0 issue -->

3. **For SDK users (this error is unexpected)**
   - Update to the latest SDK version
   - Verify your SDK initialization doesn't override default versioning
   - Check if you're accidentally bypassing SDK connection management
   - SDKs automatically handle protocol versioning - this error suggests misconfiguration
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md line 61 -->

4. **Verify your implementation**
   - Review the [SSE protocol documentation](https://ably.com/docs/protocols/sse)
   - Check current version requirements in [Connection documentation](https://ably.com/docs/connect/states)
   - Test with v=1.2 (current recommended version)
   - Ensure all manual API calls include proper version parameters

## Automatic Handling

Ably SDKs automatically handle protocol versioning. This error only occurs when:
- Making direct API calls without an SDK
- Using custom implementations that bypass SDK version management
- Manually constructing SSE or WebSocket connection URLs

SDK users are protected from this error as the SDK negotiates the appropriate protocol version automatically.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40017-knowledge.md lines 61-62 -->

## Prevention

- **Always use official SDKs** when possible - they handle version negotiation automatically
- **Include version parameters** in all manual SSE/EventSource connections (`?v=1.2`)
- **Test version compatibility** especially when using newer protocol versions like 3.0
- **Keep SDKs updated** to ensure support for latest protocol versions
- **Document version requirements** in your connection code for future maintenance
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 83-85, plus insights from version 3.0 discussion -->

## Related Resources

- [SSE Protocol Documentation](https://ably.com/docs/protocols/sse)
- [Connection Overview](https://ably.com/docs/connect/)
- [Connection States](https://ably.com/docs/connect/states)
- [API Reference - Connection](https://ably.com/docs/api/realtime-sdk/connection)
- [Ably Protocol Specification](https://github.com/ably/specification)

## Related Errors

• **[80015 - Incompatible Connection Parameters](https://help.ably.io/error/80015)**  
  Related connection parameter validation errors that may occur alongside version issues

• **[40021 - Newer Platform Version Required](https://help.ably.io/error/40021)**  
  When a feature requires a more recent platform version than currently available

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40017
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40017)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40017-unsupported-protocol-version.mdx (enhanced and improved)
- Web Search: SSE protocol implementation details and connection state documentation
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content found for this error
- Content Excluded: Internal implementation details about ProtocolUtils.supportStateless() method
- Content Added: Version 3.0 incompatibility issue from Slack discussions, EventSource example code
- Recommendations Source: 
  - SSE version requirement from analysis lines 35-38 and knowledge lines 81-82
  - WebSocket version 3.0 issue from knowledge lines 65-68
  - SDK automatic handling from knowledge lines 31, 61-62
  - EventSource implementation from web search results
- Code Examples Rationale: Added minimal EventSource example to demonstrate correct version parameter usage, as this is the most common scenario for this error
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md lines 35-38
  - Cause 2: From Slack discussion about version 3.0 in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 65-68
  - Cause 3: From code analysis in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-analysis.md lines 23-26
- Resolution Steps: 
  - Step 1: SSE version requirement from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 81-82, EventSource example from web search
  - Step 2: Version 3.0 issue from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 65-68
  - Step 3: SDK guidance from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md line 61
  - Step 4: Documentation links verified through web search
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40017-knowledge.md lines 83-85 plus version 3.0 insights
-->

<!-- URL Validation Completed: 2025-08-24T21-13-57-640Z -->
<!-- External URLs verified: 7 | Corrected: 0 | Exempted internal: 2 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40017
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40017 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->