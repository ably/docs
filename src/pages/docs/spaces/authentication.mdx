---
title: Spaces authentication
meta_description: "Configure authentication for Spaces applications with the required capabilities."
---

Spaces authentication is handled by the underlying Pub/Sub SDK. You authenticate an Ably Realtime client, then pass that authenticated client into `Spaces`.

## How Spaces maps to channels

A logical space is implemented using underlying Pub/Sub channels. Capability expressions should account for both channel types:

- Main space channel: `your-space` (presence and member locations)
- Cursors channel: `your-space::$cursors` (high-frequency cursor updates)

## Authentication flow

1. Your auth server authenticates the user.
2. Your auth server issues an Ably-compatible token (JWT format is recommended for most apps).
3. The client SDK fetches tokens with `authCallback` and refreshes them automatically before expiry.
4. The authenticated Pub/Sub client is passed into `Spaces`.

<Aside data-type='important'>
Never use API keys in client-side code. API keys do not expire and are not suitable for untrusted clients.
</Aside>

## Spaces capabilities

| Feature area | Required capabilities |
|--------------|-----------------------|
| Member locations and avatar stack | `subscribe`, `presence` |
| Live cursors | `publish`, `subscribe` |
| Component locking | `subscribe`, `presence` |
| History-aware collaboration | `history` |

## Space-scoped capabilities

<Code>
```javascript
// Server-side JWT with space-scoped capabilities
import jwt from 'jsonwebtoken';

const [keyName, keySecret] = process.env.ABLY_API_KEY.split(':');

const ablyJwt = jwt.sign(
  {
    'x-ably-capability': JSON.stringify({
      'your-space': ['publish', 'subscribe', 'presence', 'history'],
      'your-space::$cursors': ['publish', 'subscribe'],
    }),
    'x-ably-clientId': userId,
  },
  keySecret,
  { algorithm: 'HS256', keyid: keyName, expiresIn: '1h' }
);
```

```python
# Server-side JWT with space-scoped capabilities
import jwt
import json
import time
import os

key_name, key_secret = os.environ['ABLY_API_KEY'].split(':')

now = int(time.time())
ably_jwt = jwt.encode(
    {
        'iat': now,
        'exp': now + 3600,
        'x-ably-capability': json.dumps({
            'your-space': ['publish', 'subscribe', 'presence', 'history'],
            'your-space::$cursors': ['publish', 'subscribe'],
        }),
        'x-ably-clientId': user_id,
    },
    key_secret,
    algorithm='HS256',
    headers={'kid': key_name}
)
```
</Code>

## Client examples

### JavaScript

<Code>
```javascript
import Spaces from '@ably/spaces';
import { Realtime } from 'ably';

const realtimeClient = new Realtime({
  authCallback: async (tokenParams, callback) => {
    try {
      const response = await fetch('/api/ably-token', { credentials: 'include' });
      if (!response.ok) throw new Error('Auth failed');
      const jwt = await response.text();
      callback(null, jwt);
    } catch (error) {
      callback(error, null);
    }
  },
});

const spaces = new Spaces(realtimeClient);
```
</Code>

### React

<Code>
```react
import { useMemo } from 'react';
import Spaces from '@ably/spaces';
import { Realtime } from 'ably';

export function App() {
  const realtimeClient = useMemo(
    () =>
      new Realtime({
        authCallback: async (tokenParams, callback) => {
          try {
            const response = await fetch('/api/ably-token', { credentials: 'include' });
            if (!response.ok) throw new Error('Auth failed');
            callback(null, await response.text());
          } catch (error) {
            callback(error, null);
          }
        },
      }),
    []
  );

  const spaces = useMemo(() => new Spaces(realtimeClient), [realtimeClient]);

  return <YourSpacesUI spaces={spaces} />;
}
```
</Code>

In each example, the authenticated Pub/Sub client is passed into `Spaces` and Spaces uses that connection for authentication and token renewal.

## Token lifecycle and permission updates

- With `authCallback` or `authUrl`, token refresh is automatic and handled by the SDK.
- To change a user's capabilities during an active session, issue a new token from your auth server and re-authenticate.
- To immediately remove access, revoke issued tokens.
- If your capability JSON is too large for JWT or must remain confidential, use native [Ably Tokens](/docs/auth/ably-tokens).

<Code>
```javascript
// Re-authenticate to pick up updated capabilities
await realtimeClient.auth.authorize();
```
</Code>
