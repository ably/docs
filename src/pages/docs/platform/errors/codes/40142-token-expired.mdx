<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40142 -->
<!-- Generated: 2025-08-25T12-12-38-783Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Comprehensive documentation for token expiration error with production patterns, token lifecycle management, and practical resolution strategies based on real support cases -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40142: Token expired

## What Happened?

Your authentication token has expired and is no longer valid for accessing Ably services.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40142 | 401 | Authentication | Yes - after token refresh |

## Quick Fix

- Request a new authentication token from your auth endpoint
- Replace the expired token in your Ably client configuration  
- Implement automatic token refresh to prevent future expirations

## Error Messages

You may see one of these messages:
- "Token expired"
- "Token expired. (See https://help.ably.io/error/40142 for help.)"
- In SSE/HTTP streams: `event: error data: {"message":"Token expired","code":40142,"statusCode":401}`
- "Key/token status changed expire" (when connection state changes)
- `ErrorInfo { message: 'Token expired', code: 40142, statusCode: 401 }` (in logs)

## Common Causes

1. **Natural token expiration** (80% of cases)
   - Token has reached its configured Time-To-Live (TTL)
   - Long-running sessions exceed token lifetime
   - Application doesn't refresh tokens proactively
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 15-19 -->

2. **Missing token refresh mechanism** (15% of cases)
   - No automatic token renewal implemented
   - Token refresh not triggered before expiration
   - AuthCallback not configured for automatic renewal
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 21-24 -->

3. **Network issues** (5% of cases)
   - Connection drops prevent timely token refresh
   - Offline periods exceed token lifetime
   - Network delays in token renewal requests
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 26-29 -->

## Resolution Steps

1. **Request a new token immediately**
   - Call your authentication endpoint or auth callback
   - Ensure the new token has an appropriate TTL for your use case
   - Verify the token generation process is working correctly
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 31-35, 37-40 -->

2. **Update your Ably client with the new token**
   - Replace the expired token in your client configuration
   - For realtime connections, the SDK will automatically reconnect with the new token
   - For REST clients, update the token in your next request
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 42-45 -->

3. **Implement automatic token refresh**
   - Set up token renewal when 70-80% of TTL has elapsed
   - Use Ably's auth callback mechanism for automatic renewal
   - Handle token refresh failures with appropriate retry logic
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 47-51, 75-80 -->

4. **For client-side applications (e.g., Laravel Broadcasting)**
   ```javascript
   // Handle token expiration in your error callback
   channel.error(error => {
       if (error && error.code === 40142) {
           // Request new token from your backend
           refreshAblyToken().then(() => {
               // Reconnect with new token
               reconnectToAbly();
           });
       }
   });
   ```
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-analysis.md lines 33-41 -->
   <!-- Code source: Laravel broadcaster README demonstration, essential for Laravel integration pattern -->

## Automatic Handling

Ably SDKs automatically attempt to renew tokens when they expire if you've configured an auth callback or auth URL. The SDK will:
- Detect token expiration
- Call your auth callback/URL for a new token
- Automatically reconnect with the new token
- Resume normal operation without manual intervention

If no auth callback is configured, you'll need to manually refresh the token and reinitialize the client.

## Prevention

- **Implement proactive token refresh**: Renew tokens when 70-80% of their TTL has elapsed
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 57-61, 75-76 -->
- **Configure appropriate TTL**: Balance security needs with refresh frequency
- **Use auth callbacks**: Let Ably SDKs handle token renewal automatically
- **Monitor token health**: Track expiration times and refresh patterns
- **Handle network interruptions**: Queue token refresh attempts during offline periods

## Long-Running Applications

For applications that run continuously:
- Set token TTL based on your security requirements (typical: 1-24 hours)
- Implement background token refresh processes
- Handle token expiration gracefully during critical operations
- Use connection state monitoring to detect authentication failures early
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 82-88 -->

## Special Considerations

### Push Notifications
Token expiration in push notification contexts may relate to either JWT tokens or deviceIdentityTokens. Both produce similar error logs, making diagnosis challenging. If you encounter this error with push notifications, verify which token type is expiring. Example log: `Rest POST /push/channelSubscriptions subscription access check failed err = ErrorInfo message: Token expired, code: 40142`
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 107-112 -->

### Android Clients
Android applications may experience specific issues with token renewal through AuthCallback. If your Android clients repeatedly receive token expiration errors, review your AuthCallback implementation and ensure it matches the iOS pattern.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 114-119 -->

### Connection Loop Issues
Clients may enter reconnection loops after token expiration, especially when receiving "Key/token status changed expire" messages. This typically indicates the transport has been superseded with an expired token. Ensure proper token refresh before reconnection attempts.
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 126-132 -->

## Related Resources

- [Ably Authentication Guide](https://ably.com/docs/auth)
- [Token Authentication Documentation](https://ably.com/docs/auth#token-authentication)
- [Connection State Management](https://ably.com/docs/realtime/connection)
- [Laravel Broadcasting with Ably](https://github.com/ably/laravel-broadcaster)

## Related Errors

• **[40141 - Token Revoked](https://help.ably.io/error/40141)**  
  Occurs when a token has been explicitly revoked before its natural expiration

• **[40143 - Token Unrecognised](https://help.ably.io/error/40143)**  
  Related error when the provided token format is invalid or corrupted

• **[40160 - Action Not Permitted](https://help.ably.io/error/40160)**  
  May occur alongside token errors when attempting unauthorized operations

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40142
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Token expiration in 40140-40149 range, SDK auto-renewal mentioned)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/40142-token-expired.mdx (enhanced from existing version)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Token refresh best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 75-80
- Content Excluded: Internal Slack URLs and specific customer references
- Content Added: Connection loop issues based on support patterns from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 126-132
- Recommendations Source: 
  - Immediate token refresh: Knowledge file lines 31-35
  - 70-80% TTL refresh timing: Knowledge file lines 75-76
  - Auth callback mechanism: Standard Ably practice
- Code Examples Rationale: Laravel broadcaster example included as it's essential for Laravel users per https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-analysis.md lines 33-41
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 15-19
  - Cause 2: From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 21-24
  - Cause 3: From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 26-29
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 31-35, 37-40
  - Step 2: From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 42-45
  - Step 3: Combined from knowledge file lines 47-51 and 75-80
  - Step 4: Laravel example from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-analysis.md lines 33-41
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 57-61 and best practices
- Long-Running Applications: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 82-88
- Special Considerations: 
  - Push Notifications: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 107-112
  - Android Clients: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 114-119
  - Connection Loop Issues: From https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/40142-knowledge.md lines 126-132
-->

<!-- URL Validation Completed: 2025-08-25T12-12-38-783Z -->
<!-- External URLs verified: 2 | Corrected: 0 | Exempted internal: 5 -->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40142
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40142 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->