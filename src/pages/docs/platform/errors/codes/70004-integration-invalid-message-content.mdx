<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 70004 -->
<!-- Generated: 2025-08-25T05-37-30-332Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation building on existing content with updated research findings about AWS SQS empty body validation as the primary implementation -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 70004: Integration invalid message content

## What happened

The Ably Integration service rejected a message because its contents don't meet the requirements of the destination service (like AWS SQS, webhooks, or functions).

## Quick reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 70004 | 400 | Client Error (Integration) | No - requires fixing message content |

## Quick fix

- Ensure message body is not empty (AWS SQS requirement)
- Validate message data is properly formatted JSON
- Check message size is within integration limits

## Error messages

You may see:
- "SQS does not allow empty message body."
- General integration content validation failures

## Common causes

1. **Empty message body** (most common with AWS SQS)
   - Publishing null or undefined message data
   - Missing message content when SQS integration is active
   - Publishing messages without a data field
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md lines 16-23 -->

2. **Invalid JSON in message data**
   - Malformed JSON that cannot be parsed
   - Circular references in object data
   - Unsupported data types for serialization
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 11-15 -->

3. **Message content issues**
   - Binary data that cannot be serialized for webhook delivery
   - Character encoding problems (non-UTF-8 content)
   - Message size exceeding integration limits
   - Schema mismatch with integration expectations
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 11-15 -->

## Resolution steps

1. **For AWS SQS integrations: Ensure non-empty message body**
   - Never publish empty or null messages to channels with SQS rules
   - Always include at least minimal content in the message data field
   - Example of valid message publishing:
   ```javascript
   // ❌ Wrong: Empty message body
   channel.publish({ name: 'event' }); // No data field
   channel.publish('event', null);     // Null data
   channel.publish('event', '');       // Empty string
   channel.publish('event', undefined); // Undefined data
   
   // ✅ Correct: Include message content
   channel.publish('event', { content: 'data' });
   channel.publish('event', 'message text');
   channel.publish('event', { status: 'active' });
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md lines 16-23, code example based on SQS requirements -->

2. **Validate message format before publishing**
   - Ensure all data is properly serializable
   - Test JSON serialization before sending
   - Remove circular references from objects
   ```javascript
   // Test serialization before publishing
   try {
     JSON.stringify(messageData);
     channel.publish('event', messageData);
   } catch (error) {
     console.error('Message cannot be serialized:', error);
   }
   ```
   <!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 26-30 -->

3. **Review integration configuration**
   - Check the specific requirements of your integration type
   - Verify message format expectations for your webhook/queue
   - Ensure size limits are not exceeded
   - Review the integration rule settings in your Ably dashboard
   <!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 32-40 -->

4. **Test with simple messages**
   - Start with basic string messages to verify integration works
   - Gradually add complexity to identify problematic content
   - Use Ably's message inspector to examine message structure
   ```javascript
   // Start with simple test
   channel.publish('test', 'simple string');
   
   // Then try structured data
   channel.publish('test', { simple: 'object' });
   ```
   <!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 42-45 -->

## Automatic handling

This is a validation error that will not be automatically retried. You must fix the message content before the integration can process it successfully.

## Prevention

- **Input validation**: Always validate message data before publishing
- **Consistent serialization**: Use standard JSON serialization methods
- **Size management**: Keep message payloads within documented limits
- **Type safety**: Ensure data types match integration requirements
- **Character encoding**: Use UTF-8 encoding for all text content
- **Schema validation**: Implement client-side validation before publishing
<!-- Source: Knowledge prevention strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 47-52 -->

## Related resources

- [Ably Integrations documentation](https://ably.com/docs/integrations)
- [AWS SQS integration guide](https://ably.com/docs/general/firehose/sqs-rule)
- [Message format guidelines](https://ably.com/docs/realtime/messages)
- [Integration limits](https://ably.com/docs/pricing/limits)

## Related errors

• **[70000 - Integration operation failed](https://help.ably.io/error/70000)**  
  General integration failure that may occur alongside content validation issues

• **[70001 - Integration post operation failed](https://help.ably.io/error/70001)**  
  Occurs when the integration endpoint itself fails after content validation passes

• **[70003 - Integration concurrent request limit](https://help.ably.io/error/70003)**  
  May appear if retrying invalid messages causes request queuing

## Need further help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 70004
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (Section on Reactor -> Integrations lines 235-237)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/70004-integration-invalid-message-content.mdx (enhanced and updated)
- Repository Overviews: Not needed for this error
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file prevention strategies (lines 47-52), troubleshooting steps (lines 24-45)
- Content Excluded: Complex historical Slack discussion context (kept user-focused)
- Recommendations Source: 
  - SQS empty body validation from analysis lines 16-23
  - General validation advice from knowledge lines 26-45
  - Prevention strategies from knowledge lines 47-52
- Code Examples Rationale: Included simple examples showing wrong vs right message publishing for SQS based on the specific error implementation found in analysis, and serialization testing based on knowledge recommendations
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Empty message): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md lines 16-23
  - Cause 2 (Invalid JSON): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 11-15
  - Cause 3 (Content issues): From knowledge file https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 11-15
- Resolution Steps: 
  - Step 1 (SQS empty body): Source from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-analysis.md lines 16-23 - specific SQS implementation
  - Step 2 (Validate format): Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 26-30
  - Step 3 (Review config): Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 32-40
  - Step 4 (Test messages): Knowledge advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 42-45
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/70004-knowledge.md lines 47-52 with additional schema validation recommendation
-->

<!-- URL Validation Completed: 2025-08-25T05-37-30-332Z -->
<!-- External URLs verified: 5 | Corrected: 1 | Exempted internal: 3 -->
<!-- Corrected: General integrations URL updated to more specific /integrations path -->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Specific documentation about SQS empty message body requirements in integration docs
- Impact: Users may not know about this specific validation requirement until they encounter the error
- Recommendation: Add explicit note in AWS SQS integration guide about non-empty message requirement
- Severity: Medium - causes confusion when error occurs
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 70004
2. Regenerate: Run `./bin/ably-os errors document-error-codes 70004 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->