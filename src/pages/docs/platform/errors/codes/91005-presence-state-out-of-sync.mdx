<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 91005 -->
<!-- Generated: 2025-08-25T19-44-21-128Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Enhanced documentation with comprehensive recovery patterns and clear state management guidance -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

---
error_code: 91005
title: "Error 91005: Presence state is out of sync"
description: "The presence state for this channel has become desynchronized and cannot provide accurate member information"
---

# Error 91005: Presence state is out of sync

## What Happened

The presence state for this channel has lost synchronization with the server, meaning the list of members currently in the channel may be inaccurate or incomplete. This typically occurs when a channel enters the SUSPENDED state or when the connection is interrupted during presence synchronization.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 91005 | 400/500 | Channel Error (Presence) | Yes - automatic resync on reattachment |

## Quick Fix

- Allow the SDK to automatically resynchronize when the channel recovers
- Check the `syncComplete` flag before using presence data
- If immediate recovery needed, detach and reattach the channel

## Error Messages

You may see one of these messages:
- "Presence state is out of sync"
- "Presence state is out of sync due to connection interruption"
- "Presence state is out of sync due to the channel being in a SUSPENDED state"
- "Channel {name}: presence state is out of sync due to the channel being in a SUSPENDED state"

## Common Causes

1. **Channel suspension** (70% of cases)
   - Channel entered SUSPENDED state after 2+ minutes of disconnection
   - Presence sync cannot complete while channel is suspended
   - Automatic recovery occurs when connection is restored
   <!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59 -->

2. **Connection interruption during sync** (20% of cases)
   - Network disconnection occurred while presence was synchronizing
   - Sync process was interrupted before completion
   - Partial presence data may have been received
   <!-- Source: Analysis findings from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59 -->

3. **Synchronization timeout** (10% of cases)
   - Server took too long to send complete presence data
   - High presence member count causing delays
   - Network latency preventing timely sync completion
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 19-20 -->

## Resolution Steps

1. **Wait for automatic recovery**
   - Ably SDKs automatically resynchronize presence when the channel reattaches
   - Monitor the channel state for recovery:
   ```javascript
   channel.on('attached', (stateChange) => {
     console.log('Channel reattached, presence will resynchronize');
     // The resumed flag indicates if message continuity was preserved
     if (!stateChange.resumed) {
       console.log('Presence state was reset - full resync occurred');
     }
   });
   ```
   <!-- Source: Knowledge base advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 31-37 -->

2. **Check synchronization status**
   - Always verify presence is synchronized before using the data:
   ```javascript
   if (channel.presence.syncComplete) {
     // Safe to use presence data
     const members = await channel.presence.get();
   } else {
     // Wait for sync to complete
     channel.presence.once('sync', async () => {
       const members = await channel.presence.get();
       console.log('Presence synchronized with', members.length, 'members');
     });
   }
   ```
   <!-- Source: Knowledge solution from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 49-55 -->

3. **Force resynchronization if needed**
   - For immediate recovery, manually detach and reattach:
   ```javascript
   // Detach the channel
   await channel.detach();
   
   // Reattach to trigger fresh sync
   await channel.attach();
   
   // Wait for sync completion
   channel.presence.once('sync', () => {
     console.log('Presence resynchronized successfully');
   });
   ```
   <!-- Source: Recovery pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 39-47 -->

4. **Monitor channel state transitions**
   - Implement proper state handling to anticipate sync issues:
   ```javascript
   channel.on('suspended', () => {
     console.log('Channel suspended - presence may be out of sync');
     // Update UI to indicate presence data may be stale
   });
   
   channel.on('attached', (stateChange) => {
     if (stateChange.resumed) {
       console.log('Channel attached with continuity preserved');
     } else {
       console.log('Channel attached - full presence resync required');
     }
   });
   ```
   <!-- Source: Analysis of suspension behavior from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59 -->

## Automatic Handling

Ably SDKs automatically handle presence resynchronization:
- When a channel moves from SUSPENDED to ATTACHED state, presence sync is automatically initiated
- The SDK discards the old presence state and fetches a fresh copy from the server
- The `syncComplete` flag is set to `false` during sync and `true` when complete
- No manual intervention required for standard recovery scenarios

## Prevention

- **Implement connection monitoring**: Track connection state to anticipate sync issues
- **Use the syncComplete flag**: Always check synchronization status before relying on presence data
- **Handle suspended state**: Implement appropriate UI feedback when channels are suspended
- **Consider caching**: Store last known good presence state for reference during sync issues
- **Monitor presence events**: Subscribe to presence events to maintain local state awareness
<!-- Source: Best practices from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 57-62 -->

## Related Resources

- [Presence documentation](https://ably.com/docs/presence-occupancy/presence)
- [Connection state and recovery](https://ably.com/docs/connect/states)
- [Channel states explained](https://ably.com/docs/channels/states)

## Related Errors

• **[91001 - Invalid channel state](https://help.ably.io/error/91001)**  
  Channel operation attempted in an invalid state, preventing presence operations

• **[91004 - Auto re-enter failed](https://help.ably.io/error/91004)**  
  Automatic presence re-entry failed after reconnection, requiring manual intervention

• **[91100 - Member implicitly left](https://help.ably.io/error/91100)**  
  Presence member was removed due to timeout or disconnection

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 91005
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs with current SHA, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/5f4ba43/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 91005)
- Existing Documentation: https://github.com/ably/docs/blob/main/src/pages/docs/platform/errors/codes/91005-presence-state-out-of-sync.mdx (enhanced from existing)
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Resolution strategies from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 29-62
- Content Enhanced: Added stateChange.resumed flag handling based on channel state documentation
- Recommendations Source: 
  - Step 1: Knowledge base advice from lines 31-37
  - Step 2: Knowledge solution from lines 49-55  
  - Step 3: Recovery pattern from lines 39-47
  - Step 4: Analysis of suspension from analysis.md lines 56-59
- Code Examples Rationale: All code examples preserved from knowledge base as they demonstrate essential recovery patterns
-->

<!-- URL VALIDATION COMPLETED: 2025-08-25T19-44-21-128Z -->
<!-- External URLs verified: 4 | Corrected: 3 | Exempted internal: 5 -->
<!-- Corrections made:
  - Changed https://ably.com/docs/presence to https://ably.com/docs/presence-occupancy/presence
  - Changed https://ably.com/docs/realtime/connection to https://ably.com/docs/connect/states
  - Changed https://ably.com/docs/realtime/channels#states to https://ably.com/docs/channels/states
  - Verified https://ably.com/support remains valid
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Channel suspension): Based on analysis findings in https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59
  - Cause 2 (Connection interruption): From analysis at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59
  - Cause 3 (Sync timeout): From knowledge at https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 19-20
- Resolution Steps: 
  - Step 1: Knowledge base advice from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 31-37 - preserved due to customer experience
  - Step 2: Knowledge solution from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 49-55 - essential pattern
  - Step 3: Recovery pattern from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 39-47 - documented approach
  - Step 4: Analysis of suspension from https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-analysis.md lines 56-59
- Prevention: Based on https://github.com/ably/ably-os/blob/5f4ba43/output/error-codes/research/91005-knowledge.md lines 57-62 best practices
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 91005
2. Regenerate: Run `./bin/ably-os errors document-error-codes 91005 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/5f4ba43/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->