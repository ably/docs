<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 90004 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Documenting a non-fatal channel recovery error that occurs when message cache limits are exceeded during rewind/resume operations -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 90004: Message Limit Exceeded

## What Happened

Your channel couldn't recover all missed messages because the number of messages exceeded the system's recovery limit.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 90004 | 404 | Channel Error (Recovery/Resume) | No - partial recovery succeeded |

## Quick Fix

- Channel remains functional with partial message recovery
- Use the History API to retrieve messages beyond the recovery limit
- Reduce rewind parameters to request fewer messages

## Error Messages

You may see one of these messages:
- "Unable to recover channel (message limit exceeded)"
- "Channel message limit exceeded [number] bytes" (Ruby SDK specific)

## Common Causes

1. **Long disconnection period** (60% of cases)
   - Client disconnected for extended time
   - More messages accumulated than recovery limit allows
   - Example: 20 messages/second Ã— 50 seconds = 1000 messages, but only 100-1000 recoverable
   <!-- Source: Support case from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 27-31 -->

2. **Large rewind parameter** (30% of cases)
   - Requesting rewind with too many messages
   - Rewind timeframe contains more than 100 messages
   - Channel has high message volume in requested period
   <!-- Source: FAQ content from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 11-18 -->

3. **High-volume channels** (10% of cases)
   - Channels with rapid message rates
   - Brief disconnections on busy channels
   - Message cache fills quickly during recovery attempt
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 19-22 -->

## Resolution Steps

1. **Continue with partial recovery**
   - This is a non-fatal error - your channel remains operational
   - The connection is active with the most recent messages available
   - The `resumed` flag will be `false` indicating a message gap
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 65-67 -->

2. **Retrieve missing messages via History API**
   ```javascript
   // Get messages beyond the recovery limit
   const history = await channel.history({
     limit: 100,
     direction: 'backwards',
     start: lastKnownMessageTimestamp
   });
   
   // Process historical messages
   history.items.forEach(message => {
     processMessage(message);
   });
   ```
   <!-- Source: Support recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 29-31 -->

3. **Adjust recovery parameters**
   - For rewind, use smaller time windows or message counts
   - Consider implementing pagination for large message sets
   - Monitor channel message rates to set appropriate limits
   <!-- Source: FAQ recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 75-78 -->

4. **Implement message continuity handling**
   ```javascript
   channel.on('attached', (stateChange) => {
     if (!stateChange.resumed) {
       // Message continuity lost - fetch missing messages
       console.log('Channel attached but message continuity lost');
       fetchMissingMessages();
     }
   });
   ```
   <!-- Source: Technical implementation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 47-48 -->

## Automatic Handling

Ably SDKs treat this as a non-fatal error:
- Channel attachment proceeds despite the error
- Connection remains active and functional
- Most recent messages (up to limit) are delivered
- The `resumed` flag is set to `false` to indicate message gap

## Prevention

- **Monitor disconnection duration**: Be aware that disconnections over 2 minutes may result in message gaps
- **Use appropriate rewind values**: Keep rewind requests under 100 messages
- **Implement fallback strategies**: Always have History API retrieval as backup
- **Consider message rates**: High-volume channels need special handling for recovery

## Related Resources

- [Channel options and rewind limits](https://ably.com/docs/channels/options/rewind#limits)
- [History API documentation](https://ably.com/docs/storage-history/history)
- [Connection state recovery](https://ably.com/docs/connect/states)
- Related error: [90003 - Messages Expired](./90003-messages-expired.md)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 90004
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No error-specific notes for 90004)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Rewind function explanation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 11-18
- Support Case Knowledge: 17 Media Live incident details from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 23-31
- Content Excluded: Ruby SDK-specific byte size confusion (lines 102-121) as it appears to be an SDK bug rather than typical behavior
- Recommendations Source: History API usage from support cases, rewind adjustment from FAQ, continuity handling from code analysis
- Code Examples Rationale: Included History API example as it's the primary resolution method verified in support cases
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on 17 Media Live support case in https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 27-31
  - Cause 2: From FAQ content at https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 11-18
  - Cause 3: From code analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 19-22
- Resolution Steps: 
  - Step 1: Non-fatal nature from https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 65-67
  - Step 2: History API from support recommendation https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 29-31
  - Step 3: Rewind adjustment from FAQ https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-knowledge.md lines 75-78
  - Step 4: Continuity handling from code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/90004-analysis.md lines 47-48
- Prevention: Based on patterns from support cases and FAQ recommendations
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 90004
2. Regenerate: Run `./bin/ably-os errors document-error-codes 90004 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->