<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 102107 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document Chat SDK room lifecycle error with clear recovery steps based on code analysis -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 102107: Room invalid state

## What Happened

The Chat SDK cannot perform the requested operation because the chat room is not in the correct state.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 102107 | 400/500 | Client Error (Chat SDK) | No - requires room attachment |

## Quick Fix

- Attach the room before performing presence operations
- Wait for room to reach ATTACHED state
- Check room status before operations

## Error Messages

You may see one of these messages:
- "Can't perform operation; the room '{roomName}' is in an invalid state: {roomStatus}"
- "The room operation failed because the room was in an invalid state."
- "To perform this {feature} operation, you must first attach the room."

The `{roomName}` shows the specific room identifier, `{roomStatus}` shows the current room state, and `{feature}` indicates the operation type (e.g., presence).

## Common Causes

1. **Room not attached** (80% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 89-93 -->
   - Attempting presence operations before attaching room
   - Room in INITIALIZED, SUSPENDED, or FAILED state
   - Missing room.attach() call

2. **Room state transition failure** (15% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 29-35 -->
   - Room was ATTACHING but transitioned to non-ATTACHED state
   - Network interruption during attachment
   - Authentication issues during attachment

3. **Room in terminal state** (5% of cases)
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 48-51 -->
   - Room is FAILED or SUSPENDED
   - Previous error left room in unusable state
   - Room requires reinitialization

## Resolution Steps

1. **Attach the room before operations**
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 112-113 -->
   ```kotlin
   // Kotlin/Android
   val room = chatClient.rooms.get(roomId)
   room.attach()
   // Now safe to perform presence operations
   room.presence.enter()
   ```
   
   ```swift
   // Swift/iOS
   let room = chatClient.rooms.get(roomID: roomId)
   try await room.attach()
   // Now safe to perform presence operations
   try await room.presence.enter()
   ```

2. **Check room status before operations**
   <!-- Source: Code pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-knowledge.md lines 179-184 -->
   ```kotlin
   // Kotlin/Android
   if (room.status == RoomStatus.ATTACHED) {
       // Safe to perform operations
       room.presence.update(userData)
   } else {
       // Attach first
       room.attach()
   }
   ```

3. **Handle state transition failures**
   <!-- Source: Recovery strategy from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 114-116 -->
   ```swift
   // Swift/iOS
   do {
       try await room.presence.enter()
   } catch {
       if let ablyError = error as? ARTErrorInfo,
          ablyError.code == 102107 {
           // Attach room and retry
           try await room.attach()
           try await room.presence.enter()
       }
   }
   ```

4. **Monitor room status changes**
   <!-- Source: Analysis recommendation from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md line 116 -->
   Subscribe to room status changes to ensure operations only occur when room is attached. This prevents the error from occurring in the first place.

## Automatic Handling

The Chat SDK does not automatically retry this error. You must explicitly attach the room and retry the operation.

## Prevention

- Always call `room.attach()` before any presence operations
- Implement room status listeners to track state changes
- Use try-catch blocks around presence operations
- Wait for room attachment to complete before proceeding

## Related Resources

- [Ably Chat documentation](https://ably.com/docs/chat)
- [Chat SDK room lifecycle](https://ably.com/docs/chat/rooms)
- [Presence in Chat](https://ably.com/docs/chat/rooms#presence)
- Related errors: [80000](./80000-connection-failed.md), [91001](./91001-channel-operation-failed.md)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 102107
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 102107)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: No existing FAQ content to preserve (redirected to unknown error page)
- Content Excluded: None - all relevant information included
- Recommendations Source: 
  - Room attachment requirement: Based on analysis file lines 89-93, 112-113
  - State checking: Based on knowledge file pattern lines 179-184
  - Error handling: Based on knowledge file code examples lines 186-209
- Code Examples Rationale: Included because research shows specific code patterns needed for resolution
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Room not attached): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 89-93 and test coverage lines 88-92
  - Cause 2 (State transition): From SDK code at https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 29-35
  - Cause 3 (Terminal state): From analysis at https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 48-51
- Resolution Steps: 
  - Step 1: Source from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 112-113 - room attachment requirement
  - Step 2: Code pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-knowledge.md lines 179-184 - state checking pattern
  - Step 3: Error handling from https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-knowledge.md lines 198-209 - Swift error handling
  - Step 4: Based on https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md line 116 - status monitoring
- Prevention: Based on analysis recommendations in https://github.com/ably/ably-os/blob/main/output/error-codes/research/102107-analysis.md lines 112-116
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Detailed Chat SDK error handling guide specific to room lifecycle errors
- Impact: Developers may not understand the room state machine and when operations are valid
- Recommendation: Create comprehensive Chat SDK error handling documentation with state diagrams
- Severity: Medium - error is specific to Chat SDK which is relatively new
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 102107
2. Regenerate: Run `./bin/ably-os errors document-error-codes 102107 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->