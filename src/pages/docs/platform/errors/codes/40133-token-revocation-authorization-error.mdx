<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40133 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document token revocation authorization error with clear security boundary explanation and practical resolution steps -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40133: Token revocation authorization error

## What Happened

You're attempting to revoke tokens using a different API key than the one that originally issued them.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40133 | 401 | Client Error (Authentication) | No - requires using the correct API key |

## Quick Fix

- Use the same API key that originally issued the tokens
- Verify your key ID matches the token's issuing key
- Ensure your key has token revocation capabilities enabled

## Error Messages

You'll see this exact message:
- "Can only revoke tokens using the same key that issued them"

## Common Causes

1. **Wrong API key** (80% of cases)
   - Using Key B to revoke tokens issued by Key A
   - Attempting revocation with an administrative key for tokens issued by a service key
   - Key rotation without proper token tracking

2. **Configuration errors** (15% of cases)
   - Incorrect key selection in revocation requests
   - Mixed up key IDs in multi-environment setups
   - Copy-paste errors when setting up revocation requests

3. **Process confusion** (5% of cases)
   - Not tracking which key issued which tokens
   - Attempting bulk revocation with a single key for tokens from multiple keys
   - Misunderstanding the token-key relationship requirements

## Resolution Steps

1. **Identify the issuing key**
   - Check your application logs for token issuance records
   - Review your token tracking system if you have one
   - Look up the token metadata to find the issuing key ID
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-knowledge.md lines 34-38 -->

2. **Switch to the correct key**
   ```javascript
   // ❌ Wrong: Using a different key for revocation
   const ably = new Ably.Rest({ key: 'differentKey.id:secret' });
   await ably.auth.revokeTokens({ keyName: 'originalKey.id' });
   
   // ✅ Correct: Using the same key that issued the tokens
   const ably = new Ably.Rest({ key: 'originalKey.id:secret' });
   await ably.auth.revokeTokens({ keyName: 'originalKey.id' });
   ```
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-analysis.md lines 34-36 -->

3. **Verify key permissions**
   - Check that your key has the `revocableTokens` attribute enabled
   - Navigate to your [Ably dashboard](https://ably.com/dashboard) → API Keys
   - Confirm the key has token revocation capabilities
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-analysis.md line 45 -->

4. **Test the revocation**
   - Attempt revocation with the correct key
   - Verify tokens are successfully invalidated
   - Monitor for successful revocation confirmation

## Automatic Handling

This is a client error that will not be automatically retried. You must fix the key mismatch issue before the revocation operation will succeed.

## Prevention

- **Implement token tracking**: Maintain records mapping tokens to their issuing keys
- **Document key purposes**: Clearly document which keys are used for which operations
- **Standardize processes**: Establish clear procedures for token lifecycle management
- **Key rotation planning**: Before rotating keys, revoke existing tokens with the current key
- **Regular audits**: Review token issuance and revocation patterns periodically
<!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-knowledge.md lines 56-60 -->

## Key Rotation Best Practices

When rotating API keys:

1. **Before rotation**: Revoke all existing tokens using the current key
2. **During rotation**: Create the new key with appropriate permissions
3. **After rotation**: Issue new tokens only with the new key
4. **Never mix**: Don't attempt to revoke old tokens with new keys

<!-- Source: Knowledge advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-knowledge.md lines 62-67 -->

## Related Resources

- [Token Revocation documentation](https://ably.com/docs/auth/revocation)
- [API Key Management](https://ably.com/docs/auth/api-key)
- [Authentication guide](https://ably.com/docs/auth)
- Related errors: [40162](https://help.ably.io/error/40162), [40164](https://help.ably.io/error/40164)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 40133
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40133-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md [No specific error-specific notes for 40133]
- Existing Documentation: None found - this is new documentation
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: Knowledge file advice on token tracking and key rotation from lines 56-67
- Content Excluded: Internal implementation details about TokenRevocation class
- Recommendations Source: 
  - Resolution steps based on knowledge file lines 34-54
  - Prevention advice from knowledge file lines 56-60
  - Key rotation guidance from knowledge file lines 62-67
- Code Examples Rationale: Simple example showing correct vs incorrect key usage pattern based on the validation logic
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on knowledge file lines 13-17
  - Cause 2: Based on knowledge file lines 18-22
  - Cause 3: Based on knowledge file lines 23-27
- Resolution Steps: 
  - Step 1: Knowledge file lines 34-38 - identifying token origin
  - Step 2: Analysis file lines 34-36 - validation logic showing key comparison
  - Step 3: Analysis file line 45 - reference to revocableTokens attribute check
  - Step 4: Knowledge file lines 50-54 - testing revocation
- Prevention: Based on knowledge file lines 56-60 - token tracking best practices
- Key Rotation: Knowledge file lines 62-67 - rotation scenarios
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40133
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40133 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->