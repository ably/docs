---
title: SDK setup
meta_description: "Install, authenticate and instantiate the Chat SDK."
---

Use these instructions to install, authenticate and instantiate the Chat SDK.

<Aside data-type='note'>
If you have any feedback or feature requests, [let us know](https://forms.gle/SmCLNFoRrYmkbZSf8)
</Aside>

## Authentication <a id="authentication"/>

An API key is required to authenticate with Ably. API keys are used either to authenticate directly with Ably using basic authentication, or to generate tokens for untrusted clients using [token authentication](/docs/auth/token).

<Aside data-type='important'>
The examples use basic authentication to demonstrate features for convenience. In your own applications, basic authentication should never be used on the client-side as it exposes your Ably API key. Instead, use token authentication.
</Aside>

[Sign up](https://ably.com/sign-up) to Ably to create an API key in the dashboard or use the [Control API](/docs/platform/account/control-api) to create an API key programmatically.

API keys and tokens have a set of [capabilities](/docs/auth/capabilities) assigned to them that specify which operations, such as subscribe or publish can be performed on which resources. To use the Chat SDK, the API key requires the following capabilities depending on which features are being used:

| Feature | Capabilities |
| ------- | ------------ |
| Send and receive messages | `publish`, `subscribe` |
| Update message | `message-update-any` or `message-update-own` |
| Delete message | `message-delete-any` or `message-delete-own` |
| Message history | `subscribe`, `history` |
| Message reactions | `annotation-publish`, optionally `annotation-subscribe` |
| Presence | `subscribe`, `presence` |
| Room occupancy | `subscribe`, `channel-metadata` |
| Typing indicators | `publish`, `subscribe` |
| Room reactions | `publish`, `subscribe` |

When setting the capabilities for Chat, you can apply them to specific chat rooms, a group of chat rooms in a common namespace, or all chat rooms:

* `my-chat-room` or
* `dms:*` or
* `*`

For more guidance, see the [capabilities documentation](/docs/auth/capabilities).

<If lang="javascript,react">

### User claims <a id="user-claims"/>

User claims enable you to attach server-signed metadata to a user's authentication token that is automatically included on all events they produce in a chat room. This metadata is set server-side via [JWT claims](/docs/auth/token#jwt) and cannot be modified by clients, making it suitable for trusted information such as display names, roles, or custom attributes.

User claims are scoped to individual chat rooms using the `ably.room.<roomName>` key in the JWT payload. The value is an arbitrary string, commonly a JSON-encoded object. When a user publishes a message, enters presence, sends a typing indicator, or sends a reaction in a matching room, the claim is automatically copied by Ably servers into the `userClaim` field of the event.

#### Set user claims in your JWT <a id="set-user-claims"/>

Include an `ably.room.<roomName>` key in your JWT claims when generating tokens on your server:

<Code>
```javascript
const claims = {
  'x-ably-capability': JSON.stringify({ '*': ['*'] }),
  'x-ably-clientId': 'user-123',
  'ably.room.my-chat-room': JSON.stringify({ display_name: 'Alice', role: 'moderator' }),
  iat: Math.floor(Date.now() / 1000),
  exp: Math.floor(Date.now() / 1000) + 3600,
};
```
</Code>

You can also use wildcard patterns to apply claims across multiple rooms:

| Pattern | Description |
| ------- | ----------- |
| `ably.room.my-chat-room` | Applies to the `my-chat-room` room only. |
| `ably.room.support:*` | Applies to all rooms in the `support` namespace. |
| `ably.room.*` | Applies to all rooms. |

When multiple patterns match a room, the most specific claim is used.

#### Read user claims from events <a id="read-user-claims"/>

The `userClaim` field is available on messages, presence members, typing events, room reactions, and message reactions. For example, to read the claim from a message:

<Code>
```javascript
room.messages.subscribe((event) => {
  const { userClaim } = event.message;
  if (userClaim) {
    const parsed = JSON.parse(userClaim);
    console.log(`Message from ${parsed.display_name} (${parsed.role})`);
  }
});
```

```react
import { useMessages } from '@ably/chat/react';

const MyComponent = () => {
  useMessages({
    listener: (event) => {
      const { userClaim } = event.message;
      if (userClaim) {
        const parsed = JSON.parse(userClaim);
        console.log(`Message from ${parsed.display_name} (${parsed.role})`);
      }
    },
  });

  return <div>...</div>;
};
```
</Code>

<Aside data-type='note'>
The `userClaim` value is always a string. If you encode a JSON object in the claim, you must parse it on the client. The value is only present if the publishing user's token contained a matching claim for the room.
</Aside>

</If>

## Install <a id="install"/>

The Chat SDK is built on top of the Ably Pub/Sub SDK and uses that to establish a connection with Ably.

<If lang="javascript,react">
### NPM <a id="npm"/>

Install the Pub/Sub SDK and the Chat SDK:

<Code>
```shell
npm install ably @ably/chat
```
</Code>

Import the SDKs into your project:

<Code>
```javascript
import * as Ably from 'ably';
import { ChatClient } from '@ably/chat';
```

```react
import * as Ably from 'ably';
import { ChatClient } from '@ably/chat';
import { ChatClientProvider } from '@ably/chat/react';
```
</Code>
</If>

<If lang="javascript">
### CDN <a id="cdn"/>

Reference the Pub/Sub SDK and the Chat SDK within your HTML file:

<Code>
```javascript
<script src="https://cdn.ably.com/lib/ably.min-2.js"></script>
<script src="https://cdn.ably.com/lib/ably-chat.umd.cjs-0.js"></script>
<script>
  const realtime = new Ably.Realtime({ key: '{{API_KEY}}', clientId: '<clientId>'});
  const chatClient = new AblyChat.ChatClient(realtime);
</script>
```
</Code>
</If>

<If lang="swift">
### Swift Package Manager <a id="spm"/>

The SDK is distributed as a Swift Package and can be installed using Xcode or by adding it as a dependency in your package's `Package.swift`.

To install the `ably-chat-swift` package in your Xcode Project:
  * Paste `https://github.com/ably/ably-chat-swift` in the Swift Packages search box (Xcode project → Swift Packages.. . → `+` button).
  * Select the Ably Chat SDK for your target.

To install the `ably-chat-swift` package in another Swift Package, add the following to your `Package.swift`:

<Code>
```swift
.package(url: "https://github.com/ably/ably-chat-swift", from: "1.0.0"),
```
</Code>

Import the SDK:

<Code>
```swift
import AblyChat
```
</Code>
</If>

<If lang="kotlin,android">
### Gradle <a id="gradle"/>

The Ably Chat SDK is available on the Maven Central Repository. To include the dependency in your project, add the following to your `build.gradle.kts` file:

<Code>
```kotlin
  implementation("com.ably.chat:chat:1.2.0")
```

```android
implementation("com.ably.chat:chat:1.2.0")
implementation("com.ably.chat:chat-extensions-compose:1.2.0")
```
</Code>

For groovy:

<Code>
```kotlin
  implementation 'com.ably.chat:chat:1.2.0'
```

```android
implementation 'com.ably.chat:chat:1.2.0'
implementation 'com.ably.chat:chat-extensions-compose:1.2.0'
```
</Code>
</If>

## Instantiate a client <a id="instantiate"/>

Instantiate a realtime client using the Pub/Sub SDK and pass the generated client into the Chat constructor. <If lang="react">**It is strongly recommended that you initialise the clients outside of the React component tree** to avoid creating unnecessary additional connections to Ably caused by re-renders.</If>

<If lang="react">
Pass the `ChatClient` into the [`ChatClientProvider`](https://sdk.ably.com/builds/ably/ably-chat-js/main/typedoc/functions/chat-react.ChatClientProvider.html). The `ChatClient` instance will be available to all child components in your React component tree.
</If>

<Code>
```javascript
import { LogLevel } from '@ably/chat'

const realtimeClient = new Ably.Realtime({ key: '{{API_KEY}}', clientId: '<clientId>'});
const chatClient = new ChatClient(realtimeClient, { logLevel: LogLevel.Error });
```

```react
import { LogLevel } from '@ably/chat'

const realtimeClient = new Ably.Realtime({ key: '{{API_KEY}}', clientId: '<clientId>'});
const chatClient = new ChatClient(realtimeClient, { logLevel: LogLevel.Error });

const App = () => {
  return (
    <ChatClientProvider client={chatClient}>
      <RestOfYourApp />
    </ChatClientProvider>
  );
};
```

```swift
let realtimeOptions = ARTClientOptions()
realtimeOptions.key = "{{API_KEY}}"
realtimeOptions.clientId = "<clientId>"
let realtime = ARTRealtime(options: realtimeOptions)
let chatClient = ChatClient(realtime: realtime)
```

```kotlin
import com.ably.chat.ChatClient
import io.ably.lib.realtime.AblyRealtime
import io.ably.lib.types.ClientOptions

val realtimeClient = AblyRealtime(
    ClientOptions().apply {
        key = "{{API_KEY}}"
        clientId = "<clientId>"
    },
)

val chatClient = ChatClient(realtimeClient)
```

```android
import com.ably.chat.ChatClient
import io.ably.lib.realtime.AblyRealtime
import io.ably.lib.types.ClientOptions

val realtimeClient = AblyRealtime(
    ClientOptions().apply {
        key = "{{API_KEY}}"
        clientId = "<clientId>"
    },
)

val chatClient = ChatClient(realtimeClient)
```
</Code>

A [`ClientOptions`](/docs/api/realtime-sdk#client-options) object may be passed to the Pub/Sub SDK instance to further customize the connection, however at a minimum you must set an API key and provide a `clientId` to ensure that the client is [identified](/docs/auth/identified-clients).

In many cases, a users unique application-specific identifier may be used as the `clientId` to provide consistent identification for clients across your application.

Additional options can also be passed to the Chat client to customize the following properties:

<If lang="javascript,react">

| Property | Description |
| -------- | ----------- |
| `logHandler` | The function to call for each line of [log output](#logging). The default is `console.log`. |
| `logLevel` | The verbosity of the [log output](#logging). Options are; `trace`, `debug`, `info`, `warn`, `error` or `silent`. The default is `error`. |

</If>

<If lang="swift">

| Property | Description |
| -------- | ----------- |
| `logHandler` | This is your own custom log handler conforming to the `LogHandler` protocol. A single `log` function is called for each line of [log output](#logging). The default implementation uses Swift's `Logger`. |
| `logLevel` | The verbosity of the [log output](#logging). Options are; `.trace`, `.debug`, `.info`, `.warn`, `.error` or `.silent`. The default is `.error`. |

</If>

<If lang="kotlin,android">

| Property | Description |
| -------- | ----------- |
| logHandler | This is your own custom log handler conforming to the `LogHandler` interface. A single `log` function is called for each line of [log output](#logging). The default implementation uses Android's `Log`. |
| logLevel | The verbosity of the [log output](#logging). Options are; `Trace`, `Debug`, `Info`, `Warn`, `Error` or `Silent`. The default is `Error`. |

</If>

## Logging <a id="logging"/>

Set the `logHandler` and `logLevel` properties when [instantiating a client](#instantiate) to configure your log handler:

<Code>
```javascript
const ably = new Ably.Realtime({ key: '{{API_KEY}}', clientId: '<clientId>'});
const chatClient = new ChatClient(ably, {logHandler: logWriteFunc, logLevel: 'debug' });
```

```react
import * as Ably from 'ably';
import { LogLevel } from '@ably/chat';
import { ChatClientProvider } from '@ably/chat/react';

const ably = new Ably.Realtime({ key: '{{API_KEY}}', clientId: '<clientId>'});
const chatClient = new ChatClient(ably, {logHandler: logWriteFunc, logLevel: 'debug' });

const App = () => {
  return (
    <ChatClientProvider client={chatClient}>
      <RestOfYourApp />
    </ChatClientProvider>
  );
};
```

```swift
let realtimeOptions = ARTClientOptions()
realtimeOptions.key = "{{API_KEY}}"
realtimeOptions.clientId = "<clientId>"
let realtime = ARTRealtime(options: realtimeOptions)
let clientOptions = ChatClientOptions(logHandler: SomeLogHandler(), logLevel: .debug)
return ChatClient(realtime: realtime, clientOptions: clientOptions)
```

```kotlin
val realtimeClient = AblyRealtime(
    ClientOptions().apply {
        key = "{{API_KEY}}"
        clientId = "<clientId>"
    },
)
val chatClient = ChatClient(realtimeClient) {
  logHandler = CustomLogHandler() // Implements com.ably.chat.LogHandler interface
  logLevel = LogLevel.Debug
}
```

```android
val realtimeClient = AblyRealtime(
    ClientOptions().apply {
        key = "{{API_KEY}}"
        clientId = "<clientId>"
    },
)
val chatClient = ChatClient(realtimeClient) {
    logHandler = CustomLogHandler() // Implements com.ably.chat.LogHandler interface
    logLevel = LogLevel.Debug
}
```
</Code>

<If lang="javascript,react">
The `logHandler` property is your own function that will be called for each line of log output generated by the Chat SDK.
</If>

<If lang="swift,kotlin,android">
The `logHandler` property is your custom `LogHandler` implementation that will be called for each line of log output generated by the Chat SDK.
</If>

The `logLevel` sets the verbosity of logs that will be output by the SDK. The following log levels are available to set:

| Level | Description |
| ----- | ----------- |
| `trace` | Something routine and expected has occurred. This level will provide logs for the vast majority of operations and function calls. |
| `debug` | Development information, messages that are useful when trying to debug library behavior, but superfluous to normal operation. |
| `info` | Informational messages. Operationally significant to the library but not out of the ordinary. |
| `warn` | Anything that is not immediately an error, but could cause unexpected behavior in the future. For example, passing an invalid value to an option. Indicates that some action should be taken to prevent future errors. |
| `error` | A given operation has failed and cannot be automatically recovered. The error may threaten the continuity of operation. |
| `silent` | No logging will be performed. |

## Dispose of the client <a id="dispose"/>

Use the <If lang="javascript,react">[`dispose()`](https://sdk.ably.com/builds/ably/ably-chat-js/main/typedoc/interfaces/chat-js.ChatClient.html#dispose)</If><If lang="swift">[`dispose()`](https://sdk.ably.com/builds/ably/ably-chat-swift/main/AblyChat/documentation/ablychat/chatclient/dispose%28%29)</If><If lang="kotlin,jetpack">[`dispose()`](https://sdk.ably.com/builds/ably/ably-chat-kotlin/main/dokka/chat/com.ably.chat/-chat-client/dispose.html)</If> method to release all resources associated with the chat client when you are done using it:

<Code>
```javascript
await chatClient.dispose();
```

```react
await chatClient.dispose();
```

```swift
await chatClient.dispose()
```

```kotlin
chatClient.dispose()
```

```jetpack
chatClient.dispose()
```
</Code>

Calling `dispose()` will:
- Release all rooms managed by the client
- Clean up connection listeners and timers
- Free internal resources

After calling `dispose()`, the client should not be used. Attempting to get a room after dispose has been called will throw an error. This method is idempotent, so calling it multiple times has no additional effect.

<Aside data-type='note'>
The `dispose()` method does not close the underlying Ably Realtime connection, as that connection is owned by the Pub/Sub client that was passed to the Chat client during instantiation. To close the connection, call `close()` on the Pub/Sub client directly.
</Aside>

