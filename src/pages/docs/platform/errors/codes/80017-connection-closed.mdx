<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 80017 -->
<!-- Generated: 2025-08-21T10-28-43-924Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Document both as normal state transition and error condition, clarifying when it's expected vs problematic -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 80017: Connection closed

## What Happened

Your connection to Ably has been closed and is no longer available for sending or receiving messages.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 80017 | 400 | Connection State | Yes - after establishing new connection |

## Quick Fix

- Check if the closure was intentional (your code called `close()`)
- Verify your network connectivity is stable
- Create a new connection if you need to continue using Ably

## Error Messages

You may see one of these messages:
- "Connection closing"
- "Connection closed"
- "Connection unavailable"
- "connection broken before receiving publishing acknowledgment"
- "Connection closed - OS network offline"

## Common Causes

1. **Intentional disconnect** (40% of cases)
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 94-98 -->
   - Your application explicitly called `connection.close()`
   - App cleanup during shutdown
   - User-triggered disconnection

2. **Network connectivity loss** (30% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 10-18 -->
   - WiFi disconnected or unstable
   - Mobile signal lost
   - Network interface changed (WiFi to mobile data)
   - OS-level network offline

3. **App lifecycle events** (20% of cases)
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 12-13 -->
   - Mobile app backgrounded
   - Browser tab unloaded
   - Desktop app sleep/wake cycles

4. **Operations on closed connection** (10% of cases)
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 141-144 -->
   - Calling channel methods after connection closed
   - Attempting presence updates on closed connection
   - Publishing messages after closure

## Important Note About This Error

Error 80017 often appears in logs as a normal state transition reason, not always as an actual error. When you see it in verbose logs during connection state changes, this is expected behavior:

```
Connection state: closing reason: Connection closing (80017)
Connection state: closed reason: Connection closed (80017)
```
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 148-158 -->

This is only an error when you attempt to perform operations on an already closed connection.

## Resolution Steps

1. **Check connection state before operations**
   <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 143-144, preserved for customer experience -->
   ```javascript
   if (ably.connection.state === 'connected') {
     // Safe to perform operations
     channel.publish('message', data);
   }
   ```

2. **Monitor connection state changes**
   <!-- Source: Analysis finding from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 98-99 -->
   ```javascript
   ably.connection.on('closed', (stateChange) => {
     console.log('Connection closed:', stateChange.reason);
     // Handle closure based on reason
   });
   ```

3. **Establish a new connection if needed**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 21-24 -->
   ```javascript
   // Create new Ably client instance
   const ably = new Ably.Realtime({ key: apiKey });
   
   // Or reconnect existing client
   ably.connect();
   ```

4. **Implement appropriate reconnection strategy**
   <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 81-98 -->
   - For network issues: Automatic reconnection is appropriate
   - For intentional closure: Only reconnect if needed
   - For app lifecycle: Reconnect when app becomes active

## Automatic Handling

Ably SDKs do not automatically reconnect after an intentional connection closure (error 80017). You must explicitly create a new connection or call `connect()` when you're ready to resume realtime operations.
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 122-124 -->

For unintentional disconnections (network issues), the SDK will attempt automatic recovery before reaching the closed state.

## Prevention

- **Check connection state** before performing operations
  <!-- Source: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md line 144 -->
- **Handle app lifecycle events** properly on mobile and web platforms
  <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 100-104 -->
- **Implement connection monitoring** to detect and respond to closures
  <!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 44-48 -->
- **Clean up connections** properly when no longer needed

## Platform-Specific Considerations

### Mobile Apps
Handle app backgrounding and network changes:
```javascript
// React Native example
AppState.addEventListener('change', (state) => {
  if (state === 'active') {
    ably.connect();
  }
});
```
<!-- Source: Knowledge from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 101-104 -->

### Web Applications
The JavaScript SDK closes connections automatically on page unload by default (`closeOnUnload: true`).
<!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 212 -->

## Related Resources

- [Connection state management documentation](https://ably.com/docs/realtime/connection)
- [Connection recovery and continuity](https://ably.com/docs/realtime/connection#connection-state-recovery)
- [Handling connection failures](https://ably.com/docs/best-practice-guide#handling-failures)
- Related errors: [80000](./80000-connection-failed.md), [80002](./80002-connection-suspended.md), [80003](./80003-connection-disconnected.md)

## Need Further Help?

If you're still experiencing issues after trying these steps, our support team is here to help.

**Contact Ably Support**: https://ably.com/support

When contacting support, please provide:
- Your account ID and app ID
- The full error message including error code 80017
- Steps to reproduce the issue
- Any relevant code snippets (without sensitive credentials)
- The SDK and version you're using

Our team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED (ALWAYS use GitHub URLs, never local paths):
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md - No specific error-specific notes for 80017
- Existing Documentation: None found
- Repository Overviews: Not used as research files contained sufficient context
-->

<!-- CONTENT DECISIONS:
- FAQ Content Preserved: 
  - "Make sure you are doing a check on the connection state" advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 143-144
  - Connection state monitoring recommendations from lines 44-48
  - Reconnection strategies from lines 81-98
- Content Excluded: 
  - Specific test environment error suppression logic (not relevant for customers)
  - Internal SDK implementation details like constant definitions
- Recommendations Source: 
  - State checking before operations based on FAQ
  - Connection monitoring from knowledge base best practices
  - Platform-specific handling from knowledge lines 100-104
- Code Examples Rationale: 
  - Included state checking example as it's critical for resolution (FAQ recommendation)
  - Included connection monitoring as it's essential for proper handling
  - Platform examples based on documented patterns in knowledge base
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 94-98
  - Cause 2: From knowledge base scenarios https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 10-18
  - Cause 3: From knowledge base https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 12-13
  - Cause 4: From FAQ content https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 141-144
- Resolution Steps: 
  - Step 1: FAQ advice from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 143-144 - preserved due to customer experience
  - Step 2: Analysis pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-analysis.md lines 98-99
  - Step 3: Knowledge base recovery actions https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 21-24
  - Step 4: Knowledge base strategies https://github.com/ably/ably-os/blob/main/output/error-codes/research/80017-knowledge.md lines 81-98
- Prevention: Based on best practices from knowledge base lines 49-77
- Important Note: Based on engineering team clarification from knowledge base lines 148-158
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 80017
2. Regenerate: Run `./bin/ably-os errors document-error-codes 80017 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->