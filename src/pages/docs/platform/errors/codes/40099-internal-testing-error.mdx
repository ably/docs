<!-- Generated by: ably-os errors document-error-codes -->
<!-- Repository: https://github.com/ably/ably-os -->
<!-- Command: ./bin/ably-os errors document-error-codes 40099 -->
<!-- Generated: 2025-08-21T17-17-40-434Z -->
<!-- Sources: 
     - Analysis: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md
     - Knowledge: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-knowledge.md
     - Editorial notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md
-->
<!-- Key Approach: Documenting an internal testing error that users might encounter in rare edge cases or development scenarios -->
<!-- Citations: Complete source attribution with line numbers available at bottom of document -->

# Error 40099: Internal Testing Error

## What Happened

The system encountered an internal testing or development error that should not occur during normal operations.

## Quick Reference

| Error Code | HTTP Status | Category | Retryable |
|------------|-------------|----------|-----------|
| 40099 | 400 | Client Error (Testing/Development) | No - indicates configuration or testing issue |

## Quick Fix

- Remove any `_forceNack` parameters from your requests
- Check if you're using undocumented testing parameters
- Review your message metadata structure if using advanced features

## Error Messages

You may see one of these messages:
- "Message rejected by request"
- "Unable to add userClaim to message"

## Common Causes

1. **Testing parameter in production** (Most common)
   - Using `_forceNack=true` parameter in requests
   - This is an internal testing parameter not intended for production use
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 22-30 -->

2. **Message metadata processing failure** (Rare)
   - Internal failure when adding user claims to message extras
   - Related to advanced message features
   <!-- Source: Analysis from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 16-21 -->

## Resolution Steps

1. **Check for testing parameters**
   - Review your publish requests for any `_forceNack` parameter
   - Remove this parameter as it's intended for internal testing only
   <!-- Source: Testing pattern identified in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 43-48 -->

2. **Review message structure**
   - If you're using advanced message features, verify your message structure
   - Ensure message extras and metadata are properly formatted
   <!-- Source: User claims pattern from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 50-54 -->

3. **For SDK testing**
   - If you're intentionally testing error handling, this error is expected
   - The `_forceNack` parameter deliberately triggers this error for testing purposes
   <!-- Source: SDK testing context from https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 33-40 -->

## Automatic Handling

This error is not automatically retried by Ably SDKs as it indicates either:
- Intentional testing behavior
- A structural issue with the request that requires correction

## Related Resources

- [Ably Pub/Sub Documentation](https://ably.com/docs/pubsub)
- [Message Structure Documentation](https://ably.com/docs/channels/messages)

## Need Further Help?

This error code has limited documentation as it's primarily used for internal testing. If you encounter this error during normal operations, please contact Ably support at https://ably.com/support with:
- Your account ID and app ID
- The full error message including error code 40099
- The exact request that triggered the error
- Any parameters you're using in your publish requests

Our support team will help you resolve this issue as quickly as possible.

<!-- =============================================== -->
<!-- INTERNAL DOCUMENTATION (NOT RENDERED) -->
<!-- =============================================== -->

<!-- SOURCES USED:
- Analysis File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md
- Knowledge File: https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-knowledge.md
- Editorial Notes: https://github.com/ably/ably-os/blob/main/src/prompts/errors/editorial-notes.md (No specific error-specific notes for 40099)
- Existing Documentation: None found
-->

<!-- CONTENT DECISIONS:
- Content Excluded: Detailed protobuf implementation details (too technical for customer docs)
- Recommendations Source: 
  - Testing parameter removal: Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 22-30
  - Message structure review: From user claims pattern in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 50-54
- Code Examples Rationale: No code examples included as this is primarily an internal error not meant for customer use
-->

<!-- ATTRIBUTION BY SECTION:
- Common Causes: 
  - Cause 1 (Testing parameter): Based on analysis findings in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 22-30, showing _forceNack parameter usage
  - Cause 2 (Message metadata): From Go implementation analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 16-21
- Resolution Steps: 
  - Step 1: Source from testing pattern analysis in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 43-48
  - Step 2: Based on user claims handling pattern in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 50-54
  - Step 3: From SDK testing context in https://github.com/ably/ably-os/blob/main/output/error-codes/research/40099-analysis.md lines 33-40
-->

<!-- DOCUMENTATION SHORTCOMINGS:
⚠️ Areas where Ably documentation could be improved:
- Missing: Documentation of the user claims feature and message extras structure
- Impact: Users encountering the "unable to add userClaim to message" variant have no reference
- Recommendation: Document the message extras and user claims features if they're customer-facing
- Severity: Low (this appears to be an internal feature)
-->

<!-- IMPROVEMENT INSTRUCTIONS:
To improve this error code documentation:
1. First approach: Update editorial-notes.md in ably-os repository with specific guidance for error 40099
2. Regenerate: Run `./bin/ably-os errors document-error-codes 40099 --force`
3. For broader improvements: Review and update ably-os prompt templates
4. Context: See https://github.com/ably/ably-os/blob/main/docs/ERROR_COMMANDS_GUIDE.md
5. Source repository: https://github.com/ably/ably-os
-->