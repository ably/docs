{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "verification.schema.json",
  "title": "Verification Output",
  "description": "Output from a verification sub-agent for a single MDX file",
  "type": "object",
  "required": ["file", "verifiedAt", "examples"],
  "examples": [
    {
      "file": "src/pages/docs/example.mdx",
      "verifiedAt": "2026-01-30T11:00:00Z",
      "examples": [
        {
          "id": "example-1",
          "lineNumber": 45,
          "original": { "language": "javascript", "code": "const result = await channel.publish('greeting', 'hello');" },
          "translation": { "language": "swift", "code": "channel.publish(\"greeting\", data: \"hello\") { error in\n    // ...\n}" },
          "harness": {
            "functionSignature": "func example(channel: ARTRealtimeChannel) async throws",
            "stubTypes": null,
            "fullContext": "import Ably\n\nfunc example(channel: ARTRealtimeChannel) async throws {\n    // example code here\n}"
          },
          "compilation": { "status": "pass" },
          "faithfulness": { "rating": "faithful", "notes": null }
        }
      ]
    }
  ],
  "properties": {
    "file": {
      "type": "string",
      "description": "Path to the MDX file that was verified",
      "examples": ["src/pages/docs/messages/streaming.mdx"]
    },
    "verifiedAt": {
      "type": "string",
      "description": "ISO 8601 timestamp when verification was completed",
      "examples": ["2026-01-30T11:00:00Z"]
    },
    "examples": {
      "type": "array",
      "description": "Verification results for each example",
      "items": {
        "type": "object",
        "required": ["id", "lineNumber", "original", "translation", "harness", "compilation", "faithfulness"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier extracted from the harness comment in the MDX",
            "examples": ["streaming-1", "citations-2"]
          },
          "lineNumber": {
            "type": "integer",
            "minimum": 1,
            "description": "Line number of the code block in the MDX file",
            "examples": [45, 105]
          },
          "original": {
            "type": "object",
            "required": ["language", "code"],
            "properties": {
              "language": {
                "type": "string",
                "const": "javascript"
              },
              "code": {
                "type": "string",
                "description": "Original JavaScript code extracted from MDX"
              }
            }
          },
          "translation": {
            "type": "object",
            "required": ["language", "code"],
            "properties": {
              "language": {
                "type": "string",
                "const": "swift"
              },
              "code": {
                "type": "string",
                "description": "Swift translation extracted from MDX"
              }
            }
          },
          "harness": {
            "type": "object",
            "required": ["functionSignature", "fullContext"],
            "properties": {
              "functionSignature": {
                "type": "string",
                "description": "Function signature extracted from MDX harness comment"
              },
              "stubTypes": {
                "type": ["string", "null"],
                "description": "Stub type declarations if any"
              },
              "fullContext": {
                "type": "string",
                "description": "Full compilable context including imports and function wrapper"
              }
            }
          },
          "compilation": {
            "type": "object",
            "required": ["status"],
            "properties": {
              "status": {
                "type": "string",
                "enum": ["pass", "fail"],
                "description": "Whether the code compiled successfully"
              },
              "errorMessage": {
                "type": "string",
                "description": "Compiler error message if compilation failed"
              }
            }
          },
          "faithfulness": {
            "type": "object",
            "required": ["rating"],
            "properties": {
              "rating": {
                "type": "string",
                "enum": ["faithful", "minor_differences", "significant_deviation", "not_assessed"],
                "description": "Assessment of how faithful the translation is to the original"
              },
              "notes": {
                "type": ["string", "null"],
                "description": "Explanation of differences if any"
              }
            }
          }
        }
      }
    }
  }
}
